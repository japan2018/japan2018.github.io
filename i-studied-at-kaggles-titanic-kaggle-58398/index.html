<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>I studied at Kaggle&#39;s Titanic (kaggle②) | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>I studied at Kaggle&rsquo;s Titanic (kaggle②)</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 10, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/machine-learning"> machine learning</a></code></small>


<small><code><a href="https://memotut.com/tags/kaggle"> Kaggle</a></code></small>

</p>
<pre><code>#Introduction
</code></pre>
<p>This is the story of participating in the <b>Kaggle</b> competition for the first time.
<a href="https://qiita.com/sudominoru/private/0290b09c6a9cfabd7d20">Last time &ldquo;First Kaggle&rdquo;</a>
・How to join Kaggle
・How to participate in the competition
・Join and write code
・How to submit the results
I wrote mainly.
This time I would like to proceed to the point where I will study at the &ldquo;Titanic competition&rdquo;.
Is it possible to exceed the correct rate &ldquo;76%&rdquo; in the sample code?</p>
<p>#table of contents</p>
<ol>
<li>Prerequisite knowledge</li>
<li>Flow of learning</li>
<li>Maintain data
3.1. Extract required items
3.2. Handling missing values
3.3. Digitize the label
3.4. Standardize numerical values</li>
<li>Build the model</li>
<li>Learn with training data</li>
<li>Predict results with test data</li>
<li>Submitted result</li>
<li>Summary
History</li>
</ol>
<p>#1. prerequisite knowledge</p>
<p>It&rsquo;s about how much a person who knows machine learning describes it.
About 6 months ago (April 2019), I was interested in machine learning and learned mainly from the following books.
・<a href="https://www.amazon.co.jp/Python-%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0-%E9%81%94%E4%BA%BA%E3%83%87%E3%83%BC%E3%82%BF%E3%82%B5%E3%82%A4%E3%82%A8%E3%83%B3%E3%83%86%E3%82%A3%E3%82%B9%E3%83%88%E3%81%AB%E3%82%88%E3%82%8B%E7%90%86%E8%AB%96%E3%81%A8%E5%AE%9F%E8%B7%B5-impress-gear/dp/4295003379/ref=dp_ob_title_bk">Theory and practice by Python machine learning programming expert data scientist</a>
・<a href="https://www.amazon.co.jp/%E8%A9%B3%E8%A7%A3-%E3%83%87%E3%82%A3%E3%83%BC%E3%83%97%E3%83%A9%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0-TensorFlow%E3%83%BBKeras%E3%81%AB%E3%82%88%E3%82%8B%E6%99%82%E7%B3%BB%E5%88%97%E3%83%87%E3%83%BC%E3%82%BF%E5%87%A6%E7%90%86-%E5%B7%A3%E7%B1%A0-%E6%82%A0%E8%BC%94/dp/4839962510/ref=sr_1_2?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&amp;keywords=%E8%A9%B3%E8%A7%A3+%E3%83%87%E3%82%A3%E3%83%BC%E3%83%97%E3%83%A9%E3%83%BC%E3%83%8B%E3%83%B3%E3%82%B0+%7ETensorFlow%E3%83%BBKeras%E3%81%AB%E3%82%88%E3%82%8B%E6%99%82%E7%B3%BB%E5%88%97%E3%83%87%E3%83%BC%E3%82%BF%E5%87%A6%E7%90%86&amp;qid=1575853564&amp;s=books&amp;sr=1-2">Detailed description Deep learning ~Time series data processing by TensorFlow/Keras~</a></p>
<p>It&rsquo;s a situation where it&rsquo;s hard to understand what &ldquo;scikit-learn&rdquo;, &ldquo;tensorflow&rdquo;, and &ldquo;keras&rdquo; mean, but I don&rsquo;t know.</p>
<p>The image that I understand is as follows.</p>
<ul>
<li>scikit-learn has few parameters and can learn easily (processing speed is fast)</li>
<li>keras is a group of machine learning libraries that run on tensorflow. It can be set more finely than scikit-learn. (Keras seems to work on other than tensorflow, but I don&rsquo;t know the details. Theano?)</li>
<li>tensorflow is a group of libraries for machine learning, but this library is close to a container. You can handle &ldquo;constants&rdquo;, &ldquo;variables&rdquo;, and &ldquo;placeholders&rdquo; that are convenient for machine learning, but if you only use tensorflow, you need to create your own &ldquo;activation function&rdquo; and &ldquo;evaluation function&rdquo;.</li>
</ul>
<p>At my level, I can write a learning code using scikit-learn or keras.</p>
<p>#2. Learning flow</p>
<p>The flow of machine learning is as follows.</p>
<ol>
<li>Maintain data</li>
<li>Build the model</li>
<li>Learn with training data</li>
<li>Predict results with test data</li>
</ol>
<p>#3. Maintain data</p>
<p>Check and maintain the data.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/545343/56a87f65-cee4-89c2-3f94-f59e734e3858.png" alt="20191209_01.png"></p>
<p>First of all, since we will start with a new notebook different from the previous time, click &ldquo;New Notebook&rdquo; and select the language &ldquo;Paython&rdquo;, Type &ldquo;Notebook&rdquo; as before.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/545343/b76fbc4b-389d-9cc3-2f95-1159c4d9dbac.png" alt="20191209_02.png"></p>
<p>Check train.csv.
Since you can write the code, you can output the data with the pandas.head() command, but you can also download it, so let&rsquo;s download it.
Click train.csv to display 100 lines of data on the screen. You can download it with the download button.</p>
<table>
<thead>
<tr>
<th align="left">PassengerId</th>
<th align="left">Survived</th>
<th align="left">Pclass</th>
<th align="left">Name</th>
<th align="left">Sex</th>
<th align="left">Age</th>
<th align="left">SibSp</th>
<th align="left">Parch</th>
<th align="left">Ticket</th>
<th align="left">Fare</th>
<th align="left">Cabin</th>
<th align="left">Embarked</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">3</td>
<td align="left">Braund,</td>
<td align="left">male</td>
<td align="left">22</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">A/5 21171</td>
<td align="left">7.25</td>
<td align="left"></td>
<td align="left">S</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">Cumings,</td>
<td align="left">female</td>
<td align="left">38</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">PC 17599</td>
<td align="left">71.2833</td>
<td align="left">C85</td>
<td align="left">C</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">1</td>
<td align="left">3</td>
<td align="left">Heikkinen,</td>
<td align="left">female</td>
<td align="left">26</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">STON/O2. 3101282</td>
<td align="left">7.925</td>
<td align="left"></td>
<td align="left">S</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">Futrelle,</td>
<td align="left">female</td>
<td align="left">35</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">113803</td>
<td align="left">53.1</td>
<td align="left">C123</td>
<td align="left">S</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">0</td>
<td align="left">3</td>
<td align="left">Allen,</td>
<td align="left">male</td>
<td align="left">35</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">373450</td>
<td align="left">8.05</td>
<td align="left"></td>
<td align="left">S</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">0</td>
<td align="left">3</td>
<td align="left">Moran,</td>
<td align="left">male</td>
<td align="left"></td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">330877</td>
<td align="left">8.4583</td>
<td align="left"></td>
<td align="left">Q</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">McCarthy</td>
<td align="left">male</td>
<td align="left">54</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">17463</td>
<td align="left">51.8625</td>
<td align="left">E46</td>
<td align="left">S</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">0</td>
<td align="left">3</td>
<td align="left">Palsson,</td>
<td align="left">male</td>
<td align="left">2</td>
<td align="left">3</td>
<td align="left">1</td>
<td align="left">349909</td>
<td align="left">21.075</td>
<td align="left"></td>
<td align="left">S</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">1</td>
<td align="left">3</td>
<td align="left">Johnson,</td>
<td align="left">female</td>
<td align="left">27</td>
<td align="left">0</td>
<td align="left">2</td>
<td align="left">347742</td>
<td align="left">11.1333</td>
<td align="left"></td>
<td align="left">S</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">Nasser,</td>
<td align="left">female</td>
<td align="left">14</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">237736</td>
<td align="left">30.0708</td>
<td align="left"></td>
<td align="left">C</td>
</tr>
</tbody>
</table>
<p>Check the CSV with Excel etc.
There are explanations in Data of the competition, although there are some items that I do not understand well.
As an aside, as described in OverView, it seems that the sample &ldquo;gender_submission.csv&rdquo; considers that &ldquo;only women survived&rdquo;. Certainly, the values of &ldquo;Sex&rdquo; in &ldquo;test.csv&rdquo; and &ldquo;Survived&rdquo; in &ldquo;gender_submission.csv&rdquo; match. Therefore, the correct answer rate of &ldquo;76%&rdquo; is quite formidable.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/545343/8c946031-5a2d-126c-eff4-3f0e878a5e8a.png" alt="20191209_03.png">
Data Dictionary</p>
<table>
<thead>
<tr>
<th align="left">Variable</th>
<th align="left">Definition</th>
<th align="left">Translate</th>
<th align="left">Key</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">survival</td>
<td align="left">Survival</td>
<td align="left">Survival</td>
<td align="left">0 = No, 1 = Yes</td>
</tr>
<tr>
<td align="left">pclass</td>
<td align="left">Ticket class</td>
<td align="left">Ticket class</td>
<td align="left">1 = 1st, 2 = 2nd, 3 = 3rd</td>
</tr>
<tr>
<td align="left">sex</td>
<td align="left">Sex</td>
<td align="left">gender</td>
<td></td>
</tr>
<tr>
<td align="left">Age</td>
<td align="left">Age in years</td>
<td align="left">Age</td>
<td></td>
</tr>
<tr>
<td align="left">sibsp</td>
<td align="left"># of siblings / spouses aboard the Titanic</td>
<td align="left">Number of siblings/spouse on the Titanic</td>
<td></td>
</tr>
<tr>
<td align="left">parch</td>
<td align="left"># of parents / children aboard the Titanic</td>
<td align="left">Number of parents/children on the Titanic</td>
<td></td>
</tr>
<tr>
<td align="left">ticket</td>
<td align="left">Ticket number</td>
<td align="left">Ticket number</td>
<td></td>
</tr>
<tr>
<td align="left">fare</td>
<td align="left">Passenger fare</td>
<td align="left">Passenger fare</td>
<td></td>
</tr>
<tr>
<td align="left">cabin</td>
<td align="left">Cabin number</td>
<td align="left">Room number</td>
<td></td>
</tr>
<tr>
<td align="left">embarked</td>
<td align="left">Port of Embarkation</td>
<td align="left">Embarkation Port</td>
<td align="left">C = Cherbourg, Q = Queenstown, S = Southampton</td>
</tr>
</tbody>
</table>
<p>Consider which item to use for learning.
This is the part where &ldquo;Survival&rdquo; is being asked, so I will use it as an answer for learning.
&ldquo;Gender&rdquo; and &ldquo;age&rdquo; are used because women and children are more likely to get on a lifeboat.
In addition, depending on the situation, it is possible that the wealth level affected. Let&rsquo;s also use &ldquo;Ticket Class&rdquo; and &ldquo;Passenger Fares&rdquo;.
&ldquo;Name&rdquo;, &ldquo;Ticket number&rdquo;, and &ldquo;Boarding port&rdquo; are not relevant, so they are excluded.
The problem is &ldquo;sibsp&rdquo; and &ldquo;parch&rdquo;.
After summarizing &ldquo;sibsp&rdquo; and &ldquo;parch&rdquo; with Excel etc., the results are as follows.
It seems to be related, but I excluded it for simplicity this time.</p>
<h4 id="sibsp-number-of-siblingsspouse-on-the-titanic">sibsp (Number of siblings/spouse on the Titanic)</h4>
<table>
<thead>
<tr>
<th align="left">sibsp value</th>
<th align="left">Survival=1</th>
<th align="left">Survival=0</th>
<th align="left">survival rate</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0</td>
<td align="left">210</td>
<td align="left">608</td>
<td align="left">26%</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">112</td>
<td align="left">209</td>
<td align="left">35%</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">13</td>
<td align="left">28</td>
<td align="left">32%</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">4</td>
<td align="left">16</td>
<td align="left">20%</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">3</td>
<td align="left">18</td>
<td align="left">14%</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">0</td>
<td align="left">5</td>
<td align="left">0%</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">0</td>
<td align="left">7</td>
<td align="left">0%</td>
</tr>
</tbody>
</table>
<h4 id="parch-number-of-parentschildren-on-the-titanic">parch (Number of parents/children on the Titanic)</h4>
<table>
<thead>
<tr>
<th align="left">parch value</th>
<th align="left">Survival=1</th>
<th align="left">Survival=0</th>
<th align="left">Survival</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0</td>
<td align="left">233</td>
<td align="left">678</td>
<td align="left">26%</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">65</td>
<td align="left">118</td>
<td align="left">36%</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">40</td>
<td align="left">80</td>
<td align="left">33%</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">3</td>
<td align="left">5</td>
<td align="left">38%</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">0</td>
<td align="left">4</td>
<td align="left">0%</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">1</td>
<td align="left">5</td>
<td align="left">17%</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0%</td>
</tr>
</tbody>
</table>
<h2 id="31-extract-required-items">3.1. Extract required items</h2>
<p>Delete the sample code and write the following code.
Load train.csv and extract only the necessary items (&lsquo;Survived&rsquo;,&lsquo;Pclass&rsquo;,&lsquo;Sex&rsquo;,&lsquo;Age&rsquo;,&lsquo;Fare&rsquo;).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> numpy
<span style="color:#f92672">import</span> pandas<span style="color:#75715e">##############################</span>
<span style="color:#75715e"># Data preprocessing 1</span>
<span style="color:#75715e"># Extract required items</span>
<span style="color:#75715e">##############################</span>

<span style="color:#75715e"># load train.csv</span>
df_train <span style="color:#f92672">=</span> pandas<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;/kaggle/input/titanic/train.csv&#39;</span>)

df_train <span style="color:#f92672">=</span> df_train<span style="color:#f92672">.</span>loc[:, [<span style="color:#e6db74">&#39;Survived&#39;</span>,<span style="color:#e6db74">&#39;Pclass&#39;</span>,<span style="color:#e6db74">&#39;Sex&#39;</span>,<span style="color:#e6db74">&#39;Age&#39;</span>,<span style="color:#e6db74">&#39;Fare&#39;</span>]]
df_train<span style="color:#f92672">.</span>head()
</code></pre></div><table>
<thead>
<tr>
<th align="left">index</th>
<th align="left">Survived</th>
<th align="left">Pclass</th>
<th align="left">Sex</th>
<th align="left">Age</th>
<th align="left">Fare</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">3</td>
<td align="left">male</td>
<td align="left">22</td>
<td align="left">7.25</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">female</td>
<td align="left">38</td>
<td align="left">71.2833</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">3</td>
<td align="left">female</td>
<td align="left">26</td>
<td align="left">7.925</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">female</td>
<td align="left">35</td>
<td align="left">53.1</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">0</td>
<td align="left">3</td>
<td align="left">male</td>
<td align="left">35</td>
<td align="left">8.05</td>
</tr>
</tbody>
</table>
<p>I was able to extract only the necessary items.</p>
<h2 id="32-handling-missing-values">3.2. Handling missing values</h2>
<p>Check for missing values.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">##############################</span>
<span style="color:#75715e"># Data preprocessing 2</span>
<span style="color:#75715e"># Handle missing values</span>
<span style="color:#75715e">##############################</span>

<span style="color:#75715e">#Check for missing values</span>
df_train<span style="color:#f92672">.</span>isnull()<span style="color:#f92672">.</span>sum()
</code></pre></div><table>
<thead>
<tr>
<th align="left">Column</th>
<th align="left">count</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Survived</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">Pclass</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">Sex</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">Age</td>
<td align="left">177</td>
</tr>
<tr>
<td align="left">Fare</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<p>There are many data without age.
Fill in missing values if possible, but this time remove them.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Delete rows with age null</span>
<span style="color:#75715e"># Delete rows with null age</span>
df_train <span style="color:#f92672">=</span> df_train<span style="color:#f92672">.</span>dropna(subset<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Age&#39;</span>])<span style="color:#f92672">.</span>reset_index(drop<span style="color:#f92672">=</span>True)
len(df_train)
</code></pre></div><table>
<thead>
<tr>
<th align="left">Count</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">714</td>
</tr>
</tbody>
</table>
<p>Rows with a null age have been deleted.</p>
<h2 id="33-digitize-the-label">3.3. Digitize the label</h2>
<p>Gender &ldquo;male&rdquo; and &ldquo;female&rdquo; are difficult to handle as they are, so we will digitize them.
There are only two types, male and female, so you may convert it yourself, but scikit-learn provides a convenient class <b>LabelEncoder</b>, so I will try using it.
LabelEncoder: When the fit method and the fit_transform method have N kinds of character strings appearing in the input, each replaces the character string with an integer from 0 to N-1.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">##############################</span>
<span style="color:#75715e"># Data preprocessing 3</span>
<span style="color:#75715e"># Quantify the label (name)</span>
<span style="color:#75715e">##############################</span>
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> LabelEncoder

<span style="color:#75715e"># Quantify gender by using LabelEncoder</span>
encoder <span style="color:#f92672">=</span> LabelEncoder()
df_train[<span style="color:#e6db74">&#39;Sex&#39;</span>] <span style="color:#f92672">=</span> encoder<span style="color:#f92672">.</span>fit_transform(df_train[<span style="color:#e6db74">&#39;Sex&#39;</span>]<span style="color:#f92672">.</span>values)
df_train<span style="color:#f92672">.</span>head()
</code></pre></div><table>
<thead>
<tr>
<th align="left">index</th>
<th align="left">Survived</th>
<th align="left">Pclass</th>
<th align="left">Sex</th>
<th align="left">Age</th>
<th align="left">Fare</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">3</td>
<td align="left">1</td>
<td align="left">22</td>
<td align="left">7.25</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">38</td>
<td align="left">71.2833</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">3</td>
<td align="left">0</td>
<td align="left">26</td>
<td align="left">7.925</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">35</td>
<td align="left">53.1</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">0</td>
<td align="left">3</td>
<td align="left">1</td>
<td align="left">35</td>
<td align="left">8.05</td>
</tr>
</tbody>
</table>
<p>&ldquo;Sex&rdquo; has been digitized.
This encoder will also be used later to quantify sex in test.csv.</p>
<h2 id="34-standardize-numbers">3.4. Standardize numbers</h2>
<p>It seems that there are many cases in which it is possible to learn better by matching (standardizing) the scale rather than inputting the numerical values as learning data.
For example, when analyzing test results, is it easier to understand by using deviation values than by using scores (maximum 100 points, maximum 200 points)?
Let&rsquo;s standardize &ldquo;age&rdquo; and &ldquo;fare&rdquo;.
Similar to label encoding, standardization has a convenient class for scikit-learn. <b>StandardScaler</b>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">##############################</span>
<span style="color:#75715e">#Data preprocessing 4</span>
<span style="color:#75715e"># Standardize numbers</span>
<span style="color:#75715e"># Data preprocessing 4</span>
<span style="color:#75715e"># Standardize numbers</span>
<span style="color:#75715e">##############################</span>
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> StandardScaler

<span style="color:#75715e"># Standardization</span>
<span style="color:#75715e"># Standardize numbers</span>
standard <span style="color:#f92672">=</span> StandardScaler()
df_train_std <span style="color:#f92672">=</span> pandas<span style="color:#f92672">.</span>DataFrame(standard<span style="color:#f92672">.</span>fit_transform(df_train<span style="color:#f92672">.</span>loc[:, [<span style="color:#e6db74">&#39;Age&#39;</span>,<span style="color:#e6db74">&#39;Fare&#39;</span>]]), columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Age&#39;</span>,<span style="color:#e6db74">&#39;Fare&#39;</span>])

Standardize <span style="color:#75715e"># Age</span>
<span style="color:#75715e"># Standardize Age</span>
df_train[<span style="color:#e6db74">&#39;Age&#39;</span>] <span style="color:#f92672">=</span> df_train_std[<span style="color:#e6db74">&#39;Age&#39;</span>]

<span style="color:#75715e"># Fare standardized</span>
<span style="color:#75715e"># Standardize Fare</span>
df_train[<span style="color:#e6db74">&#39;Fare&#39;</span>] <span style="color:#f92672">=</span> df_train_std[<span style="color:#e6db74">&#39;Fare&#39;</span>]

df_train<span style="color:#f92672">.</span>head()
</code></pre></div><table>
<thead>
<tr>
<th align="left">index</th>
<th align="left">Survived</th>
<th align="left">Pclass</th>
<th align="left">Sex</th>
<th align="left">Age</th>
<th align="left">Fare</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">3</td>
<td align="left">1</td>
<td align="left">-0.530376641</td>
<td align="left">-0.518977865</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0.571830994</td>
<td align="left">0.69189675</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">3</td>
<td align="left">0</td>
<td align="left">-0.254824732</td>
<td align="left">-0.506213563</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0.365167062</td>
<td align="left">0.348049152</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">0</td>
<td align="left">3</td>
<td align="left">1</td>
<td align="left">0.365167062</td>
<td align="left">-0.503849804</td>
</tr>
</tbody>
</table>
<p>Ages and fares have been standardized.
Up to this point, data preparation has been completed.</p>
<h1 id="4-build-the-model">4. Build the model</h1>
<p>Once the data is ready, we can move on to model building.
For the time being, let&rsquo;s build with sckit-learn.
The following is the algorithm selection flowchart on the sckit-learn site.</p>
<p><img src="https://scikit-learn.org/stable/_static/ml_map.png" alt="ml_map.png"></p>
<p>Let&rsquo;s select a model according to this flowchart.
&ldquo;Categorization&rdquo; YES ⇒ &ldquo;With label data&rdquo; Yes, go to &ldquo;classification&rdquo; on the upper left.
I think it corresponds to &ldquo;classification and supervised learning&rdquo;.
It became &ldquo;Linear SVC&rdquo; in the chart.</p>
<p>When learning, divide the data to be learned (=x_train) and the answer (=y_train) into the model.
The image is as follows.</p>
<table>
<tr>
  <th></th>
  <th style="text-align: center">y_train</th>
  <th colspan="4" style="text-align: center">x_train</th>
</tr>
<tr>
  <th>index</th>
  <th>Survived</th>
  <th>Pclass</th>
  <th>Sex</th>
  <th>Age</th>
  <th>Fare</th>
</tr>
<tr>
  <td>0</td>
  <td>0</td>
  <td>3</td>
  <td>1</td>
  <td>-0.530376641</td>
  <td>-0.518977865</td>
</tr>
<tr>
  <td>1</td>
  <td>1</td>
  <td>1</td>
  <td>0</td>
  <td>0.571830994</td>
  <td>0.69189675</td>
</tr>
<tr>
  <td>2</td>
  <td>1</td>
  <td>3</td>
  <td>0</td>
  <td>-0.254824732</td>
  <td>-0.506213563</td>
</tr>
<tr>
  <td>3</td>
  <td>1</td>
  <td>1</td>
  <td>0</td>
  <td>0.365167062</td>
  <td>0.348049152</td>
</tr>
<tr>
  <td>4</td>
  <td>0</td>
  <td>3</td>
  <td>1</td>
  <td>0.365167062</td>
  <td>-0.503849804</td>
</tr>
</table>
<p>The code is below.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">##############################</span>
<span style="color:#75715e"># Build the model</span>
<span style="color:#75715e">##############################</span>
<span style="color:#f92672">from</span> sklearn.svm <span style="color:#f92672">import</span> LinearSVC

<span style="color:#75715e">#Prepare training data</span>
x_train <span style="color:#f92672">=</span> df_train<span style="color:#f92672">.</span>loc[:, [<span style="color:#e6db74">&#39;Pclass&#39;</span>,<span style="color:#e6db74">&#39;Sex&#39;</span>,<span style="color:#e6db74">&#39;Age&#39;</span>,<span style="color:#e6db74">&#39;Fare&#39;</span>]]<span style="color:#f92672">.</span>values
y_train <span style="color:#f92672">=</span> df_train<span style="color:#f92672">.</span>loc[:, [<span style="color:#e6db74">&#39;Survived&#39;</span>]]<span style="color:#f92672">.</span>values

Delete the dimension of <span style="color:#75715e">#y_train</span>
y_train <span style="color:#f92672">=</span> numpy<span style="color:#f92672">.</span>reshape(y_train,(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>))

<span style="color:#75715e"># Generate model</span>
model <span style="color:#f92672">=</span> LinearSVC(random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</code></pre></div><h1 id="5-learn-with-training-data">5. Learn with training data</h1>
<p>Training simply passes the training data to the model.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">##############################</span>
<span style="color:#75715e">#Learning</span>
<span style="color:#75715e">##############################</span>
model<span style="color:#f92672">.</span>fit(x_train, y_train)
</code></pre></div><h1 id="6-expect-results-with-test-data">6. Expect results with test data</h1>
<p>Let&rsquo;s see the result of learning with test data.
You need to make test.csv similar to the training data (x_train).
There are age and fare deficiencies, but even if they are deficient, the results must be predicted.
In case of test data, it is converted to &ldquo;0&rdquo; without deleting.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">##############################</span>
<span style="color:#75715e"># convert test.csv</span>
<span style="color:#75715e"># convert test.csv</span>
<span style="color:#75715e">##############################</span>
<span style="color:#75715e"># load test.csv</span>
<span style="color:#75715e"># Load test.csv</span>
df_test <span style="color:#f92672">=</span> pandas<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;/kaggle/input/titanic/test.csv&#39;</span>)

Extract <span style="color:#75715e">#&#39;PassengerId&#39; (to combine with result)</span>
df_test_index <span style="color:#f92672">=</span> df_test<span style="color:#f92672">.</span>loc[:, [<span style="color:#e6db74">&#39;PassengerId&#39;</span>]]

<span style="color:#75715e"># Extract&#39;Survived&#39;,&#39;Pclass&#39;,&#39;Sex&#39;,&#39;Age&#39;,&#39;Fare&#39;</span>
<span style="color:#75715e"># Extract&#39;Survived&#39;,&#39;Pclass&#39;,&#39;Sex&#39;,&#39;Age&#39;,&#39;Fare&#39;df_test = df_test.loc[:, [&#39;Pclass&#39;,&#39;Sex&#39;,&#39;Age&#39;,&#39;Fare&#39;]]</span>

<span style="color:#75715e"># Quantify gender by using LabelEncoder</span>
<span style="color:#75715e"># Digitize gender using LabelEncoder</span>
df_test[<span style="color:#e6db74">&#39;Sex&#39;</span>] <span style="color:#f92672">=</span> encoder<span style="color:#f92672">.</span>transform(df_test[<span style="color:#e6db74">&#39;Sex&#39;</span>]<span style="color:#f92672">.</span>values)

df_test_std <span style="color:#f92672">=</span> pandas<span style="color:#f92672">.</span>DataFrame(standard<span style="color:#f92672">.</span>transform(df_test<span style="color:#f92672">.</span>loc[:, [<span style="color:#e6db74">&#39;Age&#39;</span>,<span style="color:#e6db74">&#39;Fare&#39;</span>]]), columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Age&#39;</span>,<span style="color:#e6db74">&#39;Fare&#39;</span>])

Standardize <span style="color:#75715e"># Age</span>
<span style="color:#75715e"># Standardize Age</span>
df_test[<span style="color:#e6db74">&#39;Age&#39;</span>] <span style="color:#f92672">=</span> df_test_std[<span style="color:#e6db74">&#39;Age&#39;</span>]

<span style="color:#75715e"># Fare standardized</span>
<span style="color:#75715e"># Standardize Fare</span>
df_test[<span style="color:#e6db74">&#39;Fare&#39;</span>] <span style="color:#f92672">=</span> df_test_std[<span style="color:#e6db74">&#39;Fare&#39;</span>]

Convert Nan <span style="color:#f92672">in</span> <span style="color:#75715e"># Age, Fare to 0</span>
<span style="color:#75715e"># Convert Age and Fare Nan to 0</span>
df_test <span style="color:#f92672">=</span> df_test<span style="color:#f92672">.</span>fillna({<span style="color:#e6db74">&#39;Age&#39;</span>:<span style="color:#ae81ff">0</span>,<span style="color:#e6db74">&#39;Fare&#39;</span>:<span style="color:#ae81ff">0</span>})

df_test<span style="color:#f92672">.</span>head()
</code></pre></div><table>
<thead>
<tr>
<th align="left">Index</th>
<th align="left">Pclass</th>
<th align="left">Sex</th>
<th align="left">Age</th>
<th align="left">Fare</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0</td>
<td align="left">3</td>
<td align="left">1</td>
<td align="left">0.298549339</td>
<td align="left">-0.497810518</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">3</td>
<td align="left">0</td>
<td align="left">1.181327932</td>
<td align="left">-0.512659955</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">2.240662243</td>
<td align="left">-0.464531805</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">3</td>
<td align="left">1</td>
<td align="left">-0.231117817</td>
<td align="left">-0.482887658</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">3</td>
<td align="left">0</td>
<td align="left">-0.584229254</td>
<td align="left">-0.417970618</td>
</tr>
</tbody>
</table>
<p>The test data was converted in the same way.
Predict the result.
Just pass the test data and predict.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">##############################</span>
<span style="color:#75715e"># Anticipate results</span>
<span style="color:#75715e"># Predict results</span>
<span style="color:#75715e">##############################</span>
x_test <span style="color:#f92672">=</span> df_test<span style="color:#f92672">.</span>values
y_test <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(x_test)
</code></pre></div><p>The result is stored in y_test.
Save the result in the same format as gender_submission.csv.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Combine the result <span style="color:#66d9ef">with</span> the DataFrame of <span style="color:#75715e">#PassengerId</span>
<span style="color:#75715e"># Combine the data frame of PassengerId and the result</span>
df_output <span style="color:#f92672">=</span> pandas<span style="color:#f92672">.</span>concat([df_test_index, pandas<span style="color:#f92672">.</span>DataFrame(y_test, columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Survived&#39;</span>])], axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># write result.csv to the current directory</span>
<span style="color:#75715e"># Write result.csv to the current directory</span>
df_output<span style="color:#f92672">.</span>to_csv(<span style="color:#e6db74">&#39;result.csv&#39;</span>, index<span style="color:#f92672">=</span>False)
</code></pre></div><p>With the above, we were able to obtain results.
As with the previous time, try executing with &ldquo;Commit&rdquo;.
When the execution is complete, click &ldquo;Open Viersion&rdquo;.
You can see that result.csv has been created.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/545343/9617114f-7cf7-2039-8135-c235dcce9914.png" alt="20191209_04.png"></p>
<p>Click &ldquo;Submit to Competition&rdquo; to submit.
What will happen&hellip;</p>
<h1 id="7-submitted-result">7. Submitted result</h1>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/545343/21013061-f79d-4520-33a0-b92d528f92ab.png" alt="20191210_01.png"></p>
<p>The result is &ldquo;0.75119&rdquo;. 75%.
It is worse than the sample data ^^;</p>
<p>#8. Summary
How was that.
I didn&rsquo;t adjust the learning parameters at all, but I understood the flow of learning.
<a href="https://qiita.com/sudominoru/items/840e87cc77de29f10ca2">Next time</a> will examine the data and look at the learning parameters to get a better score.</p>
<p>#History
December 11, 2019 First edition released
December 26, 2019 Next link installation
2020/01/03 Correction of source comment
2020/03/26 Partial correction of source code of “6. Predict results with test data”</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
