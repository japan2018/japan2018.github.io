<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>A little scrutiny of pandas 1.0 and dask | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>A little scrutiny of pandas 1.0 and dask</h1>
<p>
  <small class="text-secondary">
  
  
  Feb 14, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/pandas"> pandas</a></code></small>


<small><code><a href="https://memotut.com/tags/datascience"> DataScience</a></code></small>


<small><code><a href="https://memotut.com/tags/dask"> Dask</a></code></small>


<small><code><a href="https://memotut.com/tags/pandas1.0.0"> pandas1.0.0</a></code></small>

</p>
<pre><code>#Background
</code></pre>
<p><a href="https://pandas.pydata.org/docs/whatsnew/v1.0.0.html">Pandas 1.0.0</a> has been released on January 29, 2020! Crackling
As of February 14, 2020, it is <a href="https://pandas.pydata.org/docs/whatsnew/v1.0.1.html">1.0.1</a>.</p>
<p>Personally, I think the following changes are important points.</p>
<ul>
<li>pandas original <code>NA</code></li>
<li>Enhanced support for String type (Experimental)</li>
</ul>
<p>So.</p>
<p>I often use the following libraries and pandas together during analysis.</p>
<ul>
<li><a href="https://dask.org">dask</a></li>
<li><a href="https://intake.readthedocs.io/en/latest/">intake</a></li>
</ul>
<p>In particular, I think I should sort out the status of dask&rsquo;s pandas 1.0 support and other detailed behaviors.
The version of dask is 2.10.1 as of February 14, 2020.</p>
<p>Regarding intake, I think that there will be no problem if dask handles it.
(Sometimes the waiting time for processing dask is free.)</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/373730/4138c9d7-b7d0-ed95-a96e-9b2c17e73ebb.png" alt="Screenshot 2020-02-14 AM 11.20.52.png"></p>
<h2 id="what-you-care-about">What you care about</h2>
<ul>
<li>Can dask use <code>pandas.NA</code> properly? (related to ver 1.0)</li>
<li>Can dask use <code>dtype: string</code> properly? (related to ver 1.0)</li>
<li>I/O, especially <a href="https://github.com/dask/fastparquet">fastparquet</a>can&rsquo;tinput/outputproperlywith<code>pandas.NA</code>or<code>dtype:string</code>?(relatedtover1.0)</li>
<li>No, can dask be used properly with <code>dtype: categorical</code>? (Other)</li>
</ul>
<p><a href="https://github.com/tomaugspurger">Tom Augspurger</a> seems to support pandas 1.0 like a demon, and I&rsquo;m very excited about it so far.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/373730/429bae0a-b5a7-5978-fe4f-69967db37829.png" alt="Screenshot 2020-02-14 PM 2.26.08.png"></p>
<h2 id="result">result</h2>
<p>For those who want to know only the result.</p>
<ul>
<li>dask can perform arithmetic operations and string operations even if it includes <code>pandas.NA</code></li>
<li>dask cannot be <code>set_index</code> with custom type such as <code>Int64</code>, <code>string</code> type</li>
<li>Both pandas/dask cannot index filter on <code>boolean</code> column containing <code>pandas.NA</code></li>
<li>Dask will be of type <code>object</code> even if it is <code>apply(meta='string')</code>, but it can be revived with <code>astype('string')</code>.</li>
<li>If you use pandas.Categorical in dask, you may not filter/aggregate</li>
<li>It seems that you need to use <code>astype</code> when adding a new Categorical column to dask DataFrame</li>
<li>dask cannot to_parquet <code>Int64</code> and <code>string</code> types (when engine=fastparquet).</li>
</ul>
<h3 id="construction-of-survey-environment">Construction of survey environment</h3>
<p>For the time being, prepare a clean verification environment.
The OS is <code>macOS Catalina 10.15.2</code>.</p>
<p>Regarding python version, pandas only sets minimum, and dask seems to say <a href="https://docs.dask.org/en/latest/changelog.html#id6">compatible with python3.8</a>, so <code> 3.7.4</code> should be fine.</p>
<p>Regarding dependencies, put <a href="https://pandas.pydata.org/docs/whatsnew/v1.0.0.html#increased-minimum-versions-for-dependencies">minimum versions for dependencies</a>once.However,fastparquetandpyArrowcannotcoexistonmac<a href="https://github.com/dask/dask/issues/5215">problem</a>, so I don&rsquo;t include pyArrow just in case. Do not use.</p>
<p>The verification work is done on jupyterlab.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pyenv virtualenv 3.7.4 pandas100
pyenv shell pandas100
pip install -r requirements.txt
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-requirements.txt" data-lang="requirements.txt">pandas==1.0.1
dask[complete]==2.10.1
fastparquet==0.3.3

jupyterlab==1.2.6

numpy==1.18.1
pytz==2019.3
python-dateutil==2.8.1
numexpr==2.7.1
beautifulsoup4==4.8.2
gcsfs==0.6.0
lxml==4.5.0
matplotlib==3.1.3
numba==0.48.0
openpyxl==3.0.3
pymysql==0.9.3
tables==3.6.1
s3fs==0.4.0
scipy==1.4.1
sqlalchemy==1.3.13
xarray==0.15.0
xlrd==1.2.0
xlsxwriter==1.2.7
xlwt==1.3.0
</code></pre></div><h3 id="dask-vs-pandas10">dask vs pandas1.0</h3>
<p>First, check pd.NA.</p>
<ul>
<li>dtype: int</li>
<li>dtype: Int64(&hellip;Categorical)</li>
<li>dtype: float</li>
<li>dtype: string</li>
<li>dtype: boolean</li>
<li>dtype: datetime64[ns]</li>
<li>dtype: timedelta64[ns]</li>
<li>dtype: object</li>
</ul>
<p>Confirm the behavior of pd.NA in each</p>
<table>
<thead>
<tr>
<th><code>s=...</code></th>
<th>type(s.loc[3])</th>
</tr>
</thead>
<tbody>
<tr>
<td>pandas.Series([1,2,3,None], dtype='int&rsquo;)</td>
<td>TypeError</td>
</tr>
<tr>
<td>pandas.Series([1,2,3,pandas.NA], dtype='int&rsquo;)</td>
<td>TypeError</td>
</tr>
<tr>
<td>pandas.Series([1,2,3,None], dtype='Int64&rsquo;)</td>
<td>pandas._libs.missing.NAType</td>
</tr>
<tr>
<td>pandas.Series([1,2,3,None], dtype='float&rsquo;)</td>
<td>numpy.float64</td>
</tr>
<tr>
<td>pandas.Series([1,2,3,pandas.NA], dtype='float&rsquo;)</td>
<td>TypeError</td>
</tr>
<tr>
<td>pandas.Series([1,2,3,None], dtype='Int64&rsquo;).astype(&lsquo;float&rsquo;)</td>
<td>numpy.float64</td>
</tr>
<tr>
<td>pandas.Series([&lsquo;a&rsquo;,&lsquo;b&rsquo;,&lsquo;c&rsquo; ,None], dtype='string&rsquo;)</td>
<td>pandas._libs.missing.NAType</td>
</tr>
<tr>
<td>pandas.Series([&lsquo;a&rsquo;,&lsquo;b&rsquo;,&lsquo;c&rsquo; ,None], dtype='object&rsquo;).astype(&lsquo;string&rsquo;)</td>
<td>pandas._libs.missing.NAType</td>
</tr>
<tr>
<td>pandas.Series([True, False, True ,None], dtype='boolean&rsquo;)</td>
<td>pandas._libs.missing.NAType</td>
</tr>
<tr>
<td>pandas.Series([1, 0, 1 ,None], dtype='float&rsquo;).astype(&lsquo;boolean&rsquo;)</td>
<td>pandas._libs.missing.NAType</td>
</tr>
<tr>
<td>pandas.Series(pandas.to_datetime([&lsquo;2020-01-01&rsquo;, &lsquo;2020-01-02&rsquo;, &lsquo;2020-01-03&rsquo;, None]))</td>
<td>pandas._libs.tslibs.nattype.NaTType</td>
</tr>
<tr>
<td>pandas.Series(pandas.to_timedelta([&lsquo;00:00:01&rsquo;, &lsquo;00:00:02&rsquo;, &lsquo;00:00:03&rsquo;, None]))</td>
<td>pandas._libs.tslibs.nattype.NaTType</td>
</tr>
<tr>
<td>pandas.Series([object(), object(), object(), None], dtype='object&rsquo;)</td>
<td>NoneType</td>
</tr>
<tr>
<td>pandas.Series([object(), object(), object(), pandas.NA], dtype='object&rsquo;)</td>
<td>pandas.Series([object(), object(), object(), pandas.NA ], dtype='object&rsquo;)</td>
</tr>
</tbody>
</table>
<p>Summary,</p>
<ul>
<li>dtype int does not become <code>pandas.NA</code> (TypeError as it is)</li>
<li>dtype Int64,string,boolean becomes <code>pandas.NA</code>.</li>
<li>dtype float becomes <code>numpy.NaN</code></li>
<li>dtype datetime64, timedelta64 becomes <code>NAT</code></li>
<li>dtype object does not automatically convert <code>None</code> to <code>pandas.NA</code></li>
</ul>
<p>Investigate what happens when you do <code>dask.dataframe.from_pandas</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">import</span> pandas
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">import</span> dask.dataframe

<span style="color:#f92672">&gt;&gt;&gt;</span> df <span style="color:#f92672">=</span> pandas<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;i&#39;</span>: [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>],
<span style="color:#f92672">...</span><span style="color:#e6db74">&#39;i64&#39;</span>: pandas<span style="color:#f92672">.</span>Series([<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,None], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Int64&#39;</span>),
<span style="color:#f92672">...</span><span style="color:#e6db74">&#39;s&#39;</span>: pandas<span style="color:#f92672">.</span>Series([<span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#e6db74">&#39;b&#39;</span>,<span style="color:#e6db74">&#39;c&#39;</span> ,None], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;string&#39;</span>),
<span style="color:#f92672">...</span><span style="color:#e6db74">&#39;f&#39;</span>: pandas<span style="color:#f92672">.</span>Series([<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,None], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Int64&#39;</span>)<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;float&#39;</span>)})

<span style="color:#f92672">&gt;&gt;&gt;</span> ddf <span style="color:#f92672">=</span> dask<span style="color:#f92672">.</span>dataframe<span style="color:#f92672">.</span>from_pandas(df, npartitions<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> df
i i64 s f
<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span> a <span style="color:#ae81ff">1.0</span>
<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">2</span> b <span style="color:#ae81ff">2.0</span>
<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> c <span style="color:#ae81ff">3.0</span>
<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">&lt;</span>NA<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&lt;</span>NA<span style="color:#f92672">&gt;</span> NaN

<span style="color:#f92672">&gt;&gt;&gt;</span> ddf
Dask DataFrame Structure:
i i64 s f
npartitions<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
<span style="color:#ae81ff">0</span> int64 Int64 string float643 <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span>
</code></pre></div><p>Well, <code>Int64</code> is also <code>Int64</code> on dask. The same is true for <code>string</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> (integer) operation on <span style="color:#75715e">#Int64</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> df<span style="color:#f92672">.</span>i64 <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>
<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2</span>
<span style="color:#ae81ff">14</span>
<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">6</span>
<span style="color:#ae81ff">3</span> <span style="color:#f92672">&lt;</span>NA<span style="color:#f92672">&gt;</span>
Name: i64, dtype: Int64

<span style="color:#f92672">&gt;&gt;&gt;</span> (ddf<span style="color:#f92672">.</span>i64 <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>)<span style="color:#f92672">.</span>compute()
<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2</span>
<span style="color:#ae81ff">14</span>
<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">6</span>
<span style="color:#ae81ff">3</span> <span style="color:#f92672">&lt;</span>NA<span style="color:#f92672">&gt;</span>
Name: i64, dtype: Int64
</code></pre></div><p>Int64-&gt;Int64 processing works properly.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> (Floating point) operation on <span style="color:#75715e">#Int64</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> df<span style="color:#f92672">.</span>i64<span style="color:#f92672">-</span>df<span style="color:#f92672">.</span>f
<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0.0</span>
<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0.0</span>
<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0.0</span>
<span style="color:#ae81ff">3</span> NaN
dtype: float64

<span style="color:#f92672">&gt;&gt;&gt;</span> (ddf<span style="color:#f92672">.</span>i64<span style="color:#f92672">-</span>ddf<span style="color:#f92672">.</span>f)<span style="color:#f92672">.</span>compute()
<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">0.0</span>
<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">0.0</span>
<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0.0</span>
<span style="color:#ae81ff">3</span> NaN
dtype: float64
</code></pre></div><p>Int64-&gt;float64 processing also works properly.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> set_index on Int64 column <span style="color:#66d9ef">with</span> <span style="color:#75715e"># pandas.NA</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> df<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#39;i64&#39;</span>)
i s f i64_result i64<span style="color:#f92672">-</span>f
i64
<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span> a <span style="color:#ae81ff">1.0</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">0.0</span>
<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">2</span> b <span style="color:#ae81ff">2.0</span> <span style="color:#ae81ff">4</span> <span style="color:#ae81ff">0.0</span>
<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> c <span style="color:#ae81ff">3.0</span> <span style="color:#ae81ff">6</span> <span style="color:#ae81ff">0.0</span>
NaN <span style="color:#ae81ff">4</span> <span style="color:#f92672">&lt;</span>NA<span style="color:#f92672">&gt;</span> NaN <span style="color:#f92672">&lt;</span>NA<span style="color:#f92672">&gt;</span> NaN

<span style="color:#f92672">&gt;&gt;&gt;</span> ddf<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#39;i64&#39;</span>)<span style="color:#f92672">.</span>compute()
<span style="color:#a6e22e">TypeError</span>: data type <span style="color:#f92672">not</span> understood

<span style="color:#f92672">&gt;&gt;&gt;</span> What <span style="color:#66d9ef">if</span> <span style="color:#75715e"># pandas.NA didn&#39;t exist?</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> ddf[<span style="color:#e6db74">&#39;i64_nonnull&#39;</span>] <span style="color:#f92672">=</span> ddf<span style="color:#f92672">.</span>i64<span style="color:#f92672">.</span>fillna(<span style="color:#ae81ff">1</span>)
<span style="color:#f92672">...</span>ddf<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#39;i64_nonnull&#39;</span>)<span style="color:#f92672">.</span>compute()
<span style="color:#a6e22e">TypeError</span>: data type <span style="color:#f92672">not</span> understood
</code></pre></div><p>Eh! dask cannot do <code>set_index</code> on the <code>Int64</code> column!
Of course pandas can.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> set_index on a string column containing <span style="color:#75715e"># pandas.NA</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> df<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#39;s&#39;</span>)
i i64 f
s
a <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1.0</span>
b <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">2.0</span>
c <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3.0</span>
NaN <span style="color:#ae81ff">4</span> <span style="color:#f92672">&lt;</span>NA<span style="color:#f92672">&gt;</span> NaN

<span style="color:#f92672">&gt;&gt;&gt;</span> ddf<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#39;s&#39;</span>)<span style="color:#f92672">.</span>compute()
<span style="color:#a6e22e">TypeError</span>: Cannot perform reduction<span style="color:#e6db74">&#39;max&#39;</span> <span style="color:#66d9ef">with</span> string dtype

<span style="color:#f92672">&gt;&gt;&gt;</span> What <span style="color:#66d9ef">if</span> <span style="color:#75715e"># pandas.NA didn&#39;t exist?</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> ddf[<span style="color:#e6db74">&#39;s_nonnull&#39;</span>] <span style="color:#f92672">=</span> ddf<span style="color:#f92672">.</span>s<span style="color:#f92672">.</span>fillna(<span style="color:#e6db74">&#39;a&#39;</span>)
<span style="color:#f92672">...</span>ddf<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#39;s_nonnull&#39;</span>)
<span style="color:#a6e22e">TypeError</span>: Cannot perform reduction<span style="color:#e6db74">&#39;max&#39;</span> <span style="color:#66d9ef">with</span> string dtype
</code></pre></div><p>I can&rsquo;t do <code>string</code> either. I can&rsquo;t use this yet (in my usage).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Try the <span style="color:#75715e">#.str function</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> df<span style="color:#f92672">.</span>s<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#39;a&#39;</span>)
<span style="color:#ae81ff">0</span> True
<span style="color:#ae81ff">1</span> False
<span style="color:#ae81ff">2</span> False
<span style="color:#ae81ff">3</span> <span style="color:#f92672">&lt;</span>NA<span style="color:#f92672">&gt;</span>
Name: s, dtype: boolean

<span style="color:#f92672">&gt;&gt;&gt;</span> ddf<span style="color:#f92672">.</span>s<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#39;a&#39;</span>)<span style="color:#f92672">.</span>compute()
<span style="color:#ae81ff">0</span> True
<span style="color:#ae81ff">1</span> False
<span style="color:#ae81ff">2</span> False
<span style="color:#ae81ff">3</span> <span style="color:#f92672">&lt;</span>NA<span style="color:#f92672">&gt;</span>
Name: s, dtype: boolean
</code></pre></div><p>Hmm, when this moves.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> Filter by boolean columns containing <span style="color:#75715e"># pandas.NA</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> df[df<span style="color:#f92672">.</span>s<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#39;a&#39;</span>)]
<span style="color:#a6e22e">ValueError</span>: cannot mask <span style="color:#66d9ef">with</span> array containing NA <span style="color:#f92672">/</span> NaN values

<span style="color:#f92672">&gt;&gt;&gt;</span> Is <span style="color:#75715e"># pandas.NA useless?</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> df[<span style="color:#e6db74">&#39;s_nonnull&#39;</span>] <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>s<span style="color:#f92672">.</span>fillna(<span style="color:#e6db74">&#39;a&#39;</span>)
<span style="color:#f92672">...</span> df[df<span style="color:#f92672">.</span>s_nonnull<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#39;a&#39;</span>)]
i i64 s f i64_nonnull s_nonnull
<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span> a <span style="color:#ae81ff">1.0</span> <span style="color:#ae81ff">1</span> a
<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">&lt;</span>NA<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&lt;</span>NA<span style="color:#f92672">&gt;</span> NaN <span style="color:#ae81ff">1</span> a

<span style="color:#f92672">&gt;&gt;&gt;</span> ddf[ddf<span style="color:#f92672">.</span>s<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#39;a&#39;</span>)]<span style="color:#f92672">.</span>compute()
<span style="color:#a6e22e">ValueError</span>: cannot mask <span style="color:#66d9ef">with</span> array containing NA <span style="color:#f92672">/</span> NaN values

<span style="color:#f92672">&gt;&gt;&gt;</span> ddf[<span style="color:#e6db74">&#39;s_nonnull&#39;</span>] <span style="color:#f92672">=</span> ddf<span style="color:#f92672">.</span>s<span style="color:#f92672">.</span>fillna(<span style="color:#e6db74">&#39;a&#39;</span>)
<span style="color:#f92672">...</span> ddf[ddf<span style="color:#f92672">.</span>s_nonnull<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#39;a&#39;</span>)]<span style="color:#f92672">.</span>compute()
i i64 s f i64_nonnull s_nonnull
<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span> a <span style="color:#ae81ff">1.0</span> <span style="color:#ae81ff">1</span> a
<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">&lt;</span>NA<span style="color:#f92672">&gt;</span> <span style="color:#f92672">&lt;</span>NA<span style="color:#f92672">&gt;</span> NaN <span style="color:#ae81ff">1</span> a
<span style="color:#f92672">&gt;&gt;&gt;</span> ddf[ddf<span style="color:#f92672">.</span>s<span style="color:#f92672">.</span>str<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#39;a&#39;</span>)]<span style="color:#f92672">.</span>compute()
</code></pre></div><p>e! ! ! Can&rsquo;t I filter by including pandas.NA?
This is no good!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> Try specifying meta<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Int64&#39;</span> <span style="color:#66d9ef">with</span> <span style="color:#75715e"># apply</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> ddf[<span style="color:#e6db74">&#39;i10&#39;</span>] <span style="color:#f92672">=</span> ddf<span style="color:#f92672">.</span>i<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> v: v <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>, meta<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Int64&#39;</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> ddf
Dask DataFrame Structure:
i i64 s f i64_nonnull s_nonnull i10
npartitions<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
<span style="color:#ae81ff">0</span> int64 Int64 string float64 Int64 string int64
<span style="color:#ae81ff">3</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span>

<span style="color:#f92672">&gt;&gt;&gt;</span> Try specifying meta<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;string&#39;</span> <span style="color:#66d9ef">with</span> <span style="color:#75715e"># apply</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> ddf[<span style="color:#e6db74">&#39;s_double&#39;</span>] <span style="color:#f92672">=</span> ddf<span style="color:#f92672">.</span>s<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> v: v<span style="color:#f92672">+</span>v, meta<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;string&#39;</span>)
Dask DataFrame Structure:
i i64 s f i64_nonnull s_nonnull i10 s_double
npartitions<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
<span style="color:#ae81ff">0</span> int64 Int64 string float64 Int64 string int64 object
<span style="color:#ae81ff">3</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span>

<span style="color:#f92672">&gt;&gt;&gt;</span> Try <span style="color:#75715e"># astype(&#39;string&#39;)</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> ddf[<span style="color:#e6db74">&#39;s_double&#39;</span>] <span style="color:#f92672">=</span> ddf[<span style="color:#e6db74">&#39;s_double&#39;</span>]<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;string&#39;</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> ddf
Dask DataFrame Structure:
i i64 s f i64_nonnull s_nonnull i10 s_double
npartitions<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
<span style="color:#ae81ff">0</span> int64 Int64 string float64 Int64 string int64 string
<span style="color:#ae81ff">3</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span>
</code></pre></div><p>If specified with meta=, is it not reflected? .. ..
You can revive it with astype, but it&rsquo;s troublesome. .. ..</p>
<h4 id="result-1">result</h4>
<ul>
<li>Calculation is OK</li>
<li>In dask, it cannot be used as Index (because the type that supports pandas.NA cannot be used in the first place)</li>
<li>I can&rsquo;t filter on both pandas/dask!</li>
<li>.apply(meta='string&rsquo;) is ignored. You have to astype.</li>
</ul>
<h3 id="dask-vs-pandascategorical">dask vs pandas.Categorical</h3>
<p>To explore Categorical in pandas, this time we will use the method using CategoricalDtype.
Basic usage of CategoricalDtype is</p>
<ol>
<li>Instantiate by specifying categories and ordered</li>
<li>Instantiate pandas.Series as dtype=CategoricalDtype instance</li>
</ol>
<p>I think it is. Sample code below</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#75715e">#First, create a CategoricalDtype</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> int_category <span style="color:#f92672">=</span> pandas<span style="color:#f92672">.</span>CategoricalDtype(categories<span style="color:#f92672">=</span>[<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>],
<span style="color:#f92672">...</span> ordered<span style="color:#f92672">=</span>True)
<span style="color:#f92672">&gt;&gt;&gt;</span> int_category
CategoricalDtype(categories<span style="color:#f92672">=</span>[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>], ordered<span style="color:#f92672">=</span>True)

<span style="color:#f92672">&gt;&gt;&gt;</span> int_category<span style="color:#f92672">.</span>categories
Int64Index([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;int64&#39;</span>)

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#75715e"># Make pandas.Series like this</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> int_series <span style="color:#f92672">=</span> pandas<span style="color:#f92672">.</span>Series([<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>], dtype<span style="color:#f92672">=</span>int_category)
<span style="color:#f92672">&gt;&gt;&gt;</span> int_series
<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span>
<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span>
twenty three
dtype: category
Categories (<span style="color:#ae81ff">5</span>, int64): [<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">5</span>]

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#75715e"># If it is generated, it will convert the value not in the category to NaN</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> int_series <span style="color:#f92672">=</span> pandas<span style="color:#f92672">.</span>Series([<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">6</span>], dtype<span style="color:#f92672">=</span>int_category)
<span style="color:#f92672">&gt;&gt;&gt;</span> int_series
<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span>
<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span>
twenty three
<span style="color:#ae81ff">3</span> NaN
dtype: category
Categories (<span style="color:#ae81ff">5</span>, int64): [<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">3</span> <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">5</span>]

<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#75715e"># get angry after generation</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> int_series<span style="color:#f92672">.</span>loc[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
<span style="color:#a6e22e">ValueError</span>: Cannot setitem on a Categorical <span style="color:#66d9ef">with</span> a new category, set the categories first
</code></pre></div><p>Next, try using Categorical on dask.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">import</span> pandas
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">import</span> dask.dataframe
<span style="color:#f92672">&gt;&gt;&gt;</span> Generate <span style="color:#75715e">#pandas.DataFrame</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> df <span style="color:#f92672">=</span> pandas<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;a&#39;</span>: pandas<span style="color:#f92672">.</span>Series([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>], dtype<span style="color:#f92672">=</span>int_category),
<span style="color:#f92672">...</span><span style="color:#e6db74">&#39;b&#39;</span>: pandas<span style="color:#f92672">.</span>Series([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;int64&#39;</span>)})
<span style="color:#f92672">&gt;&gt;&gt;</span> df
a b
<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span>
<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">2</span>
<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span>
<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span>
<span style="color:#ae81ff">4</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">2</span>
<span style="color:#ae81ff">5</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span>

<span style="color:#f92672">&gt;&gt;&gt;</span> convert to <span style="color:#75715e"># dask.dataframe.DataFrame</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> ddf <span style="color:#f92672">=</span> dask<span style="color:#f92672">.</span>dataframe<span style="color:#f92672">.</span>from_pandas(df, npartitions<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> ddf
Dask DataFrame Structure:
a b
npartitions<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
<span style="color:#ae81ff">0</span> category[known] int64
Five <span style="color:#f92672">...</span> <span style="color:#f92672">...</span>
</code></pre></div><p>For the time being, I was able to turn it into a dask with categorical.</p>
<pre><code class="language-python#" data-lang="python#">&gt;&gt;&gt; df.loc[2,'a'] = 30
ValueError: Cannot setitem on a Categorical with a new category, set the categories first

# dask can not be assigned in the first place regardless of Categorical
&gt;&gt;&gt; ddf.loc['a', 3] = 10
TypeError:'_LocIndexer' object does not support item assignment

#Pandas is also a rule for calculating category values
&gt;&gt;&gt; df.a * 2
TypeError: unsupported operand type(s) for *:'Categorical' and'int'

Even with #dask, the calculation of the category value is a rule
&gt;&gt;&gt; ddf.a * 2
TypeError: unsupported operand type(s) for *:'Categorical' and'int'

Try to specify as meta in apply of #dask
&gt;&gt;&gt; ddf['c'] = ddf.a.apply(lambda v: v, meta=int_category)
Dont know how to create metadata from category

Will you do your best if meta='category' in #dask apply?
&gt;&gt;&gt; ddf['c'] = ddf.a.apply(lambda v: v, meta='category')
&gt;&gt;&gt; ddf.dtypes
a category
b int64
c object
dtype: object

&gt;&gt;&gt; # Check if the contents are consistent
&gt;&gt;&gt; ddf.compute().dtypes
a category
b int64
c category
dtype: object

&gt;&gt;&gt; Try # astype
&gt;&gt;&gt; ddf['c'] = ddf.c.astype(int_category)
&gt;&gt;&gt; ddf
Dask DataFrame Structure:
a b c
npartitions=1
0 category[known] int64 category[known]
Five ... ... ...
</code></pre><p>So that&rsquo;s it. The constraint part of the category is maintained, but if you use <code>.apply(meta=)</code>, the dtype management of dask will be buggy.
It is possible to revive it with astype, but it is troublesome. .. ..
Is it a place that seems to be usable if only a filter?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Try counting</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> ddf<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;a&#39;</span>)<span style="color:#f92672">.</span>b<span style="color:#f92672">.</span>mean()<span style="color:#f92672">.</span>compute()
a
<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1.0</span>
<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">2.0</span>
<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3.0</span>
<span style="color:#ae81ff">4</span> NaN
<span style="color:#ae81ff">5</span> NaN
Name: b, dtype: float64

Isn<span style="color:#e6db74">&#39;t the type broken by being treated as # Index?</span>
Dask DataFrame Structure:
a b
npartitions<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
category[known] float64
<span style="color:#f92672">...</span> <span style="color:#f92672">...</span>
Dask Name: reset_index, <span style="color:#ae81ff">34</span> tasks
</code></pre></div><p>Hmm, do you feel like you are counting?</p>
<h4 id="result-2">result</h4>
<ul>
<li>When using pandas.Categorical with dask, filters and aggregations seem to be fine</li>
<li>If you want to add a new Categorical column to dask&rsquo;s DataFrame, use <code>astype</code></li>
</ul>
<h3 id="to_parquet-vs-pandas10">to_parquet vs pandas1.0</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#75715e">#First, create pandas.DataFrame</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> df <span style="color:#f92672">=</span> pandas<span style="color:#f92672">.</span>DataFrame(
    {
        <span style="color:#e6db74">&#39;i64&#39;</span>: pandas<span style="color:#f92672">.</span>Series([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>,None], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Int64&#39;</span>),
        <span style="color:#e6db74">&#39;i64_nonnull&#39;</span>: pandas<span style="color:#f92672">.</span>Series([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Int64&#39;</span>),
        <span style="color:#e6db74">&#39;s&#39;</span>: pandas<span style="color:#f92672">.</span>Series([<span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#e6db74">&#39;b&#39;</span>,<span style="color:#e6db74">&#39;c&#39;</span>, None], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;string&#39;</span>),
        <span style="color:#e6db74">&#39;s_nonnull&#39;</span>: pandas<span style="color:#f92672">.</span>Series([<span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#e6db74">&#39;b&#39;</span>,<span style="color:#e6db74">&#39;c&#39;</span>,<span style="color:#e6db74">&#39;d&#39;</span>], dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;string&#39;</span>),
    }
)
<span style="color:#f92672">&gt;&gt;&gt;</span> df
i64 i64_nonnull s s_nonnull
<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">1</span> a a
<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2</span> <span style="color:#ae81ff">2</span> b b
<span style="color:#ae81ff">2</span> <span style="color:#ae81ff">3</span> <span style="color:#ae81ff">3</span> c c
<span style="color:#ae81ff">3</span> <span style="color:#f92672">&lt;</span>NA<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">&lt;</span>NA<span style="color:#f92672">&gt;</span> d

<span style="color:#f92672">&gt;&gt;&gt;</span> convert to <span style="color:#75715e"># dask.dataframe.DataFrame</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> ddf <span style="color:#f92672">=</span> dask<span style="color:#f92672">.</span>dataframe<span style="color:#f92672">.</span>from_pandas(df, npartitions<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> ddf
Dask DataFrame Structure:
i64 i64_nonnull s s_nonnull
npartitions<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
<span style="color:#ae81ff">0</span> Int64 Int64 string string
<span style="color:#ae81ff">3</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span> <span style="color:#f92672">...</span>
</code></pre></div><p>For the time being, try to_parquet.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> ddf<span style="color:#f92672">.</span>to_parquet(<span style="color:#e6db74">&#39;test1&#39;</span>, engine<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;fastparquet&#39;</span>)
<span style="color:#a6e22e">ValueError</span>: Dont know how to convert data type: Int64
</code></pre></div><p>seriously. .. .. I expected it. .. ..
Int64 may not work, but string can be used. .. ..</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> ddf<span style="color:#f92672">.</span>to_parquet(<span style="color:#e6db74">&#39;test2&#39;</span>, engine<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;fastparquet&#39;</span>)
<span style="color:#a6e22e">ValueError</span>: Dont know how to convert data type: string
</code></pre></div><p>It was bad.</p>
<h4 id="result-3">result</h4>
<ul>
<li>Int64, string cannot be to_parquet.</li>
</ul>
<h2 id="in-conclusion">in conclusion</h2>
<p>How was that?
Perhaps no one has read this comment all the way to the end.
Should I have split the post?</p>
<p>pandas 1.0 I would be happy if it could be useful for people who are thinking about it.</p>
<p>See you soon.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
