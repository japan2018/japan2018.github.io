<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Me, NER, Flair | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Me, NER, Flair</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 24, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/natural-language-processing"> Natural Language Processing</a></code></small>


<small><code><a href="https://memotut.com/tags/nlp"> NLP</a></code></small>


<small><code><a href="https://memotut.com/tags/deeplearning"> DeepLearning</a></code></small>

</p>
<pre><code>This article is on the 23rd day of [MYJLab Advent Calendar](https://qiita.com/advent-calendar/2019/myjlab).
</code></pre>
<h2 id="introduction">Introduction</h2>
<p>Hello. This is marutaku from MYJLab m1. This time, I had the opportunity to use a technique called proper expression extraction, so I would like to introduce the library used at that time.</p>
<h2 id="about-proper-expression-extraction-ner">About proper expression extraction (NER)</h2>
<p>Named Entity Recognition is a technology that acquires proper nouns such as company names and place names with labels such as company and place names.
As an example,</p>
<pre><code>US aircraft giant Boeing has announced the immediate resignation of Muirenberg's CEO.
It seems that he took responsibility for the problem of the latest aircraft &quot;737 MAX&quot; which was in operation after two crashes.
Calhoun will take the CEO position on January 13, next year.
</code></pre><p><a href="https://news.yahoo.co.jp/pickup/6346205">https://news.yahoo.co.jp/pickup/6346205</a>
At this time, it can be seen that the person&rsquo;s name is <code>Muilenberg, Calhoun</code> and the organization name is <code>Boeing</code>. In this way, the task of proper expression extraction is to acquire proper nouns existing in sentences.</p>
<h3 id="data-set">data set</h3>
<p>It is collected in <a href="https://github.com/juand-r/entity-recognition-datasets">this repository</a>. I think CoNLL2003 and Ontonotes v5 are the most commonly used. There are also medical data and wikipedhia annotated data.
The Japanese dataset is not open to the public, but it seems to be sold.</p>
<h3 id="difficulty-in-extracting-unique-expressions">Difficulty in extracting unique expressions</h3>
<p>Recent Entity Extraction papers are very difficult to implement. As you can see if you look at <a href="https://paperswithcode.com/task/named-entity-recognition-ner">Paper With Code</a>, you can stack and use a large number of models, or multiple pre-learned It is very troublesome because I want to use the word expression of the model. <code>LSTM-CRF+ELMo+BERT+Flair</code> or Mounani Itternokawa Karanai.
At that time, I came across a library called Flair that could easily implement a model that achieved the NER State of the art.</p>
<h2 id="what-is-flair">What is Flair</h2>
<p><a href="https://github.com/flairNLP/flair">Flair</a> is a natural language processing library designed to easily implement the State of the art model. We have a rich set of pre-trained models, so you can quickly incorporate past SoTA models into your system.
As written in the tutorial, when trying the model for extracting eigenexpressions trained with Flair, you can do it with the following code only</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> flair.data <span style="color:#f92672">import</span> Sentence
<span style="color:#f92672">from</span> flair.models <span style="color:#f92672">import</span> SequenceTagger

<span style="color:#75715e"># make a sentence</span>
sentence <span style="color:#f92672">=</span> Sentence(<span style="color:#e6db74">&#39;I love Berlin .&#39;</span>)

<span style="color:#75715e"># load the NER tagger</span>
tagger <span style="color:#f92672">=</span> SequenceTagger<span style="color:#f92672">.</span>load(<span style="color:#e6db74">&#39;ner&#39;</span>)

<span style="color:#75715e"># run NER over sentence</span>
tagger<span style="color:#f92672">.</span>predict(sentence)
</code></pre></div><p>In addition to the model called <code>ner</code> used here, there are various models such as the model called <code>ner-fast</code> that operates at high speed even on a CPU.</p>
<h2 id="self-made-model-using-flair">Self-made model using Flair</h2>
<p>Flair can not only execute the learned model, but also create your own model.
Flair makes it easy to handle not only trained models, but also embedded representations of popular models. (<a href="https://github.com/flairNLP/flair/blob/master/resources/docs/TUTORIAL_4_ELMO_BERT_FLAIR_EMBEDDING.md">https://github.com/flairNLP/flair/blob/master/resources/docs/TUTORIAL_4_ELMO_BERT_FLAIR_EMBEDDING.md</a>)
An example of my own model is shown below.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> flair.data <span style="color:#f92672">import</span> Corpus
<span style="color:#f92672">from</span> flair.datasets <span style="color:#f92672">import</span> WNUT_17
<span style="color:#f92672">from</span> flair.embeddings <span style="color:#f92672">import</span> TokenEmbeddings, WordEmbeddings, StackedEmbeddings
<span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> List

<span style="color:#75715e"># 1. get the corpus</span>
corpus: Corpus <span style="color:#f92672">=</span> WNUT_17()<span style="color:#f92672">.</span>downsample(<span style="color:#ae81ff">0.1</span>)
<span style="color:#66d9ef">print</span>(corpus)

<span style="color:#75715e"># 2. what tag do we want to predict?</span>
tag_type <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ner&#39;</span>

<span style="color:#75715e"># 3. make the tag dictionary from the corpus</span>
tag_dictionary <span style="color:#f92672">=</span> corpus<span style="color:#f92672">.</span>make_tag_dictionary(tag_type<span style="color:#f92672">=</span>tag_type)
<span style="color:#66d9ef">print</span>(tag_dictionary<span style="color:#f92672">.</span>idx2item)

<span style="color:#75715e"># 4. initialize embeddings</span>
embedding_types: List[TokenEmbeddings] <span style="color:#f92672">=</span> [

    WordEmbeddings(<span style="color:#e6db74">&#39;glove&#39;</span>),

    <span style="color:#75715e"># comment in this line to use character embeddings</span>
    <span style="color:#75715e"># CharacterEmbeddings(),</span>

    <span style="color:#75715e"># comment in these lines to use flair embeddings</span>
    <span style="color:#75715e"># FlairEmbeddings(&#39;news-forward&#39;),</span>
    <span style="color:#75715e"># FlairEmbeddings(&#39;news-backward&#39;),</span>
]

embeddings: StackedEmbeddings <span style="color:#f92672">=</span> StackedEmbeddings(embeddings<span style="color:#f92672">=</span>embedding_types)

<span style="color:#75715e"># 5. initialize sequence tagger</span>
<span style="color:#f92672">from</span> flair.models <span style="color:#f92672">import</span> SequenceTagger

tagger: SequenceTagger <span style="color:#f92672">=</span> SequenceTagger(hidden_size<span style="color:#f92672">=</span><span style="color:#ae81ff">256</span>,
                                        embeddings<span style="color:#f92672">=</span>embeddings,
                                        tag_dictionary<span style="color:#f92672">=</span>tag_dictionary,
                                        tag_type<span style="color:#f92672">=</span>tag_type,
                                        use_crf<span style="color:#f92672">=</span>True)

<span style="color:#75715e"># 6. initialize trainer</span>
<span style="color:#f92672">from</span> flair.trainers <span style="color:#f92672">import</span> ModelTrainer

trainer: ModelTrainer <span style="color:#f92672">=</span> ModelTrainer(tagger, corpus)

<span style="color:#75715e"># 7. start training</span>
trainer<span style="color:#f92672">.</span>train(<span style="color:#e6db74">&#39;resources/taggers/example-ner&#39;</span>,
              learning_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>,
              mini_batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">32</span>,
              (max_epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">150</span>)

<span style="color:#75715e"># 8. plot weight traces (optional)</span>
<span style="color:#f92672">from</span> flair.visual.training_curves <span style="color:#f92672">import</span> Plotter
plotter <span style="color:#f92672">=</span> Plotter()
plotter<span style="color:#f92672">.</span>plot_weights(<span style="color:#e6db74">&#39;resources/taggers/example-ner/weights.txt&#39;</span>)
</code></pre></div><p>The above model uses the embedding expression of the model called <code>glove</code> inside the model, but by increasing this, you can use multiple word embedding expressions.
I haven&rsquo;t tried it yet, but it seems that I can fine-tune embedded expressions.</p>
<h2 id="at-the-end">At the end</h2>
<p>This time, we talked about NER and Flair. Flair can be applied to tasks such as negative/positive judgment and text classification in addition to NER. Natural language processing If you want to use it but it seems difficult, please try it.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.rondhuit.com/apache-opennlp-1-9-0-ja-ner.html">https://www.rondhuit.com/apache-opennlp-1-9-0-ja-ner.html</a></li>
<li><a href="https://qiita.com/Hironsan/items/62b493d92712e862e5aa">https://qiita.com/Hironsan/items/62b493d92712e862e5aa</a></li>
</ul>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
