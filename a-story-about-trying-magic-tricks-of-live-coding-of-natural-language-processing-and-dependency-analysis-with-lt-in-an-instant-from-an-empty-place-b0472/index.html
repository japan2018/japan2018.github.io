<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>A story about trying magic tricks of live coding of natural language processing and dependency analysis with LT in an instant from an empty place | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>A story about trying magic tricks of live coding of natural language processing and dependency analysis with LT in an instant from an empty place</h1>
<p>
  <small class="text-secondary">
  
  
  Jan 26, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/natural-language-processing"> natural language processing</a></code></small>


<small><code><a href="https://memotut.com/tags/pyautogui"> pyautogui</a></code></small>


<small><code><a href="https://memotut.com/tags/colaboratory"> colaboratory</a></code></small>


<small><code><a href="https://memotut.com/tags/ginza"> GiNZA</a></code></small>

</p>
<pre><code># wrap up
</code></pre>
<p>GiNZA, which carries out ultra-high-precision natural language processing and dependency analysis, is amazing,
With Colaboratory, you don&rsquo;t need to build an environment and you can use it easily with just a browser.</p>
<p>During the LT (Lightning Talk) in order to emphasize that crispness
On-the-fly environment construction &amp; natural code processing by writing code,
Moreover, I tried the &ldquo;magic trick&rdquo; that says I can achieve high precision and high functionality.
At first glance, &ldquo;magic&rdquo; has some seeds&hellip; To talk about.</p>
<p>If you read to the end, you will know the following two know-how
・A method for high-precision natural language processing in 3 minutes from zero with GiNZA
・The magic trick of live coding with LT</p>
<h1 id="background--ginza-is-amazing">Background ①: GiNZA is amazing!</h1>
<p>``GiNZA&rsquo;&rsquo; announced in April 2019,
I tried running the Japanese natural language processing open source library,
Easy and highly accurate (super important), including dependency and vectorization,
I was surprised because I was able to perform all natural language processing.</p>
<p>Reference:
<a href="https://www.recruit.co.jp/newsroom/2019/0402_18331.html">https://www.recruit.co.jp/newsroom/2019/0402_18331.html</a></p>
<h2 id="ginzas-great-point-1-high-accuracy-by-default-even-though-environment-construction-is-easy">GiNZA&rsquo;s great point 1: High accuracy by default even though environment construction is easy</h2>
<p>In natural language processing, building an environment is often difficult. (Mecab or something)
Or it is troublesome to install a dictionary or the like for high accuracy.
However, if &ldquo;GiNZA&rdquo;,
<strong>Pip installs a high-precision dictionary in one shot</strong>.
Furthermore, using <strong>Colaboratory</strong>,
<strong>Even if you start from a completely zero state, it can be easily operated with just a browser</strong>.</p>
<h2 id="ginzas-great-point-2-all-major-functions-are-included-in-one-shot">GiNZA&rsquo;s great point 2: All major functions are included in one shot</h2>
<p>It&rsquo;s not just morphological analysis.
Dependency analysis, person name and place name extraction, learned model that vectorizes sentences, etc.
A wide variety of major functions can be used in one shot (description)</p>
<h2 id="ginzas-trouble-there-is-little-information-and-i-do-not-know-how-to-use-it">GiNZA&rsquo;s trouble: There is little information and I do not know how to use it</h2>
<p>Perhaps because it is relatively new, there is still little information and it is difficult to find it.
⇒ ★I thought I would summarize the main usage in this article★</p>
<p>・Part of speech is difficult to understand by UD (Universal Dependencies) standards such as &ldquo;PROPN&rdquo;
(Familiar expressions such as nouns and verbs can also be given)
・Since the result of analysis has various attributes, which one do you want? Status
(A feeling that it has a lot of functions and is not fully used)
・A little know-how is required to operate with Colaboratory
(A little research was required for each of the startup method and graph display method)
It&rsquo;s easy if you understand the whole thing, but I want the first introduction.</p>
<p>#Background ②: Magic trick for live coding</p>
<p>I had the opportunity to attend an LT (Lightning Talk) at a study session.
I wanted to tell you about the greatness of &ldquo;GiNZA&rdquo;
** I can&rsquo;t feel the &ldquo;easy and easy feeling&rdquo; **
** Above all, it lacks in &ldquo;interesting&rdquo; **.
(Not only those who are interested in natural language processing)</p>
<p>So, from the <strong>blank state</strong> just starting the browser,
With &ldquo;<font color="Red"><strong>Live coding</strong></font>&rdquo;
I came up with a <strong>spectacle</strong> that implements high-precision natural language analysis.
** There is a feeling that it can be done easily and easily,
**Eh, this is enough for such an amazing analysis! ? I have a surprise
<strong>It&rsquo;s worth seeing on the spot and it&rsquo;s interesting as an event</strong>.</p>
<p><strong><font color="Red">, in parallel with the talk, in time</font></strong>
<strong><font color="Red">I don&rsquo;t have the skill to code without mistakes! </font></strong></p>
<p>That&rsquo;s it!
<font color="Red">**Let Python code live (mystery)**</font>
⇒Finally, I was doing it automatically, and I got a ** punch ** by spoiling it.</p>
<p>So,
A story about developing a magic trick that looks like live coding.</p>
<p>I will also write the code later, so if you replace the GiNZA part,
<strong>Everyone can live code in LT easily</strong>
**You can fake it! ! **
<del>How horrible know-how</del></p>
<h1 id="ginza-know-how-summary-first-serious-story">GiNZA know-how summary (first serious story)</h1>
<p>First of all, as GiNZA&rsquo;s know-how,
No prerequisite knowledge/prerequisite environment required, just a browser makes it super easy
The method of high-precision and high-performance natural language processing is described.</p>
<p>To do this, search for &ldquo;Colaboratory&rdquo; in your browser,
Open &ldquo;PYTHON3&rsquo;s new notebook&rdquo;,
Just execute (shift+enter) the code below 100 lines in order.
Of course it&rsquo;s free. Please do try that out.</p>
<p>From installation of GiNZA to sample implementation of major functions,
I made a code to understand everything.
(*A simple version of this was used for live coding)</p>
<h2 id="how-to-install-ginza">How to install GiNZA:</h2>
<p>Installation is pip only. Easy to enter all related modules and dictionary data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">!pip install ginza
<span style="color:#75715e"># ★ From the release of v3 of 2020-01-15, it seems that you can enter with just pip like this</span>
<span style="color:#75715e"># The conventional installation method is as follows. (This is done at LT)</span>
<span style="color:#75715e"># !pip install &#34;https://github.com/megagonlabs/ginza/releases/download/latest/ginza-latest.tar.gz&#34;</span>
</code></pre></div><p>Because of the characteristics of Colaboratory and the path of modules,
It is necessary to execute the following command after pip execution (don&rsquo;t worry)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#f92672">import</span> pkg_resources<span style="color:#f92672">,</span> imp
imp<span style="color:#f92672">.</span>reload(pkg_resources)
</code></pre></div><h2 id="how-to-use-ginza-one-shot-use-of-main-function">How to use GiNZA (one-shot use of main function)</h2>
<p>First, the execution result is posted.
In this way, morphological analysis that is likely to be used,
Dependency structure analysis (dependency), analysis of abstract classification such as name of person, place name,
And I made the sample code to display the visualization in one shot.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/193512/0e25f80e-1d68-3e4f-34b0-4b0af9d72ab1.png" alt="ginza01.PNG"></p>
<p>Here is the function that outputs the above.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e">#Function that displays the main elements from the result of dependency structure analysis</span>
<span style="color:#75715e"># Load the model outside the function</span>
<span style="color:#75715e">#import spacy</span>
<span style="color:#75715e">#nlp = spacy.load(&#39;ja_ginza&#39;)</span>
<span style="color:#75715e">#easy_display_nlp(nlp, &#34;test text&#34;)</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">easy_display_nlp</span>(my_nlp, input_str):
  doc <span style="color:#f92672">=</span> my_nlp(input_str)

  <span style="color:#75715e">### Tabular display of dependency parsing results</span>
  result_list <span style="color:#f92672">=</span> []
  <span style="color:#66d9ef">for</span> sent <span style="color:#f92672">in</span> doc<span style="color:#f92672">.</span>sents:
    <span style="color:#75715e">#Line feed display for each sentence (sentence separated display)</span>
    <span style="color:#66d9ef">print</span>(sent)

    <span style="color:#75715e"># Parse each sentence and put the result in list (even if there are multiple sentences, it will be put together as one)</span>
    <span style="color:#66d9ef">for</span> token <span style="color:#f92672">in</span> sent:
      <span style="color:#75715e">#https://spacy.io/api/token</span>
      <span style="color:#75715e">#print(dir(token))</span>
      <span style="color:#75715e">#Comments are for reference only, not interpretation on the official website.</span>
      info_dict <span style="color:#f92672">=</span> {}
      info_dict[<span style="color:#e6db74">&#34;.i&#34;</span>] <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>i <span style="color:#75715e"># Token number (even if there are multiple sentences, they will be consecutive numbers instead of returning to 0)</span>
      info_dict[<span style="color:#e6db74">&#34;.orth_&#34;</span>] <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>orth_ <span style="color:#75715e"># original text</span>
      info_dict[<span style="color:#e6db74">&#34;._.reading&#34;</span>] <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>_<span style="color:#f92672">.</span>reading <span style="color:#75715e"># reading kana</span>
      info_dict[<span style="color:#e6db74">&#34;.pos_&#34;</span>] <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>pos_ <span style="color:#75715e"># part of speech (UD)</span>
      info_dict[<span style="color:#e6db74">&#34;.tag_&#34;</span>] <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>tag_ <span style="color:#75715e"># Part of speech (Japanese)</span>
      info_dict[<span style="color:#e6db74">&#34;.lemma_&#34;</span>] <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>lemma_ <span style="color:#75715e"># basic form (after name identification)</span>
      info_dict[<span style="color:#e6db74">&#34;._.inf&#34;</span>] <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>_<span style="color:#f92672">.</span>inf <span style="color:#75715e"># Usage information</span>
      info_dict[<span style="color:#e6db74">&#34;.rank&#34;</span>] <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>rank <span style="color:#75715e"># May be treated like frequency</span>
      info_dict[<span style="color:#e6db74">&#34;.norm_&#34;</span>] <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>norm_ <span style="color:#75715e"># archetype</span>
      info_dict[<span style="color:#e6db74">&#34;.is_oov&#34;</span>] <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>is_oov <span style="color:#75715e"># Unregistered word?</span>
      info_dict[<span style="color:#e6db74">&#34;.is_stop&#34;</span>] <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>is_stop <span style="color:#75715e"># Stopword?</span>
      info_dict[<span style="color:#e6db74">&#34;.has_vector&#34;</span>] <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>has_vector <span style="color:#75715e"># do you have the information of word2vec?</span>
      info_dict[<span style="color:#e6db74">&#34;list(.lefts)&#34;</span>] <span style="color:#f92672">=</span> list(token<span style="color:#f92672">.</span>lefts) <span style="color:#75715e"># Related terms summary (left)</span>
      info_dict[<span style="color:#e6db74">&#34;list(.rights)&#34;</span>] <span style="color:#f92672">=</span> list(token<span style="color:#f92672">.</span>rights) <span style="color:#75715e"># Related terms summary (right)</span>
      info_dict[<span style="color:#e6db74">&#34;.dep_&#34;</span>] <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>dep_ <span style="color:#75715e"># Dependency relationship</span>
      info_dict[<span style="color:#e6db74">&#34;.head.i&#34;</span>] <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>head<span style="color:#f92672">.</span>i <span style="color:#75715e"># Dependent partner token number</span>
      info_dict[<span style="color:#e6db74">&#34;.head.text&#34;</span>] <span style="color:#f92672">=</span> token<span style="color:#f92672">.</span>head<span style="color:#f92672">.</span>text <span style="color:#75715e"># Dependent text</span>
      result_list<span style="color:#f92672">.</span>append(info_dict)
  
  <span style="color:#75715e"># Display the created dictionary list in DataFrame format and display it neatly on Jupyter</span>
  <span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
  <span style="color:#75715e">#pd.set_option(&#39;display.max_columns&#39;, 100)</span>
  df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(result_list)
  <span style="color:#f92672">from</span> IPython.display <span style="color:#f92672">import</span> display
  display(df)

  <span style="color:#75715e">### Dependency display</span>
  <span style="color:#75715e"># Illustrate the dependency graph format</span>
  <span style="color:#75715e">#Colaboratory requires a little ingenuity to display directly on</span>
  <span style="color:#75715e">#https://stackoverflow.com/questions/58892382/displacy-from-spacy-in-google-colab</span>
  <span style="color:#f92672">from</span> spacy <span style="color:#f92672">import</span> displacy
  displacy<span style="color:#f92672">.</span>render(doc, style<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dep&#39;</span>, jupyter<span style="color:#f92672">=</span>True, options<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;distance&#39;</span>: <span style="color:#ae81ff">90</span>})

  <span style="color:#75715e">### Visualization of abstract classification</span>
  <span style="color:#75715e">#If there is no place name etc. in the entered text,#UserWarning: [W006] No entities to visualize found in Doc object</span>
  <span style="color:#75715e">#Abstract classification display</span>
  ent_result_list <span style="color:#f92672">=</span> []
  <span style="color:#66d9ef">for</span> ent <span style="color:#f92672">in</span> doc<span style="color:#f92672">.</span>ents:
    ent_dict <span style="color:#f92672">=</span> {}
    ent_dict[<span style="color:#e6db74">&#34;.text&#34;</span>]<span style="color:#f92672">=</span>ent<span style="color:#f92672">.</span>text
    ent_dict[<span style="color:#e6db74">&#34;.start_char&#34;</span>]<span style="color:#f92672">=</span>ent<span style="color:#f92672">.</span>start_char
    ent_dict[<span style="color:#e6db74">&#34;.end_cahr&#34;</span>]<span style="color:#f92672">=</span>ent<span style="color:#f92672">.</span>end_char
    ent_dict[<span style="color:#e6db74">&#34;.label_&#34;</span>]<span style="color:#f92672">=</span>ent<span style="color:#f92672">.</span>label_
    ent_result_list<span style="color:#f92672">.</span>append(ent_dict)
  Displaying <span style="color:#75715e">#DataFrame in table format</span>
  display(pd<span style="color:#f92672">.</span>DataFrame(ent_result_list))
  <span style="color:#75715e">#Display in marking format</span>
  displacy<span style="color:#f92672">.</span>render(doc, style<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ent&#39;</span>, jupyter<span style="color:#f92672">=</span>True, options<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;distance&#39;</span>: <span style="color:#ae81ff">90</span>})
  
  <span style="color:#75715e">### Keyword enumeration display</span>
  It will be output <span style="color:#66d9ef">with</span> the <span style="color:#75715e"># prefix / suffix added</span>
  <span style="color:#66d9ef">for</span> chunks <span style="color:#f92672">in</span> doc<span style="color:#f92672">.</span>noun_chunks:
    <span style="color:#66d9ef">print</span>(chunks,end<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;, &#34;</span>)
</code></pre></div><p>Click here for the execution method</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py"><span style="color:#75715e">#How to use sample</span>
<span style="color:#f92672">import</span> spacy
nlp <span style="color:#f92672">=</span> spacy<span style="color:#f92672">.</span>load(<span style="color:#e6db74">&#39;ja_ginza&#39;</span>)

target_str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Gonbei&#39;s Aka-chan caught a cold. Tokyo Patent Licensing Office.&#34;</span>
easy_display_nlp(nlp, target_str)
</code></pre></div><p>Display morphological analysis results and main attributes in tabular form,
In addition, the dependency and the extraction of a person&rsquo;s name and place name are illustrated.
What kind of analysis will this function use?
And it is supposed to be used when first searching.</p>
<h2 id="ginza-can-also-perform-vector-operations-on-wordssentences">GiNZA can also perform vector operations on words/sentences</h2>
<p>The similarity can be calculated by vectorizing the sentence as follows.
(Built-in model already learned)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">doc1 <span style="color:#f92672">=</span> nlp (<span style="color:#e6db74">&#39;This ramen is delicious&#39;</span>)
doc2 <span style="color:#f92672">=</span> nlp (<span style="color:#e6db74">&#39;Let&#39;</span>s go eat curry<span style="color:#e6db74">&#39;)</span>
doc3 <span style="color:#f92672">=</span> nlp (<span style="color:#e6db74">&#39;I&#39;</span>m sorry, I can<span style="color:#e6db74">&#39;t go to the alumni association&#39;</span>)

<span style="color:#66d9ef">print</span>(doc1<span style="color:#f92672">.</span>similarity(doc2))
<span style="color:#66d9ef">print</span>(doc2<span style="color:#f92672">.</span>similarity(doc3))
<span style="color:#66d9ef">print</span>(doc3<span style="color:#f92672">.</span>similarity(doc1))

<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.8385934558551319</span>
<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.6690503605367146</span>
<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0.5515445470506148</span>
<span style="color:#f92672">&gt;</span> <span style="color:#75715e"># The two food types are the most similar.</span>
</code></pre></div><p>It seems that vectorization of words can be realized in the same way.
Check if you have vector information in <code>token.has_vector'', It may be better to consider returning to the basic form with </code>token.lemma_``.
For GiNZA trained models
I haven&rsquo;t seen it yet, so I&rsquo;ll check it later.</p>
<p>That&rsquo;s all about GiNZA&rsquo;s know-how.
No prerequisite knowledge/prerequisite environment required.
Just open Colaboratory in your browser and run the above code in order.
<font color="Red">** Anyone can realize highly accurate and multifunctional natural language analysis with super ease! **</font></p>
<h2 id="example-of-use-analysis-of-party-syntax-that-protects-the-people-from-nhk">(Example of use) Analysis of party syntax that protects the people from NHK</h2>
<p>&ldquo;Party syntax to protect the people from NHK&rdquo; is
I can&rsquo;t understand what you are protecting from what.
But don&rsquo;t worry.
Now you know it in one shot. <strong>Yes, if it&rsquo;s GiNZA</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">target_str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Party protecting NHK from the party protecting NHK from the party protecting NHK from the party protecting the party from NHK protecting party from the party protecting NHK from the party protecting NHK from the party protecting party from the party&#34;</span>
easy_display_nlp(nlp, target_str)
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/193512/cc8b6f00-633f-d759-7750-52b94f508661.png" alt="nhkkoubun.PNG"></p>
<p>*Those who want to understand the party syntax that protects the people from NHK as a human being
Please refer to the wonderful article below.
<a href="https://qiita.com/MirrgieRiana/items/da7dade622770a04d8f7">https://qiita.com/MirrgieRiana/items/da7dade622770a04d8f7</a></p>
<h1 id="omake-a-point-memo-that-made-me-confused-by-making-the-above-sample">(Omake) A point memo that made me confused by making the above sample</h1>
<h2 id="i-am-confused-about-the-use-on-the-colaboratory">I am confused about the use on the Colaboratory</h2>
<p>If you just install pip, you will get an error at runtime.
According to some seniors&rsquo; information, restart Colaboratory,
There are also methods such as this, and I went right and left before I reached the above method.
However, if you look closely, the above code was also written on the GiNZA official website.</p>
<p>Initially, I did not understand this method,
<code>nlp = spacy.load('ja_ginza')'' part,</code>nlp = spacy.load(r&rsquo;/usr/local/lib/python3.6/dist-packages/ja_ginza/ja_ginza-2.2.0&rsquo;)&rsquo;&rsquo;
I changed it like this and devised the method of passing the pass directly.
I will report that it will work even if it does not require extra code execution.
<code>!find / | grep spacy | grep data</code>
Check the installation path on GiNZA Colaboratory with
It is a method to specify the absolute path directly when spacy.load.</p>
<h2 id="im-confused-even-though-the-part-of-speech-is-a-ud-standard-such-as-propn">I&rsquo;m confused even though the part of speech is a UD standard such as &ldquo;PROPN&rdquo;</h2>
<p>In some examples,
&ldquo;See, this word has been parsed as PROPN!&rdquo;
It seems that it seems that the explanation is over.
(I don&rsquo;t know if I don&rsquo;t say &ldquo;noun&rdquo; or &ldquo;verb&rdquo;)</p>
<p>These Universal Dependencies classifications
It seems to be a standard internationally, and I&rsquo;m just not studying,
I also wrote down the Japanese classifications and investigated the correspondence.</p>
<p>Also, because there was too much attribute information that could be used after analysis,
A little ingenuity was made to make the dataframe table format easier to see.</p>
<h2 id="displacyrender-is-not-displayed-in-colabo-and-confusing">&ldquo;displacy.render&rdquo; is not displayed in Colabo and confusing</h2>
<p>If you normally use the graph display (displacy.render) of dependency and person name/place name extraction
``Serving on http://0.0.0.0:5000 &hellip;&rsquo;&rsquo;
Etc., the server for display starts up,
It seems that the flow is to access the server and see the diagram,
Set the option to display it directly in Colaboratory.</p>
<p>This is the end of the GiNZA know-how.</p>
<h1 id="font-colorreda-magic-trick-that-anyone-can-easily-look-like-live-codingfont"><font color="Red">A magic trick that anyone can easily look like live coding</font></h1>
<p>Now, from here I don&rsquo;t really want to introduce <strong>The world of bad children</strong>.
First of all, I demonstrated live coding like this,
Please see the gif video.</p>
<p>Live coding magic trick (pip part of environment construction omitted)
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/193512/323ef17c-1cdc-a907-84dd-2682cf1caca2.gif" alt="ginza_demo_itibu.gif"></p>
<h2 id="event-result">Event result</h2>
<p>Despite declaring &ldquo;magic trick&rdquo;,
&ldquo;It really looked like I was coding live,&rdquo; he said.</p>
<p>Expecting a Tsukkomi like &ldquo;No, it&rsquo;s actually not hit w&rdquo;,
Although I put a little lie like a lie,
&ldquo;It&rsquo;s easy to find out&hellip;&rdquo;
Because I put too much Kodawari.
Unexpectedly, it looks like a super-energy
~~ Usually there is no such stupid implementation ~~</p>
<p>With GiNZA that can easily perform advanced tasks in a few lines,
<strong>Automatic live coding</strong> is synergistic!</p>
<h1 id="font-colorredi-tried-to-make-a-live-coding-system-with-auto-font"><font color="Red">I tried to make a live coding system with auto. </font></h1>
<h2 id="implementation-policy-is-a-good-blend-of-automatic-and-manual">Implementation policy is a good blend of automatic and manual</h2>
<p>The main policy is automatic typing using <code>pyautogui</code>.
The details of the automation by <code>pyautogui</code> are the same as the following articles, so please refer to them.
<a href="https://qiita.com/youwht/items/616ccc062725fa050a34">I tried to create a system that automates &ldquo;Shakei&rdquo; and accumulates merit automatically. </a></p>
<p>However, this is &ldquo;fully automated&rdquo;,
**There is no live feeling. **
Just by writing the code fully automatically,
Adlib does not work, and there is a gap with talk.</p>
<p>So, as another policy,
<strong>Keyboard event handling is important</strong>.</p>
<p>Each time you press a special command (this time, ctrl+Q),
Automatically type the code for one cell.
In other words, the momentary manual feeling when starting to write each cell,
Above all, <strong><font color="Red">It is important to perform &ldquo;manual&rdquo; only for &ldquo;execution&rdquo; of each cell! </font></strong></p>
<p>With this moderate blend of automatic and manual,
While coding/typing is automatic,
<strong>The reason why only &ldquo;the pleasure of hitting the ENTER key&rdquo; remains manually</strong>.
In order to carry out while explaining while talking,
It is also perfect for events such as LT.</p>
<h2 id="how-to-implement-keyboard-event-handling">How to implement keyboard event handling</h2>
<p>Use keyboard library.
*This is not Colaboratory,
Note that it is implemented/executed on the PC side for presentation</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">pip install keyboard
</code></pre></div><p>See the following for the detailed specifications of this library.
<a href="https://github.com/boppreh/keyboard#keyboardon_press_keykey-callback-suppressfalse">https://github.com/boppreh/keyboard#keyboardon_press_keykey-callback-suppressfalse</a></p>
<h2 id="basic-usage-of-keyboard-library">Basic usage of keyboard library</h2>
<p>The most important points are as follows. (See all codes below for details)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">keyboard<span style="color:#f92672">.</span>add_hotkey(<span style="color:#e6db74">&#39;ctrl+q&#39;</span>, my_auto_func, args<span style="color:#f92672">=</span>(<span style="color:#ae81ff">1</span>, ))
</code></pre></div><p>Add a hotkey like this,
Each time ctrl+q is pressed,
Run the autotyping function (my_auto_func) created using pyautogui.</p>
<p>List the contents you want to type in advance with a character string,
In my_auto_func, you can output them in order.
(Type the character string for the first cell in the first run, and the character string for the second cell in the second run)</p>
<h2 id="keyboard-library-troubles">keyboard library troubles</h2>
<p>There seems to be a bug when you press the &ldquo;half-width/full-width&rdquo; key.
It seems that the hotkey will be canceled.</p>
<p>Initially, the sentence to be analyzed by natural language processing is
I was planning to enter it manually.
However, I could not solve this problem,
I decided to do all typing automatically.
(Only shift + enter of execution is manual ♪)</p>
<h2 id="problemsproblems-with-pyautogui">Problems/problems with Pyautogui</h2>
<p>If you try to enter &ldquo;:&rdquo; on a keyboard other than the US keyboard,
&ldquo;Shift+:&rdquo; key is sent and &ldquo;*&rdquo; is input.
Reference: <a href="https://teratail.com/questions/79973">https://teratail.com/questions/79973</a></p>
<p>Although I took some measures by referring to the link above, in the end,Stop typing each character with the typewrite command as follows,</p>
<pre><code class="language-py:" data-lang="py:">pyautogui.typewrite(&quot;abcdefg&quot;, interval = 0.1)
</code></pre><p>Operate/via clipboard as below,
I implemented it by simply sticking with ctrl+v.</p>
<pre><code class="language-py:" data-lang="py:">#Copy text to clipboard
pyperclip.copy(cp_str)
# Paste all strings and register
pyautogui.hotkey('ctrl','v')
</code></pre><p>If you want to input Japanese because of the &ldquo;half-width/full-width&rdquo; key problem,
~~ It is troublesome to make Giji Henkan like Auto Sutra ~~
This is because it is easier to create via the clipboard.
This time, it&rsquo;s unnatural that Japanese comes out directly without going through conversion.</p>
<p>Also, at Colaboratory
If you hit &ldquo;line feed&rdquo;, it will be indented automatically, so
For a key emulation method other than the clipboard,
If you do not process the code string to be typed, the indentation will shift.
The clipboard method does not consider it,
It is a great merit to copy and paste the original code as it is ♪</p>
<h1 id="now-anyone-can-live-code-in-lt-">Now, anyone can live code in LT! ?</h1>
<p>I thought that, but once I made it and looked at automatic typing,
<strong><font color="Red">There was the biggest miscalculation</font></strong>.</p>
<p>Because one character appears at equal intervals,
<strong><font color="Red">I can&rsquo;t feel any human touch! </font></strong></p>
<p><strong><font color="Red"> Typing proceeds at the same pace as it has happened. </font></strong>
<del>I did not notice at all when I was making a sutra</del></p>
<p>Even if you aim for Uke on the premise that it will come out (last sushi by yourself),
<strong><font color="Red"> It wouldn&rsquo;t be fun if it came out easily. </font></strong></p>
<p>So I thought about tuning so that it gives a natural atmosphere.</p>
<h2 id="automatic-type-tuning-failure-example">Automatic type tuning (failure example)</h2>
<p>The method originally thought was
<code>pyautogui.hotkey</code> and <code>pyautogui.typewrite</code>
To make the typing interval random,
How to set interval and put sleep in random numbers.</p>
<p>However, there was a problem that typing was too slow.
There seems to be a &ldquo;minimum operation interval&rdquo; in pyautogui,
There is always a certain amount of waiting for each operation.
If you use it for each character, typing will be too slow.</p>
<p>How to wait such as interval and sleep,
How to hit, such as hotkey or typewrite,
Such as the waiting time random number setting range,
I combined some, but it doesn&rsquo;t look natural.</p>
<h2 id="automatic-type-tuning-adoption-example">Automatic type tuning (adoption example)</h2>
<p>Looking at automatic typing,
Rather than typing at appropriate intervals,
It seems more natural for multiple characters to appear together,
I realized that.
It feels like human beings can be typed in units of a few characters and hit in an instant.</p>
<p>So by combining multiple characters with appropriate probabilities
(That is, store the output character string in the clipboard before executing ctrl+v)
Implemented to output all at once.
See the code below for detailed implementation.</p>
<p>Actually impossible speed (multiple key inputs output at once)
This looked more natural. (This is my personal impression)
With this, it feels like human typing,
I was able to implement automatic typing.</p>
<p>~~ I was starting to work on natural typing rather than the original natural language processing ~ ~
~~ It was a dangerous sign because it was three days ago when I decided the theme ~~</p>
<h1 id="all-codes-of-live-live-coding-system">All codes of live live coding system</h1>
<p>The code below is the result of these various examinations.
If you replace the part of the character string of the input target,
With this, anyone can realize a live demo with LT live coding!</p>
<p>~~ It is written that abuse is strictly prohibited, but code that seems to be only exploitable ~~</p>
<pre><code class="language-py:" data-lang="py:">import pyautogui
import pyperclip
import time

import random

#Add keyboard event
import keyboard
#https://github.com/boppreh/keyboard#keyboardon_press_keykey-callback-suppressfalse

#''' Triple quotes are used as is with a line break.
#If you put any code group here,
Every time you press the # hotkey, the text will be written
# Pseudo conversion of Japanese is not supported (it is easy but it is troublesome)

my_str_list = [

'''!pip install &quot;https://github.com/megagonlabs/ginza/releases/download/latest/ginza-latest.tar.gz&quot;
''',

'''import pkg_resources, imp
imp.reload(pkg_resources)
''',

'''import spacy
nlp = spacy.load('ja_ginza')
''',

'''
doc = nlp (&quot;Pizza party in Tokyo today. Gonbei's baby had a cold.&quot;)
''',

'''for s in doc.sents:
  for t in s:
    info = [t.orth_, t._.reading, t.tag_]
    print(info)
''',

'''from spacy import displacy
displacy.render(doc, style='dep', jupyter=True, options={'distance': 90})
''',

'''
displacy.render(doc, style='ent', jupyter=True, options={'distance': 90})
''',

'' doc = nlp (&quot;Party protecting the people from the party protecting the people from NHK protecting the people from the party protecting the people from the party&quot;)
displacy.render(doc, style='dep', jupyter=True, options={'distance': 90})
''',

'''doc1 = nlp ('This ramen is delicious'')
doc2 = nlp ('Let's go eat curry')
doc3 = nlp ('I'm sorry, I can't go to the alumni association')
''',

'''print(doc1.similarity(doc2))
print(doc2.similarity(doc3))
print(doc3.similarity(doc1))
''',

]

#Global variables
now_counter = 0

#Main execution function (argument is not used)
def my_auto_func(arg_val):
  global now_counter
  # Prevents the process from continuing with the key used to set the hot key pressed. Little wait
  #Especially if you keep pressing the control key, etc.
  time.sleep(1.5)
  
  print(&quot;called: &quot;+str(now_counter))

  When the # key is pressed to output, if there is nothing to output next, processing ends
  if now_counter &gt;= len(my_str_list):
    print(&quot;END: finish&quot;)
    exit()
  
  cp_str = &quot;&quot;
  # Copy and paste version
  for my_char in my_str_list[now_counter]:
    # In order to add speed and speed, we used simultaneous pasting of multiple characters under specific conditions.
    sl_time = random.uniform(-0.03, 0.10)
    cp_str += my_char
    if sl_time &lt;0:
      #Continue without executing paste
      continue
    else:
      #Copy text to clipboard
      pyperclip.copy(cp_str)
      # Paste all strings and register
      pyautogui.hotkey('ctrl','v')
      # The one used for pasting is clear
      cp_str = &quot;&quot;
      # Sleep for random sleep
      time.sleep(sl_time)
  #After exiting the loop, paste if there is remaining
  if len(cp_str)&gt; 0:
      #Copy text to clipboard
      pyperclip.copy(cp_str)
      # Paste all strings and register
      pyautogui.hotkey('ctrl','v')
      # The one used for pasting is clear
      cp_str = &quot;&quot;
  
  
  now_counter += 1
  print(&quot;END: my_auto_func :&quot;+str(now_counter))

# Bonus. Functions for responding to mistakes during the demonstration
# Return the counter to the previous one and write the same code again, or end it.
def my_sub_func(arg_val):
  global now_counter
  print(&quot;called: &quot;+&quot;for_before&quot;)
  now_counter -=1
  
  When the # key is pressed to output, if the number is negative, processing ends
  if now_counter &lt;0:
    print(&quot;END: finish&quot;)
    exit()
  
  print(&quot;END: my_sub_func :&quot;+str(now_counter))

Below, the main routine
# If you switch full-width and half-width in the middle, don't touch because hotkey addition seems to be a bug.
# (Execute in half-width mode)
#When you want to stop, use &quot;ctrl +c&quot; to kill this Python side.
if __name__ == &quot;__main__&quot;:

  try:
    #Add hotkeys and their events only once.
    # Set main hotkey: Don't duplicate other shortcuts in your app
    keyboard.add_hotkey('ctrl+q', my_auto_func, args=(1, ))
    
    #Sub-hotkey settings: Don't duplicate other shortcuts in your app
    keyboard.add_hotkey('ctrl+i', my_sub_func, args=(1, ))

    print(&quot;Press ESC to stop.&quot;)

    keyboard.wait('esc')
    print(&quot;esc-END&quot;)

  except:
    import traceback
    print(traceback.format_exc())
    exit()

  exit()

</code></pre><h2 id="what-is-the-appeal-of-automatic-live-coding">What is the appeal of automatic live coding?</h2>
<p>Due to the limited time of LT,
Even if you demo Colaboratory,No matter how you think about it, it is more appropriate to prepare the code from the beginning,
It&rsquo;s crazy to live code. But,
<strong>It&rsquo;s as funny as madness</strong> (by Akagi)</p>
<p>But actually, the code is prepared in advance, and it looks dangerous.
<strong>Pleasure called Safety, Pleasure named Safety</strong> (by Tonegawa)
A mechanism that you can taste.</p>
<p>Anyone with this,
**It may be possible to disguise it as &ldquo;At first glance it looks like a super engineer&rdquo;.</p>
<ul>
<li>If it is originally implemented at this level, if it is Windows,
It is probably easier to use an automated tool such as &ldquo;UWSC&rdquo;.
I implemented it in Python so that I can reuse it on the Mac later.
(Not tested on Mac)</li>
</ul>
<h2 id="bonus-method-of-misdirection-when-performing-as-magic-trick">(Bonus) Method of misdirection when performing as magic trick</h2>
<p>Misdirection is mainly used as a magic trick,
A phenomenon or technique that draws the attention of the audience to another place that is not intended.</p>
<p>In order to make it look &ldquo;live,&rdquo; it is good to &ldquo;make&rdquo; the audience&rsquo;s assumptions.</p>
<p>・During the first launch of Colaboratory, it is done manually</p>
<ul>
<li>Search by typing Colaboratory in a browser.
・Appealing a sense of manualness by increasing the motion of shift+enter at runtime</li>
<li>When you are typing automatically, your hand is above the keyboard (obviously)
・Don&rsquo;t start from live coding,
If it&rsquo;s a guy, might it be super fast? To make you think,
Pretend before making an atmosphere of doing something very awesome, etc.</li>
</ul>
<p>#Postscript</p>
<h2 id="extremely-easy-natural-language-processing">Extremely easy natural language processing</h2>
<p>With GiNZA,
Very easy (browser only/no environment required)
Relentless (high precision/multifunction)
Being able to process natural language
I was able to express it ~ Delay the applause of Thunder Thunder ~ ~ Bokeh in the world ~ ~
(By Red Hot Chili Pepper)</p>
<p>This time it is actually called LT, but the time is 15 minutes, which is quite long,
~~ Isn&rsquo;t it already called LT? ~~
&ldquo;How to give interesting ideas&rdquo;
&ldquo;Learning method to manage with technology&rdquo;
I have two stories.</p>
<p>I listed it as a &ldquo;learning method to manage with technology&rdquo;
To illustrate the &ldquo;HB pencil method&rdquo;,
I gave a live coding demonstration this time.</p>
<h2 id="what-is-the-hb-pencil-method">What is the HB Pencil Method?</h2>
<p><strong>Similar to breaking a HB pencil into a fold</strong>
<strong>A learning method that you can take for granted</strong>
<strong>The important thing is to &ldquo;recognize&rdquo;</strong></p>
<p>For example, natural language processing is easy,
It is a learning method that you only need to recognize that you can do it.</p>
<p>Something (when coming up with an idea)
Speaking of which, if you look it up in GiNZA, you can “do”, just think.
If you really want to know, after thinking about doing it,
You can revisit this article or check GiNZA.
Just by looking at this LT, learning is already over!
~~ When I think of that word in my head ~~
<del>Because it&rsquo;s already over</del>
~~ You can use it if you&rsquo;ve learned! ~~</p>
<p>● Learning methods such as introductory books/curriculum/qualification exams
⇒ The person who does it is nice, but I&rsquo;m sleeping on the way, so it&rsquo;s no good. Painful.</p>
<p>●Learn to make something by moving your hand
⇒It may be this in the end.
However, because human time is limited, everything is impossible.
What is your motivation?</p>
<p>●Lazy evaluation study method
⇒Doing when you need it is similar to the HB pencil method,
If there is no information on &ldquo;What would you learn if you could learn?&rdquo;
　I can&rsquo;t come up with ideas when I think of an idea.
Also, when you need it,
　I have a feeling of being punished, so I don&rsquo;t personally like the expression.</p>
<p>● HB pencil method
⇒Speaking of this article, only the image of the execution result of GiNZA should be known,
Learning method of the degree.
　I will only recognize that it can be done in about 3 minutes.
The merit is that it is easy.
Even if you don&rsquo;t have time to look at the details, you can vaguely understand what you can do,
It has the effect of making it easier to come up with ideas, including unlearned technologies.
Would you like to learn that at a later date? Motivation is likely to occur.</p>
<p>~~ Like inhaling and exhaling air! ~~
~~ It&rsquo;s natural mental strength to be able to operate the stand! ~~
~~ Exactly the learning method that rules the world ~~</p>
<h2 id="summary">Summary</h2>
<p>So this time,
&ldquo;Recognize that you can perform high-precision natural language analysis only with a browser!&rdquo;
&ldquo;Let&rsquo;s recognize that LT can demonstrate semi-automatic live coding!&rdquo;
I will introduce two examples.</p>
<p>When everyone has an idea enlightenment,
If this article works a little better, I&rsquo;m not so happy.</p>
<p>Finally, with GiNZA developers,
We would like to thank everyone involved in the event.</p>
<p>that&rsquo;s all.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
