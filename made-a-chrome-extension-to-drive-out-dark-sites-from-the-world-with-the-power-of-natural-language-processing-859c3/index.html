<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Made a Chrome extension to drive out dark sites from the world with the power of natural language processing | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Made a Chrome extension to drive out dark sites from the world with the power of natural language processing</h1>
<p>
  <small class="text-secondary">
  
  
  Apr 22, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/mecab"> mecab</a></code></small>


<small><code><a href="https://memotut.com/tags/chrome-extension"> chrome-extension</a></code></small>


<small><code><a href="https://memotut.com/tags/sentiment-analysis"> sentiment analysis</a></code></small>


<small><code><a href="https://memotut.com/tags/googlecloudfunctions"> GoogleCloudFunctions</a></code></small>

</p>
<pre><code>#Motivation
</code></pre>
<p>Coronavirus pandemic is all the dark news these days&hellip; :pensive:
→If you only see the bright news, you will feel positive!</p>
<h1 id="made">Made</h1>
<p>A Chrome extension that makes Google search results less visible as the content is darker.
Chrome Store: <a href="https://chrome.google.com/webstore/detail/opty-optimistic-search-fi/bgjckeoghfogflpgbmgikhdmaidnkamd/related?hl=ja">Opty</a>
<a href="https://github.com/tomoino/opty-pn-classifier">github</a></p>
<h3 id="actual-screen">Actual screen</h3>
<table>
<thead>
<tr>
<th>Dark site</th>
<th>Bright site</th>
</tr>
</thead>
<tbody>
<tr>
<td><img width="350" alt="Screenshot 2020-04-22 11.01.17.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/623530/8851fba1-ea6c-2b40-64b8-7fb198ed7c6b.png"></td>
<td><img width="350" alt="Screenshot 2020-04-22 11.03.22.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/623530/22fde8fa-1942-491f-7f76-ba5fb9710850.png"></td>
</tr>
</tbody>
</table>
<h3 id="how-to-use">How to use</h3>
<p>Just install the Chrome extension from <a href="https://chrome.google.com/webstore/detail/opty-optimistic-search-fi/bgjckeoghfogflpgbmgikhdmaidnkamd/related?hl=ja">here</a> and search!
Reference: <a href="https://support.google.com/chrome_webstore/answer/2664769?hl=ja">How to install the extension</a></p>
<p>#environment
Number of staff: 2 university students (<a href="https://twitter.com/tomoino925/">Tomohiro Inoue</a>,<a href="https://twitter.com/dubianhaozhi">TakashiWatanabe</a>)
Production period: 1 day
Cloud Functions
Python 3.7
JavaScript
MeCab</p>
<p>##System configuration
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/623530/351d902e-d552-35fb-2b01-1c3b2930ab98.png" alt="Figure.png"></p>
<p>#Brightness judgment
The sentence is broken down into words and each element is judged to be bright or dark.</p>
<p>MeCab is used for the process of breaking sentences into words.
For example,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-morph.py" data-lang="morph.py"><span style="color:#f92672">import</span> MeCab

tagger <span style="color:#f92672">=</span> MeCab<span style="color:#f92672">.</span>Tagger()
result <span style="color:#f92672">=</span> tagger<span style="color:#f92672">.</span>parse(<span style="color:#e6db74">&#39;The new coronavirus is all over the world.&#39;</span>)
<span style="color:#66d9ef">print</span>(result)
</code></pre></div><p>When you execute the process</p>
<pre><code class="language-analysis" data-lang="analysis">New type noun, general, *,*,*,*, new type, singata, singata
Corona noun, general, *,*,*,*, corona, corona, corona
Virus noun, general, *,*,*,*, virus, virus, virus
Is a particle, case particle, general, *,*,*, is, ga, ga
World noun, general, *,*,*,*, world, sekai, sekai
Target noun, suffix, adjective stem, *,*,*, target, text, text
Particle, adverb, *,*,*,*, ni, ni, ni
Large prefix, noun connect, *,*,*,*,large,die,die
Fashion noun, sahen connection, *,*,*,*, fashion, ryuko, ryuko
Verb, self-reliance, *, *, sa-hen/suru, continuous form, do, shi, shi
Te particle, connective particle, *,*,*,*,te,te,te
I verb, non-self-supporting, *, *, one-step, continuous form, there, i, i
More auxiliary verbs, *,*,*, special mass, basic form, masu, mass, mass
.. Symbol, punctuation, *,*,*,*,. ,. ,.
EOS
</code></pre><p>Will be disassembled.
From the decomposed result, the unused form of each word is extracted and used.</p>
<p>To determine the brightness of an element, the Inui-Suzuki Laboratory of Tohoku University has published <a href="http://www.cl.ecei.tohoku.ac.jp/index.php?Open.Iused%20Resources%2FJapanese%20Sentiment%20Polarity%20Dictionary">Japanese Evaluation Polarity Dictionary</a>.</p>
<p>In this dictionary, Japanese idioms are classified into positive (bright) or negative (dark) and nouns into three levels: p (positive), n (negative), and e (neither).</p>
<pre><code class="language-wago.121808.pn" data-lang="wago.121808.pn">Negative (experience)
Negative (experience) give up
Negative (experience) Akiru
Negative (experience)
Negative (experience)
</code></pre><pre><code class="language-pn.csv.m3.120408.trim" data-lang="pn.csv.m3.120408.trim">Thank you p ~ There is / increases (existence / nature)
Thank you p ~ There is / increases (existence / nature)
Thank you for being n ~ Becoming (evaluation/emotion) Subjectivity
E as it is/becomes (evaluation/emotion) subjectivity
Being e-as-is, becoming (evaluation/emotion) subjectivity
</code></pre><p>Each of the constituent elements of the sentence is replaced with 1 if positive, -1 if negative, and 0 otherwise, and the average is taken as the sentence brightness.</p>
<p>Below are the points I stumbled upon during development.</p>
<h2 id="stumble-point-1-polarity-dictionary--brightness-of-each-word">Stumble point 1: Polarity dictionary ≠ Brightness of each word</h2>
<p>I was thinking easily if I could divide the sentence into words and search the polar dictionary using the words as keys, but it was not so simple. In the polarity dictionary, not only a single word such as &ldquo;good&rdquo; but also an element consisting of two or more words such as &ldquo;bad&rdquo; (in this case, &ldquo;good&rdquo; + &ldquo;not&rdquo;) are registered.
Therefore, I restructured the dictionary so that it can be searched with elements consisting of multiple words, and made it pickle before use.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:main.py" data-lang="python:main.py">    <span style="color:#75715e">#Store in dictionary</span>
    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> pn_noun_file:
        line <span style="color:#f92672">=</span> line<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">``</span>)<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#39;</span>)
        <span style="color:#66d9ef">if</span> line[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;e&#39;</span>: <span style="color:#75715e"># ignore lines that are neither positive nor negative</span>
            <span style="color:#66d9ef">continue</span>
        <span style="color:#75715e">#List of basic words converted from the polar dictionary</span>
        basic_form <span style="color:#f92672">=</span> convert_to_basic_form(line[<span style="color:#ae81ff">0</span>])
        <span style="color:#75715e"># Ignore lines that cannot get the basic form and lines that have a single basic form</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> basic_form:
            <span style="color:#66d9ef">continue</span>
        <span style="color:#66d9ef">elif</span> len(basic_form) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">and</span> len(basic_form[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
            <span style="color:#66d9ef">continue</span>
        key <span style="color:#f92672">=</span> basic_form[<span style="color:#ae81ff">0</span>]
        <span style="color:#66d9ef">if</span> key <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> pn_dict:
            pn_dict[key] <span style="color:#f92672">=</span> {}
        <span style="color:#75715e"># Stored by combining the basic shape and brightness</span>
        pn_dict[key][(<span style="color:#e6db74">&#39;,&#39;</span>)<span style="color:#f92672">.</span>join(basic_form)] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> line[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;p&#39;</span> <span style="color:#66d9ef">else</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
</code></pre></div><h2 id="stumbling-point-2-not-fun--positive">Stumbling point 2: Not fun = Positive?</h2>
<p>While &ldquo;bad&rdquo; is registered as a negative element in the polarity dictionary, &ldquo;not enjoyable&rdquo; is not registered, so it was judged as a positive word by reacting only to the &ldquo;happy&rdquo; part. It was Therefore, when the shape becomes &ldquo;not&rdquo;, the brightness value up to that point is reversed.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:main.py" data-lang="python:main.py"><span style="color:#75715e"># PN judgment. Returns the average PN value of the requested elements.</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calc_pn</span>(basic_form):
    pn_dict <span style="color:#f92672">=</span> pickle<span style="color:#f92672">.</span>load(open(<span style="color:#e6db74">&#39;pn.pkl&#39;</span>,<span style="color:#e6db74">&#39;rb&#39;</span>))
    pn_values <span style="color:#f92672">=</span> [] <span style="color:#75715e"># Store the numerical value of PN judgment of each element in the sentence</span>

    <span style="color:#66d9ef">while</span> basic_form:
        pn_value <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        del_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e"># number to remove from list</span>
        beginning <span style="color:#f92672">=</span> basic_form[<span style="color:#ae81ff">0</span>] <span style="color:#75715e"># set the first word as key</span>

        <span style="color:#66d9ef">if</span> beginning <span style="color:#f92672">in</span> pn_dict:
            <span style="color:#66d9ef">for</span> index, word <span style="color:#f92672">in</span> enumerate(basic_form):
                <span style="color:#66d9ef">if</span> word <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#f92672">or</span> word <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;,&#34;</span>: <span style="color:#75715e"># When the sentence is broken, stop</span>
                    <span style="color:#66d9ef">break</span>
                <span style="color:#66d9ef">if</span> index <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
                    joined_basic_forms <span style="color:#f92672">=</span> beginning
                <span style="color:#66d9ef">else</span>:
                    joined_basic_forms <span style="color:#f92672">+=</span><span style="color:#e6db74">&#39;,&#39;</span> <span style="color:#f92672">+</span> word

                <span style="color:#66d9ef">if</span> word <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;none&#34;</span> <span style="color:#f92672">and</span> del_num <span style="color:#f92672">==</span> index: <span style="color:#75715e"># Positive/negative reversal required</span>
                    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;reverse&#39;</span>)
                    pn_value <span style="color:#f92672">*=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
                    del_num <span style="color:#f92672">=</span> index <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>

                <span style="color:#66d9ef">if</span> joined_basic_forms <span style="color:#f92672">in</span> pn_dict[beginning]:
                    pn_value <span style="color:#f92672">=</span> pn_dict[beginning][joined_basic_forms]
                    del_num <span style="color:#f92672">=</span> index <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>

        pn_values<span style="color:#f92672">.</span>append(pn_value)
        <span style="color:#66d9ef">del</span> basic_form[<span style="color:#ae81ff">0</span>:del_num]

    <span style="color:#66d9ef">return</span> sum(pn_values) <span style="color:#f92672">/</span> len(pn_values)
</code></pre></div><p>#Improvement points</p>
<ul>
<li>Slow: Currently, it takes about 3 seconds from displaying the search result to reflecting the style.</li>
<li>Bright page decoration: I want the brighter the page to stand out.</li>
</ul>
<p>#Finally
I had a lot of time refraining from corona, so I made it while studying during the spring break.
Others are under development!
If you like, please follow LGTM and Twitter!</p>
<p>Extension: <a href="https://chrome.google.com/webstore/detail/opty-optimistic-search-fi/bgjckeoghfogflpgbmgikhdmaidnkamd/related?hl=ja">Opty</a>Twitter: <a href="https://twitter.com/tomoino925/">Tomohiro Inoue</a>,<a href="https://twitter.com/dubianhaozhi">TakashiWatanabe</a></p>
<h1 id="references">References</h1>
<ol>
<li><a href="https://qiita.com/hatt0519/items/e6352d31311418f38227">I tried to make a gem for negative/positive judgment</a></li>
</ol>
<ul>
<li><a href="https://qiita.com/Yuhsak/items/7c8e2b131cc536ef9ba1">[Python] Speed up reading of time series CSV</a>
)</li>
<li><a href="https://cloud.google.com/functions?hl=ja">Cloud Functions</a></li>
<li><a href="https://qiita.com/RyBB/items/32b2a7b879f21b3edefc">How to make Chrome extension (super outline)</a></li>
<li><a href="https://qiita.com/mdstoy/items/9866544e37987337dc79">How to write manifest file of Chrome extension</a></li>
</ul>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
