<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>Using Search Tweets: Full Archive / Sandbox in Python | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Using Search Tweets: Full Archive / Sandbox in Python</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 4, 2019
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/twitter">Twitter</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/twitterapi">TwitterAPI</a></code></small>

</p>
<pre><code>I started Python for my thesis in [previous article](https://qiita.com/johnsakagami/items/7202368fe11e570e060e) and tried various things with Twitter API.
</code></pre>
<p>Python is no more than 10 days old. Well, my skill hasn&rsquo;t improved so much&hellip;</p>
<h2 id="premise-of-this-time-are-all-the-searches-on-the-twitter-official-website-displayed">Premise of this time: Are all the searches on the Twitter official website displayed?</h2>
<p>After all, the data collection of graduation thesis was a search on the Twitter official website that has full access to past tweets. Primitive.
By the way, I was taking the number of data in that way, but the number of search results with that keyword decreases ** unexpectedly ** as I go back in the past.</p>
<p>There is an unpleasant premonition that crosses my head.</p>
<p><strong>&ldquo;Maybe all searches on the Twitter official website are not displayed&hellip;?&quot;</strong></p>
<p>Certainly, it is not unthinkable that &ldquo;the more tweets you have in the past, the less browsing needs you have, so the search results will be thinned out.&rdquo;
Now there is no quantitative analysis or shit. It&rsquo;s a graduation thesis. (；・∀・)</p>
<h2 id="search-specifications-on-the-official-twitter-website">Search specifications on the official Twitter website</h2>
<p>There are several types of search result display formats for searches on the Twitter official website (hereinafter referred to as Twitter search).
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/508374/fbe9b464-1252-eb36-25c4-258ab5723094.png" alt="1.PNG">
The focus is often on the difference between &ldquo;topic tweets&rdquo; and &ldquo;latest.&rdquo;
(Before, there was a time when &ldquo;topic tweets&rdquo; was called &ldquo;topic&rdquo; and &ldquo;latest&rdquo; was called &ldquo;all tweets.&quot;)</p>
<p>According to the official Twitter announcement (“<a href="https://help.twitter.com/en/using-twitter/top-search-results-faqs">Frequently Asked Questions about Search Results</a>”),</p>
<blockquote>
<p>**Why doesn&rsquo;t my favorite tweet show up in the top tweets? **
The topical tweets are the ones most relevant to your search. Twitter determines relevance based on a number of factors, including the popularity of tweets (which many people respond to and share through retweets, replies, etc.), the keywords they contain. If you don&rsquo;t see your favorite Tweet in the Topic Tweets, it means your Tweet isn&rsquo;t very relevant to your search. Click or tap All Tweets (Latest) to view recent tweets that match your search keyword.</p>
</blockquote>
<p>Of course, the data acquisition this time also used the &ldquo;latest&rdquo; tab.
Previously it was called &ldquo;all tweets&rdquo;, so I thought it would be displayed all &hellip; but at the moment it is named &ldquo;latest&rdquo; and in the official announcement &ldquo;all displayed I couldn&rsquo;t confirm because I didn&rsquo;t have a clear announcement.</p>
<h2 id="what-i-did-this-time">What I did this time</h2>
<p>Therefore, I decided to use the free trial version of Search All Items (Search Tweets: Full Archive / Sandbox) of Twitter API to verify whether all the results of Twitter search are displayed.
Due to the limited number of requests (50 requests/month for Sandbox), quantitative search is not possible, but I wish I could search several times for verification.
Also, since I couldn&rsquo;t find a complete Japanese article about Search Tweets: Full Archive / Sandbox in my inspection, I&rsquo;ll try to put it together (although it&rsquo;s extremely preoccupied).
Acquisition of a Twitter developer account is already over.</p>
<h3 id="-development-environment-setting-in-dashboard">① Development environment setting in Dashboard</h3>
<p>First, it seems that you have to log in with a developer account and set the development environment of Search Tweets: Full Archive / Sandbox from Dashboard.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/508374/41156a2e-85b3-1f16-92c5-9479bba1e6ff.png" alt="2.PNG">
In the above figure, nothing is displayed because the settings have already been completed, but in the first state, ``You must first set up a dev environment before accessing an endpoint and viewing usage.&rsquo;&rsquo; is displayed in the lower part. I am. Click &ldquo;set up a dev environment&rdquo; and set &ldquo;Dev environment label&rdquo; and which app will use Search Tweets: Full Archive / Sandbox.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/508374/1d0ed6e4-c358-2a11-fb62-205168a2ac9e.png" alt="3.png">
The Dev environment label (<code>development</code> in this case) will be used later, and the App Name must be the same as the consumer key used for authentication.</p>
<h3 id="-points-that-stumble-in-the-code">② Points that stumble in the code</h3>
<p>I was wondering if <a href="https://qiita.com/johnsakagami/items/7202368fe11e570e060e">the code I used to search the previous free version</a>couldbeusedasis,butfirstIneededtorewritetheURLoftheendpoint(That&rsquo;sright).
What worked well with the free version
<code>https://api.twitter.com/1.1/search/tweets.json</code>
It was, but this time
<code>https://api.twitter.com/1.1/tweets/search/fullarchive/development.json</code>
have become. (Of course there is a description in <a href="https://developer.twitter.com/en/docs/tweets/search/api-reference/premium-search">Search Tweets: Premium search APIs reference</a>.)
As mentioned above, the Dev environment label you set is also included in this URL. In this case it is the <code>development</code> part. Please rewrite according to your own.</p>
<p>Also, I don&rsquo;t know why it is because I am unschooled, but the name of the parameter used is different between the search with the Standard search API and the search with the Premium search APIs. So, if I didn&rsquo;t change the point from the code used in the free version, it would not work.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/508374/67af28c6-cb25-7b12-aa72-363c803f5f2c.png" alt="5.PNG">
(↑<a href="https://developer.twitter.com/en/docs/tweets/search/api-reference/get-search-tweets">Search Tweets: Standard search API reference</a>)
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/508374/f0757c28-cdad-74b8-6706-c071212602da.png" alt="4.PNG">
(↑<a href="https://developer.twitter.com/en/docs/tweets/search/api-reference/premium-search">Search Tweets: Premium search APIs reference</a>)</p>
<p>The name of the parameter that contains the search query is &ldquo;<code>q</code>&rdquo; in the free version, whereas it is &ldquo;<code>query</code>&rdquo; in the Premium search APIs.
The other parameters were rewritten while looking at the reference.</p>
<p>Also, it&rsquo;s plain, but the name of the internal structure of json that is exhaled was also slightly different, so I am rewriting it.</p>
<p>###③ code
It is based on the previous code, so I will recite the code on which the previous code is based. Thank you very much.</p>
<blockquote>
<p><a href="https://qiita.com/tomozo6/items/d7fac0f942f3c4c66daf">Play with twitter API #3 (Get search results)</a></p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-test.py" data-lang="test.py"><span style="color:#75715e">#! python3</span>
<span style="color:#75715e"># -*- coding: utf-8 -*-</span>

<span style="color:#f92672">import</span> json
<span style="color:#f92672">from</span> requests_oauthlib <span style="color:#f92672">import</span> OAuth1Session

<span style="color:#75715e"># OAuth authentication part</span>
CK <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Acquired Consumer key&#39;</span>
CS <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Acquired Consumer secret&#39;</span>
AT <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;acquired Access token&#39;</span>
ATS <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Acquired Access token secret&#39;</span>
twitter <span style="color:#f92672">=</span> OAuth1Session(CK, CS, AT, ATS)

<span style="color:#75715e"># Twitter Endpoint (Get search results)</span>
url <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;https://api.twitter.com/1.1/tweets/search/fullarchive/development.json&#39;</span>

Parameters passed to <span style="color:#75715e"># Enedpoint</span>
keyword <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#34;Pikmin&#34;&#39;</span>

params <span style="color:#f92672">=</span>{
         <span style="color:#e6db74">&#39;query&#39;</span> :keyword ,<span style="color:#75715e"># search keyword</span>
         <span style="color:#e6db74">&#39;maxResults&#39;</span>: <span style="color:#ae81ff">20</span> ,<span style="color:#75715e"># number of tweets to get</span>
         <span style="color:#e6db74">&#39;fromDate&#39;</span>: <span style="color:#ae81ff">201301311500</span>,
         <span style="color:#e6db74">&#39;toDate&#39;</span>: <span style="color:#ae81ff">201302011500</span>
        }

req <span style="color:#f92672">=</span> twitter<span style="color:#f92672">.</span>get(url, params <span style="color:#f92672">=</span> params)

<span style="color:#66d9ef">if</span> req<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
    res <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(req<span style="color:#f92672">.</span>text)
    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> res[<span style="color:#e6db74">&#39;results&#39;</span>]:
        <span style="color:#66d9ef">print</span>(line[<span style="color:#e6db74">&#39;text&#39;</span>])
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;*******************************************&#39;</span>)
<span style="color:#66d9ef">else</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Failed: </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span>req<span style="color:#f92672">.</span>status_code)

</code></pre></div><p><code>'fromDate'</code> and <code>'toDate'</code> are optional parameters, but they are specified in UTC. It&rsquo;s not Japan time.
###④ ResultThe result of turning this code, and the result of a search on Twitter: &ldquo;&ldquo;Pikmin&rdquo; since:2013-02-01_00:00:00_JST until:2013-02-02_00:00:00_JST&rdquo; <a href="https://twitter.com/search?q=%22%E3%83%94%E3%82%AF%E3%83%9F%E3%83%B3%22%20since%3A2013-02-01_00%3A00%3A00_JST%20until%25Icompared3A2013-02-02_00%3A00%3A00_JST&amp;src=typed_query&amp;f=live">search result</a>.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/508374/7b0e47ec-a154-612c-0989-97d521b8e3ff.png" alt="6.PNG">
I tried enclosing the tweet displayed in only one of them in a red frame.
The tweets that start with &ldquo;RT @ XXXX :&rdquo; are displayed only in the search results by the API. Is it an official RT at the time&hellip;?
On the other hand, there were some tweets that were not displayed by the API search. I don&rsquo;t know about this anymore. why.
If you know anything, I would appreciate it if you could teach me.
(I wonder if the code is bad, I will put the end of the search result in the API that is displayed as dub)</p>
<p>##Maybe I can write my thesis
By the way, I don&rsquo;t know why there is a tweet that &ldquo;is not displayed in the search result by API but is displayed in the result of Twitter search&rdquo;, but the search result displayed in &ldquo;latest&rdquo; in Twitter search is retweet It seems that all are displayed except (except that there may be tweets that are not displayed in both &hellip;).
So, I think there is a certain validity for the quantitative analysis based on Twitter search.
I have managed to connect the skin on my neck, so I will do my best to write my thesis. (=゜ω゜) no</p>
<p>If you have any information, I would appreciate it if you could tell me.
Since I am still a beginner, please point out any points that you can not reach.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
