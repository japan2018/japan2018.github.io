<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Jupyter Notebook essential for software development | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Jupyter Notebook essential for software development</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 16, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/ipython">IPython</a></code></small>


<small><code><a href="https://memotut.com/tags/jupyter">Jupyter</a></code></small>


<small><code><a href="https://memotut.com/tags/jupyter-notebook">Jupyter-notebook</a></code></small>

</p>
<pre><code>Hello. I'm a software engineer who makes various embedded systems, games, web apps, iOS apps, signage control systems, etc.
</code></pre>
<p>About two and a half years ago, I thought that I should write in Python as a general-purpose scripting language that is difficult to realize only with a shell, and I was trying to learn Python while suffering.
Since I only use it occasionally, I was at a level where I forget how to write if and for loops every time.</p>
<p>However, about a year and a half ago, I learned that there is a REPL called Jupyter Notebook in a machine learning / data science book, and I tried using it by trying it, not only machine learning / data science , I found this to be useful for general tasks that require daily trial and error, and I am writing this article to spread it.</p>
<p>I think that Jupyter Notebook has a strong image of data analysis.</p>
<p>However, sending packets a little, using it as a calculator that can do complicated things, converting various file formats, copying complicated files, etc. Real time is not required, you may do it only once It&rsquo;s very suitable for doing all sorts of miscellaneous things that you may or may not have done afterwards.
It&rsquo;s like stepping, and you can write a script by trying each sentence and checking if the result is as expected or wrong, so you can write code with high certainty quickly.</p>
<p>Also, when writing a program in a dynamic type language, there is a drawback that the code tends to be written in a state where the completion does not work well, but in the case of Jupyter Notebook, while directly examining the materialized instance, Since methods and fields can be completed, the completion is as effective as that of statically typed languages, and the time required for reading references can be greatly reduced.</p>
<p>This time,</p>
<ul>
<li>Case used for analysis</li>
<li>Case used as a calculator</li>
<li>Case used to create binary data and output packets</li>
<li>Case of format conversion</li>
</ul>
<p>I will explain the four genres of.</p>
<h1 id="case-used-for-analysis">Case used for analysis</h1>
<p>When making software, there are quite a few situations in which you have to analyze behavior on a scale that cannot be tracked by a debugger, or where you need to investigate something that cannot be done with existing tools.
Sometimes a device that should be controllable by TCP or UDP is not controllable, so I&rsquo;m asked to investigate, or I want to casually check what kind of value the sensor data returns, without looking at the specifications. , There are some characters that can be displayed in a particular font and some that cannot, so I&rsquo;m asked to decide the range of characters that can be used by the system.</p>
<p>Basically, it will be necessary to analyze the log or read the metadata and manage it, but when using Jupyter, it is comfortable to proceed while checking ad hoc.</p>
<h2 id="analysis-of-packet-captured-by-wireshark">Analysis of packet captured by Wireshark</h2>
<p>In response to a request for investigation of the problem that the device controlled by TCP/UDP may not be able to control occasionally, we investigate the cause whether it is the control software side, the network, or the device side. There was something I had to do. For the time being, I thought that it would be somehow to see the communication, so I asked for a switching hub capable of port mirroring to be prepared, and I had tshark, a command line tool of Wireshark, collect several GB level packets per day.
Convert the obtained capture file, .pcap file into Pandas DataFrame with the following code.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">makeDfFromPcap</span>(filename):
    p <span style="color:#f92672">=</span> dpkt<span style="color:#f92672">.</span>pcapng<span style="color:#f92672">.</span>Reader(open(filename,<span style="color:#e6db74">&#39;rb&#39;</span>))

    dDict <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;t&#39;</span>:[],<span style="color:#e6db74">&#39;src&#39;</span>:[],<span style="color:#e6db74">&#39;dst&#39;</span>:[],<span style="color:#e6db74">&#39;type&#39;</span>:[],<span style="color:#e6db74">&#39;srcport&#39;</span>:[],<span style="color:#e6db74">&#39;dstport&#39;</span>:[],<span style="color:#e6db74">&#39;length&#39;</span>:[ ]}
    count <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">for</span> ti,buf <span style="color:#f92672">in</span> p:
        <span style="color:#66d9ef">try</span>:
            eth <span style="color:#f92672">=</span> dpkt<span style="color:#f92672">.</span>ethernet<span style="color:#f92672">.</span>Ethernet(buf)
        <span style="color:#66d9ef">except</span> dpkt<span style="color:#f92672">.</span>NeedData:
            <span style="color:#66d9ef">pass</span>
        <span style="color:#66d9ef">if</span> type(eth<span style="color:#f92672">.</span>data) <span style="color:#f92672">==</span> dpkt<span style="color:#f92672">.</span>ip<span style="color:#f92672">.</span>IP:
            ip <span style="color:#f92672">=</span> eth<span style="color:#f92672">.</span>data
            src <span style="color:#f92672">=</span> ip<span style="color:#f92672">.</span>src
            dst <span style="color:#f92672">=</span> ip<span style="color:#f92672">.</span>dst
            src_a <span style="color:#f92672">=</span> socket<span style="color:#f92672">.</span>inet_ntoa(src)
            dst_a <span style="color:#f92672">=</span> socket<span style="color:#f92672">.</span>inet_ntoa(dst)
            t <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;IP&#39;</span>
            srcPort <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
            dstPort <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
            <span style="color:#66d9ef">if</span> type(ip<span style="color:#f92672">.</span>data) <span style="color:#f92672">==</span> dpkt<span style="color:#f92672">.</span>udp<span style="color:#f92672">.</span>UDP:
                srcPort <span style="color:#f92672">=</span> ip<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>sport
                dstPort <span style="color:#f92672">=</span> ip<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>dport
                t <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;UDP&#39;</span>
            <span style="color:#66d9ef">elif</span> type(ip<span style="color:#f92672">.</span>data) <span style="color:#f92672">==</span> dpkt<span style="color:#f92672">.</span>tcp<span style="color:#f92672">.</span>TCP:
                srcPort <span style="color:#f92672">=</span> ip<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>sport
                dstPort <span style="color:#f92672">=</span> ip<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>dport
                t <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;TCP&#39;</span>
            dDict[<span style="color:#e6db74">&#39;t&#39;</span>]<span style="color:#f92672">.</span>append(ti)
            dDict[<span style="color:#e6db74">&#39;src&#39;</span>]<span style="color:#f92672">.</span>append(src_a)
            dDict[<span style="color:#e6db74">&#39;dst&#39;</span>]<span style="color:#f92672">.</span>append(dst_a)
            dDict[<span style="color:#e6db74">&#39;type&#39;</span>]<span style="color:#f92672">.</span>append(t)
            dDict[<span style="color:#e6db74">&#39;srcport&#39;</span>]<span style="color:#f92672">.</span>append(srcPort)
            dDict[<span style="color:#e6db74">&#39;dstport&#39;</span>]<span style="color:#f92672">.</span>append(dstPort)
            dDict[<span style="color:#e6db74">&#39;length&#39;</span>]<span style="color:#f92672">.</span>append(ip<span style="color:#f92672">.</span>len)
            count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
            <span style="color:#66d9ef">if</span> count <span style="color:#f92672">%</span><span style="color:#ae81ff">10000</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
                <span style="color:#66d9ef">print</span>(count)

    df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(dDict, columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;t&#39;</span>,<span style="color:#e6db74">&#39;src&#39;</span>,<span style="color:#e6db74">&#39;dst&#39;</span>,<span style="color:#e6db74">&#39;type&#39;</span>,<span style="color:#e6db74">&#39;srcport&#39;</span>,<span style="color:#e6db74">&#39;dstport&#39;</span>,<span style="color:#e6db74">&#39;length&#39;</span>])
    
    <span style="color:#66d9ef">return</span> df
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">df <span style="color:#f92672">=</span> makeDfFromPcap(<span style="color:#e6db74">&#39;cap_00001_20191216.pcap&#39;</span>)
df
</code></pre></div><img width="718" alt="Screenshots 2019-12-18 10.55.24.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/7d97abc9-94df-e1a0-909d-21e3e2ea88a6.png">
<p>After that, you can check how much communication is occurring between the source IP address and the destination IP address by grouping by DataFrame and totaling.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">pd<span style="color:#f92672">.</span>DataFrame(df<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74">&#39;src&#39;</span>,<span style="color:#e6db74">&#39;dst&#39;</span>])[<span style="color:#e6db74">&#39;length&#39;</span>]<span style="color:#f92672">.</span>sum()<span style="color:#f92672">.</span>sort_values(ascending<span style="color:#f92672">=</span>False) <span style="color:#f92672">*</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">/</span> (df<span style="color:#f92672">.</span>t<span style="color:#f92672">.</span>max()<span style="color:#f92672">-</span>df<span style="color:#f92672">.</span>t<span style="color:#f92672">.</span> min()))
<span style="color:#75715e"># Bandwidth used (unit: bps)</span>
</code></pre></div><img width="1000" alt="Screenshots 2019-12-18 10.56.49.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/35dfd201-5edf-23bd-b4c7-f57ad000c0b8.png">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">pd<span style="color:#f92672">.</span>DataFrame(df<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74">&#39;src&#39;</span>,<span style="color:#e6db74">&#39;dst&#39;</span>])<span style="color:#f92672">.</span>size()<span style="color:#f92672">.</span>sort_values(ascending<span style="color:#f92672">=</span>False) <span style="color:#f92672">/</span> (df<span style="color:#f92672">.</span>t<span style="color:#f92672">.</span>max()<span style="color:#f92672">-</span>df<span style="color:#f92672">.</span>t<span style="color:#f92672">.</span>min()))
<span style="color:#75715e"># Packets per unit time (unit: tps)</span>
</code></pre></div><img width="891" alt="Screenshots 2019-12-18 10.56.58.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/e89a8bfe-38ef-083d-758c-b1f05cf0744d.png">
<p>In this case, apparently communication between 10.100.45.26 and 10.100.45.39 seems to occur frequently, so just in case I have a hub connecting only 10.100.45.26 and 10.100.45.39 that cascade-connects from the main hub, and I had a problem. I looked at the transition to see if the problem no longer occurs.</p>
<p>Of course, I think that there are many tools that can perform this kind of packet aggregation, but it is a great advantage that you do not have to learn how to use special tools if you have knowledge of Pandas.</p>
<h2 id="visualization-of-sensor-data-of-iot-device-acquired-from-tera-term">Visualization of sensor data of IoT device acquired from Tera Term</h2>
<p>I think there are many cases in which you want to keep a skin feeling of what kind of value the device sensor data will return, and then move on to full-scale implementation.
It was necessary to find out in a short time how the value of the 3-axis geomagnetic sensor attached to the IoT device is tied to the rotation of the device and what kind of data processing should be performed to retrieve the direction ..
Fortunately, there is a sample code for the geomagnetic sensor, which dumps the sensor data via serial, so I decided to save the text log with TeraTerm and visualize it.</p>
<img width="863" alt="Screenshots 2019-12-18 10.58.59.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/60d67524-03f3-dd71-dee2-fabd507a3da7.png">
<p>Since the log data looks like this,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse_mag_str</span>(line):
    <span style="color:#66d9ef">try</span>:
        splitted <span style="color:#f92672">=</span> line[<span style="color:#ae81ff">5</span>:]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">``</span>)<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;,&#39;</span>)
        <span style="color:#66d9ef">return</span> [float(n) <span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> splitted]
    <span style="color:#66d9ef">except</span>:
        <span style="color:#66d9ef">return</span> None
</code></pre></div><p>Let&rsquo;s make an appropriate parsing function such as.</p>
<img width="642" alt="Screenshots 2019-12-18 11.00.05.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/9e7ffcbe-a41b-0a55-f9c0-b6a02a37f13c.png">
<p>The behavior seems to be okay, so</p>
<pre><code class="language-Pythonmags" data-lang="Pythonmags"></code></pre><p>As a float, leave it in a three-dimensional array.</p>
<p>After that, if you put the data in an interactive 3D visualization library such as ipyvolume, you can easily convert the data into a 3D graph by operating the mouse.
You can check.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#f92672">import</span> ipyvolume <span style="color:#f92672">as</span> ipv

start <span style="color:#f92672">=</span> <span style="color:#ae81ff">250</span>
end <span style="color:#f92672">=</span> <span style="color:#ae81ff">8000</span>
t <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(range(start,end))
x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([m[<span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">for</span> m <span style="color:#f92672">in</span> mags[start:end]])
y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([m[<span style="color:#ae81ff">1</span>] <span style="color:#66d9ef">for</span> m <span style="color:#f92672">in</span> mags[start:end]])
z <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([m[<span style="color:#ae81ff">2</span>] <span style="color:#66d9ef">for</span> m <span style="color:#f92672">in</span> mags[start:end]])
x_n <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([m[<span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">for</span> m <span style="color:#f92672">in</span> mags[start<span style="color:#f92672">+</span><span style="color:#ae81ff">10</span>:end<span style="color:#f92672">+</span><span style="color:#ae81ff">10</span>]])
y_n <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([m[<span style="color:#ae81ff">1</span>] <span style="color:#66d9ef">for</span> m <span style="color:#f92672">in</span> mags[start<span style="color:#f92672">+</span><span style="color:#ae81ff">10</span>:end<span style="color:#f92672">+</span><span style="color:#ae81ff">10</span>]])
z_n <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([m[<span style="color:#ae81ff">2</span>] <span style="color:#66d9ef">for</span> m <span style="color:#f92672">in</span> mags[start<span style="color:#f92672">+</span><span style="color:#ae81ff">10</span>:end<span style="color:#f92672">+</span><span style="color:#ae81ff">10</span>]])
u <span style="color:#f92672">=</span> x_n<span style="color:#f92672">-</span>x
v <span style="color:#f92672">=</span> y_n<span style="color:#f92672">-</span>y
w <span style="color:#f92672">=</span> z_n<span style="color:#f92672">-</span>z


ipv<span style="color:#f92672">.</span>figure()
quiver <span style="color:#f92672">=</span> ipv<span style="color:#f92672">.</span>quiver(x, y, z, u, v, w, size<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, size_selected<span style="color:#f92672">=</span><span style="color:#ae81ff">20</span>)
ipv<span style="color:#f92672">.</span>show()

</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/251c4d52-9055-9c8b-9764-003a6bf55918.gif" alt="ipyvolume.gif"></p>
<p>In this case, I found that the xy plane coordinate value should be atan2 in a good way to obtain the azimuth. Since the time series of the data can be known from the direction of the cone, the signs can be adjusted properly.</p>
<p>Packages starting with ipy are useful because many of them enhance the visibility and interactivity of Jupyter. There are ipyleaflet that can display data on interactive map, ipywidgets that can make UI by attaching buttons etc.</p>
<h2 id="analysis-summary">Analysis summary</h2>
<p>A case that you do not understand unless you comprehensively check the logs and visualize/sound the output results of data processing is that writing a processing tool seems to be very troublesome until now (only when really necessary). (I wrote using openFrameworks), but I was misled by some verification without doing too much, but in the field of data analysis / visualization, which is the core of Jupyter Notebook, most of the things can be done smoothly and my mind is nervous. You can take a step forward without using it, and the result of trial and error remains as a notebook without permission, so there is very little trouble when you need to re-validate with different data later, I loved logging and retrieving metadata for exploration. By just writing the code in a mood, I feel that I am satisfied with the fact that I was able to create a survey report that exceeded the accuracy and amount of manual verification that I had been unwilling to do by far.</p>
<h1 id="case-used-as-a-calculator">Case used as a calculator</h1>
<p>Do you have a UI design implementation, and have you made the same multiplications and additions many times according to the screen size based on the design drawing? Also, if you are doing image processing and want to do some matrix calculations (inverse matrix, diagonalization, etc.), want to create a rotation matrix in your favorite rotation order, a little complicated inverse matrix algebraic Is there anything you would like to ask?</p>
<h2 id="simple-matrix-calculation">Simple matrix calculation</h2>
<h3 id="numerical-calculation">Numerical calculation</h3>
<p>It is necessary to reproduce the color vision of a person with color vision deficiency, and after converting the RGB color space to the LMS color space (which is a linear conversion), when performing matrix calculation in the LMS color space and returning to the RGB space,
As a result, we needed to find out what kind of linear conversion should be performed in the RGB color space. The formula is as follows.</p>
<pre><code class="language-math" data-lang="math">\begin{eqnarray}
\mathbf{c^{'}}_\mathrm{RGB} &amp; = &amp; \mathbf{M}_\mathrm{LMStoRGB} \cdot \mathbf{M}_\mathrm{protanopia} \cdot \mathbf{M}_ \mathrm{RGBtoLMS} \cdot \mathbf{c}_\mathrm{RGB} \\
 &amp; = &amp; (\mathbf{M}^{-1}_\mathrm{RGBtoLMS} \cdot \mathbf{M}_\mathrm{protanopia} \cdot \mathbf{M}_\mathrm{RGBtoLMS}) \cdot \ mathbf{c}_\mathrm{RGB}
\end{eqnarray}
</code></pre><p>Since we only need to calculate the matrix part enclosed in parentheses on the right side, we put it in Numpy almost as it is and it is completed with the following code.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np

rgb2lms <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array((<span style="color:#ae81ff">0.31399022</span>, <span style="color:#ae81ff">0.63951294</span>,
            <span style="color:#ae81ff">0.04649755</span>, <span style="color:#ae81ff">0.15537241</span>, <span style="color:#ae81ff">0.75789446</span>, <span style="color:#ae81ff">0.08670142</span>, <span style="color:#ae81ff">0.01775239</span>,
            <span style="color:#ae81ff">0.10944209</span>, <span style="color:#ae81ff">0.87256922</span>])<span style="color:#f92672">.</span>reshape((<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>))

lms2rgb <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>inv(rgb2lms)
</code></pre></div><img width="627" alt=" Screenshot 2019-12-18 11.08.26.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/f239199e-825a-27c4-977a-cbac15af5ad8.png">
<p>While confirming whether rgb2lms and lms2rgb are properly made (I did not know whether Numpy is Column Major or Row Major, its neighborhood, so I proceeded while checking it on Jupyter)
The resulting matrix was calculated below.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">protanopia <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">1.05118294</span>,<span style="color:#f92672">-</span><span style="color:#ae81ff">0.05116099</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">1.0</span>])<span style="color:#f92672">.</span>reshape((<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>))

lms2rgb<span style="color:#f92672">.</span>dot(protanopia)<span style="color:#f92672">.</span>dot(rgb2lms)
</code></pre></div><img width="607" alt="Screenshots 2019-12-18 11.09.08.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/236cba26-2ae8-f5f7-df72-ac2295027088.png">
<h3 id="algebraic-calculation">Algebraic calculation</h3>
<p>I think that the rotation matrix in 3D space is often used when making a game, handling coordinates with 3DCG, or touching the motion sensor of a smartphone. There are 6 patterns of rotation matrix depending on the order of rotating the X, Y and Z axes. Until now, I&rsquo;ve been searching through Wikipedia, and I&rsquo;ve been wasting something wrong with the choices I made. However, it is the most reliable and quickest thing to do by multiplying from the left one by one while firmly grasping how the vector is transformed from the local coordinate system to the global coordinate system. That&rsquo;s why I also calculate the rotation matrix myself. Just Python has a library called Sympy that does algebraic calculations.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#f92672">from</span> sympy <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
<span style="color:#75715e">#x rotation</span>
theta <span style="color:#f92672">=</span> Symbol(<span style="color:#e6db74">&#39;theta&#39;</span>)
Rx <span style="color:#f92672">=</span> Matrix([[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>], [<span style="color:#ae81ff">0</span>, cos(theta), <span style="color:#f92672">-</span>sin(theta)], [<span style="color:#ae81ff">0</span>, sin(theta), cos(theta)]]])

<span style="color:#75715e"># rotation around y-axis</span>
yaw <span style="color:#f92672">=</span> Symbol(<span style="color:#e6db74">&#39;yaw&#39;</span>)
Ry <span style="color:#f92672">=</span> Matrix([[cos(yaw), <span style="color:#ae81ff">0</span>, sin(yaw)], [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>], [<span style="color:#f92672">-</span>sin(yaw), <span style="color:#ae81ff">0</span>, cos(yaw)]])

<span style="color:#75715e"># z-axis rotation</span>
phi <span style="color:#f92672">=</span> Symbol(<span style="color:#e6db74">&#39;phi&#39;</span>)
Rz <span style="color:#f92672">=</span> Matrix([[cos(phi), <span style="color:#f92672">-</span>sin(phi), <span style="color:#ae81ff">0</span>], [sin(phi), cos(phi), <span style="color:#ae81ff">0</span>], [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>]]])

R <span style="color:#f92672">=</span> Ry <span style="color:#f92672">*</span> Rx <span style="color:#f92672">*</span> Rz
R
</code></pre></div><img width="975" alt="Screenshots 2019-12-18 11.10.41.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/f51cfd51-5b86-afdb-b9fd-1efb4744bf51.png">
<p>The result also comes out in a beautiful form rendered by TeX, so it is easy to check, and since I am building the rotation matrix by myself, even if something is wrong, try changing the order or reducing the rotation matrix by one. You can easily say that.</p>
<h2 id="complicated-inverse-matrix-calculation">Complicated inverse matrix calculation</h2>
<p>On the IoT device, I received a request whether it is possible to display an image by <a href="https://fermiumbay13.hatenablog.com/entry/2018/08/14/032643">projection conversion</a>fromastatewithoutanylibrary.ItwasThederivationprocessisnotthemainsubject,soIwillomitit.(Theformatisalittledifferent,butinessence,<a href="https://shogo82148.github.io/homepage/memo/geometry/homography/">homography-ShogoComputingLaboratory</a>Thesamecalculationshouldhavebeendone), but as a result, the inverse matrix of the following 9-by-9 matrix was solved and multiplied by a vector, and each element of the 3-by-3 projective transformation matrix was made into a 9-dimensional vector. The thing X is obtained.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#f92672">from</span> sympy <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>

<span style="color:#75715e">#x0 = Symbol(&#39;x0&#39;) assignment to x0-x3, y0-y3</span>
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
    <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> <span style="color:#e6db74">&#34;xy&#34;</span>:
        globals()<span style="color:#f92672">.</span>update({c <span style="color:#f92672">+</span> str(i): Symbol(c <span style="color:#f92672">+</span> str(i))})

u0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">640</span>
v0 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
u1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">640</span>
v1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">480</span>
u2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
v2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">480</span>
u3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
v3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

A <span style="color:#f92672">=</span> Matrix((
            [x0, y0, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span>x0<span style="color:#f92672">*</span>u0, <span style="color:#f92672">-</span>y0<span style="color:#f92672">*</span>u0, <span style="color:#ae81ff">0</span> ],
            [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, x0, y0, <span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span>x0<span style="color:#f92672">*</span>v0, <span style="color:#f92672">-</span>y0<span style="color:#f92672">*</span>v0, <span style="color:#ae81ff">0</span> ],
            [x1, y1, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span>x1<span style="color:#f92672">*</span>u1, <span style="color:#f92672">-</span>y1<span style="color:#f92672">*</span>u1, <span style="color:#ae81ff">0</span> ],
            [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, x1, y1, <span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span>x1<span style="color:#f92672">*</span>v1, <span style="color:#f92672">-</span>y1<span style="color:#f92672">*</span>v1, <span style="color:#ae81ff">0</span> ],
            [x2, y2, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span>x2<span style="color:#f92672">*</span>u2, <span style="color:#f92672">-</span>y2<span style="color:#f92672">*</span>u2, <span style="color:#ae81ff">0</span> ],[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, x2, y2, <span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span>x2<span style="color:#f92672">*</span>v2, <span style="color:#f92672">-</span>y2<span style="color:#f92672">*</span>v2, <span style="color:#ae81ff">0</span> ],
            [x3, y3, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span>x3<span style="color:#f92672">*</span>u3, <span style="color:#f92672">-</span>y3<span style="color:#f92672">*</span>u3, <span style="color:#ae81ff">0</span> ],
            [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, x3, y3, <span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span>x3<span style="color:#f92672">*</span>v3, <span style="color:#f92672">-</span>y3<span style="color:#f92672">*</span>v3, <span style="color:#ae81ff">0</span> ],
            [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span> ],
            ])
A
</code></pre></div><img width="686" alt="Screenshots 2019-12-18 11.12.04.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/39933548-a66c-ebe6-525e-667520fe2c36.png">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">B <span style="color:#f92672">=</span> Matrix([u0, v0, u1, v1, u2, v2, u3, v3, <span style="color:#ae81ff">1</span>])
B
</code></pre></div><img width="544" alt=" Screenshot 2019-12-18 11.12.24.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/e0cd3187-0743-9848-0754-e7c49cd39ce7.png">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">X <span style="color:#f92672">=</span> A<span style="color:#f92672">.</span>inv() <span style="color:#f92672">*</span> B
</code></pre></div><img width="422" alt="Screenshots 2019-12-18 11.13.27.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/75db85a2-07ff-dba7-ebc5-2210a4f9a4b9.png">
<p>It seems that it could be calculated in about 5 seconds.
However, if each element of this X seems to have a large number of terms, it will take a lot of time to compile TeX, so let&rsquo;s take it out as a string.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">X_strs <span style="color:#f92672">=</span> [str(simplify(X[i])) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">9</span>)]
</code></pre></div><img width="1107" alt="Screenshots 2019-12-18 11.14.29.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/b95e9b2c-8ed5-9e92-a438-96b630f25b3c.png">
<p>It took about 2 minutes, probably because it took time to simplify.
I want to convert it to C code as it is, so rename the power term of x0**2 to x0p2 etc.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">list(zip([v <span style="color:#f92672">+</span> str(i) <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;**2&#39;</span> <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span><span style="color:#e6db74">&#39;xy&#39;</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)],[v <span style="color:#f92672">+</span> str(i) <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;p2&#39;</span> <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span><span style="color:#e6db74">&#39;xy&#39;</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)]))
</code></pre></div><img width="1002" alt="Screenshots 2019-12-18 11.14.41.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/e6f2bbdb-59db-bf17-8d64-15cf249c8168.png">
<p>It seems that it can be renamed like this, so replace it at once by using reduce.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">X_strs2 <span style="color:#f92672">=</span> (functools<span style="color:#f92672">.</span>reduce(<span style="color:#66d9ef">lambda</span> s, t: s<span style="color:#f92672">.</span>replace(<span style="color:#f92672">*</span>t), list(zip((v <span style="color:#f92672">+</span> str(j) <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;**2&#39;</span> <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span><span style="color:#e6db74">&#39;xy&#39;</span> <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>) ],[v <span style="color:#f92672">+</span> str(j) <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;p2&#39;</span> <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span><span style="color:#e6db74">&#39;xy&#39;</span> <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>)]), X_strs[i]) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">9</span>)]
</code></pre></div><p>Finally, convert this to C code with the following code.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span><span style="color:#e6db74">&#39;xy&#39;</span>:
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;float </span><span style="color:#e6db74">%s%d</span><span style="color:#e6db74">p2 = </span><span style="color:#e6db74">%s%d</span><span style="color:#e6db74"> * </span><span style="color:#e6db74">%s%d</span><span style="color:#e6db74">;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span>(v, i, v, i, v, i))

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">9</span>):
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;float X</span><span style="color:#e6db74">%d</span><span style="color:#e6db74"> =&#39;</span><span style="color:#f92672">%</span> i <span style="color:#f92672">+</span> X_strs2[i] <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</code></pre></div><img width="640" alt="Screenshots 2019-12-18 11.25.03.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/37a1b2fb-0cf8-ff02-8968-fe6d3edbaab4.png">
<img width="1104" alt="Screenshots 2019-12-18 11.24.04.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/21afe301-a466-b0cf-98cb-09aa03f71948.png">
<p>With this, the projective transformation function with arbitrary parameters can be done for embedded devices without depending on any library. There was an omission of conversion in one place, but when I fixed it, it worked as expected.</p>
<p>I also obtained the inverse matrix of this projective transformation matrix with a similar feeling.</p>
<img width="985" alt="Screenshots 2019-12-18 11.26.08.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/b13af8ed-2d94-1678-0c73-d3db49eeba93.png">
<p>If you write almost the formula as it is, it will be completed, so it&rsquo;s fun.</p>
<h2 id="simple-calculator">Simple calculator</h2>
<p>It&rsquo;s also used to calculate the size of UI elements designed with different screen sizes. It&rsquo;s not really a big deal, but I&rsquo;m happy that it&rsquo;s easy to see and easy to fix.</p>
<img width="567" alt="l.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/96f7e57a-e22d-8542-cb87-77db32fb85cd.png">
<h1 id="case-used-to-make-binary-data-and-output-packets">Case used to make binary data and output packets</h1>
<h2 id="device-control-experiment-by-sending-udp-packet">Device control experiment by sending UDP packet</h2>
<p>I was making a signage control system, and it was supposed that a certain power supply control device would work with UDP binary packets, so I even tried creating packets according to the specifications and sending them with UDP.</p>
<p>First, make a packet.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">switches <span style="color:#f92672">=</span> [True, False, True, True, False]

model_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span> <span style="color:#75715e"># LA-5R</span>
unit_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">0b00001111</span> <span style="color:#f92672">^</span> <span style="color:#ae81ff">0</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">make_send_bytes</span>(model_id, unit_id, switches):
    <span style="color:#66d9ef">return</span> bytes([<span style="color:#ae81ff">0xf0</span> <span style="color:#f92672">|</span> unit_id, switches[<span style="color:#ae81ff">4</span>] <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">|</span> switches[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">|</span> switches[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> switches[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> switches[<span style="color:#ae81ff">0</span>]])

send_bytes <span style="color:#f92672">=</span> make_send_bytes(model_id, unit_id, switches)
[format(send_bytes[i], <span style="color:#e6db74">&#39;02x&#39;</span>) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>]]
</code></pre></div><img width="1032" alt="Screenshots 2019-12-18 16.31.39.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/7f9cec5a-dbb5-935e-6bcf-2e7fe6866c48.png">
<p>The packet seems to be made, so I will actually send it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">switches <span style="color:#f92672">=</span> [random<span style="color:#f92672">.</span>random() <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0.5</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>)]

send_bytes <span style="color:#f92672">=</span> make_send_bytes(model_id, unit_id, switches)
[format(send_bytes[i], <span style="color:#e6db74">&#39;02x&#39;</span>) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>]]

s<span style="color:#f92672">.</span>sendto(send_bytes, (HOST, PORT))
</code></pre></div><p>I can not prepare screenshots etc, but I confirmed that it works when sending a packet.</p>
<p>Next, check if all 5ch patterns and 32 patterns of switch ON/OFF can be controlled.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">sl <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.08</span>
l <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.08</span> <span style="color:#f92672">/</span> sl
<span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, int(l)):
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">32</span>):
        switches <span style="color:#f92672">=</span> [c <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;1&#39;</span> <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> format(i, <span style="color:#e6db74">&#39;05b&#39;</span>)]
        send_bytes <span style="color:#f92672">=</span> make_send_bytes(model_id, unit_id, switches)
        [format(send_bytes[i], <span style="color:#e6db74">&#39;02x&#39;</span>) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>]]
        s<span style="color:#f92672">.</span>sendto(send_bytes, (HOST, PORT))
        time<span style="color:#f92672">.</span>sleep(sl)
</code></pre></div><img width="764" alt="Screenshots 2019-12-18 16.32.07.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/3247b985-7fee-8e2b-237f-0f4efc26a595.png">
<p>Looking at only the written results, it is almost the same as writing in C, but if you are not familiar with bit operations, try and error whether the packet is correctly made or not, whether it is actually sent and tried and working It turns out that the fast loop of sig has a great impact on the implementation efficiency.</p>
<p>At the same time, I also verified the control over TCP connection, but if you add a table of contents to the notebook, it will not be like a mysterious comment out, so you can sort out the parts that can be diverted between TCP and UDP , You can look back later and make the code easier to use.</p>
<h1 id="case-of-format-conversion">Case of format conversion</h1>
<p>This may be the most typical case. As a software engineer, there are many cases where I want to write a simple script and solve various format conversions in order to get the raw data and make it the final form. In such cases, Jupyter Notebook&rsquo;s ability to &ldquo;try and error while looking at it&rdquo; is strong and very useful.## Convert JSON exported from After Effects and create object creation code that can be executed by Unity&rsquo;s Immediate
During game development, I had a desire to port images placed using the 3D layer function in After Effects to Unity. Of course, you can do it by creating a Unity Quad object while looking at the numerical values one layer at a time, but I do not want to do such simple work even though there are about 50 layers. So, first, I wrote each information of the After Effects layer in JSON using ESTK, and then processed it with Jupyter Notebook.</p>
<p>First, check what value is included,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> codecs
<span style="color:#f92672">from</span> operator <span style="color:#f92672">import</span> item getter

<span style="color:#66d9ef">with</span> codecs<span style="color:#f92672">.</span>open(<span style="color:#e6db74">&#39;transforms.json&#39;</span>,<span style="color:#e6db74">&#39;r&#39;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;shift-jis&#39;</span>) <span style="color:#66d9ef">as</span> f:
    root <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>load(f)

root
</code></pre></div><img width="657" alt="Screenshots 2019-12-18 11.29.15.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/285641ea-f9e5-9fbe-ee7e-17a2bd21ebae.png">
<p>Take out one layer,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">layer <span style="color:#f92672">=</span> root[<span style="color:#e6db74">&#39;9&#39;</span>]
layer
</code></pre></div><img width="455" alt="Screenshots 2019-12-18 11.29.32.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/93c4e248-fb5f-0927-943a-724571ba51bc.png">
<p>Position, anchor point, width, height, scale etc. for each item of X, Y collectively,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">list(zip(layer[<span style="color:#e6db74">&#39;position&#39;</span>], layer[<span style="color:#e6db74">&#39;anchor point&#39;</span>], [layer[<span style="color:#e6db74">&#39;width&#39;</span>], layer[<span style="color:#e6db74">&#39;height&#39;</span>]], [layer[<span style="color:#e6db74">&#39;scale&#39;</span>][<span style="color:#ae81ff">0</span>], layer[<span style="color:#e6db74">&#39;scale &#39;</span>][<span style="color:#ae81ff">1</span>]]))
</code></pre></div><img width="985" alt="Screenshots 2019-12-18 11.29.38.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/71f83ba7-563f-8356-4fd3-b06cf57ed3f1.png">
<p>Positioning and scaling that are the anchor point reference are used as the center reference.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">[ps[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span>ps[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> ps[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">+</span> ps[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">*</span> ps[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">for</span> ps <span style="color:#f92672">in</span> zip(
    layer[<span style="color:#e6db74">&#39;position&#39;</span>],
    layer[<span style="color:#e6db74">&#39;anchor point&#39;</span>],
    [layer[<span style="color:#e6db74">&#39;width&#39;</span>], layer[<span style="color:#e6db74">&#39;height&#39;</span>], <span style="color:#ae81ff">0</span>],
    [layer[<span style="color:#e6db74">&#39;scale&#39;</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span>, layer[<span style="color:#e6db74">&#39;scale&#39;</span>][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">1</span>])]
</code></pre></div><img width="564" alt="Screenshots 2019-12-18 11.29.47.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/1b6efe15-46c5-86fa-5e00-9e45a665a69f.png">
<p>Now that we know how to handle one layer, let&rsquo;s apply it to all layers. The reason for reverse is because the stacking order is reverse between After Effects and Unity.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">t_list <span style="color:#f92672">=</span> [([ps[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span>ps[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> ps[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">+</span> ps[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">*</span> ps[<span style="color:#ae81ff">3</span>] <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">for</span> ps <span style="color:#f92672">in</span> zip(layer[<span style="color:#e6db74">&#39;position&#39;</span>],layer[<span style="color:#e6db74">&#39;anchor point&#39;</span>]] ,[layer[<span style="color:#e6db74">&#39;width&#39;</span>], layer[<span style="color:#e6db74">&#39;height&#39;</span>], <span style="color:#ae81ff">0</span>], [layer[<span style="color:#e6db74">&#39;scale&#39;</span>][<span style="color:#ae81ff">0</span>], layer[<span style="color:#e6db74">&#39;scale&#39;</span>][<span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">1</span>])],
 [layer[<span style="color:#e6db74">&#39;width&#39;</span>] <span style="color:#f92672">*</span> layer[<span style="color:#e6db74">&#39;scale&#39;</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span>, layer[<span style="color:#e6db74">&#39;height&#39;</span>] <span style="color:#f92672">*</span> layer[<span style="color:#e6db74">&#39;scale&#39;</span>][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span>], layer[<span style="color:#e6db74">&#39;name&#39;</span>]) <span style="color:#66d9ef">for</span> layer <span style="color:#f92672">in</span> root<span style="color:#f92672">.</span>values()]
t_list<span style="color:#f92672">.</span>reverse()
t_list
</code></pre></div><img width="994" alt="Screenshots 2019-12-18 11.30.16.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/95a270e8-590e-4df1-997e-74e4b6fa57da.png">
<p>Now that you know the coordinates, width, and height for all layers, you can type in the Immediate pane of Unity Editor and generate the C# code to create an object in your scene.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">cs_str <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;&#39;{GameObject q = GameObject.CreatePrimitive(PrimitiveType.Quad);
</span><span style="color:#e6db74">q.name = &#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;;
</span><span style="color:#e6db74">q.transform.position = new Vector3(</span><span style="color:#e6db74">%f</span><span style="color:#e6db74">f, </span><span style="color:#e6db74">%f</span><span style="color:#e6db74">f, </span><span style="color:#e6db74">%f</span><span style="color:#e6db74">f);
</span><span style="color:#e6db74">q.transform.localScale = new Vector3(</span><span style="color:#e6db74">%f</span><span style="color:#e6db74">f, </span><span style="color:#e6db74">%f</span><span style="color:#e6db74">f, 1.0f);
</span><span style="color:#e6db74">var m = (q.GetComponent&lt;Renderer&gt;().material = UnityEditor.AssetDatabase.LoadAssetAtPath&lt;Material&gt;(&#34;Assets/Textures/Background/_Materials/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">.mat&#34;));
</span><span style="color:#e6db74">if (m != null) m.renderQueue = </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">;
</span><span style="color:#e6db74">}&#39;&#39;&#39;</span>
sss <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join([cs_str <span style="color:#f92672">%</span>(t[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;.psd&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>),
                           t[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000</span>, <span style="color:#f92672">-</span>t[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000</span>, t[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">2</span>] <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000</span>,
                           t[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000</span>, t[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">/</span> <span style="color:#ae81ff">1000</span>, t[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;.psd&#39;</span>, <span style="color:#e6db74">``</span>),
                           <span style="color:#ae81ff">3000</span> <span style="color:#f92672">+</span> i <span style="color:#f92672">+</span> start) <span style="color:#66d9ef">for</span> i, t <span style="color:#f92672">in</span>
                 enumerate(sorted(t_list, key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> t: int(t[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">2</span>]), reverse<span style="color:#f92672">=</span>True)[start:start <span style="color:#f92672">+</span> lll])])
<span style="color:#66d9ef">print</span>(sss)
</code></pre></div><img width="921" alt="Screenshots 2019-12-18 11.30.56.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/6b11cc66-1f58-6e84-8fc9-aec6cf25579f.png">
<p>In fact, after typing the code in the Immediate pane, the After Effects scene was reproduced. I feel that it took as long as typing 50 times, but since the designer can mechanically deal with the After Effects scene, it feels easy from the second time. Unfortunately, the designer said, &ldquo;I don&rsquo;t want to play with such complicated and difficult to operate AE files anymore&rdquo;.</p>
<h2 id="generate-html-parts">Generate HTML parts</h2>
<p>Occasionally I also code HTML, but I have to handwrite a place where the title string etc. appears almost repeatedly, such as a blog article list. There is a story that you can use it with a static website generator, including a CMS, but in most cases you need to prioritize publishing over it, and if there are only a few repeated parts, after all it is an HTML editor such as Brackets. I feel that it is faster to write it directly in (although it is a big cause that there is little experience with HTML/CSS). Even in such a case, it is a programmer&rsquo;s feeling that it is tedious and troublesome to copy the same character string in multiple places, because it is troublesome and it is nervous. So, once I write it in Brackets and it is displayed well, I make a template and replace it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">news_template<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;&#39; &lt;article class=&#34;news-box&#34;&gt;
</span><span style="color:#e6db74">                  &lt;div class=&#34;news-photo-box&#34;&gt;&lt;img src=&#34;assets/image/news/###image_name###&#34;&gt;&lt;/div&gt;
</span><span style="color:#e6db74">                  &lt;div class=&#34;news-date&#34;&gt;###date_str###&lt;/div&gt;
</span><span style="color:#e6db74">                  &lt;div class=&#34;news-title&#34;&gt;###title_str###&lt;/div&gt;
</span><span style="color:#e6db74">                  &lt;button class=&#34;news-more&#34; alt=&#34;MORE&#34;&gt;&lt;/button&gt;
</span><span style="color:#e6db74">                  &lt;div class=&#34;news-description news-description-hidden&#34;&gt;
</span><span style="color:#e6db74">                    &lt;button class=&#34;close-button&#34;&gt;&lt;/button&gt;
</span><span style="color:#e6db74">                    &lt;button class=&#34;news-prev-button&#34;&gt;&lt;/button&gt;
</span><span style="color:#e6db74">                    &lt;button class=&#34;news-next-button&#34;&gt;&lt;/button&gt;
</span><span style="color:#e6db74">                    &lt;div class=&#34;news-description-inner&#34;&gt;
</span><span style="color:#e6db74">                      &lt;div class=&#34;news-description-pdt-box&#34;&gt;
</span><span style="color:#e6db74">                        &lt;div class=&#34;news-description-photo-box&#34;&gt;&lt;img src=&#34;assets/image/news/###image_name###&#34;&gt;&lt;/div&gt;
</span><span style="color:#e6db74">                        &lt;div class=&#34;news-description-dt-box&#34;&gt;
</span><span style="color:#e6db74">                          &lt;div class=&#34;news-description-date&#34;&gt;###date_str###&lt;/div&gt;
</span><span style="color:#e6db74">                          &lt;div class=&#34;news-description-title&#34;&gt;###title_str###&lt;/div&gt;&lt;/div&gt;
</span><span style="color:#e6db74">                      &lt;/div&gt;
</span><span style="color:#e6db74">                      &lt;div class=&#34;news-description-body&#34;&gt;
</span><span style="color:#e6db74">                        ###body_str###
</span><span style="color:#e6db74">                      &lt;/div&gt;
</span><span style="color:#e6db74">                    &lt;/div&gt;
</span><span style="color:#e6db74">                  &lt;/div&gt;
</span><span style="color:#e6db74">                &lt;/article&gt;
</span><span style="color:#e6db74">&#39;&#39;&#39;</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">make_news</span>(date_str, title_str, body_str, image_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;default.png&#39;</span>):
    <span style="color:#66d9ef">return</span> news_template \
        <span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;###date_str###&#39;</span>, date_str) \
        <span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;###title_str###&#39;</span>, title_str) \
        <span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;###body_str###&#39;</span>, body_str) \
        <span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;###image_name###&#39;</span>, image_name)
</code></pre></div><img width="879" alt="Screenshots 2019-12-18 16.14.49.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/329834/319eaf9c-72af-4067-76a1-8d2f288a11a4.png">
<p>Now you can definitely create HTML just by inserting the necessary items. It&rsquo;s great that you can do it with no learning cost. Also, if you are asked to add news in the future, you will be able to remember everything by opening this notebook, I think that it is a good point in the sense that you do not leave debt in the future despite not clearly documenting it. think.</p>
<h2 id="other">Other</h2>
<p>Besides that,</p>
<ul>
<li>Instantly convert customer-prepared CSV format metadata to JSON format for web clients with pandas and json</li>
<li>Cut the photo data directory for delivery that does not fit on the DVD by dividing it into arbitrary spans and splitting it for the DVD while watching the total file size.</li>
<li>Read GPS data and convert to KML</li>
<li>Read CSV data and output to map image</li>
<li>Convert the defect email item to a work Excel file to easily add comments</li>
<li>Convert from PGM to BMP (Because there are various versions of BMP, I couldn&rsquo;t research proper ImageMagick options, so only headers are ported from other BMPs and data is from PGM to Gachichanko)</li>
<li>When creating animated serial number tile images for Unity, check the md5 hash to remove the serial number images that are covered to save texture space.</li>
<li>Combine CSV files so that big data can be read easily by Houdini</li>
<li>Combines the same sound source into 6 types of video with 3 audio codecs, and recreates a total of 18 video files over and over</li>
</ul>
<p>Most of the things such as reading and converting are done with Jupyter Notebook unless it can be done with a single command.</p>
<p>I think there are many things you can do with traditional command line tools, but it&rsquo;s bothersome to find out how to use the tools and to think about passing data between tools, and it&rsquo;s almost certain that a record will remain and you&rsquo;ll have to start over. Since it doesn&rsquo;t bother me, the days of using Jupyter Notebook instead of the shell continue.</p>
<p>Please think that you were deceived and try Jupyter Notebook. I think that it is very suitable for people who have a lot of irregular work on a project basis.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
