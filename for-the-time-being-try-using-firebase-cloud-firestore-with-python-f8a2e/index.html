<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>For the time being, try using FireBase Cloud Firestore with Python | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>For the time being, try using FireBase Cloud Firestore with Python</h1>
<p>
  <small class="text-secondary">
  
  
  Jan 18, 2020
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/firebase">Firebase</a></code></small>

</p>
<pre><code>## Introduction
</code></pre>
<p>&ldquo;For the time being, I want to use Cloud Firestore of FireBase with Python!&rdquo;,
While following FireBase&rsquo;s <a href="https://firebase.google.com/docs/firestore/quickstart?authuser=0">official document</a>, write the basic procedure for &ldquo;data input/output&rdquo; I will.</p>
<p>##First&hellip; let&rsquo;s create a &ldquo;project&rdquo;</p>
<blockquote>
<p>A &ldquo;project&rdquo; is a &ldquo;collective&rdquo; for using services such as Firestore, Cloud Functions, Authentication, and Hosting.
Projects created with FireBase are also common with GCP.</p>
</blockquote>
<p>Now let&rsquo;s create a project.</p>
<p>First, go to <a href="https://console.firebase.google.com">FireBase Console</a>.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/d9fd48c0-479d-3366-653a-5fb754171797.png" alt="image.png">
Click &ldquo;Create Project&rdquo; in the middle.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/fbce619d-5117-8618-1f98-79d844160aa4.png" alt="image.png">
Enter a name for your project and click Continue.</p>
<p>In step 2/3, &ldquo;Google Analytics (for Firebase project)&rdquo; will be explained, so you can enable or disable it. (Turn off this time.)
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/69df399d-37bd-45ea-e615-08791ef69b7b.png" alt="image.png"></p>
<p>Finally, when you click &ldquo;Create Project&rdquo;, the creation process will start automatically.</p>
<p>After a few moments, &ldquo;New project is ready&rdquo; is displayed as shown below, so click &ldquo;Continue&rdquo;.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/e8211f4a-7a70-78ed-d63a-a4512c1ea9ab.png" alt="image.png"></p>
<p>Then, the screen will transition to the console.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/ddf42586-47a4-5308-41e9-028446c5cee4.png" alt="image.png"></p>
<p>This completes the project creation.</p>
<h2 id="lets-create-a-database-for-cloud-firestore">Let&rsquo;s create a database for Cloud Firestore</h2>
<blockquote>
<p>In Cloud Firestore, &ldquo;Document&rdquo; that writes &ldquo;Data&rdquo;,
There is a &ldquo;collection&rdquo; (like a folder) for keeping documents organized.
A &ldquo;database&rdquo; is a &ldquo;box&rdquo; for storing collections.</p>
</blockquote>
<p>&hellip; it&rsquo;s difficult.
If you&rsquo;re not sure, take a look at the very easy-to-understand articles of others!</p>
<p>Let&rsquo;s create the database first.</p>
<p>Click Database from the menu on the left.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/5a225ed2-d729-fc2b-85bd-7f378008ec20.png" alt="image.png">
Then click &ldquo;Create Database&rdquo;.</p>
<p>A dialog will appear, so select &ldquo;Start in test mode&rdquo; and then &ldquo;Next&rdquo;.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/bc724924-ae20-623d-5b37-81ad28545063.png" alt="image.png">
Leave the location selection as is and click Finish.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/de4b52df-f8be-8086-2288-d05b59041015.png" alt="image.png"></p>
<p>When the provisioning and security settings are completed, the screen below automatically appears.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/65d5bc91-878a-16de-2504-eb37a871a393.png" alt="image.png"></p>
<p>The database is now created.</p>
<h2 id="create-collections-and-documents">Create collections and documents</h2>
<p>Now let&rsquo;s get ready to pour in the data.</p>
<p>Click &ldquo;Start Collection&rdquo; in the middle.
A dialog appears, so enter an arbitrary character string (collection name) in &ldquo;Collection ID&rdquo;.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/162877ca-bc39-c7de-357b-b13bc2093863.png" alt="image.png"></p>
<p>The &ldquo;Document ID&rdquo; can be any character string, or click &ldquo;Automatic ID&rdquo; to assign it appropriately.
You can set the &ldquo;field&rdquo;, but if you enter data, it will be generated automatically.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/dcf6c3c6-3361-f186-0c22-1b40e953431e.png" alt="image.png"></p>
<p>Then, the collection and the document are created at once, and you are ready to pour the data.</p>
<h2 id="bring-your-api-key">Bring your API key</h2>
<p>Finally, generate and download the API key for tampering with FireBase from Python.</p>
<p>Click the gear mark on the upper left â†’ &ldquo;Project settings&rdquo;.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/a23595b0-683b-fdec-beaa-b6bada51f78f.png" alt="image.png"></p>
<p>Then select &ldquo;Service Account&rdquo;.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/6703ac98-2a11-4903-dfdd-00dceef96f9c.png" alt="image.png"></p>
<p>Continue to click Generate New Private Key, then click Generate Key.
The Json file will be downloaded, so please save it in a suitable place.</p>
<h1 id="then-python">Then Python!</h1>
<p>From here, leave FireBase and start working on Python.
The code written here is quoted from <a href="https://firebase.google.com/docs/firestore/quickstart">official document</a> and partly modified.</p>
<h2 id="put-the-library">Put the library</h2>
<p>We already have a library for tinkering with FireBase.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">pip install firebase<span style="color:#f92672">-</span>admin
</code></pre></div><p>Run and install the FireBase library.</p>
<h2 id="first-lets-initialize">First let&rsquo;s initialize</h2>
<p>Initialize your Cloud Firestore SDK instance.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> firebase_admin
<span style="color:#f92672">from</span> firebase_admin <span style="color:#f92672">import</span> credentials
<span style="color:#f92672">from</span> firebase_admin <span style="color:#f92672">import</span> firestore

cred <span style="color:#f92672">=</span> credentials<span style="color:#f92672">.</span>Certificate(<span style="color:#e6db74">&#39;Please write the private key path.json&#39;</span>)
firebase_admin<span style="color:#f92672">.</span>initialize_app(cred)

db <span style="color:#f92672">=</span> firestore<span style="color:#f92672">.</span>client()
</code></pre></div><p>With this alone, the SDK is initialized and data can be input and output.</p>
<h2 id="okay-lets-add-some-data">Okay, let&rsquo;s add some data</h2>
<p>Now let&rsquo;s add some data to the database we created in the previous step.
Use the sample of <a href="https://firebase.google.com/docs/firestore/quickstart">official document</a> as it is.
Please add the code below to the code below the initialization code!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">doc_ref <span style="color:#f92672">=</span> db<span style="color:#f92672">.</span>collection(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;users&#39;</span>)<span style="color:#f92672">.</span>document(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;alovelace&#39;</span>)
doc_ref<span style="color:#f92672">.</span>set({
    <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;first&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Ada&#39;</span>,
    <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;last&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Lovelace&#39;</span>,
    <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;born&#39;</span>: <span style="color:#ae81ff">1815</span>
})
</code></pre></div><blockquote>
<p>A little commentary
<code>db.collection(u'users')</code>&hellip; which collection in the database to specify
<code>.document(u'alovelace')</code>&hellip; which document in the collection specified above should be specified
<code>u'first': u'Ada',</code>&hellip; add the value &ldquo;Ada&rdquo; to the &ldquo;first&rdquo; field</p>
</blockquote>
<p>Let&rsquo;s do it!</p>
<p>If it is executed correctly, I think that it looks like this on the FireBase Console side.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/8d79e76c-c49b-314f-c7f6-cf0930a72dbc.png" alt="image.png"></p>
<h2 id="now-lets-read-the-data">Now let&rsquo;s read the data</h2>
<p>Now, let&rsquo;s read the added data.
Here, the character string is output as is in the Python output window.</p>
<p>Below the initialization code</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">users_ref <span style="color:#f92672">=</span> db<span style="color:#f92672">.</span>collection(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;users&#39;</span>)
docs <span style="color:#f92672">=</span> users_ref<span style="color:#f92672">.</span>stream()

<span style="color:#66d9ef">for</span> doc <span style="color:#f92672">in</span> docs:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;{} =&gt; {}&#39;</span><span style="color:#f92672">.</span>format(doc<span style="color:#f92672">.</span>id, doc<span style="color:#f92672">.</span>to_dict()))
</code></pre></div><p>If all goes well, you should get the following output:
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/eeb140dc-0611-0c2c-90d5-49a1c3a2de9a.png" alt="image.png"></p>
<h2 id="lets-delete-the-added-data">Let&rsquo;s delete the added data</h2>
<p>Finally, let&rsquo;s delete the data.</p>
<p>I think the structure before deletion is as follows<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331782/8d79e76c-c49b-314f-c7f6-cf0930a72dbc.png" alt="image.png"></p>
<p>To delete only the added fields</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">city_ref <span style="color:#f92672">=</span> db<span style="color:#f92672">.</span>collection(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;users&#39;</span>)<span style="color:#f92672">.</span>document(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;alovelace&#39;</span>)
city_ref<span style="color:#f92672">.</span>update({
    <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;born&#39;</span>: firestore<span style="color:#f92672">.</span>DELETE_FIELD
})
</code></pre></div><p>This code removes the &ldquo;born&rdquo; field.</p>
<p>To delete the entire document</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">db<span style="color:#f92672">.</span>collection(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;users&#39;</span>)<span style="color:#f92672">.</span>document(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;alovelace&#39;</span>)<span style="color:#f92672">.</span>delete()
</code></pre></div><p>To delete a collection</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">delete_collection</span>(coll_ref, batch_size):
    docs <span style="color:#f92672">=</span> coll_ref<span style="color:#f92672">.</span>limit(batch_size)<span style="color:#f92672">.</span>get()
    deleted <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

    <span style="color:#66d9ef">for</span> doc <span style="color:#f92672">in</span> docs:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Deleting doc {} =&gt; {}&#39;</span><span style="color:#f92672">.</span>format(doc<span style="color:#f92672">.</span>id, doc<span style="color:#f92672">.</span>to_dict()))
        doc<span style="color:#f92672">.</span>reference<span style="color:#f92672">.</span>delete()
        deleted <span style="color:#f92672">=</span> deleted <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>

    <span style="color:#66d9ef">if</span> deleted <span style="color:#f92672">&gt;=</span> batch_size:
        <span style="color:#66d9ef">return</span> delete_collection(coll_ref, batch_size)
</code></pre></div><p>(When you delete a collection, you need to get and delete all the documents.)</p>
<p>This concludes the basic operation.</p>
<p>##in conclusion
I think the article was difficult to read, but thank you for reading this far.
Have a good FireBase life!</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
