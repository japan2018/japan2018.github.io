<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Python] Build your own PC for deep learning | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] Build your own PC for deep learning</h1>
<p>
  <small class="text-secondary">
  
  
  Nov 6, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/machine-learning"> machine learning</a></code></small>


<small><code><a href="https://memotut.com/tags/homebrew-pc"> homebrew PC</a></code></small>


<small><code><a href="https://memotut.com/tags/deep-learning"> deep learning</a></code></small>

</p>
<pre><code>Leave a memorandum of your own PC.
</code></pre>
<p>Finally, I will describe up to the point where Ubuntu is installed and a deep learning environment is created with docker.</p>
<h1 id="table-of-contents">table of contents</h1>
<ol>
<li>Find out how to make your own PC</li>
<li>Assemble the PC</li>
<li>Environmental construction</li>
</ol>
<h1 id="1-find-out-how-to-make-your-own-pc">1. Find out how to make your own PC</h1>
<ul>
<li>I referred to the following sites.
-<a href="https://artjuku.com/pc-make/">Summary by budget for own PC</a>
-<a href="https://souzouno-yakata.com/2019/02/17/38080/">How to make a deep learning PC</a></li>
</ul>
<p>It seems that it is better to decide the specifications according to the application.</p>
<ul>
<li>Preprocessing is executed frequently, so the number of CPU cores should be large</li>
<li>Keep a large power supply and case in case you want to add a GPU</li>
</ul>
<p>As a result of examination, the following configuration was adopted.</p>
<h3 id="what-you-made">What you made</h3>
<p><strong>CPU</strong> <a href="https://www.amazon.co.jp/%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AB-Corei7-9700K-INTEL300%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA-Chipset%E3%83%9E%E3%82%B6%E3%83%BC%E3%83%9C%E3%83%BC%E3%83%89%E5%AF%BE%E5%BF%9C-BX80684I79700K%E3%80%90BOX%E3%80%91/dp/B07HHN6KBZ">Core i7-9700K</a> 45,000 yen
<strong>GPU</strong> <a href="https://www.dospara.co.jp/5shopping/detail_parts.php?bg=1&amp;ic=455951&amp;lf=0">GeForce RTX2080Ti 11GB GamingPro OC</a>89,000yen(used)
<strong>Motherboard</strong> <a href="https://www.amazon.co.jp/Intel-LGA1151-%E3%83%9E%E3%82%B6%E3%83%BC%E3%83%9C%E3%83%BC%E3%83%89-PRIME-Z390/dp/B07HCY7K9L">ASUS PRIME Z390-A</a> 22,000 yen
<strong>Memory</strong> <a href="https://www.amazon.co.jp/gp/product/B07WHF2RQ2/ref=ppx_yo_dt_b_asin_title_o01_s00?ie=UTF8&amp;psc=1">Kingston FURY RGB (DDR4 2666MHz 16GBx2)</a> ¥20,000
<strong>Case</strong> <a href="https://www.amazon.co.jp/DYNAMIC%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA-ATX%E5%AF%BE%E5%BF%9CPC%E3%82%B1%E3%83%BC%E3%82%B9-%E5%BC%B7%E5%8C%96%E3%82%AC%E3%83%A9%E3%82%B9%E3%83%91%E3%83%8D%E3%83%AB-DYNAMIC-%E6%97%A5%E6%9C%AC%E6%AD%A3%E8%A6%8F%E4%BB%A3%E7%90%86%E5%BA%97%E5%93%81/dp/B07C88K4KP/ref=sr_1_8?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&amp;crid=126X9EAEQS38A&amp;keywords=pc%E3%82%B1%E3%83%BC%E3%82%B9%2Be-atx&amp;qid=1572082964&amp;s=computers&amp;sprefix=PC%E3%82%B1%E3%83%BC%E3%82%B9%2Be%2Ccomputers%2C234&amp;sr=1-8&amp;th=1">O11 DYNAMIC WHITE</a> 14,000 yen
<strong>Power supply</strong> <a href="https://www.amazon.co.jp/Corsair-HX1000i-80PLUS-PLATINUM-CP-9020074-JP/dp/B00NV3NN1G/ref=sr_1_1?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&amp;keywords=Corsair+HX1000i&amp;linkCode=sl2&amp;linkId=7e74aeede033623f3854a6a093ea43d9&amp;qid=1572077086&amp;sr=8-1">Corsair HX1000i</a> 25,000 yen
<strong>SSD</strong><a href="https://www.amazon.co.jp/dp/B07GCL6BR4/ref=as_li_ss_tl?ie=UTF8&amp;linkCode=ll1&amp;tag=jisakuhibi0b-22&amp;linkId=fd963ff0cd812b7122e38e558af646c5&amp;language=ja_JP1&amp;1=JP1JP1&amp;1=JP_JP1">Intel SSD 660P</a>
<strong>HDD</strong> <a href="https://kakaku.com/item/K0001026181/">SEAGATE ST6000DM003</a> 11,000 yen
<strong>Simple water cooling fan</strong> [Novonest CC240RGB]
(<a href="https://www.amazon.co.jp/gp/product/B07JFVV9VB/ref=ppx_yo_dt_b_asin_title_o01_s00?ie=UTF8&amp;psc=1">https://www.amazon.co.jp/gp/product/B07JFVV9VB/ref=ppx_yo_dt_b_asin_title_o01_s00?ie=UTF8&amp;psc=1</a>) ¥7,000
<strong>Wireless LAN card</strong> <a href="https://www.amazon.co.jp/gp/product/B07T42NH34/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&amp;psc=1">Ziyituod ZYT-WIE9260</a> 4,000 yen
<strong>Case fan</strong> <a href="https://www.amazon.co.jp/gp/product/B07GFBR8M5/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&amp;psc=1">Ubanner RB001</a> 4,500 yen</p>
<p><strong>Total</strong> 254,500 yen</p>
<p>*The last case fan is not necessary because it is for enjoying with LEDs.</p>
<p>I didn&rsquo;t do much research, but I bought it at &ldquo;Eiya!&rdquo;, but I should have looked into it more ** as described later.</p>
<h3 id="other-bought">Other bought</h3>
<p><strong>RGB fan controller</strong> <a href="https://www.amazon.co.jp/gp/product/B07PFMY9KV/ref=ppx_yo_dt_b_asin_title_o01_s00?ie=UTF8&amp;psc=1">Fractal Design Adjust R1</a> 3,000 yen</p>
<p>This is because I bought a motherboard that does not support the addressable RGB standard, but I ended up buying it because I bought a simple water cooling fan of addressable RGB. (Be careful not to make the same mistake&hellip;)</p>
<p><strong>Thermal conduction grease</strong> <a href="https://www.amazon.co.jp/gp/product/B011F7W3LU/ref=ppx_yo_dt_b_asin_title_o02_s00?ie=UTF8&amp;psc=1">Thermal Grizzly</a> ¥750</p>
<h3 id="considerationreflections">Consideration/Reflections</h3>
<ul>
<li>
<p>Looking only at the number of cores, <a href="https://kakaku.com/pc/cpu/itemlist.aspx?pdf_ma=39&amp;pdf_se=5">Xeon</a>and<a href="https://kakaku.com/pc/cpu_amd/itemlist.aspx?pdf_Spec101=73">Threadripper</a>, but I couldn&rsquo;t afford it.</p>
</li>
<li>
<p><a href="https://www.amazon.co.jp/INTEL-%E3%82%A4%E3%83%B3%E3%83%86%E3%83%AB-Corei9-9900K-INTEL300%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BAChipset%E3%83%9E%E3%82%B6%E3%83%BC%E3%83%9C%E3%83%BC%E3%83%89%E5%AF%BE%E5%BF%9C-BX80684I99900K%E3%80%90BOX%E3%80%91/dp/B005404P9I">Intel 9900k</a>and<a href="https://www.amazon.co.jp/AMD-Ryzen-3900X-105W%E3%80%90%E5%9B%BD%E5%86%85%E6%AD%A3%E8%A6%8F%E4%BB%A3%E7%90%86%E5%BA%97%E5%93%81%E3%80%91-100-100000023BOX/dp/B07SXMZLP9/ref=as_li_ss_tl?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&amp;keywords=3900x&amp;qid=1562932114&amp;s=gateway&amp;sr=8-1&amp;linkCode=sl1&amp;tag=artjuku-22&amp;linkId=302a03c426c499b28724f235b7624370&amp;language=ja_JP">Ryzen3900K</a> but also considered price and cooling. Since it seemed to be possible, I chose Core i7, which looks comfortable.</p>
</li>
<li>
<p><a href="https://g-pc.info/archives/1452/"><strong>Buying a second hand GPU is not recommended</strong></a>, so I should have bought a new one&hellip; While accepting some risks, I will continue to use it as if I had become a pillar.</p>
</li>
<li>
<p>If you look at the top of the GPU, <a href="https://www.amazon.co.jp/nVidia-900-1G150-2500-000-Titan-Graphics-Card/dp/B07L8YGDL5">Titan RTX</a>,<a href="https://kakaku.com/item/K0001083015/">TeslaV100</a> etc., but it&rsquo;s expensive and I don&rsquo;t feel like it&rsquo;s going to be used up.</p>
</li>
<li>
<p>To be honest, if you just turn deep learning, it should have been made more cheaply **.
-Stop simple water cooling <a href="https://www.amazon.co.jp/%E3%82%B5%E3%82%A4%E3%82%BA-%E3%82%AA%E3%83%AA%E3%82%B8%E3%83%8A%E3%83%ABCPU%E3%82%AF%E3%83%BC%E3%83%A9%E3%83%BC-%E8%99%8E%E5%BE%B9-Mark-II/dp/B072PWL5YF">air cooling</a>-Memory<a href="https://www.amazon.co.jp/2666Mhz-PC4-21300-8GBx2%E6%9E%9A%EF%BC%8816GBkit%EF%BC%89%E3%83%87%E3%82%B9%E3%82%AF%E3%83%88%E3%83%83%E3%83%97%E7%94%A8-%E6%97%A5%E6%9C%AC%E5%9B%BD%E5%86%85%E7%84%A1%E6%9C%9F%E9%99%90%E4%BF%9D%E8%A8%BC-%E6%B0%B8%E4%B9%85%E4%BF%9D%E8%A8%BC%EF%BC%89%E6%AD%A3%E8%A6%8F%E5%93%81/dp/B07HK1HWJK/ref=as_li_ss_tl?_encoding=UTF8&amp;refRID=KVWRMB527B7G73Z9PMSZ&amp;linkCode=sl1&amp;tag=artjuku-22&amp;linkId=4a3b17eeb2d258052d4b015fc5764f39&amp;language=ja_JP&amp;th=1">normal(notshining)</a>
-Make CPU and GPU good for cospa
-Assuming one GPU, make the power supply and case smaller
-Reduce SSD capacity</p>
</li>
</ul>
<p>And so on, it seems like we can save a lot of waste.</p>
<h1 id="2-assemble-the-pc">2. Assemble the PC</h1>
<p>While carefully reading the instruction manual of the motherboard, I assembled it referring to <a href="https://www.zoa.co.jp/pickup/detail/jisakupctsukurikata/">here</a>.</p>
<ol>
<li>Attach CPU to Motherboard</li>
<li>Attach the CPU cooler (this time simple water cooling) to the mazebo</li>
<li>Installing memory</li>
<li>Install SSD</li>
<li>Connect the power supply and check the operation</li>
<li>Attach the Mazabo to the case</li>
<li>Attach a water cooling fan to the case</li>
<li>Installing the power supply</li>
<li>HDD installation</li>
<li>GPU Installation</li>
<li>Installing the wireless LAN card</li>
<li>Installing Case Fan</li>
<li>Wiring</li>
<li>Turn on the power and check the operation (check that the CPU temperature and fan speed are within normal values)</li>
<li><strong>I am satisfied with the beautiful LED and drink beer and go to sleep</strong></li>
</ol>
<img width="400" alt="pc_image" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/193401/a3f2c333-3e7b-18cc-6e7e-870f9047561b.jpeg">
<h1 id="3-environment-construction">3. Environment construction</h1>
<h3 id="31-install-ubuntu-18044-lts">3.1 Install Ubuntu 18.04.4 LTS</h3>
<ul>
<li>
<p>I installed it by referring to <a href="https://linuxfan.info/ubuntu-18-04-install-guide">here</a>.</p>
</li>
<li>
<p>First, when I connected Ubuntu to the monitor of Grabo and started Ubuntu <a href="https://qiita.com/k_ikasumipowder/items/5e88ec45f958c35e05ed#deep-learning-%E7%92%B0%E5%A2%83%E3%81%AE%E6%A7%8B%E7%AF%89">The screen freezes</a>.</p>
</li>
<li>
<p>So, first connect it to the mazzabo terminal, or <a href="https://qiita.com/k_ikasumipowder/items/5e88ec45f958c35e05ed#nouveau%E3%81%AE%E7%84%A1%E5%8A%B9%E5%8C%96">disable nouveau</a>.</p>
</li>
</ul>
<h3 id="32-installing-graphics-driver">3.2 Installing graphics driver</h3>
<p>If you installed Ubuntu in Japanese, please correct Japanese in the documents etc. into English.</p>
<pre><code class="language-bash:terminal" data-lang="bash:terminal">LANG=C xdg-user-dirs-gtk-update
</code></pre><p>Update package</p>
<pre><code class="language-bash:terminal" data-lang="bash:terminal">sudo apt-get update
sudo apt-get upgrade
</code></pre><p>Select and download the corresponding driver from <a href="https://www.nvidia.co.jp/Download/index.aspx?lang=jp">NVIDIA driver download</a></p>
<pre><code class="language-bash:" data-lang="bash:">sudo apt-get install build-essential
</code></pre><p>Since the graphic driver may drop during the driver installation, switch to CUI with <code>Ctrl+Alt+F1</code> as a precaution. (It seems that there is a case that it is switched by pressing <code>Ctrl+Alt+F2</code> etc. If that doesn&rsquo;t work, try changing the function key to 3-12.)
At this time, specify <strong>&ndash;no-opengl-files</strong>, <strong>&ndash;no-libglx-indirect</strong>, <strong>&ndash;dkms</strong>
If you don&rsquo;t specify <code>--no shit</code>, you&rsquo;ll be stuck in a login loop, and if you don&rsquo;t have enough <code>--dkms</code>, the nvidia driver will be disabled every time you restart.</p>
<pre><code class="language-bash:" data-lang="bash:">chmod +x ./NVIDIA-Linux-x86_64-440.31.run
sudo ./NVIDIA-Linux-x86_64-440.31.run --no-opengl-files --no-libglx-indirect --dkms
</code></pre><pre><code class="language-bash:" data-lang="bash:">reboot
</code></pre><p>(If the monitor is connected to the mother board, connect it to the Grabo terminal.)</p>
<pre><code class="language-bash:" data-lang="bash:">nvidia-smi
</code></pre><p>Completed if GPU information is displayed</p>
<h3 id="33-docker-installation">3.3 docker installation</h3>
<p>Install according to <a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">official</a>. As of November 4, 2019, the following command was executed.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get update
sudo apt-get install <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    apt-transport-https <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    ca-certificates <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    curl <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    gnupg-agent <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    software-properties-common
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add-
sudo apt-key fingerprint 0EBFCD88
sudo add-apt-repository <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>   <span style="color:#e6db74">&#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu \
</span><span style="color:#e6db74">   </span><span style="color:#66d9ef">$(</span>lsb_release -cs<span style="color:#66d9ef">)</span><span style="color:#e6db74">\
</span><span style="color:#e6db74">   stable&#34;</span>
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io
</code></pre></div><p>Also <a href="https://qiita.com/DQNEO/items/da5df074c48b012152ee">Settings to execute docker command without sudo</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo groupadd docker
sudo gpasswd -a $USER docker
sudo service docker restart
reboot
</code></pre></div><h3 id="34-nvidia-docker-installation">3.4 nvidia-docker installation</h3>
<p>Install according to <a href="https://github.com/NVIDIA/nvidia-docker">NVIDIA Container Toolkit</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">distribution<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>. /etc/os-release;echo $ID$VERSION_ID<span style="color:#66d9ef">)</span>
curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add-
curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list

sudo apt-get update <span style="color:#f92672">&amp;&amp;</span> sudo apt-get install -y nvidia-container-toolkit
sudo systemctl restart docker
</code></pre></div><p>If you can see the GPU information with the following command, you are successful.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run --gpus all --rm nvidia/cuda nvidia-smi
</code></pre></div><h3 id="35-confirm-operation-with-docker-image">3.5 Confirm operation with docker image</h3>
<p>Try running the <a href="https://hub.docker.com/r/tensorflow/tensorflow/tags?page=1&amp;name=1.14.0">tensorflow official docker image</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker pull tensorflow/tensorflow:1.14.0-gpu-py3-jupyter
docker run --gpus all -it --rm -v <span style="color:#66d9ef">$(</span>realpath ~/notebooks<span style="color:#66d9ef">)</span>:/tf/notebooks -p 8888:8888 tensorflow/tensorflow:1.14.0-gpu-py3-jupyter
</code></pre></div><p>When jupyter starts, connect to <code>localhost:8888</code> with a browser</p>
<p>Check if GPU is visible from tensorflow</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> tensorflow.python.client <span style="color:#f92672">import</span> device_lib
<span style="color:#66d9ef">print</span>(device_lib<span style="color:#f92672">.</span>list_local_devices())
</code></pre></div><p>If the GPU looks like the following, it is successful.</p>
<pre><code class="language-bash:output" data-lang="bash:output">[name: &quot;/device:CPU:0&quot;
device_type: &quot;CPU&quot;
memory_limit: 268435456
locality {
}
incarnation: 14740279898702566726
, name: &quot;/device:XLA_GPU:0&quot;
device_type: &quot;XLA_GPU&quot;
memory_limit: 17179869184
locality {
}
incarnation: 10721268506091676345
physical_device_desc: &quot;device: XLA_GPU device&quot;
, name: &quot;/device:XLA_CPU:0&quot;
device_type: &quot;XLA_CPU&quot;
memory_limit: 17179869184
locality {
}
incarnation: 16980550380766421160
physical_device_desc: &quot;device: XLA_CPU device&quot;
, name: &quot;/device:GPU:0&quot;
device_type: &quot;GPU&quot;
memory_limit: 10512030106
locality {
  bus_id: 1
  links {
  }
}
incarnation: 10531017116676756003physical_device_desc: &quot;device: 0, name: GeForce RTX 2080 Ti, pci bus id: 0000:01:00.0, compute capability: 7.5&quot;
]
</code></pre><h3 id="36-mnist">3.6 MNIST</h3>
<p>いよいよディープが回せます！</p>
<p>簡単なCNNでMNISTを回してみます．</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#960050;background-color:#1e0010">!</span>pip install keras

<span style="color:#f92672">import</span> keras
<span style="color:#f92672">from</span> keras.datasets <span style="color:#f92672">import</span> mnist
<span style="color:#f92672">from</span> keras.models <span style="color:#f92672">import</span> Sequential
<span style="color:#f92672">from</span> keras.layers <span style="color:#f92672">import</span> Dense, Dropout, Flatten, MaxPooling2D, Conv2D
<span style="color:#f92672">from</span> keras.callbacks <span style="color:#f92672">import</span> TensorBoard

(X_train,y_train), (X_test, y_test) <span style="color:#f92672">=</span> mnist<span style="color:#f92672">.</span>load_data()

X_train <span style="color:#f92672">=</span> X_train<span style="color:#f92672">.</span>reshape(<span style="color:#ae81ff">60000</span>,<span style="color:#ae81ff">28</span>,<span style="color:#ae81ff">28</span>,<span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;float32&#39;</span>)
X_test <span style="color:#f92672">=</span> X_test<span style="color:#f92672">.</span>reshape(<span style="color:#ae81ff">10000</span>,<span style="color:#ae81ff">28</span>,<span style="color:#ae81ff">28</span>,<span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;float32&#39;</span>)

X_train <span style="color:#f92672">/=</span> <span style="color:#ae81ff">255</span>
X_test <span style="color:#f92672">/=</span> <span style="color:#ae81ff">255</span>

n_classes <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
y_train <span style="color:#f92672">=</span> keras<span style="color:#f92672">.</span>utils<span style="color:#f92672">.</span>to_categorical(y_train, n_classes)
y_test <span style="color:#f92672">=</span> keras<span style="color:#f92672">.</span>utils<span style="color:#f92672">.</span>to_categorical(y_test, n_classes)

model <span style="color:#f92672">=</span> Sequential()
model<span style="color:#f92672">.</span>add(Conv2D(<span style="color:#ae81ff">32</span>, kernel_size<span style="color:#f92672">=</span>(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>), activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>, input_shape<span style="color:#f92672">=</span>(<span style="color:#ae81ff">28</span>,<span style="color:#ae81ff">28</span>,<span style="color:#ae81ff">1</span>)) )
model<span style="color:#f92672">.</span>add(Conv2D(<span style="color:#ae81ff">64</span>, kernel_size<span style="color:#f92672">=</span>(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>), activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>))
model<span style="color:#f92672">.</span>add(MaxPooling2D(pool_size<span style="color:#f92672">=</span>(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>)))
model<span style="color:#f92672">.</span>add(Dropout(<span style="color:#ae81ff">0.5</span>))
model<span style="color:#f92672">.</span>add(Flatten())          
model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">128</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>))
model<span style="color:#f92672">.</span>add(Dropout(<span style="color:#ae81ff">0.5</span>))
model<span style="color:#f92672">.</span>add(Dense(n_classes, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;softmax&#39;</span>))

model<span style="color:#f92672">.</span>compile(loss<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;categorical_crossentropy&#39;</span>, optimizer<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;adam&#39;</span>, metrics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;accuracy&#39;</span>])

<span style="color:#f92672">import</span> time
start <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()

model<span style="color:#f92672">.</span>fit(X_train, y_train, batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">128</span>, epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">15</span>, verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,
          validation_data<span style="color:#f92672">=</span>(X_test,y_test))

elapsed_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time() <span style="color:#f92672">-</span> start
<span style="color:#66d9ef">print</span> (<span style="color:#e6db74">&#34;elapsed_time:{0}&#34;</span><span style="color:#f92672">.</span>format(elapsed_time) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;[sec]&#34;</span>)
</code></pre></div><pre><code class="language-python:output" data-lang="python:output">elapsed_time:65.47733306884766[sec]
</code></pre><p>Google ColaboratoryのGPUはランダムに割り当てられるのですが，P100を引いたときは62秒でした．</p>
<p>20万以上使ったPCが，無料のColaboratoryに負けてしまうのは悲しい気もしますが，時間制限もありませんし，レスポンスも早く，好きに拡張できるのは大きなメリットになりそうです．</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
