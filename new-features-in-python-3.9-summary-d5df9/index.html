<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>New Features in Python 3.9 (Summary) | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>New Features in Python 3.9 (Summary)</h1>
<p>
  <small class="text-secondary">
  
  
  Jan 18, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/python3">Python3</a></code></small>

</p>
<pre><code>## Introduction
</code></pre>
<p>I&rsquo;ve posted an article summarizing what&rsquo;s new in Python 3.5.</p>
<ul>
<li><a href="http://qiita.com/ksato9700/items/9a0aef07d90d00e67525">New in Python 3.5</a></li>
<li><a href="https://qiita.com/ksato9700/items/ed839a6db6a671fd31e6">New in Python3.6</a></li>
<li><a href="https://qiita.com/ksato9700/items/35a0bdc04693b3b09757">New to Python 3.7</a></li>
<li><a href="https://qiita.com/ksato9700/items/3846e8db573a07c71c33">New features of Python 3.8 (Summary)</a></li>
</ul>
<p>From now on, <a href="https://qiita.com/ksato9700/items/a6578b09b2949c8548dd">the release cycle will be faster</a>, so the frequency of posting is likely to increase, but I can do it as an old engineer who has been chasing Python since 1.x. I just want to continue.</p>
<p>And, as I wrote in <a href="https://qiita.com/ksato9700/items/1e12eca0f8c0fa1f4167">this article</a>, Python2 reached the end-of-life on January 1st of this year. I&rsquo;m looking forward to seeing what new features will be added to 3.9, which will be released for the first time as Python 3 is the only Python being maintained.</p>
<p>In addition, from the last time, I changed the way of organizing from the last time to &ldquo;I will write a small change in this article and a big change in another article and link here&rdquo;, but I would like to follow it again this time. And instead of covering all the changes, I will focus on what I personally care about.</p>
<p>First is the development roadmap (<a href="https://www.python.org/dev/peps/pep-0596/">PEP-596</a>), which has become a one-year cycle since this time.</p>
<ul>
<li>3.9 Start of development: 2019-06-04 (Completed)</li>
<li>3.9.0 alpha 1: 2019-11-19 (completed)</li>
<li>3.9.0 alpha 2: 2019-12-16 -&gt; 2019-12-18 (completed)</li>
<li>3.9.0 alpha 3: 2020-01-13 -&gt; 2020-01-25 (completed)</li>
<li>3.9.0 alpha 4: 2020-02-17 -&gt; 2020-02-26 (Completed)</li>
<li>3.9.0 alpha 5: 2020-03-16 -&gt; 2020-03-23 (Completed)</li>
<li>3.9.0 alpha 6: 2020-04-22 -&gt; 2020-04-28 (Completed)</li>
<li>3.9.0 beta 1: 2020-05-18 -&gt; 2020-05-19 (completed, no new features added after this)</li>
<li>3.9.0 beta 2: 2020-06-08</li>
<li>3.9.0 beta 3: 2020-06-29</li>
<li>3.9.0 beta 4: 2020-07-20</li>
<li>3.9.0 candidate 1: 2020-08-10</li>
<li>3.9.0 candidate 2: 2020-09-14</li>
<li>3.9.0 final: 2020-10-05</li>
</ul>
<p>##Change log</p>
<h3 id="20200531">2020.05.31</h3>
<p>The first beta version was released on 2020-05-19 almost as planned. Now the new features of 3.9 are a stepping stone.</p>
<p>Added the following to &ldquo;Newly Added Modules&rdquo;.</p>
<ul>
<li>zoneinfo module</li>
</ul>
<p>Added the following to &ldquo;Module Improvement&rdquo;.</p>
<ul>
<li>datetime module (specification change of <code>isocalendar()</code>)</li>
<li>functools module (adding <code>TopologicalSorter</code>)</li>
<li>hashlib module (embedded implementation can be disabled with a compile-time option)</li>
<li>ipaddress module (support for ipv6 scoped addresses)</li>
<li>math module (extension of <code>gcd</code>, addition of <code>lcm</code>)</li>
<li>os module (adding <code>os.pidfd_open()</code> and <code>os.P_PIDFD</code>)</li>
<li>random module (adding <code>Random.randbytes()</code>)</li>
</ul>
<h3 id="20200504">2020.05.04</h3>
<p>The final alpha version, a6, was released on 2020-04-28. It&rsquo;s still a week late, isn&rsquo;t it?</p>
<p>Added the following to &ldquo;Noticeable new functions&rdquo;.</p>
<ul>
<li>Added a method to remove the prefix and suffix from the character string</li>
<li>Can be typed with standard collection types</li>
<li>Introducing a new parser</li>
</ul>
<p>Added the following to &ldquo;Module Improvement&rdquo;.</p>
<ul>
<li>typing module (eg adding <code>typing.Annotated</code>)</li>
</ul>
<h3 id="20200406">2020.04.06</h3>
<p>A4 was released in 2020-02-26 and a5 was released in 2020-03-23. It came almost as planned with a delay of about a week. I was thinking about writing new features after the beta was released, but since there were quite a lot of them, I updated them. I will not add them all at once, so I will add them little by little.</p>
<ul>
<li>Added release highlight (&ldquo;Let&rsquo;s check Deprecation Warning!&quot;)</li>
<li>Added &ldquo;You can use union operator in dictionary type&rdquo;</li>
</ul>
<h3 id="20200127">2020.01.27</h3>
<p>A3 was released on 2020-01-25. As far as I can see, there seems to be no big update after 1/18. [Bugs related to GC (garbage collection)](
The fix for <a href="https://bugs.python.org/issue38379">https://bugs.python.org/issue38379</a>) was taken up. Although I was able to send a3 a little on schedule, the schedule for the next a4 has not changed.</p>
<h3 id="20200118">2020.01.18</h3>
<p>First version. a2 was released on 2019-12-18, but I am writing based on what&rsquo;s new. Since a3 was scheduled for 2020-01-13, I was thinking of waiting for it, but it seems that it is late, so I will put it out for the time being.</p>
<h2 id="release-highlights">Release highlights</h2>
<p>Check ###DeprecationWarning!</p>
<p>The support period for Python 2.7 has expired, and the past compatible features that were left behind will be cut off immediately or soon. They have been putting out <code>DeprecatedWarning</code> for many years now, but it&rsquo;s possible that they will stop working as soon as you update them unless you seriously check and put them.
To check, you can give a warning message as <code>-W default</code> at run time, or you can dare to make an error with <code>-W error</code>.</p>
<h2 id="featured-new-features">Featured new features</h2>
<h3 id="the-union-operator-can-be-used-in-the-dictionary-type">The union operator can be used in the dictionary type</h3>
<p>â†’ Made a separate article: <a href="https://qiita.com/ksato9700/items/b285af8b78f0d2cf5adb">New feature of Python3.9 (1)-Union operator can be used in dictionary type</a></p>
<h3 id="pep-616pythonorgdevpepspep-0616-added-a-method-to-remove-prefixes-and-suffixes-from-strings"><a href="python.org/dev/peps/pep-0616/">PEP 616</a> Added a method to remove prefixes and suffixes from strings</h3>
<p>The methods <code>removeprefix(prefix)</code> and <code>removesuffix(suffix)</code> have been added to <code>str</code>, <code>bytes</code>, <code>bytearray</code>, and <code>collections.UserString</code>. This is a method that cuts off the substring at the beginning or end of the character string (or byte string). For example,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span><span style="color:#e6db74">&#39;test_sample.txt&#39;</span><span style="color:#f92672">.</span>removeprefix(<span style="color:#e6db74">&#39;test_&#39;</span>)
<span style="color:#e6db74">&#39;sample.txt&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span><span style="color:#e6db74">&#39;abc.doc&#39;</span><span style="color:#f92672">.</span>removesuffix(<span style="color:#e6db74">&#39;.doc&#39;</span>)
<span style="color:#e6db74">&#39;abc&#39;</span>
</code></pre></div><p>You can do something like I wonder, &ldquo;Isn&rsquo;t there such a method?&rdquo;, but it wasn&rsquo;t. Actually, there are similar methods, <code>lstrip</code> and <code>rstrip</code>. Normally</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span><span style="color:#e6db74">&#39;spacey_head&#39;</span><span style="color:#f92672">.</span>lstrip()
<span style="color:#e6db74">&#39;spacey_head&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span><span style="color:#e6db74">&#39;spacey_tail&#39;</span> <span style="color:#f92672">.</span>rstrip()
<span style="color:#e6db74">&#39;spacey_tail&#39;</span>
</code></pre></div><p>It is used to erase white space characters in the form of, but when given an argument to this, it is a quirky (?) specification of &ldquo;erasing until it does not match any of the characters contained in the string&rdquo;. And easy to make mistakes. For example, trying to do the same as the above example,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span><span style="color:#e6db74">&#39;abc.doc&#39;</span><span style="color:#f92672">.</span>rstrip(<span style="color:#e6db74">&#39;.doc&#39;</span>)
<span style="color:#e6db74">&#39;ab&#39;</span>
<span style="color:#f92672">&gt;&gt;&gt;</span><span style="color:#e6db74">&#39;test_sample.txt&#39;</span><span style="color:#f92672">.</span>lstrip(<span style="color:#e6db74">&#39;test_&#39;</span>)
<span style="color:#e6db74">&#39;ample.txt&#39;</span>
</code></pre></div><p>If you do so, you will be surprised because it will disappear to unexpected places. In fact, this behavior is confusing Python users, which is part of the reason for adding new methods to remove prefixes and suffixes.</p>
<h3 id="pep-585httpswwwpythonorgdevpepspep-0585-allows-typing-with-standard-collection-types"><a href="https://www.python.org/dev/peps/pep-0585/">PEP 585</a> Allows typing with standard collection types</h3>
<p>Up to now, if you want to type annotate collections such as lists and tuples, you have to use <code>Listing</code> or <code>Tuple</code> of the <code>typing</code> module to do this.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> typing
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">greet_all</span>(names: typing<span style="color:#f92672">.</span>List[str]) <span style="color:#f92672">-&gt;</span> None:
    <span style="color:#66d9ef">for</span> name <span style="color:#f92672">in</span> names:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;hello&#34;</span>, name)
</code></pre></div><p>Many people would have thought that it would be nice to use the type names such as <code>list</code> and <code>tuple</code> as they are in the same way as <code>str</code> or <code>int</code>. That&rsquo;s 3.9. That is,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">greet_all</span>(names: list[str]) <span style="color:#f92672">-&gt;</span> None:
    <span style="color:#66d9ef">for</span> name <span style="color:#f92672">in</span> names:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;hello&#34;</span>, name)
</code></pre></div><p>You will be able to write!</p>
<h3 id="pep-617pythonorgdevpepspep-0617-introducing-a-new-parser"><a href="python.org/dev/peps/pep-0617/">PEP 617</a> Introducing a new parser</h3>
<p>The part that reads and analyzes the code in the language processing system is called a parser, but until now Python used a parser of the type LL(1). This is a parser that parses from the top down with only one look-ahead, and is often used in parsing programming languages in combination with the bottom-up LR type. While efficient parsing is possible, there is a problem that the grammar that can be handled is limited. Python already has a syntax that cannot be handled by LL(1), and for that reason some special logic is built in as post processing for parser parsing. This time, we are introducing a new PEG parser so that it can handle various syntaxes.</p>
<p>For example, if you want to bind multiple variables with the with statement,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">with</span> (
    open(<span style="color:#e6db74">&#34;a_really_long_foo&#34;</span>) <span style="color:#66d9ef">as</span> foo,
    open(<span style="color:#e6db74">&#34;a_really_long_baz&#34;</span>) <span style="color:#66d9ef">as</span> baz,
    open(<span style="color:#e6db74">&#34;a_really_long_bar&#34;</span>) <span style="color:#66d9ef">as</span> bar
):
    <span style="color:#f92672">...</span>
<span style="color:#e6db74">``</span><span style="color:#960050;background-color:#1e0010">`</span>I would like to write it, but this can <span style="color:#f92672">not</span> be processed by the current parser<span style="color:#f92672">.</span> I would like to introduce a new parser to handle this<span style="color:#f92672">.</span>

Python <span style="color:#ae81ff">3.9</span> also has the old LL(<span style="color:#ae81ff">1</span>) parser<span style="color:#f92672">.</span> The default <span style="color:#f92672">is</span> to use the new parser, but you can call the old one <span style="color:#66d9ef">with</span> an option (<span style="color:#e6db74">`-X oldparser`</span>) at the time of invocation <span style="color:#f92672">or</span> an environment variable (<span style="color:#e6db74">`PYTHONOLDPARSER=1`</span>)<span style="color:#f92672">.</span> However, this <span style="color:#f92672">is</span> a transitional measure, <span style="color:#f92672">and</span> when Python <span style="color:#ae81ff">3.10</span> <span style="color:#f92672">is</span> reached, the old parser will be retired <span style="color:#f92672">and</span> only the new one will be released<span style="color:#f92672">.</span> And the language specification will be based on that<span style="color:#f92672">.</span>

<span style="color:#75715e">## Other language changes</span>

<span style="color:#75715e">#### Error on import now raises `ImportError` instead of `ValueError`</span>

In a package <span style="color:#66d9ef">with</span> a hierarchical structure, the modules <span style="color:#f92672">in</span> the upper hierarchy are

<span style="color:#e6db74">``</span><span style="color:#960050;background-color:#1e0010">`</span>python
<span style="color:#f92672">import</span> <span style="color:#f92672">..</span>module_1
</code></pre></div><p>However, if you do this at the top level of the package, you will get an error. If so, until now</p>
<pre><code>ValueError: attempted relative import beyond top-level package
</code></pre><p>There was a <code>ValueError</code>, but from 3.9</p>
<pre><code>ImportError: attempted relative import beyond top-level package
</code></pre><p>It becomes <code>ImportError</code>. Similarly, the error of <code>importlib.util.resove_name()</code> will be changed from <code>ValueError</code> to <code>ImportError</code>. It&rsquo;s an incompatible change, so the code that catches and handles this exception needs to change, but it&rsquo;s a legitimate change.</p>
<h4 id="execution-path-when-executing-a-local-file-is-an-absolute-path">Execution path when executing a local file is an absolute path</h4>
<p>When it is set to <code>python script.py</code>, the file name of the executed script is entered in the <code>__file__</code> attribute, but until now it was a relative path as it was written on the command line, but from 3.9 it becomes an absolute path. I will. ~~ In addition, What&rsquo;s new says that the value of <code>sys.path[0]</code> is also an absolute path, but this is the case even in the current version, so I think it is a mistake in the document. I am thinking. ~~ -&gt; This was a bug report and I had it fixed.</p>
<p>Then, following the discussion in the past, it seems that he tried to change <code>sys.argv[0]</code> to an absolute path. However, there was a tsukkomi that the range of influence was too large, and that seems to have been canceled. Certainly it&rsquo;s good because I think it&rsquo;s a bit overkill. Huh.</p>
<h4 id="change-behavior-of-replace-for-empty-string-">Change behavior of <code>replace</code> for empty string (&quot;&quot;)</h4>
<p>The behavior when applying the <code>replace</code> method to an empty string (&quot;&quot;) changes. Previously, we had weird results with the optional <code>count</code> argument, which specifies at most how many changes to apply.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;p&#34;</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;p&#34;</span>
<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;p&#34;</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;p&#34;</span>, <span style="color:#ae81ff">2</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</code></pre></div><p>At 3.9, this will be more consistent.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;p&#34;</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;p&#34;</span>
<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;p&#34;</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;p&#34;</span>
<span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#e6db74">&#34;p&#34;</span>, <span style="color:#ae81ff">2</span>) <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;p&#34;</span>
</code></pre></div><p>Well, I think that it is a level of bug fixing to be clear, but &ldquo;(maybe not) I will not backport to the previous version because it is troublesome for those who implement this behavior&rdquo;. thing.</p>
<h2 id="newly-added-module">Newly added module</h2>
<h4 id="zoneinfo">zoneinfo</h4>
<p>A new <code>zoneinfo</code> module has been added to the standard library. This provides the functionality of IANA&rsquo;s time zone database as standard. There are some functions provided by the <code>datetime</code> module that take timezone information as arguments, but the standard <code>timezone</code> class provides only a minimal set of features, and tries to do something a little fancy. Then I had to rely on an external library such as <a href="https://dateutil.readthedocs.io/en/stable/">python-dateutil</a>. This will be a lot easier with the new <code>zoneinfo</code> module added in 3.9.</p>
<p>For example.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">from</span> zoneinfo <span style="color:#f92672">import</span> ZoneInfo
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime

<span style="color:#f92672">&gt;&gt;&gt;</span> tzinfo <span style="color:#f92672">=</span> ZoneInfo(<span style="color:#e6db74">&#34;Europe/Brussels&#34;</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> dt <span style="color:#f92672">=</span> datetime(<span style="color:#ae81ff">2020</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">24</span>, <span style="color:#ae81ff">12</span>, tzinfo<span style="color:#f92672">=</span>tzinfo)
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">print</span>(dt)
<span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">10</span><span style="color:#f92672">-</span><span style="color:#ae81ff">24</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">00</span>:<span style="color:#ae81ff">00</span><span style="color:#f92672">+</span><span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">00</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> dt<span style="color:#f92672">.</span>tzname()
<span style="color:#e6db74">&#39;CEST&#39;</span>

<span style="color:#f92672">&gt;&gt;&gt;</span> dt <span style="color:#f92672">=</span> datetime(<span style="color:#ae81ff">2020</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">25</span>, <span style="color:#ae81ff">12</span>, tzinfo<span style="color:#f92672">=</span>tzinfo)
<span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">print</span>(dt)
<span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">10</span><span style="color:#f92672">-</span><span style="color:#ae81ff">25</span> <span style="color:#ae81ff">12</span>:<span style="color:#ae81ff">00</span>:<span style="color:#ae81ff">00</span><span style="color:#f92672">+</span><span style="color:#ae81ff">01</span>:<span style="color:#ae81ff">00</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> dt<span style="color:#f92672">.</span>tzname()
<span style="color:#e6db74">&#39;CET&#39;</span>
</code></pre></div><p>Many countries in Western Europe have adopted Central European Time. The countries in this time zone are daylight saving time from the last Sunday in March to the last Sunday in October, but when it uses <code>zoneinfo</code>, there is no problem from location information without being aware of the timing of switching. You can see that it can handle time zones.</p>
<h2 id="module-improvements">Module improvements</h2>
<p>####asyncio</p>
<p>There are some changes to <code>asyncio</code>.</p>
<p>What I thought was most interesting was the addition of <code>PidfdChildWatcher</code>. It is possible to create multiple child processes in asyncio and wait for the results asynchronously, but it is surprisingly difficult to &ldquo;detect the end of the child process&rdquo;. So far, about 4 methods have been implemented, each time a child process is created, a thread for monitoring is created, 2 methods using a signal (SIGCHLD) are used, and <code>os.waitpid()</code> is used. There was a way. Each has merits and demerits, and can be changed by the user if necessary (default is thread creation). This time, the one using pidfs is added.</p>
<p>Pidfs, which I also learned for the first time, is a new device introduced in Linux that allows you to point a process to a file descriptor. In Unix, a process is usually indicated by a PID (Process ID), but since it is a 32-bit signed integer that is shared by the entire system, it will be exhausted when the system keeps running and processes are repeatedly created and deleted. I will do it. So you&rsquo;ll be reusing the PID you&rsquo;ve been using (of the process that&rsquo;s already gone), but we know this can be a security hole. As a countermeasure, the idea of a file descriptor that assigns an individual number to each process is also applied to the process, and the child process can be accessed using it.</p>
<p>The <code>PidfdChildWatcher</code> added in 3.9 does not require threads or signals and does not interfere with other processes, so it is a &ldquo;just right&rdquo; implementation of child process monitoring. The problem is that it can be used only with a relatively new version of Linux (5.3 or later), but I think that if it gradually expands, there will be more opportunities to use this.</p>
<h4 id="datetime">datetime</h4>
<p><code>datetime.isocalendar()</code> and <code>date.isocalendar()</code> used to return tuples <code>(year, week, weekday)</code> as below.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime
<span style="color:#f92672">&gt;&gt;&gt;</span> dt <span style="color:#f92672">=</span> datetime(<span style="color:#ae81ff">2020</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">30</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> isocal <span style="color:#f92672">=</span> dt<span style="color:#f92672">.</span>isocalendar()
<span style="color:#f92672">&gt;&gt;&gt;</span> isocal
(<span style="color:#ae81ff">2020</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">6</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> isocal[<span style="color:#ae81ff">0</span>]
<span style="color:#ae81ff">2020</span>
</code></pre></div><p>Tuples are hard to understand because you have to use a numerical index to access the information inside them. This will return named tuples from 3.9.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime
<span style="color:#f92672">&gt;&gt;&gt;</span> dt <span style="color:#f92672">=</span> datetime(<span style="color:#ae81ff">2020</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">30</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> isocal <span style="color:#f92672">=</span> dt<span style="color:#f92672">.</span>isocalendar()
<span style="color:#f92672">&gt;&gt;&gt;</span> isocal
datetime<span style="color:#f92672">.</span>IsoCalendarDate(year<span style="color:#f92672">=</span><span style="color:#ae81ff">2020</span>, week<span style="color:#f92672">=</span><span style="color:#ae81ff">22</span>, weekday<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>)
<span style="color:#f92672">&gt;&gt;&gt;</span> isocal<span style="color:#f92672">.</span>year
<span style="color:#ae81ff">2020</span>
</code></pre></div><p>It&rsquo;s much easier because you can access it like object attributes.</p>
<h4 id="functools">functools</h4>
<p>A function for sorting a directed graph called <code>TopologicalSorter</code> has been provided as a class. I wrote about this in <a href="https://qiita.com/ksato9700/items/0b43be7b9f2579115225">New feature of Python3.9 (2)-Sorting a directed acyclic graph in Python</a>.</p>
<h4 id="hashlib">hashlib</h4>
<p>The built-in hash function implementation can now (optionally) be disabled as an option when compiling Python implementations. This is to force the use of the OpenSSL implementation.</p>
<h4 id="ipaddress">ipaddress</h4>
<p>You can specify the scoped address specified in <a href="https://tools.ietf.org/html/rfc4007.html">RFC4007</a> in the form of <code>&lt;ipv6_address&gt;%scope_id</code>. Also, an attribute called <code>scope_id</code> has been added to the <code>IPv6Address</code> class, and in the case of a scoped address, you can check the value there.</p>
<h4 id="math">math</h4>
<p><code>gcd</code>, which computes the greatest common divisor, can now take more than two arguments. Previously it was limited to two. Also, <code>lcm</code> has been added to calculate the least common multiple. This corresponds to more than 3 arguments from the beginning.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">import</span> math
<span style="color:#f92672">&gt;&gt;&gt;</span> math<span style="color:#f92672">.</span>gcd(<span style="color:#ae81ff">120</span>, <span style="color:#ae81ff">156</span>, <span style="color:#ae81ff">180</span>)
<span style="color:#ae81ff">12</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> math<span style="color:#f92672">.</span>lcm(<span style="color:#ae81ff">120</span>, <span style="color:#ae81ff">156</span>, <span style="color:#ae81ff">180</span>)
<span style="color:#ae81ff">4680</span>
</code></pre></div><h4 id="os">os</h4>
<p>Added <code>pidfd_open()</code> and <code>P_PIDFD</code>. It&rsquo;s part of the pidfs support we discussed in <code>asyncio</code> above.</p>
<h4 id="pathlib">pathlib</h4>
<p>A <code>pathlib.Path.readlink()</code> that follows a symbolic link has been added. For example, if you have a link <code>b -&gt; a</code>, you can still use <code>os.readlink()</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">import</span> os
<span style="color:#f92672">&gt;&gt;&gt;</span> os<span style="color:#f92672">.</span>readlink(<span style="color:#e6db74">&#39;b&#39;</span>)
<span style="color:#e6db74">&#39;a&#39;</span>
</code></pre></div><p>I was able to, but I had to give the file path as a string. Since 3.9, <code>readlink()</code> is added as a method to the <code>Path</code> object, so```python</p>
<blockquote>
<blockquote>
<blockquote>
<p>from pathlib import Path
p = Path(&lsquo;b&rsquo;)
p.readlink()
PosixPath(&lsquo;a&rsquo;)</p>
</blockquote>
</blockquote>
</blockquote>
<pre><code>
You can do it this way. This example has more steps than `os.readlink()`, but a tool that uses a Path object to display a symbolic link under `/usr/local/bin` looks like this. Can write.

```python
from pathlib import Path

p = Path('/usr/local/bin/')
for child in p.iterdir():
  if child.is_symlink():
    print(f'{child} -&gt; {child.readlink()}')
</code></pre><h4 id="random">random</h4>
<p>Added <code>Random.randbytes()</code> which returns a random number as a sequence of bytes of arbitrary length. However, since the random number generated by the random module is a pseudo-random number, it is good for modeling and simulation, but not recommended for security applications and encryption. A function called <code>secrets.token_bytes()</code> is already prepared for such use.</p>
<h4 id="typing">typing</h4>
<p>A class called <code>Annotated</code> has been added to the <code>typing</code> module to add metadata to type hint information.</p>
<p>For example, suppose that a member variable called value of a class called <code>IntInRange</code> is of type integer (<code>int</code>) and its value is in the range -10 to 5. Previously, type information was added that it was an integer type, but it was not possible to specify the range of numbers. Since 3.9, you can put arbitrary data in the second and subsequent arguments of <code>Annotated</code> as follows, so I tried specifying the range of numbers with tuples.</p>
<p>And the hint information can be retrieved by passing True to the argument <code>include_extras</code> added from 3.9 to the <code>get_type_hints</code> function. If you create a special type checker using this, you can check the type including the range of values.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Annotated, get_type_hints

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IntInRange</span>:
    value: Annotated[int, (<span style="color:#f92672">-</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">5</span>)]

get_type_hints(IntInRange) <span style="color:#f92672">==</span> {<span style="color:#e6db74">&#39;value&#39;</span>: int}
get_type_hints(IntInRange, include_extras<span style="color:#f92672">=</span>True) <span style="color:#f92672">==</span> {<span style="color:#e6db74">&#39;value&#39;</span>: Annotated[int, (<span style="color:#f92672">-</span><span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">5</span>)]}
</code></pre></div><p>##optimisation</p>
<h2 id="decommissioning">Decommissioning</h2>
<ul>
<li>If <code>math.factorial()</code> includes a floating point number, the deprecation warning will be displayed even if the number of decimals is 0. It seems to be <code>TypeError</code> in the future.</li>
<li>In the <code>random</code> module, any type of data could now be used as a seed if it was hashable, but to ensure that the result is unique, <code>None</code>, <code>int</code>, <code>float</code>, Only <code>str</code>, <code>bytes and bytearray</code> can be seeded and used.</li>
</ul>
<h2 id="function-removal">Function removal</h2>
<ul>
<li><code>tostring()</code> and <code>fromstring()</code> methods of <code>array.array</code> have been removed. It was deprecated from around 3.2 and was an alias for <code>tobytes()</code> and <code>frombytes()</code>.</li>
</ul>
<h2 id="summary">Summary</h2>
<p>I summarized the changes in Python 3.9. Since 3.9 is in beta, I think this article is almost complete, but there are some optimization parts and parts that have not been written yet, so I will add it as appropriate.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
