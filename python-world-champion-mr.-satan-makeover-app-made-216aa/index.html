<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Python] World Champion Mr. Satan Makeover App Made | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] World Champion Mr. Satan Makeover App Made</h1>
<p>
  <small class="text-secondary">
  
  
  Jan 15, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/opencv"> OpenCV</a></code></small>


<small><code><a href="https://memotut.com/tags/machine-learning"> machine learning</a></code></small>


<small><code><a href="https://memotut.com/tags/face-recognition"> face recognition</a></code></small>


<small><code><a href="https://memotut.com/tags/facedetect"> facedetect</a></code></small>

</p>
<pre><code>#Introduction
</code></pre>
<p>Everyone&rsquo;s yearning, world champion &ldquo;Mr. Satan&rdquo;. I made an application that can transform into &ldquo;Mr. Satan&rdquo;. Wearing the characteristic eyebrows, beard, and afro hair, you are now &ldquo;Mr. Satan&rdquo;!</p>
<img width="500" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/7a43d395-d440-784b-9553-72dfa703b08c.jpeg">
<img width="500" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/214db16d-4680-7165-4692-e92129e1969c.png">
<img width="500" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/cb974f18-306e-12fb-0939-dd961c061de8.jpeg">
<img width="500" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/3347d5cb-5cfb-fcaf-6524-b28c0db4cdb4.png">
<h3 id="miscellaneous-w"><strong>Miscellaneous</strong> (w)!</h3>
<p>Technically, the face_recognition library is used to acquire the coordinates of various parts of the face, and the positions and sizes of the eyebrows, whiskers, and afro are calculated and drawn based on them.</p>
<p>What is #face_recognition</p>
<p>Face Recognition is the simplest face recognition library in the world that can recognize and control faces.</p>
<h3 id="face-recognitionhttpsgithubcomageitgeyface_recognition"><a href="https://github.com/ageitgey/face_recognition"><strong>Face Recognition</strong></a></h3>
<blockquote>
<p>Recognize and manipulate faces from Python or from the command line with the world&rsquo;s simplest face recognition library.</p>
</blockquote>
<p>To use it, first install it with pip.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ pip install opencv-python
$ pip install opencv-contrib-python
$ pip install cmake
$ pip install face_recognition
</code></pre></div><p>As a test, I will try to acquire face parts using the image below.</p>
<img width="500" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/bf9b1392-26fa-b8cb-0033-2f8c484719be.jpeg">
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> face_recognition
<span style="color:#f92672">import</span> cv2

F <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;image.jpg&#34;</span>

image <span style="color:#f92672">=</span> face_recognition<span style="color:#f92672">.</span>load_image_file(F)
face_landmarks_list <span style="color:#f92672">=</span> face_recognition<span style="color:#f92672">.</span>face_landmarks(image)

<span style="color:#66d9ef">print</span>(face_landmarks_list)
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/a265d3a0-34c1-e4e2-1da9-c049b52ff337.jpeg" alt="Img15790044321.jpg"></p>
<p>I got the coordinates of each part.
Plot the acquired coordinates on the actual image.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">bgr <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(F)
<span style="color:#66d9ef">for</span> face_landmarks <span style="color:#f92672">in</span> face_landmarks_list:

    <span style="color:#66d9ef">for</span> facial_feature <span style="color:#f92672">in</span> face_landmarks<span style="color:#f92672">.</span>keys():
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(face_landmarks[facial_feature])):
            cv2<span style="color:#f92672">.</span>drawMarker(bgr, face_landmarks[facial_feature][i],
                           color<span style="color:#f92672">=</span>(<span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>), markerType<span style="color:#f92672">=</span>cv2<span style="color:#f92672">.</span>MARKER_CROSS, thickness<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)

cv2<span style="color:#f92672">.</span>imshow(<span style="color:#e6db74">&#39;&#39;</span>, bgr)
cv2<span style="color:#f92672">.</span>waitKey(<span style="color:#ae81ff">0</span>)
cv2<span style="color:#f92672">.</span>destroyAllWindows()
</code></pre></div><img width="500" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/4f66b41a-1134-5bc0-8fc9-8fc74a20cee2.jpeg">
<p>You can see that it is recognized correctly.</p>
<p>#Actual code</p>
<h3 id="1-install-with-pip">1. Install with pip</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ pip install opencv-python
$ pip install opencv-contrib-python
$ pip install cmake
$ pip install face_recognition
</code></pre></div><h3 id="2-library-import-and-constant-declaration">2. Library import and constant declaration</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> face_recognition
<span style="color:#f92672">import</span> cv2
<span style="color:#f92672">from</span> PIL <span style="color:#f92672">import</span> Image
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Maximum height and width of image</span>
MAX_IMAGE_WIDTH <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>
MAX_IMAGE_HEIGHT <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>
</code></pre></div><h3 id="3-function-definition-overlay-drawingstoring-coordinates-in-array">3. Function definition (overlay drawing/storing coordinates in array)</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CvOverlayImage</span>(object):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    [summary]
</span><span style="color:#e6db74">      Overlay the specified image on the OpenCV format image
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>

    <span style="color:#66d9ef">def</span> __init__(self):
        <span style="color:#66d9ef">pass</span>

    <span style="color:#a6e22e">@classmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">overlay</span>(
            cls,
            cv_background_image,
            cv_overlay_image,
            point,
    ):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        [summary]
</span><span style="color:#e6db74">          Overlay the specified image on the OpenCV format image
</span><span style="color:#e6db74">        Parameters
</span><span style="color:#e6db74">        ----------
</span><span style="color:#e6db74">        cv_background_image :[OpenCV Image]
</span><span style="color:#e6db74">        cv_overlay_image :[OpenCV Image]
</span><span style="color:#e6db74">        point: [(x, y)]
</span><span style="color:#e6db74">        Returns :[OpenCV Image]
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        overlay_height, overlay_width <span style="color:#f92672">=</span> cv_overlay_image<span style="color:#f92672">.</span>shape[:<span style="color:#ae81ff">2</span>]

        <span style="color:#75715e"># Convert OpenCV format image to PIL format (including α value)</span>
        <span style="color:#75715e"># background image</span>
        cv_rgb_bg_image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>cvtColor(cv_background_image, cv2<span style="color:#f92672">.</span>COLOR_BGR2RGB)
        pil_rgb_bg_image <span style="color:#f92672">=</span> Image<span style="color:#f92672">.</span>fromarray(cv_rgb_bg_image)
        pil_rgba_bg_image <span style="color:#f92672">=</span> pil_rgb_bg_image<span style="color:#f92672">.</span>convert(<span style="color:#e6db74">&#39;RGBA&#39;</span>)
        <span style="color:#75715e"># Overlay image</span>
        cv_rgb_ol_image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>cvtColor(cv_overlay_image, cv2<span style="color:#f92672">.</span>COLOR_BGRA2RGBA)
        pil_rgb_ol_image <span style="color:#f92672">=</span> Image<span style="color:#f92672">.</span>fromarray(cv_rgb_ol_image)
        pil_rgba_ol_image <span style="color:#f92672">=</span> pil_rgb_ol_image<span style="color:#f92672">.</span>convert(<span style="color:#e6db74">&#39;RGBA&#39;</span>)

        <span style="color:#75715e">#composite() requires images of the same size, so prepare a composite image</span>
        pil_rgba_bg_temp <span style="color:#f92672">=</span> Image<span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#39;RGBA&#39;</span>, pil_rgba_bg_image<span style="color:#f92672">.</span>size,
                                     (<span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">0</span>))
        <span style="color:#75715e"># Specify coordinates and overlay</span>
        pil_rgba_bg_temp<span style="color:#f92672">.</span>paste(pil_rgba_ol_image, point, pil_rgba_ol_image)
        result_image <span style="color:#f92672">=</span> \
            Image<span style="color:#f92672">.</span>alpha_composite(pil_rgba_bg_image, pil_rgba_bg_temp)

        <span style="color:#75715e"># Convert to OpenCV format image</span>
        cv_bgr_result_image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>cvtColor(
            np<span style="color:#f92672">.</span>asarray(result_image), cv2<span style="color:#f92672">.</span>COLOR_RGBA2BGRA)

        <span style="color:#66d9ef">return</span> cv_bgr_result_image
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">GetPosi</span>(posi_name):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    [summary]
</span><span style="color:#e6db74">      Get the coordinates of the specified face part
</span><span style="color:#e6db74">    Parameters
</span><span style="color:#e6db74">    ----------
</span><span style="color:#e6db74">    posi_name: [str]
</span><span style="color:#e6db74">    Returns: [left_X, right_X, Top_Y, Bottom_Y]
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>

    <span style="color:#66d9ef">for</span> face_landmarks <span style="color:#f92672">in</span> face_landmarks_list:

        minX <span style="color:#f92672">=</span> MAX_IMAGE_WIDTH
        maxX <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        minY <span style="color:#f92672">=</span> MAX_IMAGE_HEIGHT
        maxY <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(face_landmarks[posi_name])):

            <span style="color:#66d9ef">if</span> face_landmarks[posi_name][i][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">&lt;</span>minX:
                minX <span style="color:#f92672">=</span> face_landmarks[posi_name][i][<span style="color:#ae81ff">0</span>]

            <span style="color:#66d9ef">if</span> face_landmarks[posi_name][i][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">&gt;</span>maxX:
                maxX <span style="color:#f92672">=</span> face_landmarks[posi_name][i][<span style="color:#ae81ff">0</span>]

            <span style="color:#66d9ef">if</span> face_landmarks[posi_name][i][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">&lt;</span>minY:
                minY <span style="color:#f92672">=</span> face_landmarks[posi_name][i][<span style="color:#ae81ff">1</span>]<span style="color:#66d9ef">if</span> face_landmarks[posi_name][i][<span style="color:#ae81ff">1</span>] <span style="color:#f92672">&gt;</span>maxY:
                maxY <span style="color:#f92672">=</span> face_landmarks[posi_name][i][<span style="color:#ae81ff">1</span>]

    <span style="color:#66d9ef">return</span> [minX, maxX, minY, maxY]

</code></pre></div><h3 id="4-get-face-landmark">4. Get face landmark</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#File name definition</span>
F <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sample.jpg&#34;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Get face landmark from image</span>
image_fl <span style="color:#f92672">=</span> face_recognition<span style="color:#f92672">.</span>load_image_file(F)
face_landmarks_list <span style="color:#f92672">=</span> face_recognition<span style="color:#f92672">.</span>face_landmarks(image_fl)
</code></pre></div><h3 id="5-calculate-the-positions-of-eyebrows-beards-and-afro">5. Calculate the positions of eyebrows, beards, and afro</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Get the coordinates of each part</span>
eye_r <span style="color:#f92672">=</span> GetPosi(<span style="color:#e6db74">&#39;right_eye&#39;</span>)
eye_l <span style="color:#f92672">=</span> GetPosi(<span style="color:#e6db74">&#39;left_eye&#39;</span>)
mouse <span style="color:#f92672">=</span> GetPosi(<span style="color:#e6db74">&#39;top_lip&#39;</span>)
nose <span style="color:#f92672">=</span> GetPosi(<span style="color:#e6db74">&#39;nose_tip&#39;</span>)
chin <span style="color:#f92672">=</span> GetPosi(<span style="color:#e6db74">&#39;chin&#39;</span>)

<span style="color:#75715e"># Calculate eyebrow width and beard width from the acquired coordinates</span>
brow_h <span style="color:#f92672">=</span> int((eye_r[<span style="color:#ae81ff">3</span>]<span style="color:#f92672">-</span>eye_r[<span style="color:#ae81ff">2</span>]) <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>)
face_w <span style="color:#f92672">=</span> chin[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">-</span>chin[<span style="color:#ae81ff">0</span>]
beard_h <span style="color:#f92672">=</span> int((mouse[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>nose[<span style="color:#ae81ff">2</span>]) <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.7</span>)
beard_w <span style="color:#f92672">=</span> int((face_w<span style="color:#f92672">-</span>(mouse[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">-</span>mouse[<span style="color:#ae81ff">0</span>])) <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.2</span>)
beard_h2 <span style="color:#f92672">=</span> int((chin[<span style="color:#ae81ff">3</span>]<span style="color:#f92672">-</span>mouse[<span style="color:#ae81ff">2</span>]) <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.6</span>)
beard_h3 <span style="color:#f92672">=</span> int((chin[<span style="color:#ae81ff">3</span>]<span style="color:#f92672">-</span>mouse[<span style="color:#ae81ff">2</span>]) <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.3</span>)
scale <span style="color:#f92672">=</span> int(face_w <span style="color:#f92672">/</span> <span style="color:#ae81ff">20</span>)
scale2 <span style="color:#f92672">=</span> scale <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>

<span style="color:#75715e">#Calculate the location of afro image</span>
hair_w <span style="color:#f92672">=</span> int(face_w <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.83</span>)
hair_h <span style="color:#f92672">=</span> int(hair_w <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.64</span>)
hair_x <span style="color:#f92672">=</span> int(chin[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span>(hair_w<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span><span style="color:#f92672">-</span>face_w<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">+</span> scale <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.5</span>)
hair_y <span style="color:#f92672">=</span> eye_l[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>hair_h
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Coordinate calculation of eyebrows/beard</span>
eyeb_r <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(
    [
        [eye_r[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span>scale2, eye_r[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>brow_h],
        [eye_r[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> scale2, eye_r[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>brow_h<span style="color:#f92672">-</span>scale2],
        [eye_r[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> scale2, eye_r[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>scale <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>],
        [eye_r[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span>scale2, eye_r[<span style="color:#ae81ff">2</span>]]
    ]
)

eyeb_l <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(
    [
        [eye_l[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span>scale2, eye_l[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>brow_h<span style="color:#f92672">-</span>scale2],
        [eye_l[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> scale2, eye_l[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>brow_h],
        [eye_l[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> scale2, eye_l[<span style="color:#ae81ff">2</span>]],
        [eye_l[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span>scale2, eye_l[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>scale <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>]
    ]
)

beard_c <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(
    [
        [mouse[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span>scale, mouse[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>beard_h],
        [mouse[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> scale, mouse[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>beard_h],
        [mouse[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> scale, mouse[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>],
        [mouse[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span>scale, mouse[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span><span style="color:#ae81ff">0</span>]
    ]
)

beard_l <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(
    [
        [mouse[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span>beard_w, mouse[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>beard_h<span style="color:#f92672">-</span>scale],
        [mouse[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, mouse[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>beard_h],
        [mouse[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>, mouse[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">+</span> beard_h2],
        [mouse[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">-</span>beard_w, mouse[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">+</span> beard_h3]
    ]
)

beard_r <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(
    [
        [mouse[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>, mouse[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>beard_h],
        [mouse[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> beard_w, mouse[<span style="color:#ae81ff">2</span>]<span style="color:#f92672">-</span>beard_h<span style="color:#f92672">-</span>scale],
        [mouse[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> beard_w, mouse[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">+</span> beard_h3],
        [mouse[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">+</span> <span style="color:#ae81ff">5</span>, mouse[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">+</span> beard_h2]
    ]
)
</code></pre></div><h3 id="6-drawing-eyebrows-beards-and-afro">6. Drawing eyebrows, beards, and afro</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Read file with OpenCV</span>
image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(F)

<span style="color:#75715e"># Eyebrow, beard, drawing processing</span>
cv2<span style="color:#f92672">.</span>fillConvexPoly(image, points <span style="color:#f92672">=</span>eyeb_r, color<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>))
cv2<span style="color:#f92672">.</span>fillConvexPoly(image, points <span style="color:#f92672">=</span>eyeb_l, color<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>))
cv2<span style="color:#f92672">.</span>fillConvexPoly(image, points <span style="color:#f92672">=</span>beard_c, color<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>))
cv2<span style="color:#f92672">.</span>fillConvexPoly(image, points <span style="color:#f92672">=</span>beard_l, color<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>))
cv2<span style="color:#f92672">.</span>fillConvexPoly(image, points <span style="color:#f92672">=</span>beard_r, color<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>))
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Afro image overlay display</span>
cv_background_image <span style="color:#f92672">=</span> image
cv_overlay_image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(
    <span style="color:#e6db74">&#34;head.png&#34;</span>,
    cv2<span style="color:#f92672">.</span>IMREAD_UNCHANGED) Specify <span style="color:#75715e"># IMREAD_UNCHANGED and read with α included</span>

cv_overlay_image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>resize(cv_overlay_image, (hair_w, hair_h))
point <span style="color:#f92672">=</span> (hair_x, hair_y)

image <span style="color:#f92672">=</span> CvOverlayImage<span style="color:#f92672">.</span>overlay(cv_background_image, cv_overlay_image, point)

<span style="color:#75715e">#Image drawing</span>
cv2<span style="color:#f92672">.</span>imshow(<span style="color:#e6db74">&#34;image&#34;</span>, image)
cv2<span style="color:#f92672">.</span>waitKey(<span style="color:#ae81ff">0</span>)
cv2<span style="color:#f92672">.</span>destroyAllWindows()
</code></pre></div><h1 id="bonus">bonus</h1>
<p>The afro image used. The background is transparent. Set it as head.png and in the working folder.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/94957f79-2fbd-fe17-cf29-2856011ffd79.png" alt="head.png"></p>
<h1 id="at-the-end">At the end</h1>
<p>At this time, only the front image is supported. Face Recognition can get the coordinates with a nice feeling, so I could make it with a little processing. Some of the output were personally interesting, but I gave up because of the balance of portrait rights. I hope you will enjoy playing with various images.</p>
<h1 id="reference-site">Reference site</h1>
<p><a href="https://qiita.com/Kazuhito/items/ff4d24cd012e40653d0c">**[OpenCV][Python] Drawing an image with transparency on the image**</a></p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
