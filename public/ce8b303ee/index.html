<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Python] Automate sushi hits with Python | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] Automate sushi hits with Python</h1>
<p>
  <small class="text-secondary">
  
  
  Jun 4, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/sushi"> sushi</a></code></small>

</p>
<pre><code>* I am the first to use qiita. Please understand that there are some points that we cannot reach.
</code></pre>
<p>The code is also weird and dirty, but I will fix it when I feel like it ()</p>
<p>Hello.
Suddenly everyone
Sushi hits
Are you doing?
If you&rsquo;ve ever typed, you&rsquo;ve probably played this game.
Sushi Uchi is a browser game.
So, I thought it would be easy to automate by getting HTML with Python, so I decided to make it.</p>
<p>I was trying to get the html but
Actually, Sushi Uchi uses a technology called OpenGL,
It seems that the characters are displayed as an image.
Therefore, it is a policy change.
Let&rsquo;s recognize images.</p>
<p>First, press the start button and recommended button.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pyautogui
<span style="color:#f92672">import</span> time
x,y<span style="color:#f92672">=</span>pyautogui<span style="color:#f92672">.</span>locateCenterOnScreen(<span style="color:#e6db74">&#34;susida.png&#34;</span>)
<span style="color:#66d9ef">print</span>(x)
<span style="color:#66d9ef">print</span>(y)
pyautogui<span style="color:#f92672">.</span>click(x, y<span style="color:#f92672">+</span><span style="color:#ae81ff">100</span>)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;You pressed the start button.&#34;</span>)
time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
pyautogui<span style="color:#f92672">.</span>click(x, y<span style="color:#f92672">+</span><span style="color:#ae81ff">100</span>)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;I pushed the recommendation.&#34;</span>)
time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
pyautogui<span style="color:#f92672">.</span>typewrite(<span style="color:#e6db74">&#34; &#34;</span>)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Start.&#34;</span>)
time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">2</span>)
</code></pre></div><p>If you specify it in absolute coordinates, it will change depending on the window size etc.
I decided to use relative coordinates from susida.png.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/649478/60bfa360-dbf3-af9a-5218-8184841cc61c.png" alt="susida.png"> ←susida.png
Then click the coordinates with pyautogui.
The installation of pyautogui is</p>
<pre><code>pip install pyautogui
</code></pre><p>is.</p>
<p>Next is the image recognition part.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pyocr
<span style="color:#f92672">import</span> pyocr.builders
<span style="color:#f92672">from</span> PIL <span style="color:#f92672">import</span> Image
<span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> cv2

i<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
result<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
tools<span style="color:#f92672">=</span>pyocr<span style="color:#f92672">.</span>get_available_tools()

<span style="color:#66d9ef">if</span> len(tools) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;OCR tool was not found.&#34;</span>)
    sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)

tool<span style="color:#f92672">=</span>tools[<span style="color:#ae81ff">0</span>]

<span style="color:#66d9ef">while</span>(i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">201</span>):
    sc<span style="color:#f92672">=</span>pyautogui<span style="color:#f92672">.</span>screenshot(region<span style="color:#f92672">=</span>(x<span style="color:#f92672">-</span><span style="color:#ae81ff">110</span>, y<span style="color:#f92672">+</span><span style="color:#ae81ff">85</span>, <span style="color:#ae81ff">210</span>, <span style="color:#ae81ff">25</span>))

    sc<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#34;original.png&#34;</span>)

    original<span style="color:#f92672">=</span>cv2<span style="color:#f92672">.</span>imread(<span style="color:#e6db74">&#34;original.png&#34;</span>,<span style="color:#ae81ff">0</span>)
    threshold<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>

    ret, img_thresh <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>threshold(original, threshold, <span style="color:#ae81ff">255</span>, cv2<span style="color:#f92672">.</span>THRESH_BINARY)
    cv2<span style="color:#f92672">.</span>imwrite(<span style="color:#e6db74">&#34;gray.png&#34;</span>, img_thresh)

    hanten <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(<span style="color:#e6db74">&#34;gray.png&#34;</span>)
    hanten2<span style="color:#f92672">=</span>cv2<span style="color:#f92672">.</span>bitwise_not(hanten)
    cv2<span style="color:#f92672">.</span>imwrite(<span style="color:#e6db74">&#34;sushida_sc.png&#34;</span>, hanten2)


    img_org<span style="color:#f92672">=</span>Image<span style="color:#f92672">.</span>open(<span style="color:#e6db74">&#34;sushida_sc.png&#34;</span>)

    builder <span style="color:#f92672">=</span> pyocr<span style="color:#f92672">.</span>builders<span style="color:#f92672">.</span>TextBuilder()
    tmp<span style="color:#f92672">=</span>result
    result<span style="color:#f92672">=</span>tool<span style="color:#f92672">.</span>image_to_string(img_org, lang<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;eng&#34;</span>, builder<span style="color:#f92672">=</span>builder)
    <span style="color:#66d9ef">if</span>(tmp <span style="color:#f92672">!=</span> result):
        <span style="color:#66d9ef">print</span>(i,<span style="color:#e6db74">&#34;Plate:&#34;</span>,result)
        pyautogui<span style="color:#f92672">.</span>typewrite(result)
    i<span style="color:#f92672">=</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>
    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">0.3</span>)
</code></pre></div><p>Pyocr is used for image recognition.
Please see here for the introduction method ↓
<a href="https://gammasoft.jp/blog/ocr-by-python/">https://gammasoft.jp/blog/ocr-by-python/</a>
First, squeeze the Roman letters normally.
However, this causes the background to be transparent and recognition accuracy to be low.
So, binarize it.
Then, invert it to make the letters black.
If you type in the recognized one with pyautogui, the automation of sushi is completed.
The reason for stopping at 200 is that if you eat too much sushi, you will get an error.
The full text is included below.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pyautogui
<span style="color:#f92672">import</span> time
<span style="color:#f92672">import</span> pyocr
<span style="color:#f92672">import</span> pyocr.builders
<span style="color:#f92672">from</span> PIL <span style="color:#f92672">import</span> Image
<span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> cv2

i<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
result<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
tools<span style="color:#f92672">=</span>pyocr<span style="color:#f92672">.</span>get_available_tools()

<span style="color:#66d9ef">if</span> len(tools) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;OCR tool was not found.&#34;</span>)
    sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)

tool<span style="color:#f92672">=</span>tools[<span style="color:#ae81ff">0</span>]

x,y<span style="color:#f92672">=</span>pyautogui<span style="color:#f92672">.</span>locateCenterOnScreen(<span style="color:#e6db74">&#34;susida.png&#34;</span>)
<span style="color:#66d9ef">print</span>(x)
<span style="color:#66d9ef">print</span>(y)
pyautogui<span style="color:#f92672">.</span>click(x, y<span style="color:#f92672">+</span><span style="color:#ae81ff">100</span>)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;You pressed the start button.&#34;</span>)
time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
pyautogui<span style="color:#f92672">.</span>click(x, y<span style="color:#f92672">+</span><span style="color:#ae81ff">100</span>)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;I pushed the recommendation.&#34;</span>)
time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
pyautogui<span style="color:#f92672">.</span>typewrite(<span style="color:#e6db74">&#34; &#34;</span>)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Start.&#34;</span>)
time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">2</span>)
<span style="color:#66d9ef">while</span>(i<span style="color:#f92672">&lt;</span><span style="color:#ae81ff">201</span>):
    sc<span style="color:#f92672">=</span>pyautogui<span style="color:#f92672">.</span>screenshot(region<span style="color:#f92672">=</span>(x<span style="color:#f92672">-</span><span style="color:#ae81ff">110</span>, y<span style="color:#f92672">+</span><span style="color:#ae81ff">85</span>, <span style="color:#ae81ff">210</span>, <span style="color:#ae81ff">25</span>))

    sc<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#34;original.png&#34;</span>)

    original<span style="color:#f92672">=</span>cv2<span style="color:#f92672">.</span>imread(<span style="color:#e6db74">&#34;original.png&#34;</span>,<span style="color:#ae81ff">0</span>)
    threshold<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>

    ret, img_thresh <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>threshold(original, threshold, <span style="color:#ae81ff">255</span>, cv2<span style="color:#f92672">.</span>THRESH_BINARY)
    cv2<span style="color:#f92672">.</span>imwrite(<span style="color:#e6db74">&#34;gray.png&#34;</span>, img_thresh)

    hanten <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(<span style="color:#e6db74">&#34;gray.png&#34;</span>)
    hanten2<span style="color:#f92672">=</span>cv2<span style="color:#f92672">.</span>bitwise_not(hanten)
    cv2<span style="color:#f92672">.</span>imwrite(<span style="color:#e6db74">&#34;sushida_sc.png&#34;</span>, hanten2)


    img_org<span style="color:#f92672">=</span>Image<span style="color:#f92672">.</span>open(<span style="color:#e6db74">&#34;sushida_sc.png&#34;</span>)

    builder <span style="color:#f92672">=</span> pyocr<span style="color:#f92672">.</span>builders<span style="color:#f92672">.</span>TextBuilder()
    tmp<span style="color:#f92672">=</span>result
    result<span style="color:#f92672">=</span>tool<span style="color:#f92672">.</span>image_to_string(img_org, lang<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;eng&#34;</span>, builder<span style="color:#f92672">=</span>builder)
    <span style="color:#66d9ef">if</span>(tmp <span style="color:#f92672">!=</span> result):
        <span style="color:#66d9ef">print</span>(i,<span style="color:#e6db74">&#34;Plate:&#34;</span>,result)
        pyautogui<span style="color:#f92672">.</span>typewrite(result)
    i<span style="color:#f92672">=</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>
    time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">0.3</span>)

</code></pre></div><p>YouTube: <a href="https://www.youtube.com/watch?v=kZ0MKTQXgj0">https://www.youtube.com/watch?v=kZ0MKTQXgj0</a></p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
