<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Python] [Abnormality detection] Try the latest method of deep distance learning | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] [Abnormality detection] Try the latest method of deep distance learning</h1>
<p>
  <small class="text-secondary">
  
  
  Jan 7, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/machinelearning"> MachineLearning</a></code></small>


<small><code><a href="https://memotut.com/tags/deeplearning"> DeepLearning</a></code></small>


<small><code><a href="https://memotut.com/tags/keras"> Keras</a></code></small>


<small><code><a href="https://memotut.com/tags/anomaly-detection"> Anomaly detection</a></code></small>

</p>
<pre><code>Previously, using **deep distance learning** [&quot;image anomaly detection&quot;](https://qiita.com/shinmura0/items/06d81c72601c7578c6d3#%E3%83%99%E3%83%B3%E3%83%81%E3%83%9E%E3%83%BC%E3%82%AF).
</code></pre>
<p>After that, <strong>The latest method of deep distance learning</strong> &ldquo;AdaCos&rdquo; appeared.</p>
<p>In this article, I would like to apply AdaCos to &ldquo;anomaly detection&rdquo; and do a simple benchmark.
The entire code is <a href="https://github.com/shinmura0/DeepAnomalyDetection_benchmark/blob/master/AdaCos_benchmark.ipynb">here</a></p>
<p>*This is the presentation material of <a href="https://pythondata.connpass.com/event/159662/">Python Data Analysis Study Group #15</a>.</p>
<p>#From the conclusion
By applying AdaCos to anomaly detection, we found the following:</p>
<ul>
<li>Same accuracy as ArcFace</li>
<li>Thank you for not tuning parameters</li>
</ul>
<p>#AdaCos
AdaCos is said to be the latest method of deep distance learning, but as of January 2020, more than half a year has passed since the paper was published.
Has passed. However, as far as I know, in the framework of &ldquo;pure deep distance learning&rdquo;, it is still
I think it&rsquo;s SOTA.</p>
<p>AdaCos is a method mainly based on ArcFace, etc., and parameters used in ArcFace etc.
This is an automatic method. Since the accuracy of ArcFace changes dramatically depending on the selection of parameters,
The tuning of the parameters was very severe. However, with the introduction of AdaCos
Thanks to the parameters you can set, you are free from this tuning task.</p>
<p>In addition, it has been confirmed that the accuracy is improved, and since work efficiency and accuracy are improved, it is extremely
This is a highly useful method. For details, please refer to the following articles.</p>
<p><a href="https://qiita.com/ninhydrin/items/797a308c864e9238c71e">Read AdaCos: Adaptively Scaling Cosine Logits for Effectively Learning Deep Face Representations</a></p>
<h2 id="constraint">Constraint</h2>
<p>There are two types of AdaCos: Fixed and Dynamic.
The method used in this paper is &ldquo;Fixed Ada Cos&rdquo;.</p>
<p>Also, AdaCos can be applied only when the number of classes is 3 or more.
This becomes a bottleneck when applying <a href="https://qiita.com/daisukelab/items/e0ff429bd58b2befbb1b">Self-supervised learning</a>, but the consideration there is
<a href="https://qiita.com/shinmura0/items/54585fccbb20cb2879fd">Next article</a>. The number of classes in this experiment is 9, so there is no problem here.</p>
<p>#Experiment
<a href="https://qiita.com/shinmura0/items/06d81c72601c7578c6d3#%E3%83%99%E3%83%B3%E3%83%81%E3%83%9E%E3%83Performtheexperimentunderthesameconditionsas%BC%E3%82%AF">Previous experiment</a>.</p>
<p>The AdaCos code itself is similar to that of ArceFace.
However, the method of giving parameters is changed to AdaCos style.</p>
<p>The entire code is <a href="https://github.com/shinmura0/DeepAnomalyDetection_benchmark/blob/master/AdaCos_benchmark.ipynb">here</a></p>
<p>##conditions</p>
<ul>
<li>AdaCos epoch is 10, optimization method is Adam</li>
<li>Batch size is 128</li>
<li>Base model is MobileNet V2 (using trained model, ie transfer learning)</li>
<li>10 trials to calculate AUC</li>
<li>Data uses Fashion-MNIST and cifar-10</li>
</ul>
<p><Fashion-MNIST>
The breakdown of the data is as follows.
Normal is &ldquo;sneakers&rdquo;, abnormal is &ldquo;boots&rdquo;.</p>
<table>
<thead>
<tr>
<th></th>
<th>Number</th>
<th>Class number</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td>Reference data for learning</td>
<td>8000</td>
<td>8</td>
<td>Excluding sneakers and boots</td>
</tr>
<tr>
<td>Normal data for learning</td>
<td>1000</td>
<td>1</td>
<td>Sneakers</td>
</tr>
<tr>
<td>Test data (normal)</td>
<td>1000</td>
<td>1</td>
<td>Sneakers</td>
</tr>
<tr>
<td>Test data (abnormal)</td>
<td>1000</td>
<td>1</td>
<td>Boots</td>
</tr>
</tbody>
</table>
<p>*The reference data for learning is the data to compare with the normal data for learning.</p>
<p><cifar-10>
The breakdown of the data is as follows.
Normal is &ldquo;deer&rdquo;, abnormal is &ldquo;horse&rdquo;.</p>
<table>
<thead>
<tr>
<th></th>
<th>Number</th>
<th>Class number</th>
<th>Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td>Learning reference data</td>
<td>8000</td>
<td>8</td>
<td>Excluding deer and horses</td>
</tr>
<tr>
<td>Normal data for learning</td>
<td>1000</td>
<td>1</td>
<td>Deer</td>
</tr>
<tr>
<td>Test Data (Normal)</td>
<td>1000</td>
<td>1</td>
<td>Deer</td>
</tr>
<tr>
<td>Test data (abnormal)</td>
<td>1000</td>
<td>1</td>
<td>horse</td>
</tr>
</tbody>
</table>
<p>##Fashion-MNIST result
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/264781/aaba2401-885e-6b7f-c22b-e6a262a90980.png" alt="image.png"></p>
<p>&ldquo;L2-Softmax Loss&rdquo; and &ldquo;Arc Face&rdquo; have published the results of previous experiments.
The result of &ldquo;AdaCos&rdquo; is the result of this experiment.</p>
<p>The median value of &ldquo;AdaCos&rdquo; has almost the same AUC as ArcFace. **</p>
<p>After all, I&rsquo;m glad that parameter tuning is not required.</p>
<p>##CIFAR-10 result
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/264781/9b310bd6-65a9-24da-621b-c4a958eeaf29.png" alt="image.png">
&ldquo;L2-Softmax Loss&rdquo; and &ldquo;Arc Face&rdquo; have published the results of previous experiments.
The result of &ldquo;AdaCos&rdquo; is the result of this experiment.</p>
<p>Similar to Fashin-MNIST, the median value of &ldquo;AdaCos&rdquo; is almost the same AUC as ArcFace.</p>
<p>#Summary</p>
<ul>
<li>When AdaCos is applied to anomaly detection, the accuracy is equivalent to ArcFace **</li>
<li>Moreover, &ldquo;tuning of parameters is unnecessary&rdquo; is appreciated.</li>
<li>In the first place, in the performance evaluation of anomaly detection, <strong>a situation with very few anomalous data can be considered</strong>, and under such a situation, a situation where <strong>data for parameter tuning must be generated can be avoided</strong> And, it seems to be a very useful method.</li>
</ul>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
