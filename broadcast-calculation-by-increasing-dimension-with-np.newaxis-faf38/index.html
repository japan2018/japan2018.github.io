<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>Broadcast calculation by increasing dimension with np.newaxis | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Broadcast calculation by increasing dimension with np.newaxis</h1>
<p>
  <small class="text-secondary">
  
  
  Feb 4, 2020
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/numpy">numpy</a></code></small>

</p>
<pre><code>This is an article where I wrote down my own understanding from the question that the image of the three-dimensional np.array is grabbed and what is np.newaxis. [Here](https://qiita.com/yoshi_san/items/4cbe3abb7d46c5252fdd) for the first half article that wrote the basics of np.array image and np.newaxis.
</code></pre>
<p>In this article, I will explain how to use np.newaxis. Specifically, when the two-dimensional array in which two or more two-dimensional vectors are lined up is first mentioned in the first half of the article, the calculation of the square of the distance between the vectors included in both is performed by brute force. to watch.</p>
<h2 id="step-3-broadcast">STEP 3. Broadcast</h2>
<p>Before we get into the main subject, let&rsquo;s review the broadcast. It&rsquo;s a guy who can perform operations on arrays with different shapes.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>]) <span style="color:#75715e"># vector of horizontal 2 vertical 1</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> A <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>],
                  [<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>],
                  [<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>]]) <span style="color:#75715e"># matrix of horizontal 2 vertical 3</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> B <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([[<span style="color:#ae81ff">1</span>],
                  [<span style="color:#ae81ff">2</span>]]) <span style="color:#75715e"># matrix of horizontal 1 vertical 2</span>
<span style="color:#f92672">&gt;&gt;&gt;</span> C <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([[[<span style="color:#ae81ff">1</span>],
                   [<span style="color:#ae81ff">2</span>]],

                  [[<span style="color:#ae81ff">3</span>],
                   [<span style="color:#ae81ff">4</span>]]]) <span style="color:#75715e"># Horizontal 1 vertical 2 depth 2 3D array</span>

<span style="color:#f92672">&gt;&gt;&gt;</span> x <span style="color:#f92672">+</span> A <span style="color:#75715e"># It becomes a matrix of horizontal 2 vertical 3</span>
array([[<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>],
       [<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">6</span>],
       [<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">8</span>]])
<span style="color:#f92672">&gt;&gt;&gt;</span> x <span style="color:#f92672">+</span> B <span style="color:#75715e"># matrix of horizontal 2 vertical 2</span>
array([[<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>],
       [<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>]])
<span style="color:#f92672">&gt;&gt;&gt;</span> x <span style="color:#f92672">+</span> C <span style="color:#75715e"># It becomes a three-dimensional array of horizontal 2 vertical 2 deep 2.</span>
array([[[<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>],
        [<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>]],

       [[<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>],
        [<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>]]])
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/476884/564591a7-af0b-9f38-f1ab-4f7ccb903faa.jpeg" alt="qiita_broadcast.jpg"></p>
<h2 id="step-4-increase-dimension-and-broadcast-calculation">STEP 4. Increase dimension and broadcast calculation</h2>
<p>Back to the main subject, what&rsquo;s nice about np.newaxis? Is a story.</p>
<h3 id="for-one-dimensional-array">For one-dimensional array</h3>
<p>Considering a one-dimensional array as a starting point, is it that np.newaxis can be used to &ldquo;store the brute force calculation result of each element of two arrays in a new axis&rdquo;?</p>
<p>For example, if you have $x=[1, 3, 5, 7]$ and $y=[2, 4, 6]$ and want to make a brute force calculation of $4\times3=12$ ways, use np.newaxis with $y If you convert $ into a matrix of vertical 3 by 1 and calculate $x$, you can get the matrix of vertical 3 by 4 by broadcasting.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">7</span>])
<span style="color:#f92672">&gt;&gt;&gt;</span> y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">6</span>])
<span style="color:#f92672">&gt;&gt;&gt;</span> x[np<span style="color:#f92672">.</span>newaxis, :] <span style="color:#f92672">+</span> y[:, np<span style="color:#f92672">.</span>newaxis] <span style="color:#75715e"># Add the elements of x and y by brute force</span>
array([[ <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">9</span>],
       [<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">11</span>],
       [<span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">13</span>]])
<span style="color:#75715e"># x + y[:, np.newaxis] is the same</span>
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/476884/3bf7b893-97fb-93af-0347-f5c29a57a292.jpeg" alt="qiita_newaxis1.jpg"></p>
<h3 id="for-a-two-dimensional-array">For a two-dimensional array</h3>
<p>So what happens in 2D?
Suppose there are two arrays in which horizontal vectors of the same dimension (two dimensions here) are arranged vertically as shown below.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> A <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>],
                  [<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>],
                  [<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>]])
<span style="color:#f92672">&gt;&gt;&gt;</span> B <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>],
                  [twenty two]])
</code></pre></div><p>At this time, if np.newaxis is introduced properly, brute force calculation can be performed for each component of the vector. Image of performing brute force calculation on a one-dimensional array multiple times at the same time ($x$ component and $y$ component in the above).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> A[np<span style="color:#f92672">.</span>newaxis, :, :]<span style="color:#f92672">-</span>B[:, np<span style="color:#f92672">.</span>newaxis, :] <span style="color:#75715e"># brute force subtraction of x and y components</span>
array([[[ <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>],
        [ twenty three],
        [<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>]],

      [[[<span style="color:#f92672">-</span>Ten],
        [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>],
        [<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>]]])
<span style="color:#75715e"># A-B[:, np.newaxis, :]</span>
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/476884/528bd4f1-6448-a651-262c-b95d877e563a.jpeg" alt="qiita_newaxis2.jpg"></p>
<p>If you arrange them so that they will be broadcast properly, you can get the same value even if you change the way of taking newaxis.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> A<span style="color:#f92672">.</span>T[np<span style="color:#f92672">.</span>newaxis, :, :]<span style="color:#f92672">-</span>B[:, :, np<span style="color:#f92672">.</span>newaxis] <span style="color:#75715e"># brute force subtraction of x and y components</span>
array([[[ <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>],
        [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>]],

      [[[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>],
        [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>]]])
<span style="color:#75715e"># A.T-same for B[:, :, np.newaxis]</span>
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/476884/bcdb7c5b-8662-d863-d1b7-6af3cf896eae.jpeg" alt="qiita_newaxis2_2.jpg"></p>
<h3 id="main-subject">Main subject</h3>
<p>If there is a pair of two-dimensional vectors $A$ and $B$ above, find (distance between vectors) $^2$ by brute force.
The square of the distance between $(a_x, a_y)$ and $(b_x, b_y)$ is $(a_x-b_x)^2+(a_y-b_y)^2$, so first the $x$ components and then the $y$ component You just need to square the subtraction of each other to the brute force, which is just the square of the calculation you did above. Then add the square of the difference between the $x$ component and the square of the difference between the $y$ components = sum on the third axis that is not added to $A$ or $B$ as a new axis. (It is easier to understand if you imagine it with a picture).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> ((A<span style="color:#f92672">.</span>T[np<span style="color:#f92672">.</span>newaxis, :, :]<span style="color:#f92672">-</span>B[:, :, np<span style="color:#f92672">.</span>newaxis])<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">.</span>sum(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
array([[ <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">41</span>],
       [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">25</span>]])
<span style="color:#75715e"># ((A.T-B[:, :, np.newaxis])**2).sum(axis=1)</span>
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/476884/8b5b8d66-bb6c-5296-a0c4-b671db667ae7.jpeg" alt="q_newax2_sum.jpg"></p>
<p>This is equivalent to the formula extracted from &ldquo;Essence of Machine Learning&rdquo; at the very beginning of <a href="https://qiita.com/yoshi_san/items/4cbe3abb7d46c5252fdd">Last time</a>.
Also, as we saw above, the newaxis locations you add to $A$ and $B$ are not unique, and you can get the same result with</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">&gt;&gt;&gt;</span> ((A[np<span style="color:#f92672">.</span>newaxis, :, :]<span style="color:#f92672">-</span>B[:, np<span style="color:#f92672">.</span>newaxis, :])<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">.</span>sum(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
array([[ <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">41</span>],
       [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">25</span>]])
<span style="color:#75715e"># ((A-B[:, np.newaxis, :])**2).sum(axis=2) is OK</span>

<span style="color:#f92672">&gt;&gt;&gt;</span> ((A<span style="color:#f92672">.</span>T[:, np<span style="color:#f92672">.</span>newaxis, :]<span style="color:#f92672">-</span>B<span style="color:#f92672">.</span>T[:, :, np<span style="color:#f92672">.</span>newaxis])<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">.</span>sum(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
array([[ <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">13</span>, <span style="color:#ae81ff">41</span>],
       [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">25</span>]])
</code></pre></div><p>To find the vector-to-vector distance, take the square root of it.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
