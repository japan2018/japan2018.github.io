<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>Regression analysis in Python | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Regression analysis in Python</h1>
<p>
  <small class="text-secondary">
  
  
  Apr 6, 2020
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/statistics"> statistics</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/least-squares"> least squares</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/regression"> regression</a></code></small>

</p>
<pre><code>Hello, this is Motty.
</code></pre>
<p>This time, I wrote about regression analysis using Python.</p>
<p>#Regression</p>
<p>Regression analysis is a method of predicting target data using the data at hand. At that time, the structure of quantitative relationships is applied to the data (regression model). If the regression model is a straight line, it is called a regression line, and if an n-order function is applied by polynomial regression, it is called a regression curve.</p>
<h1 id="how-to-determine-the-model">How to determine the model</h1>
<p>The least squares method is used to evaluate the fitted model. A method of selecting a coefficient that minimizes the sum of squares of residuals when approximating the data obtained by measurement with a function such as a straight line.</p>
<p>#Evaluation method
Use the coefficient of determination. The higher this number, the better the fit of the regression model to the actual data.
If the observed value = y and the estimated value by the function is f, it is expressed by the following formula.
![ 2020-04-06 11.20.44.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/302420/54f01be7-baad-82e4-eec2-593fdd168d4a.(png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/302420/54f01be7-baad-82e4-eec2-593fdd168d4a.(png)</a></p>
<p>If the model fits the data perfectly, the coefficient of determination has a value of 1.</p>
<p>#Regression</p>
<p>Data with noise added to each of the linear, quadratic and cubic functions
I applied a regression line.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-LinearRegression.py" data-lang="LinearRegression.py"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">%</span>matplotlib inline

<span style="color:#75715e">#sklearn</span>
<span style="color:#f92672">from</span> sklearn.linear_model <span style="color:#f92672">import</span> LinearRegression <span style="color:#66d9ef">as</span> reg
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> r2_score

<span style="color:#75715e">#Data related</span>
CI <span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;black&#34;</span>,<span style="color:#e6db74">&#34;red&#34;</span>,<span style="color:#e6db74">&#34;blue&#34;</span>,<span style="color:#e6db74">&#34;yellow&#34;</span>,<span style="color:#e6db74">&#34;green&#34;</span>,<span style="color:#e6db74">&#34;orange&#34;</span>,<span style="color:#e6db74">&#34;purple&#34;</span>,<span style="color:#e6db74">&#34;skyblue&#34;</span>]<span style="color:#75715e">#ColorIndex</span>

N <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span> <span style="color:#75715e"># number of samples</span>
x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">10</span>,N)
y1 <span style="color:#f92672">=</span> x <span style="color:#f92672">*</span><span style="color:#ae81ff">5</span> <span style="color:#f92672">+</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randn(N)<span style="color:#f92672">*</span><span style="color:#ae81ff">5</span>
y2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>(x<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">*</span>(x<span style="color:#f92672">-</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">+</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randn(N)<span style="color:#f92672">*</span><span style="color:#ae81ff">5</span>
y3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>(x<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>(x<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>)<span style="color:#f92672">*</span>(x<span style="color:#f92672">-</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">+</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randn(N)<span style="color:#f92672">*</span><span style="color:#ae81ff">10</span>

x <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span>reshape([<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>])
y1 <span style="color:#f92672">=</span> y1<span style="color:#f92672">.</span>reshape([<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>])
y2 <span style="color:#f92672">=</span> y2<span style="color:#f92672">.</span>reshape([<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>])
y3 <span style="color:#f92672">=</span> y3<span style="color:#f92672">.</span>reshape([<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>])

<span style="color:#75715e">#Learning</span>
clf1, clf2, clf3 <span style="color:#f92672">=</span> reg(),reg(),reg()
clf1<span style="color:#f92672">.</span>fit(x,y1),clf2<span style="color:#f92672">.</span>fit(x,y2),clf3<span style="color:#f92672">.</span>fit(x,y3)

Predicted value <span style="color:#66d9ef">for</span> <span style="color:#75715e">#x data</span>
y1_pred,y2_pred,y3_pred <span style="color:#f92672">=</span> clf1<span style="color:#f92672">.</span>predict(x),clf2<span style="color:#f92672">.</span>predict(x),clf3<span style="color:#f92672">.</span>predict(x)

<span style="color:#75715e">#drawing</span>
fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize <span style="color:#f92672">=</span> (<span style="color:#ae81ff">15</span>,<span style="color:#ae81ff">15</span>))
ax1,ax2,ax3 <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">1</span>), fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">2</span>), fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>)
<span style="color:#75715e">#Data</span>
ax1<span style="color:#f92672">.</span>scatter(x,y1,c <span style="color:#f92672">=</span> CI[<span style="color:#ae81ff">1</span>],label <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;R^2 = {}&#34;</span><span style="color:#f92672">.</span>format(r2_score(y1,y1_pred)))
ax2<span style="color:#f92672">.</span>scatter(x,y2,c <span style="color:#f92672">=</span> CI[<span style="color:#ae81ff">2</span>],label <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;R^2 = {}&#34;</span><span style="color:#f92672">.</span>format(r2_score(y2,y2_pred)))
ax3<span style="color:#f92672">.</span>scatter(x,y3,c <span style="color:#f92672">=</span> CI[<span style="color:#ae81ff">3</span>],label <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;R^2 = {}&#34;</span><span style="color:#f92672">.</span>format(r2_score(y3,y3_pred)))
ax1<span style="color:#f92672">.</span>legend(),ax2<span style="color:#f92672">.</span>legend(),ax3<span style="color:#f92672">.</span>legend()
<span style="color:#75715e"># Regression line</span>
ax1<span style="color:#f92672">.</span>plot(x,clf1<span style="color:#f92672">.</span>predict(x), c <span style="color:#f92672">=</span> CI[<span style="color:#ae81ff">0</span>])
ax2<span style="color:#f92672">.</span>plot(x,clf2<span style="color:#f92672">.</span>predict(x), c <span style="color:#f92672">=</span> CI[<span style="color:#ae81ff">0</span>])
ax3<span style="color:#f92672">.</span>plot(x,clf3<span style="color:#f92672">.</span>predict(x), c <span style="color:#f92672">=</span> CI[<span style="color:#ae81ff">0</span>])

fig<span style="color:#f92672">.</span>suptitle(<span style="color:#e6db74">&#34;RinearLegression&#34;</span>, fontsize <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>)
ax1<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#34;1&#34;</span>)
ax2<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#34;2&#34;</span>)
ax3<span style="color:#f92672">.</span>set_title(<span style="color:#e6db74">&#34;3&#34;</span>)
</code></pre></div><p>Not surprisingly, the straight line fit was the best result for a linear function.</p>
<p>![ 2020-04-06 13.24.26.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/302420/ee40ee70-c250-9e79-e22f-b8a5295eb8a4.(png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/302420/ee40ee70-c250-9e79-e22f-b8a5295eb8a4.(png)</a></p>
<h3 id="polynomial-regression">Polynomial regression</h3>
<p>It may be appropriate to fit a regression curve, such as a multi-dimensional function, to a dataset such as 2 or 3.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-polynomial.py" data-lang="polynomial.py">
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">%</span>matplotlib inline
<span style="color:#f92672">from</span> sklearn.linear_model <span style="color:#f92672">import</span> LinearRegression <span style="color:#66d9ef">as</span> reg
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> r2_score
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> PolynomialFeatures <span style="color:#66d9ef">as</span> PF


<span style="color:#75715e">#Data related</span>
CI <span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;black&#34;</span>,<span style="color:#e6db74">&#34;red&#34;</span>,<span style="color:#e6db74">&#34;blue&#34;</span>,<span style="color:#e6db74">&#34;yellow&#34;</span>,<span style="color:#e6db74">&#34;green&#34;</span>,<span style="color:#e6db74">&#34;orange&#34;</span>,<span style="color:#e6db74">&#34;purple&#34;</span>,<span style="color:#e6db74">&#34;skyblue&#34;</span>]<span style="color:#75715e">#ColorIndex</span>
N <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span> <span style="color:#75715e"># number of samples</span>
x <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">10</span>,N)
y3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>(x<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>(x<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>)<span style="color:#f92672">*</span>(x<span style="color:#f92672">-</span><span style="color:#ae81ff">7</span>) <span style="color:#f92672">+</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randn(N)<span style="color:#f92672">*</span><span style="color:#ae81ff">10</span>
x <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span>reshape([<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>])
y3 <span style="color:#f92672">=</span> y3<span style="color:#f92672">.</span>reshape([<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>])


<span style="color:#75715e">#Learning</span>
clf <span style="color:#f92672">=</span> reg()
clf<span style="color:#f92672">.</span>fit(x,y3)
<span style="color:#75715e">#Order</span>
DegreeSet <span style="color:#f92672">=</span>[<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>]
<span style="color:#66d9ef">for</span> dg <span style="color:#f92672">in</span> DegreeSet:
    
    pf <span style="color:#f92672">=</span> PF(degree <span style="color:#f92672">=</span> dg, include_bias <span style="color:#f92672">=</span> False)
    x_poly <span style="color:#f92672">=</span> pf<span style="color:#f92672">.</span>fit_transform(x)
    poly_reg <span style="color:#f92672">=</span> reg()
    poly_reg<span style="color:#f92672">.</span>fit(x_poly,y3)
    polypred <span style="color:#f92672">=</span> poly_reg<span style="color:#f92672">.</span>predict(x_poly)

    Predicted value <span style="color:#66d9ef">for</span> <span style="color:#75715e">#x data</span>
    pred <span style="color:#f92672">=</span> clf<span style="color:#f92672">.</span>predict(x)
    <span style="color:#75715e">#drawing</span>
    plt<span style="color:#f92672">.</span>scatter(x,y3,c <span style="color:#f92672">=</span> CI[dg], label <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;R^2={}&#34;</span><span style="color:#f92672">.</span>format(r2_score(y3,polypred)))
    plt<span style="color:#f92672">.</span>plot(x, polypred,c <span style="color:#f92672">=</span> CI[<span style="color:#ae81ff">0</span>])
    plt<span style="color:#f92672">.</span>legend()
    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#34;Regression&#34;</span>)
    plt<span style="color:#f92672">.</span>show()
</code></pre></div><p>As a result, the model fits well and the coefficient of determination is high as the order is increased to 1, 2, and 3.</p>
<p>![ 2020-04-06 15.06.49.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/302420/2b7f444f-94bc-0fa3-5632-cbf39a164102.(png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/302420/2b7f444f-94bc-0fa3-5632-cbf39a164102.(png)</a></p>
<h2 id="should-i-increase-the-order">Should I increase the order?</h2>
<p>The higher the order, the more expressive the model and the better the fit to the data, but the higher the order, the lower the generalization performance (over-learning).
In order to solve such a problem, it is better to use a simple linear regression, AIC, and other penalties added.</p>
<p>(When we reduce the fitting of the data to the model to the AIC minimization problem,
As can be seen from the formula, a penalty term is provided for increasing the order, and the optimum order can be selected. )</p>
<p>Since there is no suitable library for sklearn, I plan to carry out model evaluation using my own AIC as a continuation of this.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
