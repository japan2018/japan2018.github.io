<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>[Python] The story that seemed to be a trap for rounding off | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] The story that seemed to be a trap for rounding off</h1>
<p>
  <small class="text-secondary">
  
  
  Jan 25, 2020
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/beginner"> beginner</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/rounding"> rounding</a></code></small>

</p>
<pre><code>#Introduction
</code></pre>
<p>When I was implementing a trial calculation using Python in my work, it was a story that was almost caught in a trap.</p>
<p>#I just wanted to round&hellip;</p>
<p>&ldquo;Oh, I&rsquo;ll tell you what happened right now!&rdquo;</p>
<p>** &ldquo;I thought I was rounding &ldquo;2.5&rdquo; to &ldquo;3&rdquo;, but before I knew it, it was &ldquo;2&quot;&quot; **</p>
<p>&ldquo;I don&rsquo;t know what you&rsquo;re saying, but I didn&rsquo;t know what you were doing&hellip;&rdquo;</p>
<p>&ldquo;How was your head&hellip;
Don&rsquo;t be afraid that it&rsquo;s a mistake in calculation or a mistake in viewing
”I tasted something more scary&hellip;”</p>
<h1 id="this-is-about-the-farce">This is about the farce</h1>
<p>As I said, I thought I&rsquo;d round it up in Python.</p>
<p>The first thing that comes to mind is
<strong>round function</strong>
<strong>format function</strong></p>
<p>&ldquo;Well, if you use it here, you can afford it.&rdquo;</p>
<p>That suddenly shattered&hellip;</p>
<pre><code>&gt;&gt;&gt; k=2.5
&gt;&gt;&gt; round(k)
2
</code></pre><p>&ldquo;e&rdquo;</p>
<p>At this time, my brain was filled with distrust of rounding, which I should have learned in compulsory education at that time.</p>
<p>** &ldquo;When did you get the illusion that rounding rounded 2.5 to 3?&rdquo; **</p>
<p>No no no no</p>
<p>If you round off &ldquo;2.5&rdquo;, you get &ldquo;3&rdquo;.</p>
<p>But why?</p>
<p>Let&rsquo;s try with the format function as well</p>
<pre><code>&gt;&gt;&gt; format(k,'.0f')
'2'
</code></pre><p>Ho.
Are you guru?</p>
<p>But why?</p>
<p>#I investigated</p>
<p>When I look it up
This person was investigating and also offered a <strong>solution</strong>.
↓ ↓ ↓
<a href="https://qiita.com/sak_2/items/b2dd8bd1c4e4b0788e9a">Note because I was addicted to rounding off python3</a></p>
<p>In this person&rsquo;s article, the cause was found to be <strong>nearest nearest rounding</strong>.</p>
<blockquote>
<p>Round to nearest even number [edit]
Round to the nearest even (RN) is rounded down if the fraction is less than 0.5, rounded up if the fraction is greater than 0.5, rounded down or rounded up if the fraction is exactly 0.5. Round off. It is defined as Rule A in JIS Z 8401 and is more desirable than Rule B (rounding).
Even if there is a finite proportion of data with a fraction of 0.5, which causes a bias in rounding, the feature is that there is no bias, and even if a large number of data are added, the rounding error will not be biased toward a specific side and accumulate (even + If there is a characteristic such that 0.5 appears but odd +0.5 does not appear, the bias will still appear).
Reference: Wikipedia-Rounding</p>
</blockquote>
<p>It seems that you can round 0.5 up to Python2
Python3 is like this.</p>
<p>That is
When it is &ldquo;2.5&rdquo;, it means that it becomes &ldquo;2&rdquo; on the even side.</p>
<p>So if you do &ldquo;3.5&rdquo;, it will be &ldquo;4&rdquo;.</p>
<pre><code>&gt;&gt;&gt; k=3.5
&gt;&gt;&gt; round(k)
Four
</code></pre><p>Where is this specification in demand?</p>
<p>#Resolution</p>
<p>@Shiracamus suggested the solution to the article I introduced earlier.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">round</span>(x):
    <span style="color:#66d9ef">return</span> (x<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">round</span>(x,d<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>): <span style="color:#75715e"># Do this to specify the number of digits</span>
    p<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span><span style="color:#f92672">**</span>d
    <span style="color:#66d9ef">return</span> (x<span style="color:#f92672">*</span>p<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span><span style="color:#f92672">/</span>p
</code></pre></div><p>This solved it.
@sak_2
@shiracamus
Thank you very much.</p>
<p>Please be careful, too.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
