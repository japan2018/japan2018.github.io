<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Python] Graph database Neo4j for Python for beginners (for Mac OS X) | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] Graph database Neo4j for Python for beginners (for Mac OS X)</h1>
<p>
  <small class="text-secondary">
  
  
  Apr 11, 2015
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/database"> Database</a></code></small>


<small><code><a href="https://memotut.com/tags/neo4j"> neo4j</a></code></small>


<small><code><a href="https://memotut.com/tags/graph-database"> Graph Database</a></code></small>

</p>
<pre><code>I'm a beginner, while saying &quot;Introduction to graph database Neo4j for Python for beginners&quot; in Python, so I'm sorry.
</code></pre>
<p>I will introduce the environment construction to operate <a href="http://neo4j.com">Neo4j</a> with Python and a sample to play around with the data.</p>
<!--
Since there was a very good introduction video on Youtube, I would like to write in this article up to the point that Python4 can use Neo4j based on it.

#0.Intro#
The following video and slides were easy to understand, so I have obtained permission from Holger Spill to explain some of them in this article. So, if you find it useful to read, please like the video and slides below!

"Holger Spill: An introduction to Python and graph databases with Neo4j"
https://youtu.be/ps5RtmWKwLY

"Holger Spill: An introduction to Python and graph databases with Neo4j"
https://speakerdeck.com/nzpug/holger-spill-an-introduction-to-python-and-graph-databases-with-neo4j
- ->
#1. Introducing Neo4j#
First, let's start by installing Neo4J on Mac OS X. Since my environment is Yosemite 10.10.2, I would appreciate if you can let me know in the comments if there are any errors due to the difference in environment.

First of all, I need a JDK, but it doesn't seem to work with the Java that comes with the Mac from the beginning, so I'm using Oracle JDK 7 at http://www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260. Introduced from html.

next,
http://neo4j.com/download/
Go to and download the Neo4j Community Edition (free version).

neo4j-community-2.2.0-unix-2.tar will be downloaded, so unzip it and enter the folder.

```bash
tar zvf neo4j-community-2.2.0-unix-2.tar
cd neo4j-community-2.2.0
```

And start.

```bash
./bin/neo4j start
```

Installation is very easy!
There is a user interface that can be accessed from a browser, so I will try using it.
The access destination is
http://localhost:7474/browser/
is.
You will be required to set the ID and Password at the first startup, so set them appropriately.


#2. Connect to Neo4j with Python#
There seems to be some Python libraries that can connect to Neo4j, but here I decided to use [Neo4jRestClient](http://neo4j-rest-client.readthedocs.org/en/latest/) to connect from Python to Neo4j. I will.

```bash
pip install neo4jrestclient
```

pip is great, it's really easy to install! :satisfied:

Follow [neo4jRestClient Tutorial](http://neo4j-rest-client.readthedocs.org/en/latest/info.html#getting-started) to try it.

```py
from neo4jrestclient.client import GraphDatabase

url = "http://<user ID>:<password>@localhost:7474/db/data/"
gdb = GraphDatabase(url)
```
For the <User ID> and <Password> parts, write the settings you made earlier.
Now you are connected to Neo4j from Python.

Next, add 2 Nodes. Alice and bob are two people of the same age.

```py
alice = gdb.nodes.create(name="Alice", age=30)
bob = gdb.nodes.create(name="Bob", age=30)
```

Actually, bob knew alice from 1980, but alice knew bob three years later...
If you add a node called, it becomes the following.

```py
bob.relationships.create("Knows", alice, since=1980)
alice.relationships.create("Knows", bob, since=1983)
```

Now let's display this. (Proceeding that python is running on iPython notebook.)

Hit the query to display all, including the relationship between nodes. Also, it is a good idea to set data_contents=True, and it will not work well without this. (I didn't understand this and took some time...)

```py
gdb.query("MATCH (n)-[r]-(m) RETURN n, r, m", data_contents=True)
```

![neo4j_001-compressor.png](https://qiita-image-store.s3.amazonaws.com/0/50670/461ec2bf-5db4-627c-993f-0a01d6276a21.png)
The graph is displayed!

To see this in your browser, go to http://localhost:7474/browser/

```
MATCH (n)-[r]-(m) RETURN n, r, m
```

![neo4j_002-compressor.png](https://qiita-image-store.s3.amazonaws.com/0/50670/68bafa7e-b41d-5153-a0d3-d71287f584cb.png)

And press Enter
![neo4j_003.png](https://qiita-image-store.s3.amazonaws.com/0/50670/78d1cba2-abee-9fd1-8bfe-6b1253e81cba.png)
The graph is displayed :grinning:



#2. Play with the data#

Delete the data so far.

```py
# All Delete
gdb.query("MATCH (n) OPTIONAL MATCH (n)-[r]-() DELETE n,r", data_contents=True)
```

Then add 3 Nodes and Relationships.

```py
Add # Person Node
alice = gdb.nodes.create(name="Alice", age=30)
bob = gdb.nodes.create(name="Bob", age=30)
ken = gdb.nodes.create(name="Ken", age=35)

alice.labels.add("Person")
bob.labels.add("Person")
ken.labels.add("Person")

#Set Relationship
bob.relationships.create("Knows", alice, since=1980)
alice.relationships.create("Knows", bob, since=1983)
alice.relationships.create("Knows", ken, since=2015)
```

A node is a person here, and a relationship is a relationship where Alice knows Bob.

![neo4j_004-compressor-2.png](https://qiita-image-store.s3.amazonaws.com/0/50670/afffbc10-b38b-d108-b857-6f281b89efc6.png)

When you hit the displayed query on iPython,

```py
gdb.query("MATCH (n)-[r]-(m) RETURN n, r, m", data_contents=True)
```

![neo4j_005-compressor.png](https://qiita-image-store.s3.amazonaws.com/0/50670/ba2fd2bc-814a-8ce2-906e-3848a9f5b9b4.png)

You will see a similar graph :D

Next, Person has a Blog, and I define the relationship with the Blog as the owner of the blog: "Owner", the subscriber: "Subscribe" and look at the graph.

```py
# Add Blog Node
cam_blog = gdb.nodes.create(name="Camera Blog")
comp_blog = gdb.nodes.create(name="Computer Blog")
trav_blog = gdb.nodes.create(name="Travel Blog")
gour_blog = gdb.nodes.create(name="Gourmet Blog")

cam_blog.labels.add("Blog")
comp_blog.labels.add("Blog")
trav_blog.labels.add("Blog")
gour_blog.labels.add("Blog")

Add # Relation
alice.relationships.create("Own", cam_blog)
bob.relationships.create("Own", comp_blog)
ken.relationships.create("Own", trav_blog)

alice.relationships.create("Subscribe", trav_blog)
alice.relationships.create("Subscribe", gour_blog)
bob.relationships.create("Subscribe", cam_blog)
ken.relationships.create("Subscribe", comp_blog)
```

Also, if you access http://localhost:7474/browser/ with a browser and throw the following query,

```
MATCH (n)-[r]-(m) RETURN n, r, m
```

This graph is displayed. I think it's easy to understand. That's why it's said that graph databases are easier to understand than relational databases.![neo4j_006.png](https://qiita-image-store.s3.amazonaws.com/0/50670/c5c818f0-254a-df37-d7dd-e8ee762216d3.png)


#3. Cypher First Steps #

I'll give some examples of the basic way to write Cypher.
<br>
The following Bob, Alice, and Ken indicated by red circles are selected.

```
match (n:Person) RETURN n
```
![neo4j_007-compressor.png](https://qiita-image-store.s3.amazonaws.com/0/50670/0c7c65a5-122b-a787-6e0d-29a06d6038d8.png)
(*The red frame is added for clarity and does not mean that it is displayed on the Neo4J browser screen.)

This time, the Blog node is selected.

```
match (n:Blog) RETURN n
```

![neo4j_008-compressor.png](https://qiita-image-store.s3.amazonaws.com/0/50670/356a1825-e117-b370-a8ea-aa4afda91437.png)


This Cypher query only extracts Bob.

```
MATCH (b:Person {name:'Bob'}) RETURN b
```

![neo4j_009-compressor.png](https://qiita-image-store.s3.amazonaws.com/0/50670/67159302-367f-a911-304f-45184e7c380b.png)

Select the relationship together. In the following cases, only those that have an Own relationship are targeted.

```
MATCH (p:Person)-[r:Own]->(b:Blog) RETURN p,r,b;
```
![neo4j_011-compressor.png](https://qiita-image-store.s3.amazonaws.com/0/50670/ac1e14bc-d538-ab78-6fe4-3e1deb89fdbb.png)


Finally, generate 100 Person nodes and 100 Blog nodes at random, and generate and display a graph with 500 Subscribe relationships.

```py
import numpy.random as rd

l = 100

person_list = []
blog_list = []
for i in range(l):
    
    p = gdb.nodes.create(name="person_%d"%i)
    p.labels.add("Person")
    
    b = gdb.nodes.create(name="Blog_%d"%i)
    b.labels.add("Blog")
    
    person_list.append(p)
    blog_list.append(b)

r1 = range(len(person_list))
rd.shuffle(r1)

for i in range(len(blog_list)):
    blog_list[i].relationships.create("Own", person_list[r1[i]])


r2 = range(l) * 5
rd.shuffle(r2)
r3 = range(l) * 5
rd.shuffle(r3)
                
for i,j in zip(r2, r3):
    person_list[i].relationships.create("Subscribe", blog_list[j])
```
![neo4j_012-compressor.png](https://qiita-image-store.s3.amazonaws.com/0/50670/ea55b344-827f-6d9e-f749-3a277ad1c4be.png)

It's chaos! :grin:

#3.Drawing with Networkx#
Install iCypher.

```bash
pip install ipython-cypher
```

You can graph with networkx with the code below.

```py:neo4j-networkx.py
%load_ext cypher
%matplotlib inline
import networkx as nx
import matplotlib.pyplot as plt

result = %%cypher http://<user ID>:<password>@localhost:7474/db/data/ MATCH (n)-[r]-(m) RETURN n,r,m;
node_map ={'Person':'#22FF99','Blog':'#6622FF'}
node_label={'Person':'Person','Blog':'Blog'}

g = result.get_graph()
pos=nx.get_node_attributes(g,'pos')
plt.figure(figsize=(15,15))
nx.draw(g, node_color=[node_map[g.node[n]['labels'][0]] for n in g],node_size=80, width=0.5, edge_color='#999999')

```

![neo4j_014-compressor.png](https://qiita-image-store.s3.amazonaws.com/0/50670/ae4317b0-53e4-5a14-e083-67c476c6397a.png)

<!--
#4.Collaboration with Gephi#
- ->
    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
