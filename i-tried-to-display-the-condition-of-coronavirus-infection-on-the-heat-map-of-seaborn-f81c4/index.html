<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>I tried to display the condition of coronavirus infection on the heat map of seaborn | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>I tried to display the condition of coronavirus infection on the heat map of seaborn</h1>
<p>
  <small class="text-secondary">
  
  
  Apr 6, 2020
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/heatmap">heatmap</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/datascience">DataScience</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/seaborn">seaborn</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/colonavirus">colonavirus</a></code></small>

</p>
<pre><code># I tried to display the condition of infection of corona on the heat map of seaborn
</code></pre>
<p>##Purpose
Visualize the spread of corona in each prefecture
The goal is this.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/455102/81b7810d-7c39-7ec9-db71-0284eccb2897.png" alt="colona.png"></p>
<p>##Method
Use python&rsquo;s seaborn.
Click here for data on the number of infected people (up to 4/5). <a href="https://toyokeizai.net/sp/visual/tko/covid19/">https://toyokeizai.net/sp/visual/tko/covid19/</a>
Click here for prefecture data. <a href="https://gist.github.com/mugifly/d6e68a516de4a008687c">https://gist.github.com/mugifly/d6e68a516de4a008687c</a>
Here is a summary of various things. <a href="https://github.com/kyasby/colona.git">https://github.com/kyasby/colona.git</a></p>
<h2 id="import-library">Import library</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">import</span> seaborn <span style="color:#f92672">as</span> sns
<span style="color:#f92672">%</span>matplotlib inline
</code></pre></div><p><code>%matplotlib inline</code> is a spoiler.
numpy imports for <code>cumsum()</code>.</p>
<h2 id="import-the-infected-number-csv">Import the infected number csv</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;COVID-19.csv&#34;</span>)
df <span style="color:#f92672">=</span> df[[<span style="color:#e6db74">&#34;Prefectures&#34;</span>, <span style="color:#e6db74">&#34;Residents&#34;</span>, <span style="color:#e6db74">&#34;Number of people&#34;</span>, <span style="color:#e6db74">&#34;Date of onset&#34;</span>, <span style="color:#e6db74">&#34;Date of confirmation&#34;</span>]]
df <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>rename(columns<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;Age&#34;</span>:<span style="color:#e6db74">&#34;age&#34;</span>, <span style="color:#e6db74">&#34;Gender&#34;</span>:<span style="color:#e6db74">&#34;sex&#34;</span>, <span style="color:#e6db74">&#34;Prefecture&#34;</span>:<span style="color:#e6db74">&#34;hsp&#34;</span>, <span style="color:#e6db74">&#34;Resident&#34;</span>:<span style="color:#e6db74">&#34;house&#34;</span>})
df
</code></pre></div><p>Extract the required columns and rename them at the same time.
By passing a list to df[], you can extract only that column.</p>
<p><code>df.rename(columns={&quot;old_columns_name&quot;:&quot;new_name&quot;},index={&quot;old_index_name&quot;:&quot;new_name&quot;})</code>
You can change the column name and index name by passing a dictionary such as.</p>
<p>*Hsp is hospital.</p>
<h2 id="date-making">Date making</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">for</span> i, row <span style="color:#f92672">in</span> df<span style="color:#f92672">.</span>iterrows():
    <span style="color:#66d9ef">if</span> type(row[<span style="color:#e6db74">&#34;Date of onset&#34;</span>])<span style="color:#f92672">==</span>float:
        df<span style="color:#f92672">.</span>at[i, <span style="color:#e6db74">&#34;Date of onset&#34;</span>] <span style="color:#f92672">=</span> row[<span style="color:#e6db74">&#34;Date of confirmation&#34;</span>]
    <span style="color:#66d9ef">else</span>:
        <span style="color:#66d9ef">pass</span>
df <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>rename(columns <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;Date of onset&#34;</span>:<span style="color:#e6db74">&#34;Date&#34;</span>})
</code></pre></div><p>I want to get the date on the horizontal axis of the heat map, so I get the date.
However, as shown below, the &ldquo;onset date&rdquo; contains NaN, so in that case, replace it with the &ldquo;fixed date&rdquo;.</p>
<p>| hsp | house | Number of people | Onset date |
|&mdash;&mdash;&mdash;&mdash;|&mdash;&mdash;&mdash;&mdash;&mdash;-|&mdash;:|&mdash;&mdash;&mdash;|&mdash;- &mdash;&ndash;|
| Kanagawa Prefecture | Kanagawa Prefecture | 1|1/3/2020 |1/15/2020|
| Tokyo | People&rsquo;s Republic of China | 1|1/14/2020|1/24/2020|
| Tokyo | People&rsquo;s Republic of China | 1|1/21/2020|1/25/2020|
| Osaka Prefecture | Osaka Prefecture | 1|1/20/2020|1/29/2020|
| Unknown | People&rsquo;s Republic of China | 1|1/29/2020|1/30/2020|
| Chiba Prefecture | People&rsquo;s Republic of China | 1|NaN |1/30/2020|</p>
<p>Finally, change the column name to &ldquo;Date&rdquo;.</p>
<p>NaN judgment
<code>type(row[&quot;Date of onset&quot;])==float</code>
I wrote it like this, but please let me know if there is a better way to write it.</p>
<h2 id="import-prefecture-csv">Import prefecture CSV</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">todofuken <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;japan.csv&#34;</span>, header<span style="color:#f92672">=</span>None)[<span style="color:#ae81ff">0</span>]
</code></pre></div><h2 id="replace-part-of-hsp">Replace part of hsp</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df[<span style="color:#e6db74">&#34;hsp&#34;</span>]<span style="color:#f92672">.</span>value_counts()
</code></pre></div><p>Then, if you check the contents of &ldquo;hsp&rdquo;, you can see &ldquo;Haneda Airport&rdquo; and &ldquo;Unknown&rdquo;.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/455102/fe1c8c6c-81b8-49a8-3d7c-943289009da7.png" alt="Screenshot 2020-04-06 16.04.52.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df[<span style="color:#e6db74">&#34;hsp&#34;</span>]<span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#34;hsp&#34;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x :<span style="color:#e6db74">&#34;other&#34;</span> <span style="color:#66d9ef">if</span> x <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> list(todofuken) <span style="color:#66d9ef">else</span> x)
</code></pre></div><p>Use apply and the lambda function to partially rewrite the contents of df[&ldquo;hsp&rdquo;].
If it is not in the list of prefectures, enter &ldquo;Other&rdquo;, and if there is, enter the prefecture as it is.
If you use apply and a lambda function, you&rsquo;ll probably get a syntax error without the else. (Unconfirmed) Please note.</p>
<p>Up to this point, df looks like this.</p>
<p>| hsp | house | number of people | Date |
|&mdash;&mdash;&mdash;&mdash;|&mdash;&mdash;&mdash;&mdash;&mdash;-|&mdash;:|&mdash;&mdash;&mdash;|&mdash;- &mdash;&ndash;|
| Kanagawa Prefecture | Kanagawa Prefecture | 1|1/3/2020 |1/15/2020|
| Tokyo | People&rsquo;s Republic of China | 1|1/14/2020|1/24/2020|
| Tokyo | People&rsquo;s Republic of China | 1|1/21/2020|1/25/2020|
| Aichi | People&rsquo;s Republic of China | 1|1/23/2020|1/26/2020|
| Aichi Prefecture | People&rsquo;s Republic of China | 1|1/22/2020|1/28/2020|
| Nara | Nara | 1|1/14/2020|1/28/2020|
| Hokkaido | People&rsquo;s Republic of China | 1|1/26/2020|1/28/2020|
| Osaka | Osaka | 1|1/20/2020|1/29/2020|</p>
<h2 id="pivot">Pivot</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">pvt <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>pivot_table(index<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;hsp&#34;</span>, columns<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Date&#34;</span>, values<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;number of people&#34;</span>)<span style="color:#f92672">.</span>fillna(<span style="color:#ae81ff">0</span>)
pvt <span style="color:#f92672">=</span> pvt<span style="color:#f92672">.</span>rename(index <span style="color:#f92672">=</span> dict(zip(jpn[<span style="color:#ae81ff">0</span>], jpn[<span style="color:#ae81ff">2</span>])))<span style="color:#f92672">.</span>rename(index<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#34;other&#34;</span>:<span style="color:#e6db74">&#34;others&#34;</span>})
</code></pre></div><p>Pandas has a method called pivot_table, which allows you to literally create a pivot table. (You don&rsquo;t need Excel.) Also, fill NaN with 0.</p>
<p>And rename it from Hokkaido to Hokkaido. In my environment, if the index name or column name contains Japanese, the characters will not be displayed. It seems that it will be solved by installing something, but it will be supported by renaming. (Please let me know if there is a better way.)</p>
<p>The contents of jpn[0] are the prefecture names in Kanji such as Hokkaido and Aomori.
The contents of jpn[2] are the prefecture names in Roman letters such as Hokkaido and aomori.</p>
<p>These are paired with the <code>zip function</code>, made into a dictionary with the <code>dict function</code>, and passed to the <code>rename function</code>.
Also, change &ldquo;Others&rdquo; to &ldquo;others&rdquo;.</p>
<p>Up to this point, the data frame looks like this.
![Screenshot 2020-04-06 0.42.59.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/455102/c57ac185-d126-3a09-21c6-(fe2c82e498cb.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/455102/c57ac185-d126-3a09-21c6-(fe2c82e498cb.png)</a></p>
<h2 id="set-to-cumulative-number">Set to cumulative number</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(pvt)):
    pvt<span style="color:#f92672">.</span>iloc[i]<span style="color:#f92672">=</span>pvt<span style="color:#f92672">.</span>iloc[i]<span style="color:#f92672">.</span>cumsum()
</code></pre></div><p>Take one line at a time from pvt, and use the <code>cumsum()</code> function of <code>numpy</code> to set the cumulative number of people.</p>
<p>In this way, the cumulative number has been updated.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/455102/ad78a85e-c2ad-271f-2903-a2b7b304516c.png" alt="Screenshot 2020-04-06 0.46.14.png"></p>
<h2 id="display-and-save">Display and save</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">20</span>,<span style="color:#ae81ff">10</span>))
sns<span style="color:#f92672">.</span>heatmap(pvt<span style="color:#f92672">.</span>iloc[:,<span style="color:#f92672">-</span><span style="color:#ae81ff">60</span>:] ,linewidths<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Spectral&#39;</span>, cbar<span style="color:#f92672">=</span>True, xticklabels<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
plt<span style="color:#f92672">.</span>savefig(<span style="color:#e6db74">&#34;colona.png&#34;</span>)
</code></pre></div><p>I decided to display the date of the young date from 60 days ago, because it is meaningless that there is almost no infected person (fortunately).
You can use <code>:</code> (slice). For example, <code>10:20</code> indicates 10 or more and less than 20.</p>
<p>I was able to display the heat map like this.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/455102/81b7810d-7c39-7ec9-db71-0284eccb2897.png" alt="colona.png"></p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
