<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Raspai? What? Level of hardware inexperienced I made a system to understand if there are people in the office | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Raspai? What? Level of hardware inexperienced I made a system to understand if there are people in the office</h1>
<p>
  <small class="text-secondary">
  
  
  Jan 2, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/hardware"> hardware</a></code></small>


<small><code><a href="https://memotut.com/tags/raspberrypi"> RaspberryPi</a></code></small>


<small><code><a href="https://memotut.com/tags/crontab"> crontab</a></code></small>

</p>
<pre><code>#Introduction
</code></pre>
<p>Hello. I am currently working as an intern at an IT company while being a university student in Nagoya.</p>
<p>However, when I spend most of my time, I want to work and work on days other than the default workday.
After taking a lecture at university, go to work.
On such a day, I come to work around 6pm and work until there are no more employees (the office is closed).
Yes, at my internship, an employee has an office key, and if there is an employee, the office is vacant even on holidays.</p>
<h1 id="one-day">One day</h1>
<p>I finished college at about 19:00 and decided to head to the office.
I was convinced that there would be somebody.
When you arrive at the office&hellip;</p>
<p>** Closed Uuuuuuuuuuuuuuuuuuuuuuu</p>
<p>On that day, all the employees happened to be back.</p>
<p>This was a problem&hellip;(I can&rsquo;t say that the employee should stay late, and I&rsquo;m sorry that the last employee would let me know when he left the company&hellip;)</p>
<h1 id="main-subject">Main subject</h1>
<p>That&rsquo;s why I thought of creating a system to keep track of people in the office.
So, when I was wondering what to do, I found that I could use <code>Raspberry Pi</code> and <code>Arduino</code>.
By mounting the <code>illuminance sensor</code> on them and detecting the illuminance in the office, we can grasp whether or not there are people. I thought.</p>
<h1 id="hardware-i-dont-know-anything-i-want-to-understand-completely">Hardware I don&rsquo;t know anything. I want to understand completely.</h1>
<p>Embarrassingly, I was really ignorant about the <code>Raspberry Pi</code> and the <code>Arduino</code>, so I searched a lot.
I had an acquaintance who was from a technical college (<a href="gangan_nikki">GANGAN</a>) who is familiar with hardware, so I listened to it in DM on twitter.</p>
<p>(Like this/public consent)
<img width="578" alt="Screenshots 2019-12-31 12.38.32.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/270696/215ec132-ddbd-3d0d-0b52-1e96ad787d12.png">
(GANGAN&rsquo;s blog is <a href="https://gangannikki.hatenadiary.jp/">here</a>)</p>
<p>And&hellip;</p>
<p><a href="https://www.switch-science.com/catalog/3646/?gclid=CjwKCAiA3abwBRBqEiwAKwICA5CCJgfeovCYDEK3oXFVhl9hso62JA-3iYHto7KK-bbIUvlGd_gWWRoCP_w_BWH_BWH_BW_BWH_B_BW_B_B_WH_BW">Raspberry Pi Zero WH</a>Ithasbeendecidedtousetrade-one.co.jp/product/module/adrszlx/).(Decisionfactor:cheap)</p>
<p>I purchased the above 2 items online.
Since the conversion cable is a great deal, I went to Akihabara (Osu) in Nagoya and bought it.</p>
<p>(Like this)
<img width="714" alt="Screenshots 2019-12-31 13.12.51.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/270696/ec8bb313-a71b-ab24-0fad-c78679c10ccc.png">
<img width="715" alt="Screenshots 2019-12-31 13.12.43.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/270696/e329ced8-1d02-344b-7b37-f8df6b0efc14.png">
<img width="708" alt="Screenshots 2019-12-31 13.12.33.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/270696/e7e9abfe-3ab8-bab0-8ff0-19d789b2697e.png"></p>
<p>(I forgot to take a photo, but I also bought 4GB of storage.)</p>
<h1 id="environment">Environment</h1>
<p>I want to connect Raspberry Pi with a display and a keyboard and get a complete understanding.
With that in mind, I made trial and error while referring to various sites.</p>
<p>And finally,
<img width="1221" alt=" Screenshot 2019-12-31 13.16.26.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/270696/07204efb-7016-73eb-51b1-108b0cd92178.png"></p>
<p>**Kita! ! ! Itâ€™s amazing! ! ! **</p>
<p>Razpai is now a PC! !</p>
<p>Reference:
<a href="https://technology-memo.net/2018/12/24/startup-raspberrypi-zero/">Until OS installation on Raspberry Pi Zero WH and start</a>
<a href="https://toripiyo.hatenablog.com/entry/2018/05/05/122758">Install Raspbian OS on Raspberry Pi Zero WH</a></p>
<hr>
<p>Also, since it is dull when connected to the display and keyboard many times, I performed <code>remote access by ssh</code>.
From now on, I decided to connect to Razpi from my own PC.</p>
<p>reference:
<a href="https://qiita.com/b-wind/items/d33f759ace01658bb09e">Remote connection to Raspberry Pi</a></p>
<h1 id="implementation">Implementation</h1>
<h2 id="architecture">Architecture</h2>
<p>I would like to detect the illuminance and inform myself of the value in some way.
I thought to use <code>LINE API</code> or <code>SLACK API</code>.</p>
<p>So that&rsquo;s what the architecture looks like.
<img width="994" alt="Screenshots 2019-12-31 13.32.21.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/270696/ef4d952f-e790-3803-a5d0-dc109e49dded.png"></p>
<p>Sounds simple.</p>
<h2 id="detect-illuminance">Detect illuminance</h2>
<p>I bought this time <a href="https://bit-trade-one.co.jp/product/module/zeroone01top/">Zero One Series</a>,butitisveryconvenient,and<a href="https://github.com/bit-trade-one/RasPi-Zero-One-Series">SampleCode</a> was released.</p>
<p>Referring to the sample code above,</p>
<pre><code class="language-python:" data-lang="python:">#!/usr/bin/env python3
# coding: utf-8

import smbus

bus = smbus.SMBus(1)
bus.write_byte_data(0x13, 0x80, 0xFF)
bus.write_byte_data(0x13, 0x82, 0x00)
bus.write_byte_data(0x13, 0x84, 0x9D)
data = bus.read_i2c_block_data(0x13, 0x85, 4)

luminance = data[0] * 256 + data[1]
proximity = data[2] * 256 + data[3]
</code></pre><p>Then, the illuminance could be detected.</p>
<p>Approximately,</p>
<p>When the light is on, <code>luminance:3000</code>
When there is no electricity, <code>luminance: 5</code></p>
<p>It was like that. In addition, to prevent false detection due to sunlight, we installed a Raspberry Pi in a place that is not exposed to the sun.</p>
<h2 id="working-with-slack">Working with slack</h2>
<p>We will create a new channel and think of a mechanism in which the bot sends the illuminance as a message.
I got the webhook URL by referring to <a href="https://api.slack.com/messaging/webhooks">here</a>.
After that, all you have to do is make a post request in the specified format.</p>
<h2 id="completed-program">Completed program</h2>
<p>Holidays after 10:00
On weekdays, messages will be sent to slack after 17:00.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#!/usr/bin/env python3</span>
<span style="color:#75715e"># coding: utf-8</span>

<span style="color:#f92672">import</span> smbus
<span style="color:#f92672">import</span> time
<span style="color:#f92672">import</span> requests<span style="color:#f92672">,</span> json
<span style="color:#f92672">import</span> datetime
<span style="color:#f92672">import</span> jpholiday
WEB_HOOK_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;****&#34;</span>
message <span style="color:#f92672">=</span> <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;defalut&#39;</span>

bus <span style="color:#f92672">=</span> smbus<span style="color:#f92672">.</span>SMBus(<span style="color:#ae81ff">1</span>)
bus<span style="color:#f92672">.</span>write_byte_data(<span style="color:#ae81ff">0x13</span>, <span style="color:#ae81ff">0x80</span>, <span style="color:#ae81ff">0xFF</span>)
bus<span style="color:#f92672">.</span>write_byte_data(<span style="color:#ae81ff">0x13</span>, <span style="color:#ae81ff">0x82</span>, <span style="color:#ae81ff">0x00</span>)
bus<span style="color:#f92672">.</span>write_byte_data(<span style="color:#ae81ff">0x13</span>, <span style="color:#ae81ff">0x84</span>, <span style="color:#ae81ff">0x9D</span>)
time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">0.8</span>)
data <span style="color:#f92672">=</span> bus<span style="color:#f92672">.</span>read_i2c_block_data(<span style="color:#ae81ff">0x13</span>, <span style="color:#ae81ff">0x85</span>, <span style="color:#ae81ff">4</span>)

luminance <span style="color:#f92672">=</span> data[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">256</span> <span style="color:#f92672">+</span> data[<span style="color:#ae81ff">1</span>]
proximity <span style="color:#f92672">=</span> data[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">256</span> <span style="color:#f92672">+</span> data[<span style="color:#ae81ff">3</span>]


today <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>date<span style="color:#f92672">.</span>today()
today_str <span style="color:#f92672">=</span> str(today)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;-&#39;</span>, <span style="color:#e6db74">``</span>)
current_hour <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>now()<span style="color:#f92672">.</span>hour

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">isBizDay</span>(DATE):
 Date <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>date(int(DATE[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">4</span>]), int(DATE[<span style="color:#ae81ff">4</span>:<span style="color:#ae81ff">6</span>]), int(DATE[<span style="color:#ae81ff">6</span>:<span style="color:#ae81ff">8</span>]))
 <span style="color:#66d9ef">if</span> Date<span style="color:#f92672">.</span>weekday() <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">or</span> jpholiday<span style="color:#f92672">.</span>is_holiday(Date):
  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>
 <span style="color:#66d9ef">else</span>:
  <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sendMessage</span>():
 <span style="color:#66d9ef">if</span> luminance <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">800</span>:
  message <span style="color:#f92672">=</span> <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;There are people in the office now! Let&#39;</span>s <span style="color:#66d9ef">return</span> early<span style="color:#960050;background-color:#1e0010">!</span> <span style="color:#e6db74">&#39;</span>
 <span style="color:#66d9ef">else</span>:
  message <span style="color:#f92672">=</span> <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;There are currently no people in the office. &#39;</span>

 requests<span style="color:#f92672">.</span>post(WEB_HOOK_URL, data <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>dumps((
 <span style="color:#e6db74">&#39;text&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Illuminance is&#39;</span><span style="color:#f92672">+</span>str(luminance)<span style="color:#f92672">+</span><span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;! &#39;</span><span style="color:#f92672">+</span>message, <span style="color:#75715e"># notification content</span>
 <span style="color:#e6db74">&#39;username&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Bakira-Tech-Python-Bot&#39;</span>, <span style="color:#75715e"># username</span>
 <span style="color:#e6db74">&#39;icon_emoji&#39;</span>: <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;:smile_cat:&#39;</span>, <span style="color:#75715e">#icon</span>
 <span style="color:#e6db74">&#39;link_names&#39;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#75715e"># link names</span>
 }))


<span style="color:#66d9ef">if</span> isBizDay(today_str) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
 <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;It&#39;s a weekday&#34;</span>)
 <span style="color:#66d9ef">if</span> current_hour<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">17</span>:
  sendMessage()
<span style="color:#66d9ef">else</span>:
 <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;It&#39;s a holiday&#34;</span>)
 <span style="color:#66d9ef">if</span> current_hour<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10</span>:
  sendMessage()<span style="color:#e6db74">``</span><span style="color:#960050;background-color:#1e0010">`</span>

I was able to send a message like this <span style="color:#960050;background-color:#1e0010">â†“</span><span style="color:#f92672">.</span>

<span style="color:#f92672">&lt;</span>img width<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;534&#34;</span> alt<span style="color:#f92672">=</span><span style="color:#e6db74">&#34; Screenshot 2019-12-31 20.02.26.png&#34;</span> src<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/270696/47cbc19b-a90d-4f5c-c671-12d9dbe5df38.png&#34;</span><span style="color:#f92672">&gt;</span>

<span style="color:#75715e">#Run the program regularly</span>

Give read permission to the python file <span style="color:#f92672">and</span> execute it periodically by using the crontab command<span style="color:#f92672">.</span>


I set it to run the python file once every <span style="color:#ae81ff">30</span> minutes<span style="color:#f92672">.</span>

</code></pre></div><p>*/30 * * * * /home/pi/luminance.py</p>
<pre><code>
reference:
[Cron python on Raspberry Pi3B. ](https://qiita.com/noimi/items/a98985bb84d93b6819c3)
[Run programs regularly on RaspberryPi](http://sebarabara.com/raspbian_cron/)



# in conclusion
Now that I've been to the office, it's no longer empty!
It was a rasp pi? What level, but I am very happy to be able to implement it somehow.
After all, we were able to achieve it with a very simple implementation.
Not only this time, I would like to be able to solve more and more familiar issues using Raspai.
It's convenient!! The best rasp pie!!

For companies, why not try introducing this in this era when work style reform is being called for? Lol


that's all.
_____
reference:
[Measure temperature, humidity and atmospheric pressure with raspberry pi zero](https://qiita.com/_saki_kawa_/items/7961c82b150a01920d72)
[What to do if you get a &quot;Couldn't resolve host&quot; error in curl](https://qiita.com/bz0/items/7d4bac34c6cdada59b94)</code></pre>
    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
