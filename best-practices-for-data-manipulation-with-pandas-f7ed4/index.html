<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>Best practices for data manipulation with pandas | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Best practices for data manipulation with pandas</h1>
<p>
  <small class="text-secondary">
  
  
  Nov 4, 2019
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/machine-learning"> machine learning</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/pandas"> pandas</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/data-science"> data science</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/kaggle"> Kaggle</a></code></small>

</p>
<pre><code>After preprocessing the data with machine learning, with a hypothesis,
</code></pre>
<p>Play with data? Play with? I think there are phases,
At that time, how to control pandas freely is
I think it will be important.</p>
<p>I myself have a little programming experience and database knowledge,</p>
<p>***pandas DataFrame [] ← This is too complicated! ! ***</p>
<p>Especially, it is difficult to narrow down by conditions.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">train[train[<span style="color:#e6db74">&#34;company_id&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1088</span>][<span style="color:#e6db74">&#34;meter_reading&#34;</span>]
</code></pre></div><p>It&rsquo;s confusing at this point, but if this is train_weather_df, it will be ruined</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">train_weather_df[train_weather_df[<span style="color:#960050;background-color:#1e0010">“</span>company_id<span style="color:#960050;background-color:#1e0010">”</span>]<span style="color:#f92672">==</span><span style="color:#ae81ff">1088</span>][<span style="color:#960050;background-color:#1e0010">“</span>meter_readings<span style="color:#960050;background-color:#1e0010">”</span>]
</code></pre></div><p>Moreover, when the two conditions are met, more horrifying things will happen&hellip;</p>
<p>So to do something a little complicated,
I think it&rsquo;s better to use <em><strong>.query()</strong></em>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">train<span style="color:#f92672">.</span>query(qry)[<span style="color:#e6db74">&#34;meter_reading&#34;</span>]
</code></pre></div><p>I think there is something like trying to make this &ldquo;Group 1&rdquo; for analysis after narrowing it down,
Note that you can&rsquo;t directly assign when fetched by the query method.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#960050;background-color:#1e0010">××××</span> train<span style="color:#f92672">.</span>query(qry)[<span style="color:#e6db74">&#34;group&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</code></pre></div><p><em><strong>I can&rsquo;t do it!!</strong></em></p>
<p>It&rsquo;s a little tedious, but I think the following is probably better.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">qry <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;company_id == 1088 &amp; meter_reading &gt;20000&#39;</span>
target_idx <span style="color:#f92672">=</span> train<span style="color:#f92672">.</span>query(qry)<span style="color:#f92672">.</span>index
train[<span style="color:#e6db74">&#34;group&#34;</span>]<span style="color:#f92672">.</span>loc(target_idx) <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</code></pre></div><p>Readability is not so bad, and above all,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">train<span style="color:#f92672">.</span>loc(target_idx)
</code></pre></div><p>I think it&rsquo;s good to be able to check if the focus is good.</p>
<p>However, it seems that there are restrictions on the characters that can be entered in the query,
That may be a problem someday.</p>
<p>By the way, the query examples on this site are helpful.
<a href="https://ohke.hateblo.jp/entry/2019/01/12/230000">https://ohke.hateblo.jp/entry/2019/01/12/230000</a>
(engine = python, etc.)</p>
<ul>
<li>Addition
I think there are cases where you want to use variables in the query,
If you put @ in your head, it will be recognized as a variable! !
This is very important.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
 tmp_q <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;name_ns == @t_name &amp; year == @t_year &#34;</span>
</code></pre></div><p>Referenced articles
<a href="https://qiita.com/kurumen-b/items/45b60299f0893a537f2a">https://qiita.com/kurumen-b/items/45b60299f0893a537f2a</a>
<a href="https://qiita.com/mwmsnn/items/6a464865759231aa888d">https://qiita.com/mwmsnn/items/6a464865759231aa888d</a></p>
<p>Further addition
In recent pandas, after narrowing down the columns, it seems that writing like iloc is not recommended,
This notation seems to be more important.
If you want to go back and forth around row numbers, column numbers, row labels, column names, see below
<a href="https://note.nkmk.me/python-pandas-get-loc-row-column-num/">https://note.nkmk.me/python-pandas-get-loc-row-column-num/</a></p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
