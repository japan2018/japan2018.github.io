<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Introduction to Deep Learning-Coding Preparation- | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Introduction to Deep Learning-Coding Preparation-</h1>
<p>
  <small class="text-secondary">
  
  
  Jun 1, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/machine-learning"> machine learning</a></code></small>


<small><code><a href="https://memotut.com/tags/intro"> intro</a></code></small>


<small><code><a href="https://memotut.com/tags/coding"> coding</a></code></small>


<small><code><a href="https://memotut.com/tags/deep-learning"> deep learning</a></code></small>

</p>
<pre><code># Target audience
</code></pre>
<p>It is a continuation of <a href="https://qiita.com/kuroitu/items/221e8c477ffdd0774b6b">Last article</a>.
This article prepares for coding from now on.
If you want to implement it yourself, but it is quite &hellip; please take a look.
(Basically, I can&rsquo;t use complicated techniques, so don&rsquo;t worry.)
** The coding environment is jupyter notebook. **
If you want to manage it at the module level elsewhere, uncomment the command such as <code>import</code>.
If it doesn&rsquo;t work please let me know in the comments&hellip;
Next article <a href="https://qiita.com/kuroitu/items/d22c8750e34d5d75fb6c">here</a></p>
<p>#table of contents</p>
<ul>
<li><a href="#Layermodulecodepreparation">Layer module code preparation</a></li>
<li><a href="#LayerManagerCodePreparation">Layer Manager Code Preparation</a>
-<details>
<summary><a href="#Specialmethodimplementation">Special method implementation</a></summary>
-<a href="Implementationof#__init__method">Implementation of <code>__init__</code> method</a>
-<a href="Implementationof#__repr__methodand__str__method">Implementation of <code>__repr__</code> method and <code>__str__</code> method</a>
-<a href="Implementationof#__len__method">Implementation of <code>__len__</code> method</a>
-<a href="Implementationof#__getitem__method">Implementation of <code>__getitem__</code> method</a>
-<a href="Implementationof#__setitem__method">Implementation of <code>__setitem__</code> method</a>
-<a href="Implementationof#__delitem__method">Implementation of <code>__delitem__</code> method</a>
</summary>
-<details>
<summary><a href="#User-definedmethodimplementation">User-defined method implementation</a></summary>
-<a href="Implementationof#_renamemethod">Implementation of <code>_rename</code> method</a>
-<a href="Implementationof#appendmethod">Implementation of <code>append</code> method</a>
-<a href="Implementationof#extendmethod">Implementation of <code>extend</code> method</a>
-<a href="Implementationof#insertmethod">Implementation of <code>insert</code> method</a>
-<a href="Implementationof#extend_insertmethod">Implementation of <code>extend_insert</code> method</a>
-<a href="Implementationof#removemethod">Implementation of <code>remove</code> method</a>
-<a href="#Implementationofothermethods">Implementation of other methods</a>
-<a href="#Propertyimplementation">Property implementation</a>
</summary>
-<a href="#Fullcode">Full code</a></li>
<li><a href="#Codepreparationforlayererror">Code preparation for layer error</a></li>
<li><a href="#Conclusion">Conclusion</a></li>
<li><a href="#Listofpostedcodes">List of posted codes</a></li>
</ul>
<p>#Layermodulecodepreparation
First, make a base container.</p>
<details><summary>baselayer.py</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-baselayer.py" data-lang="baselayer.py"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BaseLayer</span>():
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    The underlying layer class of everything
</span><span style="color:#e6db74">    Describe the processing common to the middle layer and output layer.
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">def</span> __init__(self):
        <span style="color:#66d9ef">pass</span>
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">forward</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Forward propagation implementation
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">pass</span>
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">backward</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Back propagation implementation
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">pass</span>
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Implement parameter learning
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">pass</span>
</code></pre></div></div></details>
It's just a container because I haven't implemented anything yet. Only the function name that should be defined is implemented.
It is the middle and output layers that inherit this container.
<details><summary>middlelayer.py</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-middlelayer.py" data-lang="middlelayer.py"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np


<span style="color:#75715e">#import .baselayer import BaseLayer</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MiddleLayer</span>(BaseLayer):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Middle class
</span><span style="color:#e6db74">    The input layer is also handled as one of the intermediate layers in terms of mounting.
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    <span style="color:#66d9ef">pass</span>
</code></pre></div></div></details>
<details><summary>outputlayer.py</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-outputlayer.py" data-lang="outputlayer.py"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np


<span style="color:#75715e">#from .baselayer import BaseLayer</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OutputLayer</span>(BaseLayer):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Output layer class
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    <span style="color:#66d9ef">pass</span>
</code></pre></div></div></details>
<h1 id="layer-manager-code-preparation">Layer manager code preparation</h1>
<p>Here, prepare a manager to handle the layer module.
** Finally, put the code together in one. Please be aware that there is a possibility that you may forget to change the code in the middle. **
Basically, I will make it aware of Python&rsquo;s <code>List</code> type and <code>Dictionary</code> type.</p>
<details><summary>layermanager.py</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np


<span style="color:#75715e">#from .layer import *</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">_TypeManager</span>():
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Manager class for layer types
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    N_TYPE <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#75715e"># Number of layer types</span>
    
    MIDDLE <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># Middle layer numbering</span>
    OUTPUT <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e"># Output layer numbering</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LayerManager</span>(_TypeManager):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Manager class for managing layers
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    <span style="color:#66d9ef">def</span> __init__(self):
        <span style="color:#66d9ef">pass</span>
</code></pre></div></div></details>
The `_TypeManager` class is a class that holds the number of layer types and their numbering. The `_` (underscore) attached at the beginning is a `private` class in other languages that restricts access from external modules.
However, Python does not have a complete `private` attribute, so access is possible.
<p>The <code>LayerManager</code> class is aware of the <code>Dictionary</code> type so that it can hold a list of layers and add/delete layers.
Also, let <code>_TypeManager</code> be inherited.</p>
<p>By the way, the <code>layer</code> module is a module for collectively importing the <code>Layer</code> related modules.</p>
<details><summary>layer.py</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layer.py" data-lang="layer.py"><span style="color:#f92672">from</span> .middlelayer <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
<span style="color:#f92672">from</span> .outputlayer <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
<span style="color:#f92672">from</span> ._layererror <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</code></pre></div></div></details>
<p>The <code>_layererror</code> module will be described later, but we plan to make a module that summarizes the errors that occur in layers.</p>
<h2 id="implementing-special-methods">Implementing special methods</h2>
<p>First, implement the special method of <code>LayerManager</code> class. Please refer to <a href="https://docs.python.org/ja/3/reference/datamodel.html">Official Document</a> for the list of special methods.</p>
<p>###<code>__init__</code> method implementation
Now, implement the <code>__init__</code> method of the <code>LayerManager</code> class.
In the first place, the <code>__init__</code> method is one of the Python special methods and one of the methods that is called when a class is instantiated.
In other words, describe what you want the <code>LayerManager</code> class to do when it is created.
here</p>
<p>-Hold a list of layers
-Holds a list of layer names
-Keep the number of layers by type</p>
<p>I want you to implement it that way.</p>
<details><summary>`__init__` implementation</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py">    <span style="color:#66d9ef">def</span> __init__(self):
        self<span style="color:#f92672">.</span>__layer_list <span style="color:#f92672">=</span> [] <span style="color:#75715e"># list of layers</span>
        self<span style="color:#f92672">.</span>__name_list <span style="color:#f92672">=</span> [] <span style="color:#75715e"># name list for each layer</span>
        self<span style="color:#f92672">.</span>__ntype <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(self<span style="color:#f92672">.</span>N_TYPE) <span style="color:#75715e"># Number of layers by type</span>
</code></pre></div></div></details>
Of course, I don't want to be touched from the outside, so let's make it `private` with `__` (two underscores).
<h3 id="implementation-of-__repr__-and-__str__-methods">Implementation of <code>__repr__</code> and <code>__str__</code> methods</h3>
<p>The <code>__repr__</code> method is the &ldquo;official&rdquo; string representation that is called by the <code>repr</code> function, one of Python&rsquo;s built-in functions.
It is called &ldquo;official&rdquo;, but the point is detailed information.
The <code>__str__</code> method is an &ldquo;informal&rdquo; string representation that is called by one of Python&rsquo;s built-in functions, the <code>str</code> function, and the built-in functions, the <code>format</code> function and the <code>print</code> function.
&ldquo;Informal&rdquo; means that the information is easy to read.</p>
<details><summary>Implementation of `__repr__` and `__str__` methods</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py">    <span style="color:#66d9ef">def</span> __repr__(self):
        layerRepr<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;layer_list: &#34;</span><span style="color:#f92672">+</span> repr(self<span style="color:#f92672">.</span>__layer_list)
        nameRepr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;name_list: &#34;</span><span style="color:#f92672">+</span> repr(self<span style="color:#f92672">.</span>__name_list)
        ntypeRepr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ntype: &#34;</span><span style="color:#f92672">+</span> repr(self<span style="color:#f92672">.</span>__ntype)
        <span style="color:#66d9ef">return</span> (layerRepr <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#f92672">+</span> nameRepr <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#f92672">+</span> ntypeRepr)
    
    
    <span style="color:#66d9ef">def</span> __str__(self):
        layerStr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;layer_list: &#34;</span><span style="color:#f92672">+</span> str(self<span style="color:#f92672">.</span>__layer_list)
        nameStr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;name_list: &#34;</span><span style="color:#f92672">+</span> str(self<span style="color:#f92672">.</span>__name_list)ntypeStr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ntype: &#34;</span><span style="color:#f92672">+</span> str(self<span style="color:#f92672">.</span>__ntype)
        <span style="color:#66d9ef">return</span> (layerStr <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#f92672">+</span> nameStr <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#f92672">+</span> ntypeStr)
</code></pre></div></div></details>
<p>###<code>__len__</code> method implementation
The <code>__len__</code> method describes the behavior when called from the <code>len</code> function, which is one of Python&rsquo;s built-in functions.
Make sure to return the number of layers that the <code>LayerManager</code> class has.</p>
<details><summary>`__len__` implementation</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py">    <span style="color:#66d9ef">def</span> __len__(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Describe the operation when called from Python&#39;s built-in function `len`.
</span><span style="color:#e6db74">        Returns the total number of layers by type.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>sum(self<span style="color:#f92672">.</span>__ntype)
</code></pre></div></div></summary>
<p>###<code>__getitem__</code> method implementation
The <code>__getitem__</code> method is a method that is called when you get an element by specifying the index etc. in a Python list or numpy array.</p>
<details><summary>`__getitem__` implementation</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py">    <span style="color:#66d9ef">def</span> __getitem__(self, key):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        For example
</span><span style="color:#e6db74">        lm = LayerManager()
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        | (Add element to lm) |
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        x = lm[3].~~
</span><span style="color:#e6db74">        Is called when a list or array element is accessed, like
</span><span style="color:#e6db74">        Describe the operation at that time.
</span><span style="color:#e6db74">        Only access with slice, str, int is allowed.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> isinstance(key, slice):
            If the <span style="color:#75715e"># key is a slice, refer to the layer list with slice.</span>
<span style="color:#75715e"># When an abnormal value (Index out of range etc.) is entered</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__layer_list[key]
        <span style="color:#66d9ef">elif</span> isinstance(key, str):
            If <span style="color:#75715e"># key is a string, get the index from the name list of each layer,</span>
            <span style="color:#75715e"># Returns the element of the list of the corresponding layer.</span>
            <span style="color:#66d9ef">if</span> key <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list:
                index <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>index(key)
                <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__layer_list[index]
            <span style="color:#66d9ef">else</span>:
                Raise <span style="color:#a6e22e">KeyError</span> <span style="color:#66d9ef">if</span> <span style="color:#75715e"># key does not exist.</span>
                <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(<span style="color:#e6db74">&#34;{}: No such item&#34;</span><span style="color:#f92672">.</span>format(key))
        <span style="color:#66d9ef">elif</span> isinstance(key, int):
            If <span style="color:#75715e">#key is an integer, the corresponding element in the layer list is returned.</span>
            <span style="color:#75715e"># When an abnormal value (Index out of range etc.) is entered</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__layer_list[key]
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(<span style="color:#e6db74">&#34;{}: Not defined such key type.&#34;</span><span style="color:#f92672">.</span>format(key))
</code></pre></div></div></details>
It's getting too long because I put too many comments...
<p>Implementation of ###<code>__setitem__</code> method
<code>__setitem__</code> is a method that is often used in the <code>Dictionary</code> type etc. and called when setting the <code>key</code> and <code>value</code> like <code>lm[key] = value</code>.
Only allow overwriting of elements, otherwise give an error.
The reason is that we will use the naming rule later, so we do not want users to register arbitrary <code>key</code>.</p>
<details><summary>`__setitem__` implementation</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py">    <span style="color:#66d9ef">def</span> __setitem__(self, key, value):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        For example
</span><span style="color:#e6db74">        lm = LayerManager()
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        | (Add element to lm) |
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        lm[1] = x
</span><span style="color:#e6db74">        Is called when a list or array element is accessed, like
</span><span style="color:#e6db74">        Describe the operation at that time.
</span><span style="color:#e6db74">        Only overwrite of elements is allowed, and addition of new elements is prohibited.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        value_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> isinstance(value, list):
            <span style="color:#75715e">#If the&#39;value&#39; specified on the right side is&#39;list&#39;</span>
            <span style="color:#75715e">#Error if all elements do not inherit&#39;BaseLayer&#39; class or it.</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> np<span style="color:#f92672">.</span>all(
                np<span style="color:#f92672">.</span>where(isinstance(value, BaseLayer), True, False)):
                self<span style="color:#f92672">.</span>AssignError()
            value_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;list&#34;</span>
        <span style="color:#66d9ef">elif</span> isinstance(value, BaseLayer):
            <span style="color:#75715e"># Is the&#39;value&#39; specified on the right side a&#39;BaseLayer&#39; class?</span>
            <span style="color:#75715e">#Error if not inheriting it.</span>
            self<span style="color:#f92672">.</span>AssignError(type(value))
        <span style="color:#66d9ef">if</span> value_type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span>:
            value_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BaseLayer&#34;</span>
            
        <span style="color:#66d9ef">if</span> isinstance(key, slice):
            If the <span style="color:#75715e"># key is a slice, overwrite the elements in the layer list.</span>
            <span style="color:#75715e"># However, if&#39;value_type&#39; is not&#39;list&#39;, it is an error.</span>
            <span style="color:#75715e"># When an abnormal value (Index out of range etc.) is entered</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">if</span> value_type <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;list&#34;</span>:
                self<span style="color:#f92672">.</span>AssignError(value_type)
            self<span style="color:#f92672">.</span>__layer_list[key] <span style="color:#f92672">=</span> value
        <span style="color:#66d9ef">elif</span> isinstance(key, str):
            If <span style="color:#75715e"># key is a string, get the index from the name list of each layer,</span>
            <span style="color:#75715e"># Overwrite the element of the list of the corresponding layer.</span>
            <span style="color:#75715e"># However, if&#39;value_type&#39; is not&#39;BaseLayer&#39;, it is an error.</span>
            <span style="color:#66d9ef">if</span> value_type <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;BaseLayer&#34;</span>:
                <span style="color:#66d9ef">raise</span> AssignError(value_type)
            <span style="color:#66d9ef">if</span> key <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list:
                index <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>index(key)
                self<span style="color:#f92672">.</span>__layer_list[index] <span style="color:#f92672">=</span> value
            <span style="color:#66d9ef">else</span>:
                Raise <span style="color:#a6e22e">KeyError</span> <span style="color:#66d9ef">if</span> <span style="color:#75715e"># key does not exist.</span>
                <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(<span style="color:#e6db74">&#34;{}: No such item&#34;</span><span style="color:#f92672">.</span>format(key))
        <span style="color:#66d9ef">elif</span> isinstance(key, int):
            If the <span style="color:#75715e"># key is an integer, overwrite the corresponding element in the layer list.</span>
            <span style="color:#75715e"># However, if&#39;value_type&#39; is not&#39;BaseLayer&#39;, it is an error.</span>
            <span style="color:#75715e"># If an abnormal value (such as Index out of range) is entered,</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">if</span> value_type <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;BaseLayer&#34;</span>:
                <span style="color:#66d9ef">raise</span> AssignError(value_type)
            self<span style="color:#f92672">.</span>__layer_list[key] <span style="color:#f92672">=</span> value
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(key, <span style="color:#e6db74">&#34;: Undefined such key type.&#34;</span>)
</code></pre></div></div></details>
<p>Implementation of ###<code>__delitem__</code> method
<code>__delitem__</code> is a method called by <code>del lm[key]</code> etc. This is just deleting the specified element.
However, the process after deletion is a little troublesome.</p>
<details><summary>`__delitem__` implementation</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py">    <span style="color:#66d9ef">def</span> __delitem__(self, key):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        For example
</span><span style="color:#e6db74">        lm = LayerManager()
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        | (Add element to lm) |
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        del lm[2]
</span><span style="color:#e6db74">        Like when a list or array element is accessed with a del statement,
</span><span style="color:#e6db74">        Describe the operation at that time.
</span><span style="color:#e6db74">        If the specified element exists, it will be deleted and renamed.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> isinstance(key, slice):
            If the <span style="color:#75715e"># key is a slice, delete the specified element as is</span>
            <span style="color:#75715e"># When an abnormal value (Index out of range etc.) is entered</span>
            <span style="color:#75715e"># Python gives me an error.del self.__layer_list[slice]</span>
            <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__name_list[slice]
        <span style="color:#66d9ef">elif</span> isinstance(key, str):
            If <span style="color:#75715e"># key is a string, get the index from the name list of each layer,</span>
            <span style="color:#75715e"># Delete the corresponding element.</span>
            <span style="color:#66d9ef">if</span> key <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list:
                <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__layer_list[index]
                <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__name_list[index]
            <span style="color:#66d9ef">else</span>:
                Raise <span style="color:#a6e22e">KeyError</span> <span style="color:#66d9ef">if</span> <span style="color:#75715e"># key does not exist.</span>
                <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(<span style="color:#e6db74">&#34;{}: No such item&#34;</span><span style="color:#f92672">.</span>format(key))
        <span style="color:#66d9ef">elif</span> isinstance(key, int):
            If the <span style="color:#75715e"># key is an integer, delete the corresponding element in the layer list.</span>
            <span style="color:#75715e"># When an abnormal value (Index out of range etc.) is entered</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__layer_list[key]
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(key, <span style="color:#e6db74">&#34;: Undefined such key type.&#34;</span>)
        
        <span style="color:#75715e">#Rename</span>
        self<span style="color:#f92672">.</span>_rename()
</code></pre></div></div></details>
The implementation itself is similar to `__getitem__`, etc., but regarding renaming, processing is thrown to another function `_rename`. It can be expected to be used in various places.
This completes the implementation of the special method. Other special methods do not need to be defined, so let's go through.
<h4 id="stagger">Stagger</h4>
<p>By the way, <code>_</code> (single underscore) means a weaker <code>private</code> attribute than <code>__</code> (double underscore). This can be accessed from the outside like <code>class name._rename</code>, but double underscore can be accessed only by saying <code>class name._module name__method name</code>. ..
Also, module functions that do not belong to the class cannot be imported using <code>from module name import *</code> if there is <code>private</code> specified by <code>_</code>. You need to properly call <code>from module name import _method name</code>.</p>
<h2 id="implementation-of-user-defined-method">Implementation of user-defined method</h2>
<p>Now we will implement the user-defined (that is, we define) function. Here, I will basically implement the famous features of the <code>List</code> type and <code>Dictionary</code> type.</p>
<p>###<code>_rename</code> method implementation
For now, implement the <code>_rename</code> method that appeared in the previous implementation.
When is this needed?</p>
<ul>
<li>Element is added in the middle</li>
<li>Intermediate elements are deleted</li>
</ul>
<p>There are two ways.
If you work hard and think about the logic, it seems that you can reduce the number of changes, but since it is troublesome, I will restart from the beginning. Easy to implement. **Maintenance is important. **</p>
<details><summary>`_rename` method implementation</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py">    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_rename</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        If the name manipulation of the name list violates the rules due to list manipulation
</span><span style="color:#e6db74">        Rename the naming list and each layer to meet the rules again.
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        The naming rule is [Type of layer] [How many].
</span><span style="color:#e6db74">        If the layer type is Middle, it is Middle
</span><span style="color:#e6db74">                     Output Layer is Output
</span><span style="color:#e6db74">        Abbreviated as.
</span><span style="color:#e6db74">        The number is counted by type.
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        In addition, __ntype is counted again here.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#75715e"># Initialize the number of layers by type</span>
        self<span style="color:#f92672">.</span>__ntype <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(self<span style="color:#f92672">.</span>N_TYPE)
        
        <span style="color:#75715e"># Recount and rename each layer</span>
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(self)):
            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;Middle&#34;</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list[i]:
                self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>MIDDLE] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                self<span style="color:#f92672">.</span>__name_list[i] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Middle{}&#34;</span><span style="color:#f92672">.</span>format(
                        self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>MIDDLE])
                self<span style="color:#f92672">.</span>__layer_list[i]<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Middle{}&#34;</span><span style="color:#f92672">.</span>format(
                        self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>MIDDLE])
            <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#34;Output&#34;</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list[i]:
                self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>OUTPUT] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                self<span style="color:#f92672">.</span>__name_list[i] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Output{}&#34;</span><span style="color:#f92672">.</span>format(
                        self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>OUTPUT])
                self<span style="color:#f92672">.</span>__layer_list[i]<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Output{}&#34;</span><span style="color:#f92672">.</span>format(
                        self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>OUTPUT])
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">raise</span> UndefinedLayerType(self<span style="color:#f92672">.</span>__name_list[i])
</code></pre></div></div></details>
I also rename each layer, because I think that I should give the layer a `name` property as well.
I feel that it is convenient when generating an error statement. You may erase it if you do not need it.
<p>###<code>append</code> method implementation
Implement the familiar <code>append</code> method for adding elements to a list. Since it is added at the end, there is no such complicated processing.</p>
<details><summary>`append` method implementation</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py">    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">append</span>(self, <span style="color:#f92672">*</span>, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Middle&#34;</span>, <span style="color:#f92672">**</span>kwds):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Implementation of the append method that is familiar with methods for adding elements to a list.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;prev&#34;</span> <span style="color:#f92672">in</span> kwds:
            If <span style="color:#75715e">#&#39;prev&#39; is included in the keyword,</span>
            <span style="color:#75715e"># You have specified the number of elements in the previous layer.</span>
            <span style="color:#75715e"># Basically it is supposed to insert the first layer, so</span>
            <span style="color:#75715e">#Other than that, basically it is decided automatically, so it is not specified.</span>
            <span style="color:#66d9ef">if</span> len(self) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
                <span style="color:#66d9ef">if</span> kwds[<span style="color:#e6db74">&#34;prev&#34;</span>] <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n:
                    <span style="color:#75715e"># Error if the number of units at the end does not match.</span>
                    <span style="color:#66d9ef">raise</span> UnmatchUnitError(self<span style="color:#f92672">.</span>__layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n,
                                           kwds[<span style="color:#e6db74">&#34;prev&#34;</span>])
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">if</span> len(self) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
                    <span style="color:#75715e"># The first layer must always specify the number of input units.</span>
                    <span style="color:#66d9ef">raise</span> UnmatchUnitError(<span style="color:#e6db74">&#34;Input units&#34;</span>, <span style="color:#e6db74">&#34;Unspecified&#34;</span>)
                <span style="color:#66d9ef">else</span>:
                    <span style="color:#75715e"># Add the number of units of the last layer to&#39;kwds&#39;</span>
                    kwds[<span style="color:#e6db74">&#34;prev&#34;</span>] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n
            
            <span style="color:#75715e"># Read the layer type and change the name according to the naming rules</span>
            <span style="color:#66d9ef">if</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;mid&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;m&#34;</span>:
                name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Middle&#34;</span>
            <span style="color:#66d9ef">elif</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;out&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;o&#34;</span>:
                name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Output&#34;</span>
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">raise</span> UndefinedLayerError(name)
            
            <span style="color:#75715e"># Add a layer.</span>
            <span style="color:#66d9ef">if</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Middle&#34;</span>:
                <span style="color:#75715e"># Increment layers by type</span>
                self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>MIDDLE] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                <span style="color:#75715e"># Add to name</span>
                name <span style="color:#f92672">+=</span> str(self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>MIDDLE])
                <span style="color:#75715e"># Add to namelist</span>
                self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>append(name)
                <span style="color:#75715e"># Finally, generate the layer and add it to the list.</span>
                self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>append(
                        MiddleLayer(name<span style="color:#f92672">=</span>name, <span style="color:#f92672">**</span>kwds))
            <span style="color:#66d9ef">elif</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Output&#34;</span>:
                <span style="color:#75715e">#This is also the same.</span>
                self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>OUTPUT] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                name <span style="color:#f92672">+=</span> str(self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>OUTPUT])
                self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>append(name)
                self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>append(
                        OutputLayer(name<span style="color:#f92672">=</span>name, <span style="color:#f92672">**</span>kwds))<span style="color:#75715e">#Change the name that does not draw the else sentence according to the naming rule</span>
            This <span style="color:#f92672">is</span> because the abnormal<span style="color:#e6db74">&#39;name&#39;</span> has already been omitted <span style="color:#f92672">in</span> the <span style="color:#75715e"># stage.</span>
</code></pre></div></div></details>
<p>###<code>extend</code> method implementation
This may be unfamiliar? Implement the <code>extend</code> method of <code>List</code>.</p>
<details><summary>`extend` method description</summary><div>
The `extend` method is basically a method for joining a list to a list.
For example
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-example.py" data-lang="example.py">x <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]
y <span style="color:#f92672">=</span> [<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>]
x<span style="color:#f92672">.</span>append(y)
<span style="color:#66d9ef">print</span>(x)
</code></pre></div><p>Then,</p>
<pre><code class="language-console" data-lang="console">[1, 2, 3, [4, 5, 6]]
</code></pre><p>I think it will be like. Using the <code>extend</code> method</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-example.py" data-lang="example.py">x <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]
y <span style="color:#f92672">=</span> [<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>]
x<span style="color:#f92672">.</span>extend(y)
<span style="color:#66d9ef">print</span>(x)
</code></pre></div><p>Results in</p>
<pre><code class="language-console" data-lang="console">[1, 2, 3, 4, 5, 6]
</code></pre><p>Will be.</p>
</div></details>
I will implement it.
<details><summary>`extend` method implementation</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py">    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extend</span>(self, lm):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        In the extend method, the element of another layer manager&#39;lm&#39; that already exists
</span><span style="color:#e6db74">        Add all.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#f92672">is</span> instance(lm, LayerManager):
            Error <span style="color:#66d9ef">if</span> <span style="color:#75715e">#&#39;lm&#39; instance is not LayerManager.</span>
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">TypeError</span>(type(lm), <span style="color:#e6db74">&#34;: Unexpected type.&#34;</span>)
        <span style="color:#66d9ef">if</span> len(self) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>__layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n <span style="color:#f92672">!=</span> lm[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>prev:
                <span style="color:#75715e"># With the number of units in my last layer</span>
                Error <span style="color:#66d9ef">if</span> the input number of the first layer of <span style="color:#75715e">#&#39;lm&#39; does not match.</span>
                <span style="color:#66d9ef">raise</span> UnmatchUnitError(self<span style="color:#f92672">.</span>__layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n,
                                       lm[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>prev)
        
        <span style="color:#75715e"># Add each with&#39;extend&#39; method</span>
        self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>extend(lm<span style="color:#f92672">.</span>layer_list)
        self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>extend(lm<span style="color:#f92672">.</span>name_list)
        
        <span style="color:#75715e">#Rename</span>
        self<span style="color:#f92672">.</span>_rename()
</code></pre></div></div></details>
There are `lm.layer_list` and `lm.name_list` in the code, but these are implemented as properties (`getter`) using the `property` decorator described later.
<p>###<code>insert</code> method implementation
This too may not be familiar to you. This method adds an element at the specified position.</p>
<details><summary>`insert` method implementation</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py">    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">insert</span>(self, prev_name, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Middle&#34;</span>, <span style="color:#f92672">**</span>kwds):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        In the insert method, specify the name of the previous layer and merge it with that layer
</span><span style="color:#e6db74">        Add an element.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        Error <span style="color:#66d9ef">if</span> <span style="color:#75715e">#&#39;prev_name&#39; does not exist.</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> prev_name <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(prev_name, <span style="color:#e6db74">&#34;: No such key.&#34;</span>)
        If <span style="color:#75715e">#&#39;prev&#39; is included in the keyword,</span>
        Error <span style="color:#66d9ef">if</span> it does <span style="color:#f92672">not</span> match the number of units of the layer specified by <span style="color:#75715e">#&#39;prev_name&#39;.</span>
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;prev&#34;</span> <span style="color:#f92672">in</span> kwds:
            <span style="color:#66d9ef">if</span> kwds[<span style="color:#e6db74">&#34;prev&#34;</span>] \
                <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)]<span style="color:#f92672">.</span>n:
                <span style="color:#66d9ef">raise</span> UnmatchUnitError(
                    kwds[<span style="color:#e6db74">&#34;prev&#34;</span>],
                    self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)]<span style="color:#f92672">.</span>n)
        If <span style="color:#75715e">#&#39;n&#39; is included in the keyword,</span>
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;n&#34;</span> <span style="color:#f92672">in</span> kwds:
            If <span style="color:#75715e">#&#39;prev_name&#39; is not at the end</span>
            <span style="color:#66d9ef">if</span> prev_name <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__name_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]:
                <span style="color:#75715e">#Error if the number of units in the next layer does not match.</span>
                <span style="color:#66d9ef">if</span> kwds[<span style="color:#e6db74">&#34;n&#34;</span>] <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__layer_list[
                        self<span style="color:#f92672">.</span>index(prev_name)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>prev:
                    <span style="color:#66d9ef">raise</span> UnmatchUnitError(
                        kwds[<span style="color:#e6db74">&#34;n&#34;</span>],
                        self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)]<span style="color:#f92672">.</span>prev)
        <span style="color:#75715e"># Produce an error to use the&#39;append&#39; method if there are no elements yet.</span>
        <span style="color:#66d9ef">if</span> len(self) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">RuntimeError</span>(
                <span style="color:#e6db74">&#34;You have to use&#39;append&#39; method instead.&#34;</span>)
        
        <span style="color:#75715e"># Get index of insert location</span>
        index <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>index(prev_name) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
        
        <span style="color:#75715e"># Read the layer type and change the name according to the naming rules</span>
        <span style="color:#66d9ef">if</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;mid&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;m&#34;</span>:
            name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Middle&#34;</span>
        <span style="color:#66d9ef">elif</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;out&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;o&#34;</span>:
            name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Output&#34;</span>
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">raise</span> UndefinedLayerError(name)
        
        Insert <span style="color:#75715e"># element</span>
        <span style="color:#75715e">#At this time,&#39;name&#39; does not follow the naming rules yet,</span>
        <span style="color:#75715e"># Don&#39;t worry as it will be renamed later.</span>
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;Middle&#34;</span> <span style="color:#f92672">in</span> name:
            self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>insert(index,
                                     MiddleLayer(name<span style="color:#f92672">=</span>name, <span style="color:#f92672">**</span>kwds))
            self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>insert(index, name)
        <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#34;Output&#34;</span> <span style="color:#f92672">in</span> name:
            self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>insert(index,
                                     OutputLayer(name<span style="color:#f92672">=</span>name, <span style="color:#f92672">**</span>kwds))
            self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>insert(index, name)
        
        <span style="color:#75715e">#Rename</span>
        self<span style="color:#f92672">.</span>_rename()
</code></pre></div></div></details>
<p>Implementing ###<code>extend_insert</code> method
This is the original. It behaves like a combination of the <code>extend</code> method and the <code>insert</code> method.</p>
<details><summary>`extend_insert` method implementation</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py">    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extend_insert</span>(self, prev_name, lm):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Here is the original function.
</span><span style="color:#e6db74">        It behaves like a combination of extend and insert methods.
</span><span style="color:#e6db74">        In short, it&#39;s like inserting another layer manager.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#f92672">is</span> instance(lm, LayerManager):
            Error <span style="color:#66d9ef">if</span> <span style="color:#75715e">#&#39;lm&#39; instance is not LayerManager.</span>
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">TypeError</span>(type(lm), <span style="color:#e6db74">&#34;: Unexpected type.&#34;</span>)
        Error <span style="color:#66d9ef">if</span> <span style="color:#75715e">#&#39;prev_name&#39; does not exist.</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> prev_name <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(prev_name, <span style="color:#e6db74">&#34;: No such key.&#34;</span>)
        <span style="color:#75715e"># The number of units of the layers before and after the specified location and the first and last layers of lm</span>
        <span style="color:#75715e"># Error if they do not match.</span>
        <span style="color:#66d9ef">if</span> len(self) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)]<span style="color:#f92672">.</span>n \
                    <span style="color:#f92672">!=</span> lm<span style="color:#f92672">.</span>layer_list[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>prev:
                <span style="color:#75715e"># The number of units in your designated location and the first unit of&#39;lm&#39;</span>
                <span style="color:#75715e"># Error if they do not match.</span>
                <span style="color:#66d9ef">raise</span> UnmatchUnitError(
                    self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)]<span style="color:#f92672">.</span>n,
                    lm<span style="color:#f92672">.</span>layer_list[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>prev)
            <span style="color:#66d9ef">if</span> prev_name <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__name_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]:
                <span style="color:#75715e">#&#39;prev_name&#39; is not my last layer</span>
                <span style="color:#66d9ef">if</span> lm<span style="color:#f92672">.</span>layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n \
                    <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>prev:The number of units at the end of <span style="color:#75715e">#&#39;lm&#39; and the layer next to your designated location</span>
                    <span style="color:#75715e">#&#39;prev&#39; Error if it does not match the number of units.</span>
                    <span style="color:#66d9ef">raise</span> UnmatchUnitError(
                        lm<span style="color:#f92672">.</span>layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n,
                        self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>prev)
        <span style="color:#66d9ef">else</span>:
            <span style="color:#75715e"># Raise an error to use the&#39;extend&#39; method if you don&#39;t have any elements.</span>
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">RuntimeError</span>(
                <span style="color:#e6db74">&#34;You have to use&#39;extend&#39; method instead.&#34;</span>)
        
        <span style="color:#75715e"># Get index of insert location</span>
        index <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>index(prev_name) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
        
        <span style="color:#75715e"># Evacuate the elements after the insertion point to&#39;buf&#39;, then remove it once,</span>
        Add elements using the <span style="color:#75715e"># extend method</span>
        layer_buf <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__layer_list[index:]
        name_buf <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__name_list[index:]
        <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__layer_list[index:]
        <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__name_list[index:]
        self<span style="color:#f92672">.</span>extend(lm)
        
        <span style="color:#75715e"># Add elements that were evacuated</span>
        self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>extend(layer_buf)
        self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>extend(name_buf)
        
        <span style="color:#75715e">#Rename</span>
        self<span style="color:#f92672">.</span>_rename()
</code></pre></div></div></details>
It may seem a bit complicated, but the thing itself is simple. Maybe there is a simpler way of writing...
<h3 id="implementation-of-remove-method">Implementation of <code>remove</code> method</h3>
<p>The <code>remove</code> method removes the specified element, isn&rsquo;t it?
This is already done in <a href="Implementationof#__delitem__method">Implementation of del statement</a>, so I just call it.</p>
<details><summary>`remove` method implementation</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py">    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">remove</span>(self, key):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        The remove method removes the element with the specified name.
</span><span style="color:#e6db74">        Specification by index is also allowed.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#75715e"># The&#39;del&#39; statement already implemented is OK.</span>
        <span style="color:#66d9ef">del</span> self[key]
</code></pre></div></div></details>
<h3 id="implementation-of-other-methods">Implementation of other methods</h3>
<p>Other than the above, it is a convenient method list.</p>
<details><summary>Convenient method implementation</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py">    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">index</span>(self, target):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>index(target)
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>(self, indices):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__name_list[indices]
</code></pre></div></div></details>
<p>###Propertyimplementation
We will implement the properties here. Basically, only <code>getter</code> is needed, so it is implemented by decorating with <code>@property</code>.
If you want to add <code>setter</code>, you can use <code>@propertyname.setter</code> decorator.</p>
<details><summary>property implementation</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py">    <span style="color:#a6e22e">@property</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">layer_list</span>(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__layer_list
    
    
    <span style="color:#a6e22e">@property</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name_list</span>(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__name_list
    
    
    <span style="color:#a6e22e">@property</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ntype</span>(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__ntype
</code></pre></div></div></details>
<h3 id="full-code">Full code</h3>
<p>The layer manager code so far will be integrated and posted as a full text.
Of course, we will add methods etc. in future articles.</p>
<details><summary>layermanager.py</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np


<span style="color:#75715e">#from .layer import *</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">_TypeManager</span>():
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Manager class for layer types
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    N_TYPE <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#75715e"># Number of layer types</span>
    
    MIDDLE <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># Middle layer numbering</span>
    OUTPUT <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e"># Output layer numbering</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LayerManager</span>(_TypeManager):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Manager class for managing layers
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    <span style="color:#66d9ef">def</span> __init__(self):
        self<span style="color:#f92672">.</span>__layer_list <span style="color:#f92672">=</span> [] <span style="color:#75715e"># list of layers</span>
        self<span style="color:#f92672">.</span>__name_list <span style="color:#f92672">=</span> [] <span style="color:#75715e"># name list for each layer</span>
        self<span style="color:#f92672">.</span>__ntype <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(self<span style="color:#f92672">.</span>N_TYPE) <span style="color:#75715e"># Number of layers by type</span>
    
    
    <span style="color:#66d9ef">def</span> __repr__(self):
        layerRepr<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;layer_list: &#34;</span><span style="color:#f92672">+</span> repr(self<span style="color:#f92672">.</span>__layer_list)
        nameRepr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;name_list: &#34;</span><span style="color:#f92672">+</span> repr(self<span style="color:#f92672">.</span>__name_list)
        ntypeRepr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ntype: &#34;</span><span style="color:#f92672">+</span> repr(self<span style="color:#f92672">.</span>__ntype)
        <span style="color:#66d9ef">return</span> (layerRepr <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#f92672">+</span> nameRepr <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#f92672">+</span> ntypeRepr)
    
    
    <span style="color:#66d9ef">def</span> __str__(self):
        layerStr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;layer_list: &#34;</span><span style="color:#f92672">+</span> str(self<span style="color:#f92672">.</span>__layer_list)
        nameStr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;name_list: &#34;</span><span style="color:#f92672">+</span> str(self<span style="color:#f92672">.</span>__name_list)
        ntypeStr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ntype: &#34;</span><span style="color:#f92672">+</span> str(self<span style="color:#f92672">.</span>__ntype)
        <span style="color:#66d9ef">return</span> (layerStr <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#f92672">+</span> nameStr <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#f92672">+</span> ntypeStr)
    
    
    <span style="color:#66d9ef">def</span> __len__(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Describe the operation when called from Python&#39;s built-in function `len`.
</span><span style="color:#e6db74">        Returns the total number of layers by type.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>sum(self<span style="color:#f92672">.</span>__ntype)
    
    
    <span style="color:#66d9ef">def</span> __getitem__(self, key):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        For example
</span><span style="color:#e6db74">        lm = LayerManager()
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        | (Add element to lm) |
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        x = lm[3].~~
</span><span style="color:#e6db74">        Is called when a list or array element is accessed, like
</span><span style="color:#e6db74">        Describe the operation at that time.
</span><span style="color:#e6db74">        Only access with slice, str, int is allowed.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> isinstance(key, slice):
            If the <span style="color:#75715e"># key is a slice, refer to the layer list with slice.</span>
            <span style="color:#75715e"># When an abnormal value (Index out of range etc.) is entered</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__layer_list[key]
        <span style="color:#66d9ef">elif</span> isinstance(key, str):
            If <span style="color:#75715e"># key is a string, get the index from the name list of each layer,</span>
            <span style="color:#75715e"># Returns the element of the list of the corresponding layer.</span>
            <span style="color:#66d9ef">if</span> key <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list:
                index <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>index(key)
                <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__layer_list[index]
            <span style="color:#66d9ef">else</span>:
                Raise <span style="color:#a6e22e">KeyError</span> <span style="color:#66d9ef">if</span> <span style="color:#75715e"># key does not exist.</span>
                <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(<span style="color:#e6db74">&#34;{}: No such item&#34;</span><span style="color:#f92672">.</span>format(key))
        <span style="color:#66d9ef">elif</span> isinstance(key, int):
            If <span style="color:#75715e">#key is an integer, the corresponding element in the layer list is returned.</span>
            <span style="color:#75715e"># When an abnormal value (Index out of range etc.) is entered</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__layer_list[key]
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(key, <span style="color:#e6db74">&#34;: Undefined such key type.&#34;</span>)
    
    
    <span style="color:#66d9ef">def</span> __setitem__(self, key, value):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        For example
</span><span style="color:#e6db74">        lm = LayerManager()
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        | (Add element to lm) |
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        lm[1] = x
</span><span style="color:#e6db74">        Is called when a list or array element is accessed, like
</span><span style="color:#e6db74">        Describe the operation at that time.
</span><span style="color:#e6db74">        Only overwrite of elements is allowed, and addition of new elements is prohibited.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        value_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> isinstance(value, list):<span style="color:#75715e">#If the&#39;value&#39; specified on the right side is&#39;list&#39;</span>
            <span style="color:#75715e">#Error if all elements do not inherit&#39;BaseLayer&#39; class or it.</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> np<span style="color:#f92672">.</span>all(
                np<span style="color:#f92672">.</span>where(isinstance(value, BaseLayer), True, False)):
                self<span style="color:#f92672">.</span>AssignError()
            value_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;list&#34;</span>
        <span style="color:#66d9ef">elif</span> isinstance(value, BaseLayer):
            <span style="color:#75715e"># Is the&#39;value&#39; specified on the right side a&#39;BaseLayer&#39; class?</span>
            <span style="color:#75715e">#Error if not inheriting it.</span>
            self<span style="color:#f92672">.</span>AssignError(type(value))
        <span style="color:#66d9ef">if</span> value_type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span>:
            value_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BaseLayer&#34;</span>
            
        <span style="color:#66d9ef">if</span> isinstance(key, slice):
            If the <span style="color:#75715e"># key is a slice, overwrite the elements in the layer list.</span>
            <span style="color:#75715e"># However, if&#39;value_type&#39; is not&#39;list&#39;, it is an error.</span>
            <span style="color:#75715e"># When an abnormal value (Index out of range etc.) is entered</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">if</span> value_type <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;list&#34;</span>:
                self<span style="color:#f92672">.</span>AssignError(value_type)
            self<span style="color:#f92672">.</span>__layer_list[key] <span style="color:#f92672">=</span> value
        <span style="color:#66d9ef">elif</span> isinstance(key, str):
            If <span style="color:#75715e"># key is a string, get the index from the name list of each layer,</span>
            <span style="color:#75715e"># Overwrite the element of the list of the corresponding layer.</span>
            <span style="color:#75715e"># However, if&#39;value_type&#39; is not&#39;BaseLayer&#39;, it is an error.</span>
            <span style="color:#66d9ef">if</span> value_type <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;BaseLayer&#34;</span>:
                <span style="color:#66d9ef">raise</span> AssignError(value_type)
            <span style="color:#66d9ef">if</span> key <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list:
                index <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>index(key)
                self<span style="color:#f92672">.</span>__layer_list[index] <span style="color:#f92672">=</span> value
            <span style="color:#66d9ef">else</span>:
                Raise <span style="color:#a6e22e">KeyError</span> <span style="color:#66d9ef">if</span> <span style="color:#75715e"># key does not exist.</span>
                <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(<span style="color:#e6db74">&#34;{}: No such item&#34;</span><span style="color:#f92672">.</span>format(key))
        <span style="color:#66d9ef">elif</span> isinstance(key, int):
            If the <span style="color:#75715e"># key is an integer, overwrite the corresponding element in the layer list.</span>
            <span style="color:#75715e"># However, if&#39;value_type&#39; is not&#39;BaseLayer&#39;, it is an error.</span>
            <span style="color:#75715e"># If an abnormal value (such as Index out of range) is entered,</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">if</span> value_type <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;BaseLayer&#34;</span>:
                <span style="color:#66d9ef">raise</span> AssignError(value_type)
            self<span style="color:#f92672">.</span>__layer_list[key] <span style="color:#f92672">=</span> value
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(key, <span style="color:#e6db74">&#34;: Undefined such key type.&#34;</span>)
    
    
    <span style="color:#66d9ef">def</span> __delitem__(self, key):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        For example
</span><span style="color:#e6db74">        lm = LayerManager()
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        | (Add element to lm) |
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        del lm[2]
</span><span style="color:#e6db74">        Like when a list or array element is accessed with a del statement,
</span><span style="color:#e6db74">        Describe the operation at that time.
</span><span style="color:#e6db74">        If the specified element exists, it will be deleted and renamed.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> isinstance(key, slice):
            If the <span style="color:#75715e"># key is a slice, delete the specified element as is</span>
            <span style="color:#75715e"># When an abnormal value (Index out of range etc.) is entered</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__layer_list[slice]
            <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__name_list[slice]
        <span style="color:#66d9ef">elif</span> isinstance(key, str):
            If <span style="color:#75715e"># key is a string, get the index from the name list of each layer,</span>
            <span style="color:#75715e"># Delete the corresponding element.</span>
            <span style="color:#66d9ef">if</span> key <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list:
                <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__layer_list[index]
                <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__name_list[index]
            <span style="color:#66d9ef">else</span>:
                Raise <span style="color:#a6e22e">KeyError</span> <span style="color:#66d9ef">if</span> <span style="color:#75715e"># key does not exist.</span>
                <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(<span style="color:#e6db74">&#34;{}: No such item&#34;</span><span style="color:#f92672">.</span>format(key))
        <span style="color:#66d9ef">elif</span> isinstance(key, int):
            If the <span style="color:#75715e"># key is an integer, delete the corresponding element in the layer list.</span>
            <span style="color:#75715e"># When an abnormal value (Index out of range etc.) is entered</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__layer_list[key]
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(key, <span style="color:#e6db74">&#34;: Undefined such key type.&#34;</span>)
        
        <span style="color:#75715e">#Rename</span>
        self<span style="color:#f92672">.</span>_rename()
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_rename</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        If the name manipulation of the name list violates the rules due to list manipulation
</span><span style="color:#e6db74">        Rename the naming list and each layer to meet the rules again.
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        The naming rule is [Type of layer] [How many].
</span><span style="color:#e6db74">        If the layer type is Middle, it is Middle
</span><span style="color:#e6db74">                     Output Layer is Output
</span><span style="color:#e6db74">        Abbreviated as.
</span><span style="color:#e6db74">        The number is counted by type.
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        In addition, __ntype is counted again here.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#75715e"># Initialize the number of layers by type</span>
        self<span style="color:#f92672">.</span>__ntype <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(self<span style="color:#f92672">.</span>N_TYPE)
        
        <span style="color:#75715e"># Recount and rename each layer</span>
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(self)):
            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;Middle&#34;</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list[i]:
                self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>MIDDLE] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                self<span style="color:#f92672">.</span>__name_list[i] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Middle{}&#34;</span><span style="color:#f92672">.</span>format(
                        self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>MIDDLE])
                self<span style="color:#f92672">.</span>__layer_list[i]<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Middle{}&#34;</span><span style="color:#f92672">.</span>format(
                        self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>MIDDLE])
            <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#34;Output&#34;</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list[i]:
                self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>OUTPUT] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                self<span style="color:#f92672">.</span>__name_list[i] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Output{}&#34;</span><span style="color:#f92672">.</span>format(
                        self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>OUTPUT])
                self<span style="color:#f92672">.</span>__layer_list[i]<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Output{}&#34;</span><span style="color:#f92672">.</span>format(
                        self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>OUTPUT])
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">raise</span> UndefinedLayerType(self<span style="color:#f92672">.</span>__name_list[i])
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">append</span>(self, <span style="color:#f92672">*</span>, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Middle&#34;</span>, <span style="color:#f92672">**</span>kwds):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Implementation of the append method that is familiar with methods for adding elements to a list.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;prev&#34;</span> <span style="color:#f92672">in</span> kwds:
            If <span style="color:#75715e">#&#39;prev&#39; is included in the keyword,</span>
            <span style="color:#75715e"># You have specified the number of elements in the previous layer.</span>
            <span style="color:#75715e"># Basically it is supposed to insert the first layer, so</span>
            <span style="color:#75715e">#Other than that, basically it is decided automatically, so it is not specified.</span>
            <span style="color:#66d9ef">if</span> len(self) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
                <span style="color:#66d9ef">if</span> kwds[<span style="color:#e6db74">&#34;prev&#34;</span>] <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n:
                    <span style="color:#75715e"># Error if the number of units at the end does not match.</span>
                    <span style="color:#66d9ef">raise</span> UnmatchUnitError(self<span style="color:#f92672">.</span>__layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n,
                                           kwds[<span style="color:#e6db74">&#34;prev&#34;</span>])
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">if</span> len(self) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
                    <span style="color:#75715e"># The first layer must always specify the number of input units.</span>
                    <span style="color:#66d9ef">raise</span> UnmatchUnitError(<span style="color:#e6db74">&#34;Input units&#34;</span>, <span style="color:#e6db74">&#34;Unspecified&#34;</span>)<span style="color:#66d9ef">else</span>:
                    <span style="color:#75715e"># Add the number of units of the last layer to&#39;kwds&#39;</span>
                    kwds[<span style="color:#e6db74">&#34;prev&#34;</span>] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n
            
            <span style="color:#75715e"># Read the layer type and change the name according to the naming rules</span>
            <span style="color:#66d9ef">if</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;mid&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;m&#34;</span>:
                name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Middle&#34;</span>
            <span style="color:#66d9ef">elif</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;out&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;o&#34;</span>:
                name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Output&#34;</span>
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">raise</span> UndefinedLayerError(name)
            
            <span style="color:#75715e"># Add a layer.</span>
            <span style="color:#66d9ef">if</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Middle&#34;</span>:
                <span style="color:#75715e"># Increment layers by type</span>
                self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>MIDDLE] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                <span style="color:#75715e"># Add to name</span>
                name <span style="color:#f92672">+=</span> str(self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>MIDDLE])
                <span style="color:#75715e"># Add to namelist</span>
                self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>append(name)
                <span style="color:#75715e"># Finally, generate the layer and add it to the list.</span>
                self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>append(
                        MiddleLayer(name<span style="color:#f92672">=</span>name, <span style="color:#f92672">**</span>kwds))
            <span style="color:#66d9ef">elif</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Output&#34;</span>:
                <span style="color:#75715e">#This is also the same.</span>
                self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>OUTPUT] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                name <span style="color:#f92672">+=</span> str(self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>OUTPUT])
                self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>append(name)
                self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>append(
                        OutputLayer(name<span style="color:#f92672">=</span>name, <span style="color:#f92672">**</span>kwds))
            <span style="color:#75715e">#Change the name that does not draw the else sentence according to the naming rule</span>
            This <span style="color:#f92672">is</span> because the abnormal<span style="color:#e6db74">&#39;name&#39;</span> has already been omitted <span style="color:#f92672">in</span> the <span style="color:#75715e"># stage.</span>
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extend</span>(self, lm):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        In the extend method, the element of another layer manager&#39;lm&#39; that already exists
</span><span style="color:#e6db74">        Add all.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#f92672">is</span> instance(lm, LayerManager):
            Error <span style="color:#66d9ef">if</span> <span style="color:#75715e">#&#39;lm&#39; instance is not LayerManager.</span>
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">TypeError</span>(type(lm), <span style="color:#e6db74">&#34;: Unexpected type.&#34;</span>)
        <span style="color:#66d9ef">if</span> len(self) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>__layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n <span style="color:#f92672">!=</span> lm[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>prev:
                <span style="color:#75715e"># With the number of units in my last layer</span>
                Error <span style="color:#66d9ef">if</span> the input number of the first layer of <span style="color:#75715e">#&#39;lm&#39; does not match.</span>
                <span style="color:#66d9ef">raise</span> UnmatchUnitError(self<span style="color:#f92672">.</span>__layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n,
                                       lm[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>prev)
        
        <span style="color:#75715e"># Add each with&#39;extend&#39; method</span>
        self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>extend(lm<span style="color:#f92672">.</span>layer_list)
        self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>extend(lm<span style="color:#f92672">.</span>name_list)
        
        <span style="color:#75715e">#Rename</span>
        self<span style="color:#f92672">.</span>_rename()
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">insert</span>(self, prev_name, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Middle&#34;</span>, <span style="color:#f92672">**</span>kwds):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        In the insert method, specify the name of the previous layer and merge it with that layer
</span><span style="color:#e6db74">        Add an element.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        Error <span style="color:#66d9ef">if</span> <span style="color:#75715e">#&#39;prev_name&#39; does not exist.</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> prev_name <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(prev_name, <span style="color:#e6db74">&#34;: No such key.&#34;</span>)
        If <span style="color:#75715e">#&#39;prev&#39; is included in the keyword,</span>
        Error <span style="color:#66d9ef">if</span> it does <span style="color:#f92672">not</span> match the number of units of the layer specified by <span style="color:#75715e">#&#39;prev_name&#39;.</span>
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;prev&#34;</span> <span style="color:#f92672">in</span> kwds:
            <span style="color:#66d9ef">if</span> kwds[<span style="color:#e6db74">&#34;prev&#34;</span>] \
                <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)]<span style="color:#f92672">.</span>n:
                <span style="color:#66d9ef">raise</span> UnmatchUnitError(
                    kwds[<span style="color:#e6db74">&#34;prev&#34;</span>],
                    self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)]<span style="color:#f92672">.</span>n)
        If <span style="color:#75715e">#&#39;n&#39; is included in the keyword,</span>
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;n&#34;</span> <span style="color:#f92672">in</span> kwds:
            If <span style="color:#75715e">#&#39;prev_name&#39; is not at the end</span>
            <span style="color:#66d9ef">if</span> prev_name <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__name_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]:
                <span style="color:#75715e">#Error if the number of units in the next layer does not match.</span>
                <span style="color:#66d9ef">if</span> kwds[<span style="color:#e6db74">&#34;n&#34;</span>] <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__layer_list[
                        self<span style="color:#f92672">.</span>index(prev_name)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>prev:
                    <span style="color:#66d9ef">raise</span> UnmatchUnitError(
                        kwds[<span style="color:#e6db74">&#34;n&#34;</span>],
                        self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)]<span style="color:#f92672">.</span>prev)
        <span style="color:#75715e"># Produce an error to use the&#39;append&#39; method if there are no elements yet.</span>
        <span style="color:#66d9ef">if</span> len(self) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">RuntimeError</span>(
                <span style="color:#e6db74">&#34;You have to use&#39;append&#39; method instead.&#34;</span>)
        
        <span style="color:#75715e"># Get index of insert location</span>
        index <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>index(prev_name) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
        
        <span style="color:#75715e"># Read the layer type and change the name according to the naming rules</span>
        <span style="color:#66d9ef">if</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;mid&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;m&#34;</span>:
            name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Middle&#34;</span>
        <span style="color:#66d9ef">elif</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;out&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;o&#34;</span>:
            name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Output&#34;</span>
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">raise</span> UndefinedLayerError(name)
        
        Insert <span style="color:#75715e"># element</span>
        <span style="color:#75715e">#At this time,&#39;name&#39; does not follow the naming rules yet,</span>
        <span style="color:#75715e"># Don&#39;t worry as it will be renamed later.</span>
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;Middle&#34;</span> <span style="color:#f92672">in</span> name:
            self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>insert(index,
                                     MiddleLayer(name<span style="color:#f92672">=</span>name, <span style="color:#f92672">**</span>kwds))
            self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>insert(index, name)
        <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#34;Output&#34;</span> <span style="color:#f92672">in</span> name:
            self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>insert(index,
                                     OutputLayer(name<span style="color:#f92672">=</span>name, <span style="color:#f92672">**</span>kwds))
            self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>insert(index, name)
        
        <span style="color:#75715e">#Rename</span>
        self<span style="color:#f92672">.</span>_rename()
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extend_insert</span>(self, prev_name, lm):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Here is the original function.
</span><span style="color:#e6db74">        It behaves like a combination of extend and insert methods.
</span><span style="color:#e6db74">        In short, it&#39;s like inserting another layer manager.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#f92672">is</span> instance(lm, LayerManager):
            Error <span style="color:#66d9ef">if</span> <span style="color:#75715e">#&#39;lm&#39; instance is not LayerManager.</span>
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">TypeError</span>(type(lm), <span style="color:#e6db74">&#34;: Unexpected type.&#34;</span>)
        Error <span style="color:#66d9ef">if</span> <span style="color:#75715e">#&#39;prev_name&#39; does not exist.</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> prev_name <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(prev_name, <span style="color:#e6db74">&#34;: No such key.&#34;</span>)
        <span style="color:#75715e"># The number of units of the layers before and after the specified location and the first and last layers of lm</span>
        <span style="color:#75715e"># Error if they do not match.</span>
        <span style="color:#66d9ef">if</span> len(self) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)]<span style="color:#f92672">.</span>n \
                    <span style="color:#f92672">!=</span> lm<span style="color:#f92672">.</span>layer_list[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>prev:
                <span style="color:#75715e"># The number of units in your designated location and the first unit of&#39;lm&#39;</span>
                <span style="color:#75715e"># Error if they do not match.</span>
                <span style="color:#66d9ef">raise</span> UnmatchUnitError(
                    self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)]<span style="color:#f92672">.</span>n,
                    lm<span style="color:#f92672">.</span>layer_list[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>prev)<span style="color:#66d9ef">if</span> prev_name <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__name_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]:
                <span style="color:#75715e">#&#39;prev_name&#39; is not my last layer</span>
                <span style="color:#66d9ef">if</span> lm<span style="color:#f92672">.</span>layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n \
                    <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>prev:
                    The number of units at the end of <span style="color:#75715e">#&#39;lm&#39; and the layer next to your designated location</span>
                    <span style="color:#75715e">#&#39;prev&#39; Error if it does not match the number of units.</span>
                    <span style="color:#66d9ef">raise</span> UnmatchUnitError(
                        lm<span style="color:#f92672">.</span>layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n,
                        self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>prev)
        <span style="color:#66d9ef">else</span>:
            <span style="color:#75715e"># Raise an error to use the&#39;extend&#39; method if you don&#39;t have any elements.</span>
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">RuntimeError</span>(
                <span style="color:#e6db74">&#34;You have to use&#39;extend&#39; method instead.&#34;</span>)
        
        <span style="color:#75715e"># Get index of insert location</span>
        index <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>index(prev_name) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
        
        <span style="color:#75715e"># Evacuate the elements after the insertion point to&#39;buf&#39;, then remove it once,</span>
        Add elements using the <span style="color:#75715e"># extend method</span>
        layer_buf <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__layer_list[index:]
        name_buf <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__name_list[index:]
        <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__layer_list[index:]
        <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__name_list[index:]
        self<span style="color:#f92672">.</span>extend(lm)
        
        <span style="color:#75715e"># Add elements that were evacuated</span>
        self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>extend(layer_buf)
        self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>extend(name_buf)
        
        <span style="color:#75715e">#Rename</span>
        self<span style="color:#f92672">.</span>_rename()
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">remove</span>(self, key):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        The remove method removes the element with the specified name.
</span><span style="color:#e6db74">        Specification by index is also allowed.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#75715e"># The&#39;del&#39; statement already implemented is OK.</span>
        <span style="color:#66d9ef">del</span> self[key]
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">index</span>(self, target):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>index(target)
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>(self, indices):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__name_list[indices]
    
    
    <span style="color:#a6e22e">@property</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">layer_list</span>(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__layer_list
    
    
    <span style="color:#a6e22e">@property</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name_list</span>(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__name_list
    
    
    <span style="color:#a6e22e">@property</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ntype</span>(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__ntype
</code></pre></div></div></details>
I feel that the comments occupy more than half... If you find it in the way, please delete it~
<p>#Codepreparationforlayererror
Introduction to the <code>_layererror</code> module. For the time being, only the errors that came out in the implementation so far are implemented.
We may add this as well.</p>
<details><summary>_layererror.py</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-_layererror.py" data-lang="_layererror.py"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LayerManagerError</span>(<span style="color:#a6e22e">Exception</span>):
    <span style="color:#e6db74">&#34;&#34;&#34;Base class for user-defined errors in layer module&#34;&#34;&#34;</span>
    <span style="color:#66d9ef">pass</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AssignError</span>(LayerManagerError):
    <span style="color:#66d9ef">def</span> __init__(self, value<span style="color:#f92672">=</span>None):
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> value <span style="color:#f92672">is</span> None:
            self<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> value
            self<span style="color:#f92672">.</span>message <span style="color:#f92672">=</span> (str(value)
                         <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: Assigning that value is prohibited.&#34;</span>)
        <span style="color:#66d9ef">else</span>:
            self<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> None
            self<span style="color:#f92672">.</span>message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Assigning that value is prohibited.&#34;</span>
    
    
    <span style="color:#66d9ef">def</span> __str__(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>message


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UnmatchUnitError</span>(LayerManagerError):
    <span style="color:#66d9ef">def</span> __init__(self, prev, n):
        self<span style="color:#f92672">.</span>prev <span style="color:#f92672">=</span> prev
        self<span style="color:#f92672">.</span>n <span style="color:#f92672">=</span> n
        
        self<span style="color:#f92672">.</span>message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Unmatch units: {} and {}.&#34;</span><span style="color:#f92672">.</span>format(prev, n)
    
    
    <span style="color:#66d9ef">def</span> __str__(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>message


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UndefinedLayerError</span>(LayerManagerError):
    <span style="color:#66d9ef">def</span> __init__(self, type_name):
        self<span style="color:#f92672">.</span>type <span style="color:#f92672">=</span> type_name
        self<span style="color:#f92672">.</span>message <span style="color:#f92672">=</span> str(type_name) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: Undefined layer type.&#34;</span>
    
    
    <span style="color:#66d9ef">def</span> __str__(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>message
</code></pre></div></div></details>
Unexpectedly, I have posted a user-defined exception, so I will post it here.
<p>the first</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-_layererror.py" data-lang="_layererror.py"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LayerManagerError</span>(<span style="color:#a6e22e">Exception</span>):
    <span style="color:#e6db74">&#34;&#34;&#34;Base class for user-defined errors in layer module&#34;&#34;&#34;</span>
    <span style="color:#66d9ef">pass</span>
</code></pre></div><p>Catches the exception about the layer</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-example.py" data-lang="example.py"><span style="color:#66d9ef">try</span>:
    <span style="color:#66d9ef">raise</span> AssignError()
<span style="color:#66d9ef">except</span> LayerManagerError:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;catch LayerManagerError&#34;</span>)
</code></pre></div><p>This is to allow you to catch errors that inherit this in a batch. Of course, you can also catch errors individually.
Also, the error statement can be output only after defining the <code>__str__</code> method.</p>
<p>#in conclusion
So, here we have created a layer object template, a manager for handling it, and a module for error control.
The contents of the implementation will be added more and more in subsequent articles.</p>
<p>#Listofpostedcodes</p>
<details><summary>baselayer.py [here](#layermodulecodepreparation)</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-baselayer.py" data-lang="baselayer.py"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BaseLayer</span>():
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    The underlying layer class of everything
</span><span style="color:#e6db74">    Describe the processing common to the middle layer and output layer.
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    
    <span style="color:#66d9ef">def</span> __init__(self):
        <span style="color:#66d9ef">pass</span>
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">forward</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Forward propagation implementation
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">pass</span>
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">backward</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Back propagation implementation
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">pass</span>
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Implement parameter learning
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">pass</span>
</code></pre></div></div></details>
<details><summary>middlelayer.py [here](#layermodulecodepreparation)</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-middlelayer.py" data-lang="middlelayer.py"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np


<span style="color:#75715e">#import .baselayer import BaseLayer</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MiddleLayer</span>(BaseLayer):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Middle class
</span><span style="color:#e6db74">    The input layer is also handled as one of the intermediate layers in terms of mounting.
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    <span style="color:#66d9ef">pass</span>
</code></pre></div></div></details>
<details><summary>outputlayer.py [here](#layermodulecodepreparation)</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-outputlayer.py" data-lang="outputlayer.py"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np


<span style="color:#75715e">#from .baselayer import BaseLayer</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OutputLayer</span>(BaseLayer):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Output layer class
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    <span style="color:#66d9ef">pass</span>
</code></pre></div></div></details>
<details><summary>layermanager.py [here](#codefulltext)</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-layermanager.py" data-lang="layermanager.py"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np


<span style="color:#75715e">#from .layer import *</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">_TypeManager</span>():
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Manager class for layer types
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    N_TYPE <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#75715e"># Number of layer types</span>
    
    MIDDLE <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e"># Middle layer numbering</span>
    OUTPUT <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e"># Output layer numbering</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LayerManager</span>(_TypeManager):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Manager class for managing layers
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    <span style="color:#66d9ef">def</span> __init__(self):
        self<span style="color:#f92672">.</span>__layer_list <span style="color:#f92672">=</span> [] <span style="color:#75715e"># list of layers</span>
        self<span style="color:#f92672">.</span>__name_list <span style="color:#f92672">=</span> [] <span style="color:#75715e"># name list for each layer</span>
        self<span style="color:#f92672">.</span>__ntype <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(self<span style="color:#f92672">.</span>N_TYPE) <span style="color:#75715e"># Number of layers by typedef __repr__(self):</span>
        layerRepr<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;layer_list: &#34;</span><span style="color:#f92672">+</span> repr(self<span style="color:#f92672">.</span>__layer_list)
        nameRepr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;name_list: &#34;</span><span style="color:#f92672">+</span> repr(self<span style="color:#f92672">.</span>__name_list)
        ntypeRepr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ntype: &#34;</span><span style="color:#f92672">+</span> repr(self<span style="color:#f92672">.</span>__ntype)
        <span style="color:#66d9ef">return</span> (layerRepr <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#f92672">+</span> nameRepr <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#f92672">+</span> ntypeRepr)
    
    
    <span style="color:#66d9ef">def</span> __str__(self):
        layerStr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;layer_list: &#34;</span><span style="color:#f92672">+</span> str(self<span style="color:#f92672">.</span>__layer_list)
        nameStr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;name_list: &#34;</span><span style="color:#f92672">+</span> str(self<span style="color:#f92672">.</span>__name_list)
        ntypeStr <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ntype: &#34;</span><span style="color:#f92672">+</span> str(self<span style="color:#f92672">.</span>__ntype)
        <span style="color:#66d9ef">return</span> (layerStr <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#f92672">+</span> nameStr <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#f92672">+</span> ntypeStr)
    
    
    <span style="color:#66d9ef">def</span> __len__(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Describe the operation when called from Python&#39;s built-in function `len`.
</span><span style="color:#e6db74">        Returns the total number of layers by type.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">return</span> np<span style="color:#f92672">.</span>sum(self<span style="color:#f92672">.</span>__ntype)
    
    
    <span style="color:#66d9ef">def</span> __getitem__(self, key):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        For example
</span><span style="color:#e6db74">        lm = LayerManager()
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        | (Add element to lm) |
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        x = lm[3].~~
</span><span style="color:#e6db74">        Is called when a list or array element is accessed, like
</span><span style="color:#e6db74">        Describe the operation at that time.
</span><span style="color:#e6db74">        Only access with slice, str, int is allowed.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> isinstance(key, slice):
            If the <span style="color:#75715e"># key is a slice, refer to the layer list with slice.</span>
            <span style="color:#75715e"># When an abnormal value (Index out of range etc.) is entered</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__layer_list[key]
        <span style="color:#66d9ef">elif</span> isinstance(key, str):
            If <span style="color:#75715e"># key is a string, get the index from the name list of each layer,</span>
            <span style="color:#75715e"># Returns the element of the list of the corresponding layer.</span>
            <span style="color:#66d9ef">if</span> key <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list:
                index <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>index(key)
                <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__layer_list[index]
            <span style="color:#66d9ef">else</span>:
                Raise <span style="color:#a6e22e">KeyError</span> <span style="color:#66d9ef">if</span> <span style="color:#75715e"># key does not exist.</span>
                <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(<span style="color:#e6db74">&#34;{}: No such item&#34;</span><span style="color:#f92672">.</span>format(key))
        <span style="color:#66d9ef">elif</span> isinstance(key, int):
            If <span style="color:#75715e">#key is an integer, the corresponding element in the layer list is returned.</span>
            <span style="color:#75715e"># When an abnormal value (Index out of range etc.) is entered</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__layer_list[key]
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(key, <span style="color:#e6db74">&#34;: Undefined such key type.&#34;</span>)
    
    
    <span style="color:#66d9ef">def</span> __setitem__(self, key, value):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        For example
</span><span style="color:#e6db74">        lm = LayerManager()
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        | (Add element to lm) |
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        lm[1] = x
</span><span style="color:#e6db74">        Is called when a list or array element is accessed, like
</span><span style="color:#e6db74">        Describe the operation at that time.
</span><span style="color:#e6db74">        Only overwrite of elements is allowed, and addition of new elements is prohibited.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        value_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> isinstance(value, list):
            <span style="color:#75715e">#If the&#39;value&#39; specified on the right side is&#39;list&#39;</span>
            <span style="color:#75715e">#Error if all elements do not inherit&#39;BaseLayer&#39; class or it.</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> np<span style="color:#f92672">.</span>all(
                np<span style="color:#f92672">.</span>where(isinstance(value, BaseLayer), True, False)):
                self<span style="color:#f92672">.</span>AssignError()
            value_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;list&#34;</span>
        <span style="color:#66d9ef">elif</span> isinstance(value, BaseLayer):
            <span style="color:#75715e"># Is the&#39;value&#39; specified on the right side a&#39;BaseLayer&#39; class?</span>
            <span style="color:#75715e">#Error if not inheriting it.</span>
            self<span style="color:#f92672">.</span>AssignError(type(value))
        <span style="color:#66d9ef">if</span> value_type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span>:
            value_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;BaseLayer&#34;</span>
            
        <span style="color:#66d9ef">if</span> isinstance(key, slice):
            If the <span style="color:#75715e"># key is a slice, overwrite the elements in the layer list.</span>
            <span style="color:#75715e"># However, if&#39;value_type&#39; is not&#39;list&#39;, it is an error.</span>
            <span style="color:#75715e"># When an abnormal value (Index out of range etc.) is entered</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">if</span> value_type <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;list&#34;</span>:
                self<span style="color:#f92672">.</span>AssignError(value_type)
            self<span style="color:#f92672">.</span>__layer_list[key] <span style="color:#f92672">=</span> value
        <span style="color:#66d9ef">elif</span> isinstance(key, str):
            If <span style="color:#75715e"># key is a string, get the index from the name list of each layer,</span>
            <span style="color:#75715e"># Overwrite the element of the list of the corresponding layer.</span>
            <span style="color:#75715e"># However, if&#39;value_type&#39; is not&#39;BaseLayer&#39;, it is an error.</span>
            <span style="color:#66d9ef">if</span> value_type <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;BaseLayer&#34;</span>:
                <span style="color:#66d9ef">raise</span> AssignError(value_type)
            <span style="color:#66d9ef">if</span> key <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list:
                index <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>index(key)
                self<span style="color:#f92672">.</span>__layer_list[index] <span style="color:#f92672">=</span> value
            <span style="color:#66d9ef">else</span>:
                Raise <span style="color:#a6e22e">KeyError</span> <span style="color:#66d9ef">if</span> <span style="color:#75715e"># key does not exist.</span>
                <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(<span style="color:#e6db74">&#34;{}: No such item&#34;</span><span style="color:#f92672">.</span>format(key))
        <span style="color:#66d9ef">elif</span> isinstance(key, int):
            If the <span style="color:#75715e"># key is an integer, overwrite the corresponding element in the layer list.</span>
            <span style="color:#75715e"># However, if&#39;value_type&#39; is not&#39;BaseLayer&#39;, it is an error.</span>
            <span style="color:#75715e"># If an abnormal value (such as Index out of range) is entered,</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">if</span> value_type <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;BaseLayer&#34;</span>:
                <span style="color:#66d9ef">raise</span> AssignError(value_type)
            self<span style="color:#f92672">.</span>__layer_list[key] <span style="color:#f92672">=</span> value
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(key, <span style="color:#e6db74">&#34;: Undefined such key type.&#34;</span>)
    
    
    <span style="color:#66d9ef">def</span> __delitem__(self, key):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        For example
</span><span style="color:#e6db74">        lm = LayerManager()
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        | (Add element to lm) |
</span><span style="color:#e6db74">        +----------------+
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        del lm[2]
</span><span style="color:#e6db74">        Like when a list or array element is accessed with a del statement,
</span><span style="color:#e6db74">        Describe the operation at that time.
</span><span style="color:#e6db74">        If the specified element exists, it will be deleted and renamed.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> isinstance(key, slice):
            If the <span style="color:#75715e"># key is a slice, delete the specified element as is</span>
            <span style="color:#75715e"># When an abnormal value (Index out of range etc.) is entered</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__layer_list[slice]
            <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__name_list[slice]
        <span style="color:#66d9ef">elif</span> isinstance(key, str):
            If <span style="color:#75715e"># key is a string, get the index from the name list of each layer,</span>
            <span style="color:#75715e"># Delete the corresponding element.</span>
            <span style="color:#66d9ef">if</span> key <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list:
                <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__layer_list[index]
                <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__name_list[index]
            <span style="color:#66d9ef">else</span>:
                Raise <span style="color:#a6e22e">KeyError</span> <span style="color:#66d9ef">if</span> <span style="color:#75715e"># key does not exist.raise KeyError(&#34;{}: No such item&#34;.format(key))</span>
        <span style="color:#66d9ef">elif</span> isinstance(key, int):
            If the <span style="color:#75715e"># key is an integer, delete the corresponding element in the layer list.</span>
            <span style="color:#75715e"># When an abnormal value (Index out of range etc.) is entered</span>
            <span style="color:#75715e"># Python gives me an error.</span>
            <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__layer_list[key]
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(key, <span style="color:#e6db74">&#34;: Undefined such key type.&#34;</span>)
        
        <span style="color:#75715e">#Rename</span>
        self<span style="color:#f92672">.</span>_rename()
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_rename</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        If the name manipulation of the name list violates the rules due to list manipulation
</span><span style="color:#e6db74">        Rename the naming list and each layer to meet the rules again.
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        The naming rule is [Type of layer] [How many].
</span><span style="color:#e6db74">        If the layer type is Middle, it is Middle
</span><span style="color:#e6db74">                     Output Layer is Output
</span><span style="color:#e6db74">        Abbreviated as.
</span><span style="color:#e6db74">        The number is counted by type.
</span><span style="color:#e6db74">        
</span><span style="color:#e6db74">        In addition, __ntype is counted again here.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#75715e"># Initialize the number of layers by type</span>
        self<span style="color:#f92672">.</span>__ntype <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(self<span style="color:#f92672">.</span>N_TYPE)
        
        <span style="color:#75715e"># Recount and rename each layer</span>
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(self)):
            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;Middle&#34;</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list[i]:
                self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>MIDDLE] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                self<span style="color:#f92672">.</span>__name_list[i] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Middle{}&#34;</span><span style="color:#f92672">.</span>format(
                        self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>MIDDLE])
                self<span style="color:#f92672">.</span>__layer_list[i]<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Middle{}&#34;</span><span style="color:#f92672">.</span>format(
                        self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>MIDDLE])
            <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#34;Output&#34;</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list[i]:
                self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>OUTPUT] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                self<span style="color:#f92672">.</span>__name_list[i] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Output{}&#34;</span><span style="color:#f92672">.</span>format(
                        self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>OUTPUT])
                self<span style="color:#f92672">.</span>__layer_list[i]<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Output{}&#34;</span><span style="color:#f92672">.</span>format(
                        self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>OUTPUT])
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">raise</span> UndefinedLayerType(self<span style="color:#f92672">.</span>__name_list[i])
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">append</span>(self, <span style="color:#f92672">*</span>, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Middle&#34;</span>, <span style="color:#f92672">**</span>kwds):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Implementation of the append method that is familiar with methods for adding elements to a list.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;prev&#34;</span> <span style="color:#f92672">in</span> kwds:
            If <span style="color:#75715e">#&#39;prev&#39; is included in the keyword,</span>
            <span style="color:#75715e"># You have specified the number of elements in the previous layer.</span>
            <span style="color:#75715e"># Basically it is supposed to insert the first layer, so</span>
            <span style="color:#75715e">#Other than that, basically it is decided automatically, so it is not specified.</span>
            <span style="color:#66d9ef">if</span> len(self) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
                <span style="color:#66d9ef">if</span> kwds[<span style="color:#e6db74">&#34;prev&#34;</span>] <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n:
                    <span style="color:#75715e"># Error if the number of units at the end does not match.</span>
                    <span style="color:#66d9ef">raise</span> UnmatchUnitError(self<span style="color:#f92672">.</span>__layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n,
                                           kwds[<span style="color:#e6db74">&#34;prev&#34;</span>])
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">if</span> len(self) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
                    <span style="color:#75715e"># The first layer must always specify the number of input units.</span>
                    <span style="color:#66d9ef">raise</span> UnmatchUnitError(<span style="color:#e6db74">&#34;Input units&#34;</span>, <span style="color:#e6db74">&#34;Unspecified&#34;</span>)
                <span style="color:#66d9ef">else</span>:
                    <span style="color:#75715e"># Add the number of units of the last layer to&#39;kwds&#39;</span>
                    kwds[<span style="color:#e6db74">&#34;prev&#34;</span>] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n
            
            <span style="color:#75715e"># Read the layer type and change the name according to the naming rules</span>
            <span style="color:#66d9ef">if</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;mid&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;m&#34;</span>:
                name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Middle&#34;</span>
            <span style="color:#66d9ef">elif</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;out&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;o&#34;</span>:
                name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Output&#34;</span>
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">raise</span> UndefinedLayerError(name)
            
            <span style="color:#75715e"># Add a layer.</span>
            <span style="color:#66d9ef">if</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Middle&#34;</span>:
                <span style="color:#75715e"># Increment layers by type</span>
                self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>MIDDLE] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                <span style="color:#75715e"># Add to name</span>
                name <span style="color:#f92672">+=</span> str(self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>MIDDLE])
                <span style="color:#75715e"># Add to namelist</span>
                self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>append(name)
                <span style="color:#75715e"># Finally, generate the layer and add it to the list.</span>
                self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>append(
                        MiddleLayer(name<span style="color:#f92672">=</span>name, <span style="color:#f92672">**</span>kwds))
            <span style="color:#66d9ef">elif</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Output&#34;</span>:
                <span style="color:#75715e">#This is also the same.</span>
                self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>OUTPUT] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                name <span style="color:#f92672">+=</span> str(self<span style="color:#f92672">.</span>__ntype[self<span style="color:#f92672">.</span>OUTPUT])
                self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>append(name)
                self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>append(
                        OutputLayer(name<span style="color:#f92672">=</span>name, <span style="color:#f92672">**</span>kwds))
            <span style="color:#75715e">#Change the name that does not draw the else sentence according to the naming rule</span>
            This <span style="color:#f92672">is</span> because the abnormal<span style="color:#e6db74">&#39;name&#39;</span> has already been omitted <span style="color:#f92672">in</span> the <span style="color:#75715e"># stage.</span>
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extend</span>(self, lm):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        In the extend method, the element of another layer manager&#39;lm&#39; that already exists
</span><span style="color:#e6db74">        Add all.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#f92672">is</span> instance(lm, LayerManager):
            Error <span style="color:#66d9ef">if</span> <span style="color:#75715e">#&#39;lm&#39; instance is not LayerManager.</span>
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">TypeError</span>(type(lm), <span style="color:#e6db74">&#34;: Unexpected type.&#34;</span>)
        <span style="color:#66d9ef">if</span> len(self) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>__layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n <span style="color:#f92672">!=</span> lm[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>prev:
                <span style="color:#75715e"># With the number of units in my last layer</span>
                Error <span style="color:#66d9ef">if</span> the input number of the first layer of <span style="color:#75715e">#&#39;lm&#39; does not match.</span>
                <span style="color:#66d9ef">raise</span> UnmatchUnitError(self<span style="color:#f92672">.</span>__layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n,
                                       lm[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>prev)
        
        <span style="color:#75715e"># Add each with&#39;extend&#39; method</span>
        self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>extend(lm<span style="color:#f92672">.</span>layer_list)
        self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>extend(lm<span style="color:#f92672">.</span>name_list)
        
        <span style="color:#75715e">#Rename</span>
        self<span style="color:#f92672">.</span>_rename()
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">insert</span>(self, prev_name, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Middle&#34;</span>, <span style="color:#f92672">**</span>kwds):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        In the insert method, specify the name of the previous layer and merge it with that layer
</span><span style="color:#e6db74">        Add an element.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        Error <span style="color:#66d9ef">if</span> <span style="color:#75715e">#&#39;prev_name&#39; does not exist.</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> prev_name <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(prev_name, <span style="color:#e6db74">&#34;: No such key.&#34;</span>)
        If <span style="color:#75715e">#&#39;prev&#39; is included in the keyword,</span>
        Error <span style="color:#66d9ef">if</span> it does <span style="color:#f92672">not</span> match the number of units of the layer specified by <span style="color:#75715e">#&#39;prev_name&#39;.</span>
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;prev&#34;</span> <span style="color:#f92672">in</span> kwds:
            <span style="color:#66d9ef">if</span> kwds[<span style="color:#e6db74">&#34;prev&#34;</span>] \
                <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)]<span style="color:#f92672">.</span>n:
                <span style="color:#66d9ef">raise</span> UnmatchUnitError(
                    kwds[<span style="color:#e6db74">&#34;prev&#34;</span>],
                    self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)]<span style="color:#f92672">.</span>n)If <span style="color:#75715e">#&#39;n&#39; is included in the keyword,</span>
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;n&#34;</span> <span style="color:#f92672">in</span> kwds:
            If <span style="color:#75715e">#&#39;prev_name&#39; is not at the end</span>
            <span style="color:#66d9ef">if</span> prev_name <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__name_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]:
                <span style="color:#75715e">#Error if the number of units in the next layer does not match.</span>
                <span style="color:#66d9ef">if</span> kwds[<span style="color:#e6db74">&#34;n&#34;</span>] <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__layer_list[
                        self<span style="color:#f92672">.</span>index(prev_name)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>prev:
                    <span style="color:#66d9ef">raise</span> UnmatchUnitError(
                        kwds[<span style="color:#e6db74">&#34;n&#34;</span>],
                        self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)]<span style="color:#f92672">.</span>prev)
        <span style="color:#75715e"># Produce an error to use the&#39;append&#39; method if there are no elements yet.</span>
        <span style="color:#66d9ef">if</span> len(self) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">RuntimeError</span>(
                <span style="color:#e6db74">&#34;You have to use&#39;append&#39; method instead.&#34;</span>)
        
        <span style="color:#75715e"># Get index of insert location</span>
        index <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>index(prev_name) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
        
        <span style="color:#75715e"># Read the layer type and change the name according to the naming rules</span>
        <span style="color:#66d9ef">if</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;mid&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;m&#34;</span>:
            name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Middle&#34;</span>
        <span style="color:#66d9ef">elif</span> name <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;out&#34;</span> <span style="color:#f92672">or</span> <span style="color:#e6db74">&#34;o&#34;</span>:
            name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Output&#34;</span>
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">raise</span> UndefinedLayerError(name)
        
        Insert <span style="color:#75715e"># element</span>
        <span style="color:#75715e">#At this time,&#39;name&#39; does not follow the naming rules yet,</span>
        <span style="color:#75715e"># Don&#39;t worry as it will be renamed later.</span>
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;Middle&#34;</span> <span style="color:#f92672">in</span> name:
            self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>insert(index,
                                     MiddleLayer(name<span style="color:#f92672">=</span>name, <span style="color:#f92672">**</span>kwds))
            self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>insert(index, name)
        <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#34;Output&#34;</span> <span style="color:#f92672">in</span> name:
            self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>insert(index,
                                     OutputLayer(name<span style="color:#f92672">=</span>name, <span style="color:#f92672">**</span>kwds))
            self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>insert(index, name)
        
        <span style="color:#75715e">#Rename</span>
        self<span style="color:#f92672">.</span>_rename()
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">extend_insert</span>(self, prev_name, lm):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Here is the original function.
</span><span style="color:#e6db74">        It behaves like a combination of extend and insert methods.
</span><span style="color:#e6db74">        In short, it&#39;s like inserting another layer manager.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#f92672">is</span> instance(lm, LayerManager):
            Error <span style="color:#66d9ef">if</span> <span style="color:#75715e">#&#39;lm&#39; instance is not LayerManager.</span>
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">TypeError</span>(type(lm), <span style="color:#e6db74">&#34;: Unexpected type.&#34;</span>)
        Error <span style="color:#66d9ef">if</span> <span style="color:#75715e">#&#39;prev_name&#39; does not exist.</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> prev_name <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>__name_list:
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">KeyError</span>(prev_name, <span style="color:#e6db74">&#34;: No such key.&#34;</span>)
        <span style="color:#75715e"># The number of units of the layers before and after the specified location and the first and last layers of lm</span>
        <span style="color:#75715e"># Error if they do not match.</span>
        <span style="color:#66d9ef">if</span> len(self) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)]<span style="color:#f92672">.</span>n \
                    <span style="color:#f92672">!=</span> lm<span style="color:#f92672">.</span>layer_list[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>prev:
                <span style="color:#75715e"># The number of units in your designated location and the first unit of&#39;lm&#39;</span>
                <span style="color:#75715e"># Error if they do not match.</span>
                <span style="color:#66d9ef">raise</span> UnmatchUnitError(
                    self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)]<span style="color:#f92672">.</span>n,
                    lm<span style="color:#f92672">.</span>layer_list[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>prev)
            <span style="color:#66d9ef">if</span> prev_name <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__name_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]:
                <span style="color:#75715e">#&#39;prev_name&#39; is not my last layer</span>
                <span style="color:#66d9ef">if</span> lm<span style="color:#f92672">.</span>layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n \
                    <span style="color:#f92672">!=</span> self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>prev:
                    The number of units at the end of <span style="color:#75715e">#&#39;lm&#39; and the layer next to your designated location</span>
                    <span style="color:#75715e">#&#39;prev&#39; Error if it does not match the number of units.</span>
                    <span style="color:#66d9ef">raise</span> UnmatchUnitError(
                        lm<span style="color:#f92672">.</span>layer_list[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>n,
                        self<span style="color:#f92672">.</span>__layer_list[self<span style="color:#f92672">.</span>index(prev_name)<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>prev)
        <span style="color:#66d9ef">else</span>:
            <span style="color:#75715e"># Raise an error to use the&#39;extend&#39; method if you don&#39;t have any elements.</span>
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">RuntimeError</span>(
                <span style="color:#e6db74">&#34;You have to use&#39;extend&#39; method instead.&#34;</span>)
        
        <span style="color:#75715e"># Get index of insert location</span>
        index <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>index(prev_name) <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
        
        <span style="color:#75715e"># Evacuate the elements after the insertion point to&#39;buf&#39;, then remove it once,</span>
        Add elements using the <span style="color:#75715e"># extend method</span>
        layer_buf <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__layer_list[index:]
        name_buf <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__name_list[index:]
        <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__layer_list[index:]
        <span style="color:#66d9ef">del</span> self<span style="color:#f92672">.</span>__name_list[index:]
        self<span style="color:#f92672">.</span>extend(lm)
        
        <span style="color:#75715e"># Add elements that were evacuated</span>
        self<span style="color:#f92672">.</span>__layer_list<span style="color:#f92672">.</span>extend(layer_buf)
        self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>extend(name_buf)
        
        <span style="color:#75715e">#Rename</span>
        self<span style="color:#f92672">.</span>_rename()
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">remove</span>(self, key):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        The remove method removes the element with the specified name.
</span><span style="color:#e6db74">        Specification by index is also allowed.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#75715e"># The&#39;del&#39; statement already implemented is OK.</span>
        <span style="color:#66d9ef">del</span> self[key]
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">index</span>(self, target):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__name_list<span style="color:#f92672">.</span>index(target)
    
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>(self, indices):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__name_list[indices]
    
    
    <span style="color:#a6e22e">@property</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">layer_list</span>(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__layer_list
    
    
    <span style="color:#a6e22e">@property</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name_list</span>(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__name_list
    
    
    <span style="color:#a6e22e">@property</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ntype</span>(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__ntype
</code></pre></div></div></details>
<details><summary>_layererror.py [here](#preparecodeforlayererror)</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-_layererror.py" data-lang="_layererror.py"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LayerManagerError</span>(<span style="color:#a6e22e">Exception</span>):
    <span style="color:#e6db74">&#34;&#34;&#34;Base class for user-defined errors in layer module&#34;&#34;&#34;</span>
    <span style="color:#66d9ef">pass</span>


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AssignError</span>(LayerManagerError):
    <span style="color:#66d9ef">def</span> __init__(self, value<span style="color:#f92672">=</span>None):
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> value <span style="color:#f92672">is</span> None:
            self<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> value
            self<span style="color:#f92672">.</span>message <span style="color:#f92672">=</span> (str(value)
                         <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: Assigning that value is prohibited.&#34;</span>)
        <span style="color:#66d9ef">else</span>:
            self<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> None
            self<span style="color:#f92672">.</span>message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Assigning that value is prohibited.&#34;</span>
    
    
    <span style="color:#66d9ef">def</span> __str__(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>message


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UnmatchUnitError</span>(LayerManagerError):
    <span style="color:#66d9ef">def</span> __init__(self, prev, n):
        self<span style="color:#f92672">.</span>prev <span style="color:#f92672">=</span> prev
        self<span style="color:#f92672">.</span>n <span style="color:#f92672">=</span> n
        
        self<span style="color:#f92672">.</span>message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Unmatch units: {} and {}.&#34;</span><span style="color:#f92672">.</span>format(prev, n)
    
    
    <span style="color:#66d9ef">def</span> __str__(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>message


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UndefinedLayerError</span>(LayerManagerError):<span style="color:#66d9ef">def</span> __init__(self, type_name):
         self<span style="color:#f92672">.</span>type <span style="color:#f92672">=</span> type_name
         self<span style="color:#f92672">.</span>message <span style="color:#f92672">=</span> str(type_name) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: Undefined layer type.&#34;</span>
    
    
     <span style="color:#66d9ef">def</span> __str__(self):
         <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>message
</code></pre></div></div></details>
<p>#reference</p>
<ul>
<li><a href="https://medium.com/lsc-psd/pythonicLet'smastervariouspythonunderscores-3c132842eeef">Let&rsquo;s master Python&rsquo;s underscore (_)! </a></li>
</ul>
<p>#Deep learning series</p>
<ul>
<li><a href="https://qiita.com/kuroitu/items/221e8c477ffdd0774b6b">Introduction to Deep Learning ~Basics~</a></li>
<li><a href="https://qiita.com/kuroitu/items/d22c8750e34d5d75fb6c">Introduction to Deep Learning-Forward Propagation Edition</a></li>
<li><a href="https://qiita.com/kuroitu/items/35d7b5a4bde470f69570">im2col thorough understanding</a></li>
<li><a href="https://qiita.com/kuroitu/items/73cd401afd463a78115a">Activation function list (2020)</a></li>
</ul>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
