<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>I tried to imitate Python × Kivy de Kinoppy (Kinokuniya bookstore application) | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>I tried to imitate Python × Kivy de Kinoppy (Kinokuniya bookstore application)</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 12, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/pdf"> PDF</a></code></small>


<small><code><a href="https://memotut.com/tags/kivy"> Kivy</a></code></small>


<small><code><a href="https://memotut.com/tags/personal-development"> personal development</a></code></small>

</p>
<pre><code>This article is the 14th day of [Personal Development Advent Calendar 2019](https://qiita.com/advent-calendar/2019/private-development).
</code></pre>
<p>And Qiita&rsquo;s first post. Begin.</p>
<p>I am creating a Windows app using a framework called Python x Kivy.</p>
<p>###background</p>
<ol>
<li>I cooked a paper book and made it into PDF. Refreshing!
-Now read on your iPad
-My child took an iPad&hellip;
-I bought a Surface! Let&rsquo;s read on Surface
-Unlike iPad, there is no good app for Windows
-Kinoppy (Kinokuniya bookstore app) Good!
-Is it possible to make this with Kivy which I am studying now?</li>
</ol>
<p>Kinoppy (Kinokuniya Bookstore App) is a very good app and is recommended.</p>
<h3 id="app-overview">App overview</h3>
<p>It has a bookshelf and a PDF viewer function.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/280388/3ec52dc9-cc2f-0c50-a54d-ca997fbe513d.gif" alt="pdfapp2-min.gif"></p>
<p>###Development environment
AnacondaNavigator
VSCode
Python3.7
Kivy1.11</p>
<h3 id="library-used">Library used</h3>
<p>There are a lot of people who rely too much on others, but the main ones are:
PDF rendering: <a href="https://github.com/Belval/pdf2image">pdf2image</a>
Configuration file: ruamel.yaml
Icon fonts: <a href="https://github.com/kivy-garden/garden.iconfonts">iconfonts</a></p>
<h3 id="a-site-that-has-been-very-helpful">A site that has been very helpful</h3>
<p><a href="https://k-kinoppy.jp/">Kinoppy</a>
<a href="https://kivy.org/">Kivy</a>
<a href="https://stackoverflow.com/">stackoverflow</a>
<a href="https://koh-sen.jp/">Arakawa Ray Blog Main Building</a>
And
<a href="https://qiita.com/tags/kivy">Qiita:Kivy</a></p>
<p>###Todo
It&rsquo;s quite deep and I&rsquo;m half aspiring, but I&rsquo;m aiming for the following. far. ..</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> Read PDF (local PC)</li>
<li>[] PDF reading (DropBox)</li>
<li><input checked="" disabled="" type="checkbox"> Bookshelf management (adding and deleting bookshelves)</li>
<li><input checked="" disabled="" type="checkbox"> Move books with D&amp;D (in bookshelf)</li>
<li>[] Move books with D&amp;D (different bookshelf)</li>
<li><input checked="" disabled="" type="checkbox"> viewer function (1 or 2 page display, right or left open)</li>
<li>[] Viewer function (Automatic table of contents creation)</li>
<li>[] Viewer function (Search)</li>
</ul>
<h3 id="source-code-etc">Source code etc.</h3>
<p>Here are two excerpts of the Kivy source code.</p>
<ol>
<li>Thumbnail drag and drop with Scatter
-Realization of Sleider right → left
-(Bonus) How to make a bookshelf</li>
</ol>
<p>####1.Scatter thumbnail drag and drop
Color the image frame by dragging and dropping the thumbnail (the image displayed on the bookshelf) for a few seconds. If you release it before entering drag and drop, it will be regarded as a normal click and will transition to the viewer.</p>
<pre><code class="language-Python:Library.kv" data-lang="Python:Library.kv">
&lt;DraggableThumbnail@Scatter&gt;:
    image_name:''
    image_path:''
    image: image_id
    shelf_row: None
    shelf_col: None

    do_rotation: False
    do_scale: False
    auto_bring_to_front: True
    do_collide_after_children: True

    background_color: 0,0,0,0
    background_normal:''

    Image:
        id: image_id
        source: root.image_path
        allow_stretch: True
        keep_ratio: True
        canvas:
            Color:
                rgb: (1, 1, 1)
            Rectangle:
                texture: self.texture
                pos: self.pos
                size: self.size
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python:Library.py" data-lang="Python:Library.py">
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DraggableThumbnail</span>(Scatter):
    image_name <span style="color:#f92672">=</span> StringProperty(None)
    image_path <span style="color:#f92672">=</span> StringProperty(None)
    shelf_row <span style="color:#f92672">=</span> NumericProperty(None)
    shelf_col <span style="color:#f92672">=</span> NumericProperty(None)

    state <span style="color:#f92672">=</span> OptionProperty(<span style="color:#e6db74">&#39;released&#39;</span>,options<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;grabed&#39;</span>,<span style="color:#e6db74">&#39;released&#39;</span>])
    img_touched <span style="color:#f92672">=</span> StringProperty(None)
    t <span style="color:#f92672">=</span> NumericProperty(<span style="color:#ae81ff">0</span>)

    <span style="color:#66d9ef">def</span> __init__(self,<span style="color:#f92672">**</span>kwargs):
        super(DraggableThumbnail,self)<span style="color:#f92672">.</span>__init__(<span style="color:#f92672">**</span>kwargs)
        <span style="color:#75715e"># Can&#39;t resize without Clock.schedule_once here</span>
        Clock<span style="color:#f92672">.</span>schedule_once(self<span style="color:#f92672">.</span>drag_after_init)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">drag_after_init</span>(self, dt):
        self<span style="color:#f92672">.</span>size_hint <span style="color:#f92672">=</span> None,None
        self<span style="color:#f92672">.</span>size <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>image<span style="color:#f92672">.</span>size
        <span style="color:#75715e"># Make only the image frame for drag and drop here</span>
        <span style="color:#66d9ef">with</span> self<span style="color:#f92672">.</span>canvas:
            self<span style="color:#f92672">.</span>color <span style="color:#f92672">=</span> Color(rgba <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>))
            self<span style="color:#f92672">.</span>frame <span style="color:#f92672">=</span> Line(rectangle<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,self<span style="color:#f92672">.</span>image<span style="color:#f92672">.</span>width,self<span style="color:#f92672">.</span>image<span style="color:#f92672">.</span>height))

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_state</span>(self,<span style="color:#f92672">*</span>args):
        <span style="color:#75715e"># After grabbing, make the image frame gray.</span>
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>state <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;grabed&#39;</span>:
            self<span style="color:#f92672">.</span>color<span style="color:#f92672">.</span>rgba <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0.5</span>,<span style="color:#ae81ff">0.5</span>,<span style="color:#ae81ff">0.5</span>,<span style="color:#ae81ff">1</span>)
        <span style="color:#75715e">#Return to original when released.</span>
        <span style="color:#66d9ef">elif</span> self<span style="color:#f92672">.</span>state <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;released&#39;</span>:
            self<span style="color:#f92672">.</span>color<span style="color:#f92672">.</span>rgba <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">time_count</span>(self,<span style="color:#f92672">*</span>args):
        self<span style="color:#f92672">.</span>t <span style="color:#f92672">+=</span> <span style="color:#ae81ff">0.1</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_t</span>(self,<span style="color:#f92672">*</span>args):
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>t <span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">0.5</span>:
            Clock<span style="color:#f92672">.</span>unschedule(self<span style="color:#f92672">.</span>time_count)
            self<span style="color:#f92672">.</span>t <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
            self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;grabed&#39;</span>
            self<span style="color:#f92672">.</span>img_touched <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_touch_down</span>(self, touch):
        self<span style="color:#f92672">.</span>on_state(touch)
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>collide_point(<span style="color:#f92672">*</span>touch<span style="color:#f92672">.</span>pos):
            Clock<span style="color:#f92672">.</span>schedule_interval(self<span style="color:#f92672">.</span>time_count, <span style="color:#ae81ff">0.1</span>)
            self<span style="color:#f92672">.</span>img_touched <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>image_name

            touch<span style="color:#f92672">.</span>grab(self)
            <span style="color:#66d9ef">return</span> True

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_touch_up</span>(self, touch):
        Clock<span style="color:#f92672">.</span>unschedule(self<span style="color:#f92672">.</span>time_count)
        self<span style="color:#f92672">.</span>t <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

        <span style="color:#66d9ef">if</span> touch<span style="color:#f92672">.</span>grab_current <span style="color:#f92672">is</span> self:
            <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>img_touched <span style="color:#f92672">==</span> self<span style="color:#f92672">.</span>image_name:
                self<span style="color:#f92672">.</span>img_touched <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>
                <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>state <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;released&#39;</span>:
                    <span style="color:#75715e">#Transition to viewer</span>
                    app<span style="color:#f92672">=</span> App<span style="color:#f92672">.</span>get_running_app()
                    app<span style="color:#f92672">.</span>root<span style="color:#f92672">.</span>chgdisp_viewer(self<span style="color:#f92672">.</span>image_name)
            <span style="color:#66d9ef">else</span>:
                <span style="color:#75715e"># Dropped so thumbnails aligned</span>
                app<span style="color:#f92672">=</span> App<span style="color:#f92672">.</span>get_running_app()
                app<span style="color:#f92672">.</span>root<span style="color:#f92672">.</span>Library<span style="color:#f92672">.</span>lineup_thumbnail(self,touch)
            touch<span style="color:#f92672">.</span>ungrab(self)

        self<span style="color:#f92672">.</span>state <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;released&#39;</span>
        <span style="color:#66d9ef">return</span> True

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_touch_move</span>(self, touch):
        Clock<span style="color:#f92672">.</span>unschedule(self<span style="color:#f92672">.</span>time_count)
        self<span style="color:#f92672">.</span>t <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>state <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;grabed&#39;</span>:
            self<span style="color:#f92672">.</span>pos <span style="color:#f92672">=</span> touch<span style="color:#f92672">.</span>x<span style="color:#f92672">-</span>self<span style="color:#f92672">.</span>image<span style="color:#f92672">.</span>width <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>, touch<span style="color:#f92672">.</span>y<span style="color:#f92672">-</span>self<span style="color:#f92672">.</span>image<span style="color:#f92672">.</span>height <span style="color:#f92672">/</span> <span style="color:#ae81ff">2</span>
            <span style="color:#66d9ef">return</span> True
        <span style="color:#66d9ef">else</span>:
            self<span style="color:#f92672">.</span>img_touched <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>


</code></pre></div><p>####2. Realization of Sleider right → left
What I find inconvenient with overseas PDF Viewers is that they do not support vertical writing (right → left). Kivy&rsquo;s slider can be realized from left to right (bottom to top), but there is no right to left setting. I also wanted the number of pages when sliding, so I made it into a part. The source is uploaded to <a href="https://github.com/MamiTakata/Kivy-ViewSlider">Github</a>. I learned how to customize standard parts in this way. Please see the source if you like.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/280388/9b2cc70c-fec0-4a36-8818-730550aa88a2.gif" alt="Example.gif">####3.(Bonus) How to make a bookshelf
I didn&rsquo;t have a good bookshelf image, so I made one. This is the image.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/280388/e3b49d6f-5f7d-01cf-3d73-f3b11e9bbd2d.png" alt="shelf2.png"></p>
<p>How to make it <a href="https://flat-kids.net/2019/10/06/inkscape0-92-4%e3%81%a7%e6%9c%ac%e6%a3%9a%e3%82%92%e4%bd%9c%e3%82%8b/">My blog here</a> has nothing to do with the program and there seems to be no demand anywhere.</p>
<p>###Finally
The first Qiita posting and the first Advent Calendar, it&rsquo;s fast from December 1st to my charge! ! Every day, the excitement of &ldquo;Ah, it&rsquo;s about to come&hellip;&rdquo; was a great motivation. If there wasn&rsquo;t this event, it wouldn&rsquo;t be finished so far. I&rsquo;m glad I could participate. Thank you for reading.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
