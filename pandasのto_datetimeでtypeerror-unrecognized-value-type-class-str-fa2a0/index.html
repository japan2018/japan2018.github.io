<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>pandasのto_datetimeで「TypeError: Unrecognized value type: &lt;class &#39;str&#39;&gt;」 | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>pandasのto_datetimeで「TypeError: Unrecognized value type: &lt;class &lsquo;str'&gt;」</h1>
<p>
  <small class="text-secondary">
  
  
  Apr 17, 2020
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/pandas">pandas</a></code></small>

</p>
<pre><code>This error occurs when a character string that cannot be recognized as a date is included.
</code></pre>
<p>I am addicted to it, so I have summarized it in an article.</p>
<p>When creating a DataFrame, if a &ldquo;value that is not a date&rdquo; is entered between date strings, it will be read as an object.
(Note that if it consists of all strings that can be interpreted as a date, it can be read as datetime.)</p>
<p>For example, a hyphen (-) is inserted between dates as is often the case with real data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">temp <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame([<span style="color:#e6db74">&#34;2020-04-09&#34;</span>, <span style="color:#e6db74">&#34;2020-04-10&#34;</span>, <span style="color:#e6db74">&#34;-&#34;</span>, <span style="color:#e6db74">&#34;2020-04-12&#34;</span>], columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;date&#34;</span>])
</code></pre></div><table>
<thead>
<tr>
<th align="left"></th>
<th align="left">date</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0</td>
<td align="left">2020-04-09</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">2020-04-10</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">2020-04-12</td>
</tr>
</tbody>
</table>
<p>At this time, if you try to convert to datetime type, an error will occur.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">pd<span style="color:#f92672">.</span>to_datetime(temp<span style="color:#f92672">.</span>date)

<span style="color:#75715e">#Error output</span>
<span style="color:#a6e22e">TypeError</span>: Unrecognized value type: <span style="color:#f92672">&lt;</span>class<span style="color:#e6db74">&#39;str&#39;</span><span style="color:#f92672">&gt;</span>
</code></pre></div><p>The measures are as follows.</p>
<h2 id="forcibly-execute-pdto_datetime">Forcibly execute pd.to_datetime()</h2>
<p>Ignore conversion errors and run.
At that time, the location of conversion NG becomes &ldquo;NaT&rdquo;.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">pd<span style="color:#f92672">.</span>to_datetime(temp<span style="color:#f92672">.</span>date, errors<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;coerce&#34;</span>)

<span style="color:#75715e">#Conversion result</span>
<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">04</span><span style="color:#f92672">-</span><span style="color:#ae81ff">09</span>
<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">04</span><span style="color:#f92672">-</span><span style="color:#ae81ff">10</span>
<span style="color:#ae81ff">2</span> NaT
<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">04</span><span style="color:#f92672">-</span><span style="color:#ae81ff">12</span>
Name: date, dtype: datetime64[ns]
</code></pre></div><p>As with this time, if you understand in advance that hyphens are in and you can ignore them, I think that there is no problem.
However, it may be better to avoid using it because I get an error although I am not sure.</p>
<h2 id="correct-the-data-before-executing-pdto_datetime">Correct the data before executing pd.to_datetime()</h2>
<p>Correctly replace or remove unnecessary character strings in advance.
Or deal with it at the stage of data file or DB.</p>
<p>For example, replace the hyphen with an empty string and then run it.
(If the string is empty, pd.to_datetime() can execute without exception.)
Similar to the above forced execution, the conversion NG part is &ldquo;NaT&rdquo;.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">temp<span style="color:#f92672">.</span>date <span style="color:#f92672">=</span> temp<span style="color:#f92672">.</span>date<span style="color:#f92672">.</span>replace({<span style="color:#e6db74">&#34;-&#34;</span>:<span style="color:#e6db74">&#34;&#34;</span>})
pd<span style="color:#f92672">.</span>to_datetime(temp<span style="color:#f92672">.</span>date)

<span style="color:#75715e">#Conversion result</span>
<span style="color:#ae81ff">0</span> <span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">04</span><span style="color:#f92672">-</span><span style="color:#ae81ff">09</span>
<span style="color:#ae81ff">1</span> <span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">04</span><span style="color:#f92672">-</span><span style="color:#ae81ff">10</span>
<span style="color:#ae81ff">2</span> NaT
<span style="color:#ae81ff">3</span> <span style="color:#ae81ff">2020</span><span style="color:#f92672">-</span><span style="color:#ae81ff">04</span><span style="color:#f92672">-</span><span style="color:#ae81ff">12</span>
Name: date, dtype: datetime64[ns]
</code></pre></div><h3 id="easy-way-to-identify-fraud">Easy way to identify fraud</h3>
<p>In the above example, it&rsquo;s easy to see that the hyphens are mixed in because there isn&rsquo;t much data, but when the amount of data is large, it&rsquo;s difficult to understand.
For example, with the code below, you can easily check illegal characters.
An exception is thrown at the first illegal place.
To check all, it is an image to repeat the check while correcting the caught part each time.
(Please note that if there are too many fraudulent variations, it can be a tremendous task.)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check</span>(x):
    <span style="color:#66d9ef">print</span>(x)
    pd<span style="color:#f92672">.</span>to_datetime(x)
    
temp<span style="color:#f92672">.</span>date<span style="color:#f92672">.</span>map(check)
</code></pre></div><p>that&rsquo;s all.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
