<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Responding to Pokemon&#39;s wonderful message by using COTOHA▼ | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Responding to Pokemon&rsquo;s wonderful message by using COTOHA▼</h1>
<p>
  <small class="text-secondary">
  
  
  Mar 11, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/natural-language-processing"> natural language processing</a></code></small>


<small><code><a href="https://memotut.com/tags/pokemon"> Pokemon</a></code></small>


<small><code><a href="https://memotut.com/tags/cotoha"> COTOHA</a></code></small>

</p>
<pre><code>Welcome to the # COTOHA world! ▼
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">This kiji is squid
Because I saw a secret
▼▼
Let<span style="color:#960050;background-color:#1e0010">&#39;</span>s try
It’s a lottery
▼▼
</code></pre></div><p><a href="https://zine.qiita.com/event/collaboration-cotoha-api/">[Qiita x COTOHA API present project] Let&rsquo;s do text analysis with COTOHA API! </a></p>
<p>#What is Pokemon Nice Message ▼
It is a message display used on the screen of the famous game &ldquo;Pokemon&rdquo; (released from <a href="https://www.pokemon.co.jp/">Pokemon</a>)(TheimagebelowisPokemonredandgreen.Fromthegamescreen).<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331465/61239943-3d5e-597c-77a8-96761299072d.gif%22Examplegamescreen%22%22" alt="Screenanimation">
The point is that we want to reproduce this (why do you want to do that? Just because I like Pokemon. Congratulations to the 27th anniversary of February 27, 2020!).</p>
<p>For this Pokemon-like message display</p>
<ul>
<li>Kanji is not used (except some exceptions)</li>
<li>Separated by &ldquo;space&rdquo;</li>
</ul>
<p>It is characterized by <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>. This time, I&rsquo;m aiming to use COTOHA to convert arbitrary Japanese sentences into messages with this atmosphere.</p>
<h2 id="result-sample">Result sample</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 poke_msg.py <span style="color:#e6db74">&#34;Pokemon, Pokemon for shrinking. The mysterious and mysterious creature of this star. In the sky, in the mountains, in the sea, Pokemon can be seen everywhere.&#34;</span>
Pokemon
▼▼
Chimete Pokemon
▼▼
This hoshino mysterious mysterious
living things
▼▼
In the sky, in the mountain, in the sea
Pokemon are everywhere
▼▼
To see the sugata
it can
▼▼
</code></pre></div><p>I will make something like this.</p>
<h2 id="source-code">Source code</h2>
<p>The source code is given in the following GitHub repository.
<a href="https://github.com/mkuriki1990/poke_msg">mkuriki1990/poke_msg-GitHub</a>
The license is MIT License.</p>
<p>What is # COTOHA API ▼
COTOHA API is a natural language processing and voice recognition API developed by NTT Communications that utilizes a Japanese dictionary.
<a href="https://api.ce-cotoha.com/">https://api.ce-cotoha.com/</a>
It&rsquo;s a great guy who can analyze Japanese and perform syntax analysis, keyword extraction, emotion extraction, voice recognition, etc.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/331465/3123e7ef-bad5-2be8-2313-bd63605e7df9.png" alt="cotoha.png">
Although it is limited in the &ldquo;for Developer plan&rdquo;, it can be used free of charge. I made it available in Python by referring to the following article.
<a href="https://qiita.com/gossy5454/items/83072418fb0c5f3e269f">I tried using the COTOHA API rumored to be easy to handle natural language processing using Python-Qiita</a></p>
<p>At #COTOHA First of all, Kaiseki▼
I referred to the article about COTOHA in Qiita <a href="https://qiita.com/Harusugi/items/f499e8707b36d0f570c4">Ole program Ugocas Omae Genshijinaru-Qiita</a>.</p>
<p>This article was a code that outputs the character string given to the argument by omitting particles etc. after parsing the input sentence so that it becomes a primitive (?) Word. I deleted the part that omits words such as particles. Also, if the output is only Katakana, there is no atmosphere, so use the <code>jaconv</code> library and forcibly convert it to hiragana.</p>
<h2 id="execution-environment">Execution environment</h2>
<ul>
<li>Windows10 (WSL: Ubuntu)</li>
<li>Python 3.6.9</li>
</ul>
<h3 id="first-code">first code</h3>
<details><summary>Code slightly modified from the code of the original article (click to expand)</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:pokemon_msg.py" data-lang="python:pokemon_msg.py">
<span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> jaconv

BASE_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.ce-cotoha.com/api/dev/nlp/&#34;</span>
CLIENT_ID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enter COTOHA Client ID&#34;</span>
CLIENT_SECRET <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enter COTOHA Client Secret&#34;</span>


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">auth</span>(client_id, client_secret):
    token_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.ce-cotoha.com/v1/oauth/accesstokens&#34;</span>
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
        <span style="color:#e6db74">&#34;charset&#34;</span>: <span style="color:#e6db74">&#34;UTF-8&#34;</span>
    }
    
    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;grantType&#34;</span>: <span style="color:#e6db74">&#34;client_credentials&#34;</span>,
        <span style="color:#e6db74">&#34;clientId&#34;</span>: client_id,
        <span style="color:#e6db74">&#34;clientSecret&#34;</span>: client_secret
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(token_url,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))
    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#34;access_token&#34;</span>]


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse</span>(sentence, access_token):
    base_url <span style="color:#f92672">=</span> BASE_URL
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
        <span style="color:#e6db74">&#34;charset&#34;</span>: <span style="color:#e6db74">&#34;UTF-8&#34;</span>,
        <span style="color:#e6db74">&#34;Authorization&#34;</span>: <span style="color:#e6db74">&#34;Bearer {}&#34;</span><span style="color:#f92672">.</span>format(access_token)
    }
    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;sentence&#34;</span>: sentence,
        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;default&#34;</span>
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(base_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;v1/parse&#34;</span>,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))
    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    document <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;You have now taken the first step to the Can Tho region!&#34;</span>
    args <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv
    <span style="color:#66d9ef">if</span> len(args) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>:
        document <span style="color:#f92672">=</span> str(args[<span style="color:#ae81ff">1</span>])
   
    access_token <span style="color:#f92672">=</span> auth(CLIENT_ID, CLIENT_SECRET)
    parse_document <span style="color:#f92672">=</span> parse(document, access_token)
    result_list <span style="color:#f92672">=</span> list()
    <span style="color:#66d9ef">for</span> chunks <span style="color:#f92672">in</span> parse_document[<span style="color:#e6db74">&#39;result&#39;</span>]:
        <span style="color:#66d9ef">for</span> token <span style="color:#f92672">in</span> chunks[<span style="color:#e6db74">&#34;tokens&#34;</span>]:
            result_list<span style="color:#f92672">.</span>append(jaconv<span style="color:#f92672">.</span>kata2hira(token[<span style="color:#e6db74">&#34;kana&#34;</span>]))

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(result_list))
</code></pre></div></div>
<h3 id="result">result</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 pokemon_msg.py <span style="color:#e6db74">&#34;You have now taken the first step to the Can Tho region!&#34;</span>
You<span style="color:#e6db74">&#39;re the one who&#39;</span>s going to the Kanto Chiho
</code></pre></div><p>Something like that came out.</p>
<h1 id="more-pokémon-its-going-to-have-a-nice-soft-flavor">More Pokémon It&rsquo;s going to have a nice soft flavor▼</h1>
<p>However, the actual Pokémon text message does not include so many space delimiters. I would like the last part of &ldquo;Fumidashita&rdquo; to be &ldquo;Fumidashita&rdquo; as one lump, as the part of speech is not so divided. Also, Katakana can be displayed, so I would like to display &ldquo;Can Tho&rdquo; etc. originally written in Katakana as it is.</p>
<h2 id="change-the-position-of-the-delimiter-space">Change the position of the delimiter space</h2>
<p>As mentioned above, there are too many spaces at the moment. In the game, it seems that each clause basically has a delimiter space, and it seems that there are many cases where a delimiter space is inserted after a proper noun. Looking at <a href="https://api.ce-cotoha.com/contents/reference/apireference.html">API Reference</a>, fortunately, COTOHA API can read each phrase as <code>chunk_info</code>, so the character string can be read for each phrase. Can be connected. Furthermore, if you look at the <code>features</code> in the <code>tokens</code>, you can distinguish the <code>proper noun</code> as the <code>subpart of speech</code>, so I changed it to add a full-width space only after that.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">result_list <span style="color:#f92672">=</span> list()
<span style="color:#66d9ef">for</span> chunks <span style="color:#f92672">in</span> parse_document[<span style="color:#e6db74">&#39;result&#39;</span>]:
    text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#75715e"># prepare empty text</span>
    <span style="color:#66d9ef">for</span> token <span style="color:#f92672">in</span> chunks[<span style="color:#e6db74">&#34;tokens&#34;</span>]:
        word <span style="color:#f92672">=</span> jaconv<span style="color:#f92672">.</span>kata2hira(token[<span style="color:#e6db74">&#34;kana&#34;</span>]
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;unique&#34;</span> <span style="color:#f92672">in</span> token[<span style="color:#e6db74">&#34;features&#34;</span>]:
            text <span style="color:#f92672">+=</span> word <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#75715e"># Add full-width space</span>
        <span style="color:#66d9ef">else</span>:
            text <span style="color:#f92672">+=</span> word
    result_list<span style="color:#f92672">.</span>append(text)
</code></pre></div><h2 id="convert-only-words-other-than-katakana-to-hiragana">Convert only words other than katakana to hiragana</h2>
<p>I also want to use the katakana word as it is, so I defined the following function. In COTOHA, the original word is <code>form</code> in <code>tokens</code>, and its phonetic alphabet is contained in <code>kana</code>. By comparing this, if <code>form</code> and <code>kana</code> match, it is a katakana word, otherwise it is a function returned in hiragana. By putting this in between, the katakana word is used as it is in katakana.</p>
<pre><code class="language-pythondef" data-lang="pythondef">    if token[&quot;form&quot;] != token[&quot;kana&quot;]:
        word = jaconv.kata2hira(token[&quot;kana&quot;])
    else:
        word = token[&quot;kana&quot;]
    return word
</code></pre><h3 id="for-now-the-code-so-far">For now, the code so far</h3>
<details><summary>Full code up to here (click to expand)</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:pokemon_msg.py" data-lang="python:pokemon_msg.py">
<span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> jaconv

BASE_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.ce-cotoha.com/api/dev/nlp/&#34;</span>
CLIENT_ID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enter COTOHA Client ID&#34;</span>
CLIENT_SECRET <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enter COTOHA Client Secret&#34;</span>


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">auth</span>(client_id, client_secret):
    token_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.ce-cotoha.com/v1/oauth/accesstokens&#34;</span>
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
        <span style="color:#e6db74">&#34;charset&#34;</span>: <span style="color:#e6db74">&#34;UTF-8&#34;</span>
    }

    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;grantType&#34;</span>: <span style="color:#e6db74">&#34;client_credentials&#34;</span>,
        <span style="color:#e6db74">&#34;clientId&#34;</span>: client_id,
        <span style="color:#e6db74">&#34;clientSecret&#34;</span>: client_secret
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(token_url,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))
    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#34;access_token&#34;</span>]


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse</span>(sentence, access_token):
    base_url <span style="color:#f92672">=</span> BASE_URL
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
        <span style="color:#e6db74">&#34;charset&#34;</span>: <span style="color:#e6db74">&#34;UTF-8&#34;</span>,
        <span style="color:#e6db74">&#34;Authorization&#34;</span>: <span style="color:#e6db74">&#34;Bearer {}&#34;</span><span style="color:#f92672">.</span>format(access_token)
    }
    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;sentence&#34;</span>: sentence,
        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;default&#34;</span>
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(base_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;v1/parse&#34;</span>,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))
    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()

<span style="color:#75715e"># Convert only words other than katakana to hiragana</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">conv_kana</span>(token):
    <span style="color:#66d9ef">if</span> token[<span style="color:#e6db74">&#34;form&#34;</span>] <span style="color:#f92672">!=</span> token[<span style="color:#e6db74">&#34;kana&#34;</span>]:
        word <span style="color:#f92672">=</span> jaconv<span style="color:#f92672">.</span>kata2hira(token[<span style="color:#e6db74">&#34;kana&#34;</span>])
    <span style="color:#66d9ef">else</span>:
        word <span style="color:#f92672">=</span> token[<span style="color:#e6db74">&#34;kana&#34;</span>]
    <span style="color:#66d9ef">return</span> word


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    document <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;You have now taken the first step to the Can Tho region!&#34;</span> <span style="color:#75715e">#Sample text</span>
    args <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv
    <span style="color:#66d9ef">if</span> len(args) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>:
        document <span style="color:#f92672">=</span> str(args[<span style="color:#ae81ff">1</span>]) <span style="color:#75715e"># Replace with sample if argument is present</span>

    access_token <span style="color:#f92672">=</span> auth(CLIENT_ID, CLIENT_SECRET)
    parse_document <span style="color:#f92672">=</span> parse(document, access_token)
    result_list <span style="color:#f92672">=</span> list()
    <span style="color:#66d9ef">for</span> chunks <span style="color:#f92672">in</span> parse_document[<span style="color:#e6db74">&#39;result&#39;</span>]:
        text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#75715e"># prepare empty text</span>
        <span style="color:#66d9ef">for</span> token <span style="color:#f92672">in</span> chunks[<span style="color:#e6db74">&#34;tokens&#34;</span>]:

            word <span style="color:#f92672">=</span> conv_kana(token)
            <span style="color:#66d9ef">if</span> token[<span style="color:#e6db74">&#34;pos&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;noun&#34;</span>:
                text <span style="color:#f92672">+=</span> word <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#34;</span>
            <span style="color:#66d9ef">else</span>:
                text <span style="color:#f92672">+=</span> word

        result_list<span style="color:#f92672">.</span>append(text)

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(result_list))
</code></pre></div></div>
<h3 id="result-1">result</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 pokemon_msg.py <span style="color:#e6db74">&#34;You have now taken the first step to the Can Tho region!&#34;</span>
You<span style="color:#960050;background-color:#1e0010">&#39;</span>ve just launched a good one <span style="color:#66d9ef">for</span> Can Tho
</code></pre></div><p>It has become more like that.</p>
<h1 id="make-long-bunsho-into-a-pokémon-nice-message-">Make long bunsho into a Pokémon nice message ▼</h1>
<p>The words of a character in the original game are as follows (Kanji conversion and punctuation added arbitrarily).</p>
<blockquote>
<p>Strong Pokemon, Weak Pokemon, selfishness of such person. If you&rsquo;re a really strong trainer, do your best to win your favorite Pokemon.</p>
</blockquote>
<p>This is converted into the following.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 pokemon_msg.py <span style="color:#e6db74">&#34;Strong Pokemon, Weak Pokémon, the kind of people like that. If you&#39;re a really strong trainer, you should do your best to win with your favorite Pokemon.&#34;</span>
Tsuyoi Pokemon Yawaii Pokemon Such a person really should be a good trainer to try with a favorite Pokemon
</code></pre></div><p>This is a fairly verbose display. In the Pokemon game, there is also a problem with the screen width, and the text is wrapped at an appropriate length (16 characters in the red/green version). Where there are punctuation marks, it seems that there are line breaks. Adjust around that.</p>
<h2 id="punctuation-processing">Punctuation processing</h2>
<p>Punctuation can also be found by looking in <code>tokens</code>. If <code>pos</code> has &ldquo;punctuation&rdquo; or &ldquo;punctuation&rdquo;, insert a line break. Also, the message may contain &ldquo;exclamation points&rdquo; and &ldquo;question marks&rdquo; such as &ldquo;!&rdquo; and &ldquo;?&rdquo;. Unlike &ldquo;.&rdquo; &ldquo;,&rdquo;, these are displayed as messages in Pokemon, so I will insert them as line breaks and sets as appropriate by examining <code>features</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">result_list <span style="color:#f92672">=</span> list()
<span style="color:#66d9ef">for</span> chunks <span style="color:#f92672">in</span> parse_document[<span style="color:#e6db74">&#39;result&#39;</span>]:
    text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#75715e"># prepare empty text</span>
    <span style="color:#66d9ef">for</span> token <span style="color:#f92672">in</span> chunks[<span style="color:#e6db74">&#34;tokens&#34;</span>]:
        word <span style="color:#f92672">=</span> jaconv<span style="color:#f92672">.</span>kata2hira(token[<span style="color:#e6db74">&#34;kana&#34;</span>]
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;unique&#34;</span> <span style="color:#f92672">in</span> token[<span style="color:#e6db74">&#34;features&#34;</span>]:
            text <span style="color:#f92672">+=</span> word <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#75715e"># Add full-width space</span>
        <span style="color:#66d9ef">elif</span> token[<span style="color:#e6db74">&#34;pos&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;punctuation&#34;</span> <span style="color:#f92672">or</span> token[<span style="color:#e6db74">&#34;pos&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;punctuation&#34;</span>:
            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;question mark&#34;</span> <span style="color:#f92672">in</span> token[<span style="color:#e6db74">&#34;features&#34;</span>]:
                text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;?</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
            <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#34;exclamation mark&#34;</span> <span style="color:#f92672">in</span> token[<span style="color:#e6db74">&#34;features&#34;</span>]:
                text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
            <span style="color:#66d9ef">else</span>:
                text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
        <span style="color:#66d9ef">else</span>:
            text <span style="color:#f92672">+=</span> word
    result_list<span style="color:#f92672">.</span>append(text)
</code></pre></div><h2 id="string-wrapping">String wrapping</h2>
<p>The first Pokemon used <a href="https://www.nintendo.co.jp/n02/dmg/index.html">GAMEBOY</a> as the game hardware. The screen resolution is only 160x144 dots, and Pokemon seems to display only 16 characters in the horizontal direction. Therefore, if it exceeds 16 characters, it is displayed with a line break. Rewrite the last <code>result_list</code> where you <code>join</code> as follows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># print(&#39;&#39;.join(result_list))</span>
line <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
<span style="color:#66d9ef">for</span> word <span style="color:#f92672">in</span> result_list:
    <span style="color:#66d9ef">if</span> len(line) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
        line <span style="color:#f92672">=</span> word
        newLine <span style="color:#f92672">=</span> line
    <span style="color:#66d9ef">else</span>:
        newLine <span style="color:#f92672">=</span> line <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">+</span> word

    <span style="color:#66d9ef">if</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">in</span> newLine:
        <span style="color:#66d9ef">if</span> len(newLine)<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">16</span>:
            <span style="color:#66d9ef">print</span>(line)
            <span style="color:#66d9ef">print</span>(word)
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">print</span>(newLine)
        line <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
    <span style="color:#66d9ef">elif</span> len(newLine) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">16</span>:
        line <span style="color:#f92672">=</span> newLine
    <span style="color:#66d9ef">else</span>:
        <span style="color:#66d9ef">print</span>(line)
        line <span style="color:#f92672">=</span> word

<span style="color:#66d9ef">print</span>(line, end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#75715e"># excluding the last newline</span>
</code></pre></div><h3 id="code-up-to-here">Code up to here</h3>
<details><summary>Full code up to here (click to expand)</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:pokemon_msg.py" data-lang="python:pokemon_msg.py">
<span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> jaconv

BASE_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.ce-cotoha.com/api/dev/nlp/&#34;</span>
CLIENT_ID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enter COTOHA Client ID&#34;</span>
CLIENT_SECRET <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enter COTOHA Client Secret&#34;</span>


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">auth</span>(client_id, client_secret):
    token_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.ce-cotoha.com/v1/oauth/accesstokens&#34;</span>
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
        <span style="color:#e6db74">&#34;charset&#34;</span>: <span style="color:#e6db74">&#34;UTF-8&#34;</span>
    }

    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;grantType&#34;</span>: <span style="color:#e6db74">&#34;client_credentials&#34;</span>,
        <span style="color:#e6db74">&#34;clientId&#34;</span>: client_id,
        <span style="color:#e6db74">&#34;clientSecret&#34;</span>: client_secret
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(token_url,
                      headers<span style="color:#f92672">=</span>headers,data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))
    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#34;access_token&#34;</span>]


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse</span>(sentence, access_token):
    base_url <span style="color:#f92672">=</span> BASE_URL
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
        <span style="color:#e6db74">&#34;charset&#34;</span>: <span style="color:#e6db74">&#34;UTF-8&#34;</span>,
        <span style="color:#e6db74">&#34;Authorization&#34;</span>: <span style="color:#e6db74">&#34;Bearer {}&#34;</span><span style="color:#f92672">.</span>format(access_token)
    }
    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;sentence&#34;</span>: sentence,
        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;default&#34;</span>
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(base_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;v1/parse&#34;</span>,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))
    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()

<span style="color:#75715e"># Convert only words other than katakana to hiragana</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">conv_kana</span>(token):
    <span style="color:#66d9ef">if</span> token[<span style="color:#e6db74">&#34;form&#34;</span>] <span style="color:#f92672">!=</span> token[<span style="color:#e6db74">&#34;kana&#34;</span>]:
        word <span style="color:#f92672">=</span> jaconv<span style="color:#f92672">.</span>kata2hira(token[<span style="color:#e6db74">&#34;kana&#34;</span>])
    <span style="color:#66d9ef">else</span>:
        word <span style="color:#f92672">=</span> token[<span style="color:#e6db74">&#34;kana&#34;</span>]
    <span style="color:#66d9ef">return</span> word


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    document <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;You have now taken the first step to the Can Tho region!&#34;</span> <span style="color:#75715e">#Sample text</span>
    document <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Strong Pokémon, Weak Pokémon, such people&#39;s selfishness. If you are a really strong trainer, you should do your best to win with your favorite Pokemon.&#34;</span> <span style="color:#75715e">#Sample text</span>
    args <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv
    <span style="color:#66d9ef">if</span> len(args) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>:
        document <span style="color:#f92672">=</span> str(args[<span style="color:#ae81ff">1</span>]) <span style="color:#75715e"># Replace with sample if argument is present</span>

    access_token <span style="color:#f92672">=</span> auth(CLIENT_ID, CLIENT_SECRET)
    parse_document <span style="color:#f92672">=</span> parse(document, access_token)
    result_list <span style="color:#f92672">=</span> list()
    <span style="color:#66d9ef">for</span> chunks <span style="color:#f92672">in</span> parse_document[<span style="color:#e6db74">&#39;result&#39;</span>]:
        text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#75715e"># prepare empty text</span>
        <span style="color:#66d9ef">for</span> token <span style="color:#f92672">in</span> chunks[<span style="color:#e6db74">&#34;tokens&#34;</span>]:

            word <span style="color:#f92672">=</span> conv_kana(token)
            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;unique&#34;</span> <span style="color:#f92672">in</span> token[<span style="color:#e6db74">&#34;features&#34;</span>]:
                text <span style="color:#f92672">+=</span> word <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#75715e"># Add full-width space</span>
            <span style="color:#66d9ef">elif</span> token[<span style="color:#e6db74">&#34;pos&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;punctuation&#34;</span> <span style="color:#f92672">or</span> token[<span style="color:#e6db74">&#34;pos&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;punctuation&#34;</span>:
                <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;question mark&#34;</span> <span style="color:#f92672">in</span> token[<span style="color:#e6db74">&#34;features&#34;</span>]:
                    text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;?</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#34;exclamation mark&#34;</span> <span style="color:#f92672">in</span> token[<span style="color:#e6db74">&#34;features&#34;</span>]:
                    text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#66d9ef">else</span>:
                    text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
            <span style="color:#66d9ef">else</span>:
                text <span style="color:#f92672">+=</span> word

        result_list<span style="color:#f92672">.</span>append(text)

    line <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
    <span style="color:#66d9ef">for</span> word <span style="color:#f92672">in</span> result_list:
        <span style="color:#66d9ef">if</span> len(line) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
            line <span style="color:#f92672">=</span> word
            newLine <span style="color:#f92672">=</span> line
        <span style="color:#66d9ef">else</span>:
            newLine <span style="color:#f92672">=</span> line <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">+</span> word

        <span style="color:#66d9ef">if</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">in</span> newLine:
            <span style="color:#66d9ef">if</span> len(newLine)<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">16</span>:
                <span style="color:#66d9ef">print</span>(line)
                <span style="color:#66d9ef">print</span>(word)
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">print</span>(newLine)
            line <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
        <span style="color:#66d9ef">elif</span> len(newLine) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">16</span>:
            line <span style="color:#f92672">=</span> newLine
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">print</span>(line)
            line <span style="color:#f92672">=</span> word

    <span style="color:#66d9ef">print</span>(line, end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#75715e"># excluding the last newline</span>
</code></pre></div></div>
<h3 id="result-2">result</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 pokemon_msg.py <span style="color:#e6db74">&#34;Strong Pokemon, Weak Pokémon, the kind of people like that. If you&#39;re a really strong trainer, you should do your best to win with your favorite Pokemon.&#34;</span>
Tsuiyo Pokemon

Yoi Pokemon

That kind of person

Really good
For trainers

I like Pokémon
You should try hard
</code></pre></div><p>Oh!</p>
<p>It looks like that
It became a message!</p>
<h2 id="allow-sending-messages">Allow sending messages</h2>
<p>Up to this point, the display looks quite like that. In the original game, instead of displaying all the text at once on the screen, it is displayed in about two lines and you can send a message by pressing the button. I will try to reproduce this. We will also change it so that a <code>▼</code> can be displayed at the end of the message to indicate that the message can be sent. For message sending, I decided to put <code>input()</code> and wait for the Enter key.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">line <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
lineCounter <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">for</span> word <span style="color:#f92672">in</span> result_list:
    <span style="color:#66d9ef">if</span> len(line) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
        line <span style="color:#f92672">=</span> word
        newLine <span style="color:#f92672">=</span> line
    <span style="color:#66d9ef">else</span>:
        newLine <span style="color:#f92672">=</span> line <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">+</span> word

    <span style="color:#66d9ef">if</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">in</span> newLine:
        <span style="color:#66d9ef">if</span> len(newLine)<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">16</span>:
            <span style="color:#66d9ef">print</span>(line)
            <span style="color:#66d9ef">print</span>(word)
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">print</span>(newLine);
        lineCounter <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
        line <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
    <span style="color:#66d9ef">elif</span> len(newLine) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">16</span>:
        line <span style="color:#f92672">=</span> newLine
    <span style="color:#66d9ef">else</span>:
        <span style="color:#66d9ef">print</span>(line); lineCounter <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
        line <span style="color:#f92672">=</span> word

    <span style="color:#66d9ef">if</span> lineCounter <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34; ▼ ▼&#34;</span>); input()
        lineCounter <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

<span style="color:#66d9ef">print</span>(line, end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#75715e"># excluding the last newline</span>
</code></pre></div><h3 id="code-up-to-here-1">Code up to here</h3>
<details><summary>Full code up to here (click to expand)</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:pokemon_msg.py" data-lang="python:pokemon_msg.py">
<span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> jaconv

BASE_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.ce-cotoha.com/api/dev/nlp/&#34;</span>
CLIENT_ID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enter COTOHA Client ID&#34;</span>
CLIENT_SECRET <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enter COTOHA Client Secret&#34;</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">auth</span>(client_id, client_secret):
    token_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.ce-cotoha.com/v1/oauth/accesstokens&#34;</span>
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
        <span style="color:#e6db74">&#34;charset&#34;</span>: <span style="color:#e6db74">&#34;UTF-8&#34;</span>
    }

    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;grantType&#34;</span>: <span style="color:#e6db74">&#34;client_credentials&#34;</span>,
        <span style="color:#e6db74">&#34;clientId&#34;</span>: client_id,
        <span style="color:#e6db74">&#34;clientSecret&#34;</span>: client_secret
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(token_url,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))
    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#34;access_token&#34;</span>]


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse</span>(sentence, access_token):
    base_url <span style="color:#f92672">=</span> BASE_URL
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
        <span style="color:#e6db74">&#34;charset&#34;</span>: <span style="color:#e6db74">&#34;UTF-8&#34;</span>,
        <span style="color:#e6db74">&#34;Authorization&#34;</span>: <span style="color:#e6db74">&#34;Bearer {}&#34;</span><span style="color:#f92672">.</span>format(access_token)
    }
    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;sentence&#34;</span>: sentence,
        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;default&#34;</span>
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(base_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;v1/parse&#34;</span>,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))
    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()

<span style="color:#75715e"># Convert only words other than katakana to hiragana</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">conv_kana</span>(token):
    <span style="color:#66d9ef">if</span> token[<span style="color:#e6db74">&#34;form&#34;</span>] <span style="color:#f92672">!=</span> token[<span style="color:#e6db74">&#34;kana&#34;</span>]:
        word <span style="color:#f92672">=</span> jaconv<span style="color:#f92672">.</span>kata2hira(token[<span style="color:#e6db74">&#34;kana&#34;</span>])
    <span style="color:#66d9ef">else</span>:
        word <span style="color:#f92672">=</span> token[<span style="color:#e6db74">&#34;kana&#34;</span>]
    <span style="color:#66d9ef">return</span> word


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    document <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;You have now taken the first step to the Can Tho region!&#34;</span> <span style="color:#75715e">#Sample text</span>
    document <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Strong Pokémon, Weak Pokémon, such people&#39;s selfishness. If you are a really strong trainer, you should try hard to win with your favorite Pokemon.&#34;</span>
    args <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv
    <span style="color:#66d9ef">if</span> len(args) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>:
        document <span style="color:#f92672">=</span> str(args[<span style="color:#ae81ff">1</span>]) <span style="color:#75715e"># Replace with sample if argument is presentaccess_token = auth(CLIENT_ID, CLIENT_SECRET)</span>
    parse_document <span style="color:#f92672">=</span> parse(document, access_token)
    result_list <span style="color:#f92672">=</span> list()
    <span style="color:#66d9ef">for</span> chunks <span style="color:#f92672">in</span> parse_document[<span style="color:#e6db74">&#39;result&#39;</span>]:
        text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#75715e"># prepare empty text</span>
        <span style="color:#66d9ef">for</span> token <span style="color:#f92672">in</span> chunks[<span style="color:#e6db74">&#34;tokens&#34;</span>]:

            word <span style="color:#f92672">=</span> conv_kana(token)
            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;unique&#34;</span> <span style="color:#f92672">in</span> token[<span style="color:#e6db74">&#34;features&#34;</span>]:
                text <span style="color:#f92672">+=</span> word <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#75715e"># Add full-width space</span>
            <span style="color:#66d9ef">elif</span> token[<span style="color:#e6db74">&#34;pos&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;punctuation&#34;</span> <span style="color:#f92672">or</span> token[<span style="color:#e6db74">&#34;pos&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;punctuation&#34;</span>:
                <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;question mark&#34;</span> <span style="color:#f92672">in</span> token[<span style="color:#e6db74">&#34;features&#34;</span>]:
                    text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;?</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#34;exclamation mark&#34;</span> <span style="color:#f92672">in</span> token[<span style="color:#e6db74">&#34;features&#34;</span>]:
                    text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#66d9ef">else</span>:
                    text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
            <span style="color:#66d9ef">else</span>:
                text <span style="color:#f92672">+=</span> word

        result_list<span style="color:#f92672">.</span>append(text)

    line <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
    lineCounter <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">for</span> word <span style="color:#f92672">in</span> result_list:
        <span style="color:#66d9ef">if</span> len(line) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
            line <span style="color:#f92672">=</span> word
            newLine <span style="color:#f92672">=</span> line
        <span style="color:#66d9ef">else</span>:
            newLine <span style="color:#f92672">=</span> line <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">+</span> word

        <span style="color:#66d9ef">if</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">in</span> newLine:
            <span style="color:#66d9ef">if</span> len(newLine)<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">16</span>:
                <span style="color:#66d9ef">print</span>(line)
                <span style="color:#66d9ef">print</span>(word)
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">print</span>(newLine);
            lineCounter <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
            line <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
        <span style="color:#66d9ef">elif</span> len(newLine) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">16</span>:
            line <span style="color:#f92672">=</span> newLine
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">print</span>(line); lineCounter <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
            line <span style="color:#f92672">=</span> word

        <span style="color:#66d9ef">if</span> lineCounter <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34; ▼ ▼&#34;</span>); input()
            lineCounter <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>


    <span style="color:#66d9ef">print</span>(line, end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#75715e"># excluding the last newline</span>
</code></pre></div></div>
<h3 id="result-3">result</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 pokemon_msg.py <span style="color:#e6db74">&#34;Strong Pokemon, Weak Pokémon, the kind of people like that. If you&#39;re a really strong trainer, you should do your best to win with your favorite Pokemon.&#34;</span>
Tsuiyo Pokemon
▼▼
Yoi Pokemon
▼▼
That kind of person
▼▼
Really good
For trainers
▼▼
I like Pokémon
You should try hard
▼▼
</code></pre></div><p>This actually feels more like it&rsquo;s executed from the command line, you can send messages one by one with the Enter key.</p>
<h1 id="reigaishori">Reigaishori▼</h1>
<p>As I wrote at the beginning, in Pokemon-like message display</p>
<blockquote>
<p>-Kanji is not used (with some exceptions)</p>
</blockquote>
<p>However, there are some exceptions, which are &ldquo;yen&rdquo; on the price display. Only here, Kanji is used. If you try to replace the &ldquo;yen&rdquo; character as it is, all idioms such as &ldquo;go smoothly&rdquo; will also change, which is a problem. But with COTOHA API, you can distinguish <code>classifier</code> by part of speech, so I decided to use it.</p>
<h2 id="what-if-you-want-to-use-a-classifier-to-judge-">What if you want to use a classifier to judge 〇○……?</h2>
<p>However, this was no good.
Following the COTOHA API reference, if you throw the word &ldquo;500 yen&rdquo;, the following information will be returned.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -X POST -H <span style="color:#e6db74">&#34;Content-Type:application/json;charset=UTF-8&#34;</span> -H <span style="color:#e6db74">&#34;Authorization:Bearer [Access Token]&#34;</span> -d<span style="color:#e6db74">&#39;{&#34;sentence&#34;:&#34;500 Yen&#34;,&#34;type&#34;: &#34;default&#34;}&#39;</span> <span style="color:#e6db74">&#34;[API Base URL]/nlp/v1/parse&#34;</span>
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;result&#34;</span> :<span style="color:#f92672">[</span> <span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;chunk_info&#34;</span> :<span style="color:#f92672">{</span>
      <span style="color:#e6db74">&#34;id&#34;</span>: 0,
      <span style="color:#e6db74">&#34;head&#34;</span> :-1,
      <span style="color:#e6db74">&#34;dep&#34;</span> :<span style="color:#e6db74">&#34;O&#34;</span>,
      <span style="color:#e6db74">&#34;chunk_head&#34;</span>: 0,
      <span style="color:#e6db74">&#34;chunk_func&#34;</span>: 0,
      <span style="color:#e6db74">&#34;links&#34;</span> :<span style="color:#f92672">[]</span>
    <span style="color:#f92672">}</span>,
    <span style="color:#e6db74">&#34;tokens&#34;</span> :<span style="color:#f92672">[</span> <span style="color:#f92672">{</span>
      <span style="color:#e6db74">&#34;id&#34;</span>: 0,
      <span style="color:#e6db74">&#34;form&#34;</span>: <span style="color:#e6db74">&#34;500 yen&#34;</span>,
      <span style="color:#e6db74">&#34;kana&#34;</span>: <span style="color:#e6db74">&#34;Gohyakuen&#34;</span>,
      <span style="color:#e6db74">&#34;lemma&#34;</span>: <span style="color:#e6db74">&#34;500 yen&#34;</span>,
      <span style="color:#e6db74">&#34;pos&#34;</span>: <span style="color:#e6db74">&#34;noun&#34;</span>,
      <span style="color:#e6db74">&#34;features&#34;</span> :<span style="color:#f92672">[</span> <span style="color:#f92672">]</span>,
      <span style="color:#e6db74">&#34;dependency_labels&#34;</span> :<span style="color:#f92672">[</span> <span style="color:#f92672">]</span>,
      <span style="color:#e6db74">&#34;attributes&#34;</span> :<span style="color:#f92672">{}</span>
    <span style="color:#f92672">}]</span>
  <span style="color:#f92672">}</span> <span style="color:#f92672">]</span>,
  <span style="color:#e6db74">&#34;status&#34;</span>: 0,
  <span style="color:#e6db74">&#34;message&#34;</span> :<span style="color:#e6db74">&#34;&#34;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>That noun&hellip;?</p>
<p>What was expected was that &ldquo;pos&rdquo; of &ldquo;yen&rdquo; would become &ldquo;classifier&rdquo; by splitting into &ldquo;500&rdquo; and &ldquo;yen&rdquo;. When &ldquo;151&rdquo; or &ldquo;10 years old&rdquo; or the like, &ldquo;cat&rdquo; or &ldquo;age&rdquo; is properly separated as a <code>classifier</code>, but the price seems to be a <code>noun</code> in a lump. I&rsquo;m not familiar with linguistics so I&rsquo;m not very familiar with these classifications, but I was disappointed.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 pokemon_msg.py <span style="color:#e6db74">&#34;The secret Pokémon, Coyking is only 500 yen! How can I buy it?&#34;</span>
Secret Pokemon
▼▼
Coking
What a hell!
▼▼
How is it?
▼▼
</code></pre></div><p>~~ Unfortunately, I will give up on the amount. ~~ Well, isn&rsquo;t it so strange as the text of the game?</p>
<h2 id="use-named-entity-extraction">Use named entity extraction</h2>
<p>(Added on March 12, 2020)
In the comment, I got the advice that &ldquo;It is better to use <a href="https://api.ce-cotoha.com/contents/reference/apireference.html#entity">property extraction</a>&quot;(thanksto@hanamizuno). .. Certainly, it can be judged by whether the <code>class</code> of this result is <code>MNY</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl -X POST -H <span style="color:#e6db74">&#34;Content-Type:application/json;charset=UTF-8&#34;</span> -H <span style="color:#e6db74">&#34;Authorization:Bearer [Access Token]&#34;</span> -d<span style="color:#e6db74">&#39;{&#34;sentence&#34;:&#34; Secret Pokémon, Koi King 500 yen! How would you buy it?&#34;, &#34;type&#34;: &#34;default&#34;}&#39;</span> <span style="color:#e6db74">&#34;[API Base URL]/nlp/v1/ne&#34;</span>
<span style="color:#f92672">{</span>
  <span style="color:#e6db74">&#34;result&#34;</span> :<span style="color:#f92672">[</span> <span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;begin_pos&#34;</span> :3
    <span style="color:#e6db74">&#34;end_pos&#34;</span> :7
    <span style="color:#e6db74">&#34;form&#34;</span>: <span style="color:#e6db74">&#34;Pokemon&#34;</span>,
    <span style="color:#e6db74">&#34;std_form&#34;</span>: <span style="color:#e6db74">&#34;Pokemon&#34;</span>,
    <span style="color:#e6db74">&#34;class&#34;</span> :<span style="color:#e6db74">&#34;ART&#34;</span>,
    <span style="color:#e6db74">&#34;extended_class&#34;</span> :<span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#e6db74">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;basic&#34;</span>
  <span style="color:#f92672">}</span>, <span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;begin_pos&#34;</span> :8
    <span style="color:#e6db74">&#34;end_pos&#34;</span> :13
    <span style="color:#e6db74">&#34;form&#34;</span>: <span style="color:#e6db74">&#34;coking&#34;</span>,
    <span style="color:#e6db74">&#34;std_form&#34;</span>: <span style="color:#e6db74">&#34;coking&#34;</span>,
    <span style="color:#e6db74">&#34;class&#34;</span> :<span style="color:#e6db74">&#34;ART&#34;</span>,
    <span style="color:#e6db74">&#34;extended_class&#34;</span> :<span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#e6db74">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;basic&#34;</span>
  <span style="color:#f92672">}</span>, <span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;begin_pos&#34;</span>: 21,
    <span style="color:#e6db74">&#34;end_pos&#34;</span> :25,
    <span style="color:#e6db74">&#34;form&#34;</span>: <span style="color:#e6db74">&#34;500 yen&#34;</span>,
    <span style="color:#e6db74">&#34;std_form&#34;</span>: <span style="color:#e6db74">&#34;500 yen&#34;</span>,
    <span style="color:#e6db74">&#34;class&#34;</span>: <span style="color:#e6db74">&#34;MNY&#34;</span>,
    <span style="color:#e6db74">&#34;extended_class&#34;</span> :<span style="color:#e6db74">&#34;&#34;</span>,
    <span style="color:#e6db74">&#34;source&#34;</span>: <span style="color:#e6db74">&#34;basic&#34;</span>
  <span style="color:#f92672">}</span> <span style="color:#f92672">]</span>,
  <span style="color:#e6db74">&#34;status&#34;</span>: 0,
  <span style="color:#e6db74">&#34;message&#34;</span> :<span style="color:#e6db74">&#34;&#34;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>First, store all <code>MNY</code> elements that are &ldquo;money expressions&rdquo; included in the sentence in the list.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#List words with monetary expressions</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">make_pricelist</span>(ne_document):

    pricelist <span style="color:#f92672">=</span> list()

    <span style="color:#66d9ef">for</span> result <span style="color:#f92672">in</span> ne_document[<span style="color:#e6db74">&#39;result&#39;</span>]:
        <span style="color:#66d9ef">if</span> result[<span style="color:#e6db74">&#39;class&#39;</span>] <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;MNY&#39;</span>:
            pricelist<span style="color:#f92672">.</span>append(result[<span style="color:#e6db74">&#39;form&#39;</span>])

    <span style="color:#66d9ef">return</span> pricelist
</code></pre></div><p>The <code>conv_kana</code> function that converts the Katakana created above to hiragana is also used for monetary expressions so that the strings stored in this list are scanned in order and the original word is returned in the case of monetary expressions. Rewritten as conv_word<code>. However, if you return the monetary expression with Chinese numerals such as &quot;50 yen&quot;, it will ruin the atmosphere, so I will convert it into Arabic kanji in different cases. I used the </code>kanjize` library introduced in [Kanjize]-[Kanjize] mutual conversion library for Python numbers &lt;-&gt; Kanji numbers](<a href="https://qiita.com/nagataaaas/items/154751c4f23b468e1c15">https://qiita.com/nagataaaas/items/154751c4f23b468e1c15</a>) .. Also, instead of half-width numbers, we will output full-width numbers.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Convert only words other than katakana to hiragana,</span>
<span style="color:#75715e"># If the monetary expression is included, only the Kanji of &#34;Yen&#34; is left and converted</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">conv_word</span>(token, pricelist):

    <span style="color:#66d9ef">if</span> len(pricelist)<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
        price <span style="color:#f92672">=</span> pricelist[<span style="color:#ae81ff">0</span>]
        <span style="color:#66d9ef">if</span> token[<span style="color:#e6db74">&#34;form&#34;</span>] <span style="color:#f92672">==</span> price:
            price <span style="color:#f92672">=</span> pricelist<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>)<span style="color:#75715e"># If it is expressed in Chinese numerals, change it to Arabic kanji</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#39;[0-9].+&#39;</span>, price):
                price <span style="color:#f92672">=</span> str(kanji2int(price<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;yen&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>))) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;yen&#34;</span>

            <span style="color:#75715e"># Return half-width numbers as full-width numbers</span>
            <span style="color:#66d9ef">return</span> jaconv<span style="color:#f92672">.</span>h2z(price, digit<span style="color:#f92672">=</span>True, ascii<span style="color:#f92672">=</span>True)

    <span style="color:#66d9ef">if</span> token[<span style="color:#e6db74">&#34;form&#34;</span>] <span style="color:#f92672">!=</span> token[<span style="color:#e6db74">&#34;kana&#34;</span>]:
        word <span style="color:#f92672">=</span> jaconv<span style="color:#f92672">.</span>kata2hira(token[<span style="color:#e6db74">&#34;kana&#34;</span>])
    <span style="color:#66d9ef">else</span>:
        word <span style="color:#f92672">=</span> token[<span style="color:#e6db74">&#34;kana&#34;</span>]
    <span style="color:#66d9ef">return</span> word
</code></pre></div><h3 id="code-up-to-here-2">Code up to here</h3>
<details><summary>Full code up to here (click to expand)</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:pokemon_msg.py" data-lang="python:pokemon_msg.py"><span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> jaconv
<span style="color:#f92672">import</span> re
<span style="color:#f92672">from</span> kanjize <span style="color:#f92672">import</span> int2kanji, kanji2int

BASE_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.ce-cotoha.com/api/dev/nlp/&#34;</span>
CLIENT_ID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enter COTOHA Client ID&#34;</span>
CLIENT_SECRET <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Enter COTOHA Client Secret&#34;</span>


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">auth</span>(client_id, client_secret):
    token_url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.ce-cotoha.com/v1/oauth/accesstokens&#34;</span>
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
        <span style="color:#e6db74">&#34;charset&#34;</span>: <span style="color:#e6db74">&#34;UTF-8&#34;</span>
    }

    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;grantType&#34;</span>: <span style="color:#e6db74">&#34;client_credentials&#34;</span>,
        <span style="color:#e6db74">&#34;clientId&#34;</span>: client_id,
        <span style="color:#e6db74">&#34;clientSecret&#34;</span>: client_secret
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(token_url,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))
    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#34;access_token&#34;</span>]


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse</span>(sentence, access_token):
    base_url <span style="color:#f92672">=</span> BASE_URL
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
        <span style="color:#e6db74">&#34;charset&#34;</span>: <span style="color:#e6db74">&#34;UTF-8&#34;</span>,
        <span style="color:#e6db74">&#34;Authorization&#34;</span>: <span style="color:#e6db74">&#34;Bearer {}&#34;</span><span style="color:#f92672">.</span>format(access_token)
    }
    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;sentence&#34;</span>: sentence,
        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;default&#34;</span>
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(base_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;v1/parse&#34;</span>,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))
    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ne</span>(sentence, access_token):
    base_url <span style="color:#f92672">=</span> BASE_URL
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
        <span style="color:#e6db74">&#34;charset&#34;</span>: <span style="color:#e6db74">&#34;UTF-8&#34;</span>,
        <span style="color:#e6db74">&#34;Authorization&#34;</span>: <span style="color:#e6db74">&#34;Bearer {}&#34;</span><span style="color:#f92672">.</span>format(access_token)
    }
    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;sentence&#34;</span>: sentence,
        <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;default&#34;</span>
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(base_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;v1/ne&#34;</span>,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))
    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()

<span style="color:#75715e"># Convert only words other than katakana to hiragana,</span>
<span style="color:#75715e"># If the monetary expression is included, only the Kanji of &#34;Yen&#34; is left and converted</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">conv_word</span>(token, pricelist):

    <span style="color:#66d9ef">if</span> len(pricelist)<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
        price <span style="color:#f92672">=</span> pricelist[<span style="color:#ae81ff">0</span>]
        <span style="color:#66d9ef">if</span> token[<span style="color:#e6db74">&#34;form&#34;</span>] <span style="color:#f92672">==</span> price:
            price <span style="color:#f92672">=</span> pricelist<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>)
            <span style="color:#75715e"># If it is expressed in Chinese numerals, change it to Arabic kanji</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#39;[0-9].+&#39;</span>, price):
                price <span style="color:#f92672">=</span> str(kanji2int(price<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;yen&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>))) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;yen&#34;</span>

            <span style="color:#75715e"># Return half-width numbers as full-width numbers</span>
            <span style="color:#66d9ef">return</span> jaconv<span style="color:#f92672">.</span>h2z(price, digit<span style="color:#f92672">=</span>True, ascii<span style="color:#f92672">=</span>True)

    <span style="color:#66d9ef">if</span> token[<span style="color:#e6db74">&#34;form&#34;</span>] <span style="color:#f92672">!=</span> token[<span style="color:#e6db74">&#34;kana&#34;</span>]:
        word <span style="color:#f92672">=</span> jaconv<span style="color:#f92672">.</span>kata2hira(token[<span style="color:#e6db74">&#34;kana&#34;</span>])
    <span style="color:#66d9ef">else</span>:
        word <span style="color:#f92672">=</span> token[<span style="color:#e6db74">&#34;kana&#34;</span>]
    <span style="color:#66d9ef">return</span> word

<span style="color:#75715e">#List words with monetary expressions</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">make_pricelist</span>(ne_document):

    pricelist <span style="color:#f92672">=</span> list()

    <span style="color:#66d9ef">for</span> result <span style="color:#f92672">in</span> ne_document[<span style="color:#e6db74">&#39;result&#39;</span>]:
        <span style="color:#66d9ef">if</span> result[<span style="color:#e6db74">&#39;class&#39;</span>] <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;MNY&#39;</span>:
            pricelist<span style="color:#f92672">.</span>append(result[<span style="color:#e6db74">&#39;form&#39;</span>])

    <span style="color:#66d9ef">return</span> pricelist
    

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    document <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;You have now taken the first step to the Can Tho region!&#34;</span> <span style="color:#75715e">#Sample text</span>
    document <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Strong Pokémon, Weak Pokémon, such people&#39;s selfishness. If you are a really strong trainer, you should try hard to win with your favorite Pokemon.&#34;</span>
    document <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;The secret Pokémon, Coyking is only 500 yen! How should I buy it?&#34;</span> <span style="color:#75715e">#Sample text</span>
    args <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv
    <span style="color:#66d9ef">if</span> len(args) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>:
        document <span style="color:#f92672">=</span> str(args[<span style="color:#ae81ff">1</span>]) <span style="color:#75715e"># Replace with sample if argument is present</span>

    access_token <span style="color:#f92672">=</span> auth(CLIENT_ID, CLIENT_SECRET)
    parse_document <span style="color:#f92672">=</span> parse(document, access_token)
    ne_document <span style="color:#f92672">=</span> ne(document, access_token)
    pricelist <span style="color:#f92672">=</span> make_pricelist(ne_document)
    result_list <span style="color:#f92672">=</span> list()
    <span style="color:#66d9ef">for</span> chunks <span style="color:#f92672">in</span> parse_document[<span style="color:#e6db74">&#39;result&#39;</span>]:
        text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#75715e"># prepare empty text</span>
        <span style="color:#66d9ef">for</span> token <span style="color:#f92672">in</span> chunks[<span style="color:#e6db74">&#34;tokens&#34;</span>]:

            word <span style="color:#f92672">=</span> conv_word(token, pricelist)
            <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;unique&#34;</span> <span style="color:#f92672">in</span> token[<span style="color:#e6db74">&#34;features&#34;</span>]:
                text <span style="color:#f92672">+=</span> word <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#75715e"># Add full-width space</span>
            <span style="color:#66d9ef">elif</span> token[<span style="color:#e6db74">&#34;pos&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;punctuation&#34;</span> <span style="color:#f92672">or</span> token[<span style="color:#e6db74">&#34;pos&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;punctuation&#34;</span>:
                <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;question mark&#34;</span> <span style="color:#f92672">in</span> token[<span style="color:#e6db74">&#34;features&#34;</span>]:
                    text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;?</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#66d9ef">elif</span> <span style="color:#e6db74">&#34;exclamation mark&#34;</span> <span style="color:#f92672">in</span> token[<span style="color:#e6db74">&#34;features&#34;</span>]:
                    text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
                <span style="color:#66d9ef">else</span>:
                    text <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
            <span style="color:#66d9ef">else</span>:
                text <span style="color:#f92672">+=</span> word

        result_list<span style="color:#f92672">.</span>append(text)

    line <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
    lineCounter <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">for</span> word <span style="color:#f92672">in</span> result_list:
        <span style="color:#66d9ef">if</span> len(line) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
            line <span style="color:#f92672">=</span> word
            newLine <span style="color:#f92672">=</span> line
        <span style="color:#66d9ef">else</span>:
            newLine <span style="color:#f92672">=</span> line <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">+</span> word

        <span style="color:#66d9ef">if</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">in</span> newLine:
            <span style="color:#66d9ef">if</span> len(newLine)<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">16</span>:
                <span style="color:#66d9ef">print</span>(line)
                <span style="color:#66d9ef">print</span>(word)
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">print</span>(newLine);
            lineCounter <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
            line <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
        <span style="color:#66d9ef">elif</span> len(newLine) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">16</span>:
            line <span style="color:#f92672">=</span> newLine
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">print</span>(line); lineCounter <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
            line <span style="color:#f92672">=</span> word

        <span style="color:#66d9ef">if</span> lineCounter <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34; ▼ ▼&#34;</span>); input()
            lineCounter <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>


    <span style="color:#66d9ef">print</span>(line, end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#75715e"># excluding the last newline</span>

</code></pre></div></div>
<h3 id="result-4">result</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 pokemon_msg.py <span style="color:#e6db74">&#34;The secret Pokémon, Coyking is only 500 yen! How can I buy it?&#34;</span>
Secret Pokemon
▼▼
Coking
Only <span style="color:#ae81ff">500</span> yen!
▼▼
How is it?
▼▼
</code></pre></div><p>I&rsquo;m done.</p>
<h1 id="summary-">Summary ▼</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">The fascination is amazing!▼
Right now
Send Japanese
▼▼
I<span style="color:#960050;background-color:#1e0010">&#39;</span>m afraid
You can see
▼▼
</code></pre></div><h2 id="to-make-it-more-like-that">To make it more like that</h2>
<p>It&rsquo;s kinda like that, but there&rsquo;s more to do.</p>
<h3 id="processing-the-classifier-yen">Processing the classifier &ldquo;yen&rdquo;</h3>
<p>~~ As mentioned above. Probably I think that it can be judged by conditional branching in combination with numbers, but I gave up for the time being. ~~
(Added on March 12, 2020): It is now possible to process using the named entity extraction function.</p>
<h3 id="alphanumeric-processing">Alphanumeric processing</h3>
<p>The COTOHA API is excellent, so it&rsquo;s all easy to handle in Japanese. For example, <code>COTOHA</code> makes it <code>she-o-te-e-etchi</code>, and <code>151</code> makes it <code>hyakugojuupipiki</code> (not hyakugoju &ldquo;Ichihiki&rdquo;). Or However, I think it would be better to display English letters and Arabic numerals as they are.</p>
<h1 id="katsuyo-hoho-">Katsuyo Hoho ▼</h1>
<p>If it is used in combination with voice recognition, it is possible to convert the spoken content into a retro game text style and display it in the form of overlapping video. Basically, it becomes hiragana and katakana, so it may be useful for children&rsquo;s programs (?).</p>
<h1 id="link-">Link ▼</h1>
<ul>
<li><a href="https://api.ce-cotoha.com/contents/index.html">COTOHA API-NTT Communications</a></li>
<li><a href="https://qiita.com/Harusugi/items/f499e8707b36d0f570c4">Ore program Ugocas Omae Genshizinaru-Qiita</a></li>
<li><a href="https://qiita.com/gossy5454/items/83072418fb0c5f3e269f">I tried using the COTOHA API rumored to be easy to handle natural language processing with Python-Qiita</a></li>
<li><a href="https://qiita.com/nagataaaas/items/154751c4f23b468e1c15">Kanjize, a mutual conversion library for numbers &lt;-&gt; Chinese numbers for Python-Qiita</a></li>
<li><a href="https://www.youtube.com/watch?v=V0sHeCUrDfo">Pokemon Red/Green/Blue/Pikachu digest video-YouTube</a>: Used as a reference for message display.</li>
<li><a href="https://github.com/mkuriki1990/poke_msg">mkuriki1990/poke_msg-GitHub</a>: Source code is MIT License.</li>
</ul>
<h1 id="license-">License ▼</h1>
<h2 id="this-sentence">This sentence</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">This kiji no inoububunto
Boy<span style="color:#960050;background-color:#1e0010">&#39;</span>s game is noodle
▼▼
Nozoku
Kantori-Kurabubai Yontendoro
Licensed
▼▼
</code></pre></div><p>(The text except the quoted part and the game screen at the beginning of this article is licensed at <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>.) <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
<h2 id="source-code-1">Source code</h2>
<p>The source code is licensed under the MIT License as described in the GitHub repository.
<a href="https://github.com/mkuriki1990/poke_msg">mkuriki1990/poke_msg-GitHub</a></p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>You may be able to display kanji in recent works, but in this article, I will try to match the specifications of the so-called &ldquo;first generation&rdquo; &ldquo;Pokemon red/green&rdquo;. <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>In COTOHA API, &ldquo;CC&rdquo; seems to be &ldquo;country club&rdquo;. Of course here &ldquo;CC&rdquo; means &ldquo;Creative Commons&rdquo;. <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
