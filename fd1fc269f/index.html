<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Python] A problem study memo that asks for too much divided by 1000000007 | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] A problem study memo that asks for too much divided by 1000000007</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 16, 2016
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/programming"> programming</a></code></small>

</p>
<pre><code>In programming contests, when the answer gets very large, the question often arises is to find too much divided by a prime number.
</code></pre>
<p>I studied the way of thinking about such problems, so I will summarize it.
The sample code is basically Python 2.7.
Reference: <a href="http://nagoyacoder.web.fc2.com/topcoder/topcoder_cpp4.html">Top Coder Trends and Countermeasures 4 (C++: Counting)</a></p>
<h1 id="what-should-i-do">What should I do?</h1>
<p>You just have to ask too much for each calculation.</p>
<h2 id="in-case-of-addition">In case of addition</h2>
<p>After adding, you can ask for too much.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">mod <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000000007</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add</span>(a, b):
    <span style="color:#66d9ef">return</span> (a <span style="color:#f92672">+</span> b) <span style="color:#f92672">%</span>mod
</code></pre></div><h2 id="in-case-of-subtraction">In case of subtraction</h2>
<p>In the case of Python, you don&rsquo;t have to think about it, you can draw it, and then ask for too much.
If your language requires too many negative values, don&rsquo;t worry about it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">mod <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000000007</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sub</span>(a, b):
    <span style="color:#66d9ef">return</span> (a <span style="color:#f92672">+</span> mod<span style="color:#f92672">-</span>b) <span style="color:#f92672">%</span>mod

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sub_</span>(a, b):
    <span style="color:#66d9ef">return</span> (a<span style="color:#f92672">-</span>b) <span style="color:#f92672">%</span>mod

<span style="color:#66d9ef">print</span> sub(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>) <span style="color:#75715e"># =&gt; 1000000006</span>
<span style="color:#66d9ef">print</span> sub_(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>) <span style="color:#75715e"># =&gt; 1000000006</span>
</code></pre></div><p>When I tried it with C, it became a negative value.
In this case, it seems good to add 1000000007 to <code>a</code> and then subtract <code>b</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">int</span> mod <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000000007</span>;

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">sub</span>(a, b) {
  <span style="color:#66d9ef">return</span> (a <span style="color:#f92672">+</span> mod<span style="color:#f92672">-</span>b) <span style="color:#f92672">%</span>mod;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">sub_</span>(a, b) {
  <span style="color:#66d9ef">return</span> (a<span style="color:#f92672">-</span>b) <span style="color:#f92672">%</span>mod;
}

<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">void</span>){
  printf(<span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, sub(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>)); <span style="color:#75715e">// =&gt; 1000000006
</span><span style="color:#75715e"></span>  printf(<span style="color:#e6db74">&#34;%d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, sub_(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>)); <span style="color:#75715e">// =&gt; -1
</span><span style="color:#75715e"></span>}
</code></pre></div><p>The compiler used the following.</p>
<pre><code>$ gcc -v
Configured with: --prefix=/Applications/Xcode.app/Contents/Developer/usr --with-gxx-include-dir=/usr/include/c++/4.2.1
Apple LLVM version 8.0.0 (clang-800.0.38)
Target: x86_64-apple-darwin16.0.0
Thread model: posix
InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin
</code></pre><h2 id="for-multiplication">For multiplication</h2>
<p>Multiply each other and take more.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">mod <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000000007</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">mul</span>(a, b):
    <span style="color:#66d9ef">return</span> ((a <span style="color:#f92672">%</span>mod) <span style="color:#f92672">*</span> (b <span style="color:#f92672">%</span>mod)) <span style="color:#f92672">%</span>mod
</code></pre></div><h2 id="for-division">For division</h2>
<p>Suddenly Fermat&rsquo;s Little Theorem comes out and I&rsquo;m scared. It seems to be difficult.
For the time being, I don&rsquo;t really understand if it is division, so I would like to fix it in multiplication.</p>
<pre><code class="language-math" data-lang="math">a \div b = a \times b^{-1}
</code></pre><p>That&rsquo;s what it is. Therefore, I want to find the inverse element of <code>b</code> in too much world.
Then we use Fermat&rsquo;s Little Theorem to find the inverse.
See the reference page for the process, and the result is like <code>b</code> raised to 1000000005.
In other words, the following calculation should be done in division.</p>
<pre><code class="language-math" data-lang="math">a \div b = a \times b^{1000000005} (mod 1000000007)
</code></pre><p>This time, we have to do a heavy calculation of <code>b</code> to the 1000000005th power, but the dichotomy method can be used for this.
If you first find the square, use it to find the fourth power, and then use it to find the eighth power, and so on, you&rsquo;ll get much faster than multiplying <code>b</code> by 1000000005 times. Therefore it is a story.</p>
<p>Summarizing the above, the division is as follows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">mod <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000000007</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">mul</span>(a, b):
    <span style="color:#66d9ef">return</span> ((a <span style="color:#f92672">%</span>mod) <span style="color:#f92672">*</span> (b <span style="color:#f92672">%</span>mod)) <span style="color:#f92672">%</span>mod

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">power</span>(x, y):
    <span style="color:#66d9ef">if</span> y <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> :<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">elif</span> y <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> :<span style="color:#66d9ef">return</span> x <span style="color:#f92672">%</span>mod
    <span style="color:#66d9ef">elif</span> y <span style="color:#f92672">%</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>: <span style="color:#66d9ef">return</span> power(x, y<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">%</span>mod
    <span style="color:#66d9ef">else</span>: <span style="color:#66d9ef">return</span> power(x, y<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> x <span style="color:#f92672">%</span>mod

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">div</span>(a, b):
    <span style="color:#66d9ef">return</span> mul(a, power(b, mod<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>))

<span style="color:#66d9ef">print</span> div(<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">3</span>) <span style="color:#75715e"># =&gt; 2</span>
<span style="color:#66d9ef">print</span> div(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">2</span>) <span style="color:#75715e"># =&gt; 5</span>
<span style="color:#66d9ef">print</span> div(<span style="color:#ae81ff">3000000000</span>, <span style="color:#ae81ff">2</span>) <span style="color:#75715e"># =&gt; 499999993</span>
<span style="color:#66d9ef">print</span> div(<span style="color:#ae81ff">45000000000</span>, <span style="color:#ae81ff">5</span>) <span style="color:#75715e"># =&gt; 999999944</span>
<span style="color:#66d9ef">print</span> div(<span style="color:#ae81ff">4000000000</span>, <span style="color:#ae81ff">2000000000</span>) <span style="color:#75715e"># =&gt; 2</span>
<span style="color:#66d9ef">print</span> div(<span style="color:#ae81ff">45000000000</span>, <span style="color:#ae81ff">5000000000</span>) <span style="color:#75715e"># =&gt; 9</span>
</code></pre></div><p>Sounds good, but not intuitive&hellip;</p>
<h1 id="try-to-solve-some-problems-because-it-is">Try to solve some problems because it is</h1>
<p>I tried it. This is a problem to calculate the combination.
<a href="http://abc042.contest.atcoder.jp/tasks/arc058_b">AtCoder Beginner Contest 042: D-Iroha-chan and square</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">mod <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000000007</span>
H, W, A, B <span style="color:#f92672">=</span> map(int, raw_input()<span style="color:#f92672">.</span>split())

factorial <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>]
<span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> xrange(<span style="color:#ae81ff">1</span>, H<span style="color:#f92672">+</span>W):
    factorial<span style="color:#f92672">.</span>append(factorial[n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">*</span>n<span style="color:#f92672">%</span>mod)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">power</span>(x, y):
    <span style="color:#66d9ef">if</span> y <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> :<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">elif</span> y <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> :<span style="color:#66d9ef">return</span> x <span style="color:#f92672">%</span>mod
    <span style="color:#66d9ef">elif</span> y <span style="color:#f92672">%</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>: <span style="color:#66d9ef">return</span> power(x, y<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">%</span>mod
    <span style="color:#66d9ef">else</span>: <span style="color:#66d9ef">return</span> power(x, y<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> x <span style="color:#f92672">%</span>mod

inverseFactorial <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*</span> (H<span style="color:#f92672">+</span>W)
inverseFactorial[H<span style="color:#f92672">+</span>W<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> power(factorial[H<span style="color:#f92672">+</span>W<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>], mod<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>)
<span style="color:#66d9ef">for</span> n <span style="color:#f92672">in</span> xrange(H<span style="color:#f92672">+</span>W<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>):
    inverseFactorial[n] <span style="color:#f92672">=</span> inverseFactorial[n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">*</span> (n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">%</span>mod

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">combi</span>(n, m):
    <span style="color:#66d9ef">return</span> factorial[n] <span style="color:#f92672">*</span> inverseFactorial[m] <span style="color:#f92672">*</span> inverseFactorial[n<span style="color:#f92672">-</span>m] <span style="color:#f92672">%</span>mod

sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> xrange(B<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, W<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>):
    sum <span style="color:#f92672">=</span> (sum <span style="color:#f92672">+</span> combi(H<span style="color:#f92672">-</span>A<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">+</span>i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> combi(A<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">+</span>W<span style="color:#f92672">-</span>i, W<span style="color:#f92672">-</span>i)) <span style="color:#f92672">%</span>mod
<span style="color:#66d9ef">print</span> sum
</code></pre></div><p>In combination calculation, division will be performed by factorial, so find the inverse of factorial that seems necessary in advance.
At that time, if you use the following to calculate it, you do not have to calculate 1000000005 power many times, so it seems to be fast.</p>
<pre><code class="language-math" data-lang="math">n!^{-1} = (n+1)!^{-1} \times (n+1)
</code></pre><p>After that, I could do it by properly adding <code>% mod</code>.</p>
<h1 id="in-conclusion">in conclusion</h1>
<p>To be honest, I haven&rsquo;t really come out right, but I think it&rsquo;s probably done because I got AC.
Until now, I couldn&rsquo;t get into the chords because I was scared of Fermat&rsquo;s Little Theorem, so I think I could make a little progress.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
