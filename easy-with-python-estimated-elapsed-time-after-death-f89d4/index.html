<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>✨ Easy with Python ☆ Estimated elapsed time after death ✨ | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>✨ Easy with Python ☆ Estimated elapsed time after death ✨</h1>
<p>
  <small class="text-secondary">
  
  
  May 28, 2020
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/python3"> Python3</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/differential-equations"> differential equations</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/niton-method"> Niton method</a></code></small>

</p>
<pre><code># What if there was a corpse in front of you?
</code></pre>
<p><img src="http://blog-imgs-46.fc2.com/k/o/n/konanhitosuzi/20131216231144a8f.jpg" alt="">(quoted;DetectiveConan&quot;SweetColdCourier&rdquo;)
When Conan finds his body, he thinks about the post-mortem time at the very beginning, right? If you know the estimated time of death, you can narrow down the suspects greatly (^o^)/
Therefore, this time we will introduce how to obtain more details about the elapsed time after death!</p>
<p>#Example
There was a man&rsquo;s body in a refrigerated car set at room temperature of 16°C. The man weighed 86 kg, and when Conan measured the temperature in the rectum of his body, it was 27°C. Find the elapsed time after a man&rsquo;s death.</p>
<h1 id="newtons-law-of-cooling">Newton&rsquo;s Law of Cooling</h1>
<p>First, let&rsquo;s consider a simplified phenomenon. Consider the problem of hot coffee in a cup being cooled by the ambient temperature (air). At this time, it is said that the following &ldquo;Newton&rsquo;s law of cooling&rdquo; approximately holds.
The differential equation representing Newton&rsquo;s law of cooling is</p>
<p>$\frac{dT}{dt} = -γ(T-T_s)$ (1)</p>
<p>It is represented by. Where each character is
$T$: Hot water temperature
$T_s$: Ambient temperature
$\gamma$: Cooling constant
Is represented. This differential equation can be solved analytically. First, divide both sides of equation (1) by $T-T_s$.
$\frac{1}{T-T_s}dT = -γdt$</p>
<p>If both sides are integrated and the integration constant is C, then
$log (T-T_s) = -γt + C$
Will be. Solving this equation for T yields the following equation.
$T = T_s + e^{-γt + C}$ (2)
When the initial condition $T(0)=T_0$ is imposed, the integration constant C becomes
$C = log (T_0-T_s)$</p>
<p>Will be. Substituting this into Eq. (2), the analytical solution is given below.
$T(t) = T_s + (T_0-T_s) e^{-γt}$</p>
<p>(Also, transform this)
$\frac{T(t)-T_s}{T_0-T_s} = e^{-γt}$</p>
<p>#Estimation of elapsed time after death by continuous measurement of rectal temperature
Then use Newton&rsquo;s law of cooling to determine the post-mortem time. According to &ldquo;Estimation of elapsed time after death by continuous measurement of rectal temperature (Waseda Institute of Advanced Science and Technology)&rdquo;, in the case of a body, the differential equation is transformed as follows.
$\frac{T_r-T_e}{T_o-T_e}=1.25e^{B<em>t}-0.25e^{5B</em>t}$ $(T_e\le23.2)$
$\frac{T_r-T_e}{T_o-T_e}=1.11e^{B<em>t}-0.11e^{10B</em>t}$ $(T_e\ge23.2)$
$B=-1.2815(bW)^{-0.625}+0.0284$
However,
$T_r$ is rectal temperature ℃
$T_e$ is the ambient temperature ℃
$T_o$ is the rectal temperature at death, which is 37.2°C
$T_e$ is the average value of measurement time at ambient temperature ℃ and is constant
$W$ Corpse weight kg
$b=1$ is the correction factor
$B$ is Newton&rsquo;s cooling constant
$t$ is the elapsed time after death (h)
will do.
Let&rsquo;s solve this example based on this!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-.py" data-lang=".py"><span style="color:#f92672">import</span> sympy

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">death_time</span>(Tr,Te,W):
    Tr<span style="color:#f92672">=</span>Tr
    Te<span style="color:#f92672">=</span>Te
    W<span style="color:#f92672">=</span>W
    B <span style="color:#f92672">=</span> sympy<span style="color:#f92672">.</span>Symbol(<span style="color:#e6db74">&#39;B&#39;</span>)
    t <span style="color:#f92672">=</span> sympy<span style="color:#f92672">.</span>Symbol(<span style="color:#e6db74">&#39;t&#39;</span>)
    To <span style="color:#f92672">=</span> <span style="color:#ae81ff">37.2</span>
    b <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    E <span style="color:#f92672">=</span> sympy<span style="color:#f92672">.</span>S<span style="color:#f92672">.</span>Exp1
    equation1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.25</span><span style="color:#f92672">*</span>(E<span style="color:#f92672">**</span>(B<span style="color:#f92672">*</span>t))<span style="color:#f92672">-</span><span style="color:#ae81ff">0.25</span><span style="color:#f92672">*</span>(E<span style="color:#f92672">**</span>(<span style="color:#ae81ff">5</span><span style="color:#f92672">*</span>B<span style="color:#f92672">*</span>t))<span style="color:#f92672">-</span>(Tr<span style="color:#f92672">-</span>Te)<span style="color:#f92672">/</span>(To<span style="color:#f92672">-</span>Te)
    equation2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.11</span><span style="color:#f92672">*</span>(E<span style="color:#f92672">**</span>(B<span style="color:#f92672">*</span>t))<span style="color:#f92672">-</span><span style="color:#ae81ff">0.11</span><span style="color:#f92672">*</span>(E<span style="color:#f92672">**</span>(<span style="color:#ae81ff">10</span><span style="color:#f92672">*</span>B<span style="color:#f92672">*</span>t))<span style="color:#f92672">-</span>(Tr<span style="color:#f92672">-</span>Te)<span style="color:#f92672">/</span>(To<span style="color:#f92672">-</span>Te)
    equation3 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1.2815</span><span style="color:#f92672">*</span>((b<span style="color:#f92672">*</span>W)<span style="color:#f92672">**</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">0.625</span>))<span style="color:#f92672">+</span><span style="color:#ae81ff">0.0284</span><span style="color:#f92672">-</span>B
    <span style="color:#66d9ef">if</span> Te <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">23.2</span>:
        <span style="color:#66d9ef">print</span>(sympy<span style="color:#f92672">.</span>solve([equation1,equation3]))
    <span style="color:#66d9ef">else</span>:
        <span style="color:#66d9ef">print</span>(sympy<span style="color:#f92672">.</span>solve([equation2,equation3]))
death_time(<span style="color:#ae81ff">27</span>,<span style="color:#ae81ff">16</span>,<span style="color:#ae81ff">86</span>) <span style="color:#75715e"># Setting this issue</span>
</code></pre></div><p>$ $ According to the reference, $T_e$ uses the average of the ambient temperature, but this time we used $T_e$ as the room temperature of 16°C at the time of discovery.
As you can see without telling the result, I couldn&rsquo;t directly do the calculation including the power variable in scipy, and I continued to calculate even when I woke up in the morning. I decided to solve it based on the idea of trial and error method as in the reference.</p>
<p><img src="https://www.researchgate.net/profile/Michael_Scott27/publication/245305588/figure/fig1/AS:637393577209870@1528977879462/Graphical-representation-of-the-Krylov-subspace-acceleration-method.png" alt="">(Quoted<a href="https://www.researchgate.net/figure/Graphical-representation-of-the-Krylov-subspace-acceleration-method_fig1_245305588">KrylovSubspaceAcceleratedNewtonAlgorithm:ApplicationtoDynamicProgressiveCollapseSimulationofFrames</a>)</p>
<p>Since the process of finding the derivative of the function and solving the equation each time iterate is large, we decided to use the Krylov partial exchange method, which approximates the derivative by the difference as shown in the figure above.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-.py" data-lang=".py"><span style="color:#f92672">import</span> math
<span style="color:#f92672">from</span> scipy.optimize <span style="color:#f92672">import</span> newton_krylov
<span style="color:#f92672">import</span> sympy

Corresponds to formula (<span style="color:#ae81ff">3</span>)<span style="color:#f92672">.</span> Calculate Newton<span style="color:#e6db74">&#39;s cooling constant B from body weight (kg). To (rectal temperature at death) is 37.2</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">predict_B</span>(W):
    W<span style="color:#f92672">=</span>W
    B <span style="color:#f92672">=</span> sympy<span style="color:#f92672">.</span>Symbol(<span style="color:#e6db74">&#39;B&#39;</span>)
    b <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    equation3 <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1.2815</span><span style="color:#f92672">*</span>((b<span style="color:#f92672">*</span>W)<span style="color:#f92672">**</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">0.625</span>))<span style="color:#f92672">+</span><span style="color:#ae81ff">0.0284</span><span style="color:#f92672">-</span>B
    B <span style="color:#f92672">=</span> sympy<span style="color:#f92672">.</span>solve([equation3])[B]
    <span style="color:#66d9ef">return</span> B

Equivalent to <span style="color:#75715e">#(1)(2). Case classification by environment temperature Te</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">predict_deathtime</span>(W,Tr,Te,ta):
    Bx <span style="color:#f92672">=</span> predict_B(W)
    Tr,Te,ta <span style="color:#f92672">=</span> Tr,Te,ta
    E <span style="color:#f92672">=</span> sympy<span style="color:#f92672">.</span>S<span style="color:#f92672">.</span>Exp1
    To <span style="color:#f92672">=</span> <span style="color:#ae81ff">37.2</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">F</span>(x):
        <span style="color:#66d9ef">if</span> Te <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">23.2</span>:
            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1.25</span><span style="color:#f92672">*</span>(E<span style="color:#f92672">**</span>(Bx<span style="color:#f92672">*</span>x))<span style="color:#f92672">-</span><span style="color:#ae81ff">0.25</span><span style="color:#f92672">*</span>(E<span style="color:#f92672">**</span>(<span style="color:#ae81ff">5</span><span style="color:#f92672">*</span>Bx<span style="color:#f92672">*</span>x))<span style="color:#f92672">-</span>(Tr<span style="color:#f92672">-</span>Te)<span style="color:#f92672">/</span>(To<span style="color:#f92672">-</span>Te)
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1.11</span><span style="color:#f92672">*</span>(E<span style="color:#f92672">**</span>(Bx<span style="color:#f92672">*</span>x))<span style="color:#f92672">-</span><span style="color:#ae81ff">0.11</span><span style="color:#f92672">*</span>(E<span style="color:#f92672">**</span>(<span style="color:#ae81ff">10</span><span style="color:#f92672">*</span>Bx<span style="color:#f92672">*</span>x))<span style="color:#f92672">-</span>(Tr<span style="color:#f92672">-</span>Te)<span style="color:#f92672">/</span>(To<span style="color:#f92672">-</span>Te)
    guess <span style="color:#f92672">=</span> ta
    sol <span style="color:#f92672">=</span> newton_krylov(F, guess, method<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lgmres&#39;</span>)
    <span style="color:#66d9ef">print</span>(sol)

Enter <span style="color:#f92672">in</span> order of <span style="color:#75715e"># (body weight, rectal temperature, environmental temperature, initial value of elapsed time after death)</span>
<span style="color:#75715e">#Note that the initial value of the elapsed time after death cannot be obtained by setting the initial value to 0.</span>
predict_deathtime(<span style="color:#ae81ff">86</span>,<span style="color:#ae81ff">27</span>,<span style="color:#ae81ff">16</span>,<span style="color:#ae81ff">2</span>)
</code></pre></div><pre><code>Output result 17.19191007875492
</code></pre><p>Therefore, in this example, we found that he died about 17 hours ago!</p>
<h1 id="references">References</h1>
<p><a href="https://dekfractal.com/2018/09/23/%E8%A8%88%E7%AE%97%E7%A7%91%E5%AD%A6%E3%82%92%E3%81%AF%E3%81%98%E3%82%81%E3%82%88%E3%81%86%EF%BC%81%E3%80%80%E3%83%8B%E3%83%A5%E3%83%BC%E3%83%88%E3%83%B3%E3%81%AE%E5%86%B7%E5%8D%B4%E6%B3%95%E5%89%87/">Begin Computational Science! Newton&rsquo;s cooling law ①</a>
<a href="https://www.jstage.jst.go.jp/article/scej/2009f/0/2009f_0_1027/_pdf/-char/ja">Estimation of elapsed time after death by continuous measurement of rectal temperature (Waseda Univ. Advanced Science and Engineering) ○ (Gaku) Inoue Mikiyasu* (Ful) Sakai Kiyotaka (Waseda Univ.) (Ful) Ken Yamamoto (National Defense Academy) (Ful) Jun Kim</a></p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
