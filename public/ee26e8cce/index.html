<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Python] [Python3] A//B and math.floor(A/B) are not always the same! ? | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] [Python3] A//B and math.floor(A/B) are not always the same! ?</h1>
<p>
  <small class="text-secondary">
  
  
  Feb 8, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/atcoder"> AtCoder</a></code></small>


<small><code><a href="https://memotut.com/tags/beginner"> Beginner</a></code></small>


<small><code><a href="https://memotut.com/tags/python3"> Python3</a></code></small>

</p>
<pre><code># Note
</code></pre>
<p>**This article contains spoilers for &ldquo;Atcoder Beginner Contest 148 E-Double Factorial&rdquo;. Please refrain from browsing if you plan to solve this problem yourself. **</p>
<h1 id="overview">Overview</h1>
<p>I got into a problem with the title while solving Atcoder, so I&rsquo;ll post this article to keep it as a memorandum and to hear the opinions of Python experts.</p>
<h1 id="problem">Problem</h1>
<p><a href="https://atcoder.jp/contests/abc148/tasks/abc148_e">Atcoder Beginner Contest 148 E-Double Factorial</a></p>
<p>Define f(n) as follows for an integer n of 0 or more.</p>
<pre><code class="language-math" data-lang="math">・F(n) = 1 [when n &lt;2]\\
・F(n) = nf(n-2) [when n \geq 2]
</code></pre><p>Given an integer N. When f(N) is expressed in decimal number, find out how many zeros follow the end.</p>
<p>#Environment</p>
<ul>
<li>MacBook Pro (64bit)</li>
<li>Python 3.8</li>
</ul>
<ul>
<li>Python version of Atcoder is &ldquo;3.4.3&rdquo;, but it has been confirmed in advance that similar results can be obtained in the above environment.</li>
</ul>
<h1 id="phenomenon">Phenomenon</h1>
<p>In the following two codes, <strong>upper is AC (correct answer)</strong>, but <strong>lower is WA (wrong answer)</strong>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:AC.py" data-lang="python:AC.py"><span style="color:#f92672">import</span> math
N <span style="color:#f92672">=</span> int(input())
ans <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">if</span> N <span style="color:#f92672">%</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
    <span style="color:#66d9ef">pass</span>
<span style="color:#66d9ef">else</span>:
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">25</span>):
        ans <span style="color:#f92672">+=</span> N <span style="color:#f92672">//</span> (<span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">**</span> i)
<span style="color:#66d9ef">print</span>(ans)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:WA.py" data-lang="python:WA.py"><span style="color:#f92672">import</span> math
N <span style="color:#f92672">=</span> int(input())
ans <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">if</span> N <span style="color:#f92672">%</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
    <span style="color:#66d9ef">pass</span>
<span style="color:#66d9ef">else</span>:
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">25</span>):
        ans <span style="color:#f92672">+=</span> math<span style="color:#f92672">.</span>floor(N <span style="color:#f92672">/</span> (<span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">**</span> i))
<span style="color:#66d9ef">print</span>(ans)
</code></pre></div><p>There are 15 test cases for this problem, but the following two test cases resulted in WA.</p>
<pre><code>[15.txt]
IN: 237590337949089028
OUT: 29698792243636116

[16.txt]
IN: 999003990299500294
OUT: 124875498787437525
</code></pre><h1 id="expected-cause">Expected cause</h1>
<p>**The probable cause is a spelling of what I tried until I identified the cause. **
**I just want to know the result! If so, please skip to the next chapter. **</p>
<p>The following parts are related to AC and WA.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">ans <span style="color:#f92672">+=</span> N <span style="color:#f92672">//</span> (<span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">**</span> i) <span style="color:#75715e">#AC</span>
ans <span style="color:#f92672">+=</span> math<span style="color:#f92672">.</span>floor(N <span style="color:#f92672">/</span> (<span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">**</span> i)) <span style="color:#75715e">#WA</span>
</code></pre></div><p>Both are doing similar things, so it looks like the same result, but not.</p>
<p>For now, let&rsquo;s output where the error is occurring. Do as follows.</p>
<ul>
<li>Use the test case &ldquo;237590337949089028&rdquo; where the value of N is WA.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:debug.py" data-lang="python:debug.py"><span style="color:#f92672">import</span> math
N <span style="color:#f92672">=</span> int(input())
ans_ac <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
ans_wa <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">if</span> N <span style="color:#f92672">%</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
    <span style="color:#66d9ef">pass</span>
<span style="color:#66d9ef">else</span>:
    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">25</span>):
        ans_ac <span style="color:#f92672">=</span> N <span style="color:#f92672">//</span> (<span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">**</span> i)
        ans_wa <span style="color:#f92672">=</span> math<span style="color:#f92672">.</span>floor(N <span style="color:#f92672">/</span> (<span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">**</span> i))
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;i =&#39;</span>, i)
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;d =&#39;</span>, N <span style="color:#f92672">/</span> (<span style="color:#ae81ff">10</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">5</span> <span style="color:#f92672">**</span> i))
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;AC:&#39;</span>, ans_ac)
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;WA:&#39;</span>, ans_wa)
</code></pre></div><p>The result looks like this:</p>
<pre><code>i = 0 # error: 2
d = 2.3759033794908904e+16
AC: 23759033794908902
WA: 23759033794908904

i = 1 # error: 1
d = 4751806758981781.0
AC: 4751806758981780
WA: 4751806758981781

i = 2 # error: 0
d = 950361351796356.1
AC: 950361351796356
WA: 950361351796356

i = 3 # error: 0
d = 190072270359271.22
AC: 190072270359271
WA: 190072270359271

(Omitted below)
</code></pre><p>In the subsequent iterations (i is 3 or more and less than 25), the errors between AC and WA were all 0 (AC and WA are equal).
It seems that there was an error only at the beginning of the iteration (i = 0, 1).
For the time being, I don&rsquo;t seem to understand anything as it is, so I decided to think about something different.</p>
<p>There was one thing that came to my mind here. What is the type of these calculations?
There are two types in Python that represent real numbers.</p>
<ul>
<li><strong>int</strong></li>
<li><strong>float</strong></li>
</ul>
<p>The former does not have a precision limit, but the latter does.
What type of deviation does the two calculation methods at issue have?</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/298123/4cf127a6-e656-aa3a-38fa-75a34f5a5aa5.jpeg" alt="abc.001.jpeg"></p>
<p>Regarding <code>//</code>, according to <a href="https://docs.python.org/ja/3/library/stdtypes.html">official document</a></p>
<blockquote>
<p><code>x // y</code> cut down the quotient of x and y
Also known as integer division. The result type is not necessarily integer, but the result value is an integer.
The result is always rounded towards negative infinity.</p>
</blockquote>
<p>There is. In AC calculation, it seems that it is never assigned to float type and is assigned to a variable.</p>
<p>Then how about the calculation of WA? This is via the float type once according to the calculation result of <code>x/y</code>.
I checked it in the environment at hand.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:test.py" data-lang="python:test.py">A <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
B <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
<span style="color:#66d9ef">print</span>(type(A), type(B))
<span style="color:#66d9ef">print</span>(type(A <span style="color:#f92672">/</span> B))
<span style="color:#66d9ef">print</span>(A<span style="color:#f92672">/</span>B)

<span style="color:#e6db74">&#39;&#39;&#39;
</span><span style="color:#e6db74">&lt;class&#39;int&#39;&gt; &lt;class&#39;int&#39;&gt;
</span><span style="color:#e6db74">&lt;class&#39;float&#39;&gt;
</span><span style="color:#e6db74">2.0
</span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</code></pre></div><p>In other words, it is already a float type before using <code>math.floor()</code>.
Isn&rsquo;t <code>//</code> and <code>math.floor()</code> similar to each other? I thought, but that seems not to be the cause.</p>
<p>The definition of <code>math.floor()</code> in <a href="https://docs.python.org/ja/3/library/math.html#math.floor">official document</a> is as follows.</p>
<blockquote>
<p>Returns the &ldquo;floor&rdquo; of x (the largest integer less than or equal to x).
If x is not a floating point number, it internally performs x.__ floor __() and returns an Integral value.</p>
</blockquote>
<p>Rather, I expected that WA&rsquo;s computations were done via a <strong>float type</strong> and that I was passing an incorrect value to <code>math.floor()</code> in the first place.</p>
<p>Although it was described when introducing the type, the float type has a limitation of precision unlike the int type.
There are the following ways to check this.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:dig.py" data-lang="python:dig.py"><span style="color:#f92672">import</span> sys
<span style="color:#66d9ef">print</span>(sys<span style="color:#f92672">.</span>float_info<span style="color:#f92672">.</span>dig)
<span style="color:#75715e">#15</span>
</code></pre></div><p><a href="https://docs.python.org/ja/3/library/sys.html">Official document</a> is as follows.</p>
<blockquote>
<p><strong>sys.float_info</strong>
A named tuple that holds information about float types
dig: the largest decimal digit that can be represented exactly as a floating point number</p>
</blockquote>
<p>Apparently the float type is accurate up to 15 digits, but more digits are doubtful&hellip;
Now, let&rsquo;s check the test case that issued the WA again. This time, pay attention to the number of digits.</p>
<pre><code>i = 0 # error: 2
d = 2.3759033794908904e+16 # 17 integer digits, 0 decimal digit
AC: 23759033794908902 # 23759033794908904
WA: 23759033794908904 # 17 digits&gt; 15 digits

i = 1 # error: 1
d = 4751806758981781.0 # 16 integer digits, 1 decimal digit
AC: 4751806758981780 # 16 digits&gt; 15 digits
WA: 4751806758981781

i = 2 # error: 0
d = 950361351796356.1 # 15 integer digits, 1 decimal digit
AC: 950361351796356 # 15 digits = 15 digits
WA: 950361351796356

i = 3 # error: 0
d = 190072270359271.22 # 15 integers, 2 decimals
AC: 190072270359271 # 15 digits = 15 digits
WA: 190072270359271

(Omitted below)
</code></pre><p>The integer digit part is important for the solution of this Atcoder problem.
It turns out that an error occurs when the integer digit has more than 15 digits of precision of float type!
When <code>4 &lt;= i &lt;25</code>, the integer digit is never larger than 15 digits, so it seems that there was no error.</p>
<p>It seemed that AC wasn&rsquo;t working this time by biting the float type <code>d</code> with the error into <code>math.floor()</code>.</p>
<p>#Summary</p>
<ul>
<li><code>A // B</code> and <code>math.floor(A / B)</code> do the same thing</li>
<li>When both <code>A</code> and <code>B</code> are integer type, <code>A // B</code> is output as <strong>integer type</strong></li>
<li><code>math.floor(A / B)</code> is <code>A / B</code> via <strong>float type</strong> even if both <code>A</code> and <code>B</code> are integer type</li>
<li>If the result of <code>A / B</code> exceeds the precision of float type, an error will occur</li>
<li><strong>The result of <code>A // B</code> and <code>math.floor(A / B)</code> may be different depending on the value of <code>A</code>, <code>B</code></strong></li>
<li>** Be careful with competitive professionals! ! **</li>
</ul>
<p>That&rsquo;s it. Thank you for reading!</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
