<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Introduction of drawing code for figures with a certain degree of perfection of weather data | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Introduction of drawing code for figures with a certain degree of perfection of weather data</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 9, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/fortran"> Fortran</a></code></small>


<small><code><a href="https://memotut.com/tags/basemap"> Basemap</a></code></small>


<small><code><a href="https://memotut.com/tags/grid2"> grid2</a></code></small>


<small><code><a href="https://memotut.com/tags/meteorological-data"> meteorological data</a></code></small>

</p>
<pre><code>This article is the 11th day of [Student LT Advent Calendar 2019-Qiita](https://qiita.com/advent-calendar/2019/student-lt).
</code></pre>
<p>Hello.
I am a graduate student majoring in atmospheric science.</p>
<p>This time, although I can see some in the previous article, I posted with a focus on drawing weather data using Python.
The drawing code introduced is published on <a href="https://github.com/Toyo-Daichi">GitHub</a>, so if you are interested, please download it.</p>
<h2 id="introduction">Introduction</h2>
<p>The following articles were found regarding the drawing and handling of meteorological data.</p>
<ol>
<li><a href="https://qiita.com/noritada/items/1f808682b62efffaeced">Visualize GRIB2 on the map with Cartopy</a></li>
<li><a href="https://qiita.com/mhangyo/items/f06debce3975a269a658">Visualize grid2 on map with python (matplotlib)</a></li>
</ol>
<p>It is very easy to understand, but both are limited to the introduction of drawing one element.</p>
<p>I would like to differentiate from the above article by introducing the code from the data organization to drawing of a figure with a certain degree of perfection as shown below.</p>
<p>Click here for the completed drawing to be created this time.
The target captures the case of Typhoon No. 10 in 2016.</p>
<table>
<thead>
<tr>
<th align="left">・Fig. 1</th>
<th align="left">・Fig. 2</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/420620/e4d1258d-3a6e-653b-e8d6-9a129c163744.gif" alt="GPV_elem_201608210600-201608310000.gif"></td>
<td align="left"><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/420620/1fe43db0-d623-6208-42f4-14c5ad57e5d5.png" alt="typhoon_strength2000-2019_track_1610.png"></td>
</tr>
</tbody>
</table>
<h3 id="introduction-of-each-figure">Introduction of each figure</h3>
<p>I will introduce my own interpretation of the figure. (&hellip;The demand may be low)</p>
<ul>
<li>Figure 1</li>
</ul>
<p>The combination of meteorological elements from 06:00 on August 21, 2016 to 00:00 on August 31, 2016 is drawn.
The contour represents the altitude field, the blue vector represents the wind speed field of 10 m/s or more, and the shaded area + yellow part represents the particularly strong low pressure area in the specified altitude field.
*The method of extracting strong low pressure areas was decided at my own discretion this time, but I am not deeply elaborate because it is not an academic one but an introduction of drawing methods.</p>
<p>→ You can see how the power is gradually expanding by the time you land.</p>
<ul>
<li>Figure 2</li>
</ul>
<p>The hexagrid shows where the typhoon has been passing through for the past 20 years (2000-2019). In addition, the plot shows a specific typhoon path, and this time the path of 2016 Typhoon No. 10 is plotted according to Figure 1.</p>
<p>→ It can be read from the hexagrid that most of the typhoons so far have passed northward through the eastern part of Taiwan and approached Japan, but it was confirmed that typhoon No. 10 in 2016 was a special route. I can do it.</p>
<h2 id="data-to-prepare">Data to prepare</h2>
<ul>
<li>Global numerical forecast model GPV</li>
</ul>
<p><a href="http://database.rish.kyoto-u.ac.jp/arch/jmadata/gpv-original.html">RISH: Research Institute for Sustainable Humanosphere</a>Iwill.Pleasesee<a href="http://database.rish.kyoto-u.ac.jp/arch/jmadata/gpv-original.html">MeteorologicalLineSupportCenter</a> for detailed grid information and delivery time.</p>
<p>*Please note the following points when using the above site.</p>
<blockquote>
<p>We provide data for educational research institutions. If you frequently need data for corporate activities, please purchase the data directly from the Meteorological Business Support Center and cooperate with the maintenance and development of the entire data provision scheme. (Quoted from the site)</p>
</blockquote>
<p>For the data used this time, the data obtained from the above site is extracted in binary format from the east-west wind, north-south wind, vertical wind, temperature, and altitude field using wgirb2.</p>
<p>The cut out data format is described in Fortran90. &hellip;For reference only.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fortran:format.f90" data-lang="fortran:format.f90"> <span style="color:#66d9ef">integer</span>, <span style="color:#66d9ef">parameter</span> <span style="color:#66d9ef">::</span> nx <span style="color:#f92672">=</span> <span style="color:#ae81ff">720</span>, ny <span style="color:#f92672">=</span> <span style="color:#ae81ff">361</span>, np <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>
 <span style="color:#66d9ef">integer</span>, <span style="color:#66d9ef">parameter</span> <span style="color:#66d9ef">::</span> elem <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
 <span style="color:#66d9ef">real</span>(<span style="color:#ae81ff">4</span>) <span style="color:#66d9ef">::</span> gpv(elem, hgt, nx, ny)
 <span style="color:#66d9ef">real</span>(<span style="color:#ae81ff">4</span>) <span style="color:#66d9ef">::</span> pr(hgt)

 <span style="color:#66d9ef">character</span>(<span style="color:#ae81ff">4</span>) <span style="color:#66d9ef">::</span> elem_list(elem)

 <span style="color:#66d9ef">data </span>pr <span style="color:#f92672">/</span> <span style="color:#ae81ff">100</span><span style="color:#ae81ff">0.</span>, <span style="color:#ae81ff">92</span><span style="color:#ae81ff">5.</span>, <span style="color:#ae81ff">85</span><span style="color:#ae81ff">0.</span>, <span style="color:#ae81ff">70</span><span style="color:#ae81ff">0.</span>, <span style="color:#ae81ff">60</span><span style="color:#ae81ff">0.</span>, <span style="color:#ae81ff">50</span><span style="color:#ae81ff">0.</span>, <span style="color:#ae81ff">40</span><span style="color:#ae81ff">0.</span>, <span style="color:#ae81ff">30</span><span style="color:#ae81ff">0.</span>, <span style="color:#ae81ff">25</span><span style="color:#ae81ff">0.</span>, <span style="color:#ae81ff">20</span><span style="color:#ae81ff">0.</span>, <span style="color:#ae81ff">15</span><span style="color:#ae81ff">0.</span>, <span style="color:#ae81ff">10</span><span style="color:#ae81ff">0.</span> <span style="color:#f92672">/</span>
 <span style="color:#66d9ef">data </span>elem_list <span style="color:#f92672">/</span> <span style="color:#e6db74">&#34;U &#34;</span>, <span style="color:#e6db74">&#34;V &#34;</span>, <span style="color:#e6db74">&#34;W &#34;</span>, <span style="color:#e6db74">&#34;T &#34;</span>, <span style="color:#e6db74">&#34;Z &#34;</span><span style="color:#f92672">/</span>

 <span style="color:#66d9ef">open</span>(<span style="color:#f92672">*</span>, fille<span style="color:#f92672">=*</span>, form<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;unformatted&#39;</span>, access<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;direct&#39;</span>, recl<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>nx<span style="color:#f92672">*</span>ny<span style="color:#f92672">*</span>np<span style="color:#f92672">*</span>elem)
 <span style="color:#66d9ef">close</span>(<span style="color:#f92672">*</span>)

</code></pre></div><ul>
<li>Typhoon position table (csv format)</li>
</ul>
<p>It can be obtained by year from <a href="https://www.data.jma.go.jp/fcd/yoho/typhoon/position_table/index.html">JMA</a>.
The information from the time of typhoon occurrence to low temperate cyclone is listed at 6-hour intervals.</p>
<h2 id="execution-code">Execution code</h2>
<p>I hope you read both codes based on main_driver.
Please change the setting of PATH if you execute.</p>
<h3 id="meteorological-element-drawing-code-figure-1">Meteorological element drawing code (Figure 1)</h3>
<p>First, I will introduce the code that draws the weather elements.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:weather_bin2plot.py" data-lang="python:weather_bin2plot.py"><span style="color:#75715e"># -*- coding: utf-8 -*-</span>
<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Created on 2019.12.11
</span><span style="color:#e6db74">@author: Toyo_Daichi
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>

<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> glob
<span style="color:#f92672">import</span> itertools
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">import</span> matplotlib.cm <span style="color:#f92672">as</span> cm
<span style="color:#f92672">from</span> mpl_toolkits.basemap <span style="color:#f92672">import</span> Basemap

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">mapping</span>:
It<span style="color:#e6db74">&#39;s a sequel.</span>
<span style="color:#66d9ef">def</span> __init__(self):
<span style="color:#66d9ef">pass</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gpv_data_coef</span>(self):
nx, ny, hgt <span style="color:#f92672">=</span> <span style="color:#ae81ff">720</span>, <span style="color:#ae81ff">361</span>, <span style="color:#ae81ff">12</span>
elem <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
<span style="color:#66d9ef">return</span> nx, ny, hgt, elem

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">prj_coef</span>(self, nx, ny):
dx, dy <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.5</span>
lon, lat <span style="color:#f92672">=</span> [], []
<span style="color:#66d9ef">for</span> ix <span style="color:#f92672">in</span> range(nx):
lon <span style="color:#f92672">+=</span> [float(<span style="color:#e6db74">&#39;{:.2f}&#39;</span><span style="color:#f92672">.</span>format(dx<span style="color:#f92672">*</span>ix))]
<span style="color:#66d9ef">for</span> iy <span style="color:#f92672">in</span> range(ny):
lat <span style="color:#f92672">+=</span> [float(<span style="color:#e6db74">&#39;{:.2f}&#39;</span><span style="color:#f92672">.</span>format(<span style="color:#f92672">-</span><span style="color:#ae81ff">90.</span> <span style="color:#f92672">+</span> dy<span style="color:#f92672">*</span>iy))]

X, Y <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>meshgrid(lon, lat)

<span style="color:#66d9ef">return</span> X, Y

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">preparating_data</span>(self, yyyy, mm, dd, hh):
time_list <span style="color:#f92672">=</span> []
num_time_list <span style="color:#f92672">=</span> len(time_list)
It<span style="color:#e6db74">&#39;s a sequel.</span>
month_thirtyone <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">12</span>]
month_thirty <span style="color:#f92672">=</span> [<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">9</span>, <span style="color:#ae81ff">11</span>]
month_twntynine <span style="color:#f92672">=</span> [<span style="color:#ae81ff">2</span>]

<span style="color:#66d9ef">while</span> num_time_list <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">40</span>:
time_list<span style="color:#f92672">.</span>append(str(yyyy) <span style="color:#f92672">+</span> str(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%02d</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span>mm) <span style="color:#f92672">+</span> str(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%02d</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span>dd) <span style="color:#f92672">+</span> str(<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%02d</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span>hh) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;00&#39;</span>)
hh <span style="color:#f92672">=</span> hh<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>
It<span style="color:#e6db74">&#39;s a sequel.</span>
<span style="color:#66d9ef">if</span> hh <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">and</span> dd <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
mm, hh <span style="color:#f92672">=</span> mm<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">18</span>
<span style="color:#66d9ef">if</span> mm <span style="color:#f92672">in</span> month_thirty:
dd <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>
<span style="color:#66d9ef">elif</span> mm <span style="color:#f92672">in</span> month_thirtyone:
dd <span style="color:#f92672">=</span> <span style="color:#ae81ff">31</span>
<span style="color:#66d9ef">elif</span> mm <span style="color:#f92672">in</span> month_twntynine:
<span style="color:#66d9ef">if</span> yyyy <span style="color:#f92672">%</span><span style="color:#ae81ff">4</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
dd <span style="color:#f92672">=</span> <span style="color:#ae81ff">28</span>
<span style="color:#66d9ef">else</span>:
dd <span style="color:#f92672">=</span><span style="color:#ae81ff">29</span>

<span style="color:#66d9ef">elif</span> hh <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0</span>:
dd, hh <span style="color:#f92672">=</span> dd<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">18</span>

num_time_list <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

<span style="color:#66d9ef">return</span> time_list

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">setup_gpv_filelist</span>(self, path, time_list):
filelist <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> i_file <span style="color:#f92672">in</span> time_list:
filelist<span style="color:#f92672">.</span>append(path <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;/data&#39;</span>)
<span style="color:#66d9ef">return</span> filelist

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">open_gpv_filelist</span>(self, gpv_filelist, nx, ny, hgt, elem):
data <span style="color:#f92672">=</span> [[]<span style="color:#f92672">*</span>i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(gpv_filelist))]
<span style="color:#66d9ef">for</span> num_gpv, gpv_file <span style="color:#f92672">in</span> enumerate(gpv_filelist):
<span style="color:#66d9ef">with</span> open(gpv_file,<span style="color:#e6db74">&#39;rb&#39;</span>) <span style="color:#66d9ef">as</span> ifile:
<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">elem: 1-u, 2-v, 3-w, 4-tmp, 5-height
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
data[num_gpv] <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>fromfile(ifile, dtype<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&gt;f&#39;</span>, sep <span style="color:#f92672">=</span> <span style="color:#e6db74">``</span>)<span style="color:#f92672">.</span>reshape(elem, hgt, ny, nx)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;..... Preparating data for&#39;</span><span style="color:#f92672">+</span> gpv_file,<span style="color:#e6db74">&#39;, shapes ::&#39;</span>, data[num_gpv]<span style="color:#f92672">.</span>shape)
<span style="color:#66d9ef">return</span> data

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main_mapping_tool</span>(self, mode, path, time_list, nx, ny, <span style="color:#f92672">*</span>, gpv_datalist<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;None&#39;</span>, snap_step<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, level<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;1000&#39;</span>):

fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots()
outpath <span style="color:#f92672">=</span> path <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;/fig/&#39;</span>
It<span style="color:#e6db74">&#39;s a sequel.</span>
lat_min, lat_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">50</span>
lon_min, lon_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">120</span>, <span style="color:#ae81ff">155</span>mapping <span style="color:#f92672">=</span> Basemap( projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lcc&#39;</span>, resolution<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;i&#34;</span>, lat_0<span style="color:#f92672">=</span><span style="color:#ae81ff">35</span>, lon_0<span style="color:#f92672">=</span><span style="color:#ae81ff">140</span>, fix_aspect<span style="color:#f92672">=</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>), llcrnrlat<span style="color:#f92672">=</span>lat_min, urcrnrlat<span style="color:#f92672">=</span>lat_max, llcrnrlon<span style="color:#f92672">=</span>lon_min, urcrnrlon<span style="color:#f92672">=</span>lon_max )

  mapping<span style="color:#f92672">.</span>drawcoastlines(color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
  mapping<span style="color:#f92672">.</span>drawmeridians(np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">360</span>, <span style="color:#ae81ff">5</span>),  labels<span style="color:#f92672">=</span>[False, True, False, True], fontsize<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;small&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
  mapping<span style="color:#f92672">.</span>drawparallels(np<span style="color:#f92672">.</span>arange(<span style="color:#f92672">-</span><span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">5</span>), labels<span style="color:#f92672">=</span>[True, False, False, True], fontsize<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;small&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)

  lon_list, lat_list <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>prj_coef(nx, ny)
  x, y <span style="color:#f92672">=</span> mapping(lon_list, lat_list)

  <span style="color:#66d9ef">if</span> mode <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">or</span> mode <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:

   <span style="color:#66d9ef">if</span> level <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;1000&#34;</span>:
    hPa, min_list <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">200</span>]
   <span style="color:#66d9ef">elif</span> level <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;925&#34;</span>:
    hPa, min_list <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">600</span>]
   <span style="color:#66d9ef">elif</span> level <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;850&#34;</span>:
    hPa, min_list <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">750</span>]
   <span style="color:#66d9ef">elif</span> level <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;700&#34;</span>:
    hPa, min_list <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>, [<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1500</span>]
   <span style="color:#66d9ef">elif</span> level <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;600&#34;</span>:
    hPa, min_list <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;None&#34;</span>
   <span style="color:#66d9ef">elif</span> level <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;500&#34;</span>:
    hPa, min_list <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#34;None&#34;</span>
   <span style="color:#66d9ef">elif</span> level <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;400&#34;</span>:
    hPa, min_list <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>, <span style="color:#e6db74">&#34;None&#34;</span>
   <span style="color:#66d9ef">elif</span> level <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;300&#34;</span>:
    hPa, min_list <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>, <span style="color:#e6db74">&#34;None&#34;</span>
   <span style="color:#66d9ef">elif</span> level <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;250&#34;</span>:
    hPa, min_list <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>, <span style="color:#e6db74">&#34;None&#34;</span>
   <span style="color:#66d9ef">elif</span> level <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;200&#34;</span>:
    hPa, min_list <span style="color:#f92672">=</span> <span style="color:#ae81ff">9</span>, <span style="color:#e6db74">&#34;None&#34;</span>
   <span style="color:#66d9ef">elif</span> level <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;150&#34;</span>:
    hPa, min_list <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#34;None&#34;</span>
   <span style="color:#66d9ef">elif</span> level <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;100&#34;</span>:
    hPa, min_list <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span>, <span style="color:#e6db74">&#34;None&#34;</span>

   gpv_u_data <span style="color:#f92672">=</span> gpv_datalist[snap_step][<span style="color:#ae81ff">0</span>][hPa]
   gpv_v_data <span style="color:#f92672">=</span> gpv_datalist[snap_step][<span style="color:#ae81ff">1</span>][hPa]
   speed <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sqrt(gpv_u_data<span style="color:#f92672">*</span>gpv_u_data <span style="color:#f92672">+</span> gpv_v_data<span style="color:#f92672">*</span>gpv_v_data)
   speed_list <span style="color:#f92672">=</span> list(range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">25</span>)) 
  
   gpv_height_data <span style="color:#f92672">=</span> gpv_datalist[snap_step][<span style="color:#ae81ff">4</span>][hPa]
   num_list <span style="color:#f92672">=</span> list(range(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">7500</span>, <span style="color:#ae81ff">10</span>))

   contour <span style="color:#f92672">=</span> mapping<span style="color:#f92672">.</span>contour(x, y, gpv_height_data, linewidths<span style="color:#f92672">=</span><span style="color:#ae81ff">0.25</span>, linestyles<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;-&#39;</span>, levels<span style="color:#f92672">=</span>num_list, colors<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;m&#39;</span>)
   contour<span style="color:#f92672">.</span>clabel(fmt<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%1.1f</span><span style="color:#e6db74">&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">6.5</span>)

   <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> min_list <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;None&#34;</span>:
    lines <span style="color:#f92672">=</span> mapping<span style="color:#f92672">.</span>contourf(x, y, gpv_height_data, min_list, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, hatches<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;///&#39;</span>], lw<span style="color:#f92672">=</span><span style="color:#ae81ff">1.</span>, zorder<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, edgecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;r&#39;</span>, colors<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;y&#34;</span>)

   <span style="color:#66d9ef">for</span> i_nx, i_ny <span style="color:#f92672">in</span> itertools<span style="color:#f92672">.</span>product(range(nx), range(ny)):
    <span style="color:#66d9ef">if</span> speed[i_ny][i_nx] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">and</span> lon_min <span style="color:#f92672">&lt;=</span> lon_list[i_ny][i_nx] <span style="color:#f92672">&lt;=</span> lon_max <span style="color:#f92672">and</span> lat_min <span style="color:#f92672">&lt;=</span> lat_list[i_ny][i_nx] <span style="color:#f92672">&lt;=</span> lat_max:
     <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;...... Halfway step, &#39;</span>, i_nx, i_ny, speed[i_ny][i_nx])
     vector <span style="color:#f92672">=</span> mapping<span style="color:#f92672">.</span>quiver(x[i_ny][i_nx], y[i_ny][i_nx], gpv_u_data[i_ny][i_nx], gpv_v_data[i_ny][i_nx], color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;c&#39;</span>, units<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;dots&#39;</span>, scale<span style="color:#f92672">=</span><span style="color:#ae81ff">2.0</span>, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.6</span>)
   
   plt<span style="color:#f92672">.</span>title(time_list[snap_step] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; @GSM &#39;</span> <span style="color:#f92672">+</span> level <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;hPa&#39;</span> , loc<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;left&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
   plt<span style="color:#f92672">.</span>quiverkey(vector, <span style="color:#ae81ff">0.75</span>, <span style="color:#ae81ff">0.9</span>, <span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#39;10 m/s&#39;</span>, labelpos<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;W&#39;</span>, coordinates<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;figure&#39;</span>)

   plt<span style="color:#f92672">.</span>savefig(outpath <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;GPV_elem_&#39;</span> <span style="color:#f92672">+</span> time_list[snap_step] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.png&#39;</span>)
   <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;...... Saving fig :: &#39;</span>, outpath <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;GPV_elem_&#39;</span> <span style="color:#f92672">+</span> time_list[snap_step] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.png&#39;</span>)

  <span style="color:#75715e">#plt.show()</span>

 <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main_driver</span>(self, mode, indir, time_list, level):
  nx, ny, hgt, elem <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>gpv_data_coef()

  gpv_filelist <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>setup_gpv_filelist(indir, time_list)
  gpv_datalist <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>open_gpv_filelist(gpv_filelist, nx, ny, hgt, elem)

  <span style="color:#66d9ef">if</span> mode <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
   snap_step <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
   self<span style="color:#f92672">.</span>main_mapping_tool(mode, indir, time_list, nx, ny, gpv_datalist<span style="color:#f92672">=</span>gpv_datalist, level<span style="color:#f92672">=</span>level, snap_step<span style="color:#f92672">=</span>snap_step)
  <span style="color:#66d9ef">elif</span> mode <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
   <span style="color:#66d9ef">for</span> snap_step <span style="color:#f92672">in</span> range(len(gpv_datalist)):
    self<span style="color:#f92672">.</span>main_mapping_tool(mode, indir, time_list, nx, ny, gpv_datalist<span style="color:#f92672">=</span>gpv_datalist, level<span style="color:#f92672">=</span>level, snap_step<span style="color:#f92672">=</span>snap_step)

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
 mapp <span style="color:#f92672">=</span> mapping()

 <span style="color:#75715e">#input dir</span>
 indir <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/your_directory/&#39;</span>

 <span style="color:#75715e">#target time</span>
 yyyy, mm, dd, hh <span style="color:#f92672">=</span> <span style="color:#ae81ff">2016</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">31</span>, <span style="color:#ae81ff">0</span>
 time_list <span style="color:#f92672">=</span> mapp<span style="color:#f92672">.</span>preparating_data(yyyy, mm, dd, hh)

 <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74"> Target altitude list
</span><span style="color:#e6db74"> 1000, 925, 850, 700, 600, 500, 400, 300, 250, 200, 150, 100 hPa
</span><span style="color:#e6db74"> &#34;&#34;&#34;</span>
 level <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;925&#39;</span> 

 <span style="color:#75715e">#choose mode, if you append new func. more anynum. </span>
 <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74"> 2019.12.11
</span><span style="color:#e6db74"> mode 1: Normal weather element info at GPV GSM snap shot.
</span><span style="color:#e6db74"> mode 2: Normal weather element info at GPV GSM gif.
</span><span style="color:#e6db74"> &#34;&#34;&#34;</span>
 
 mode <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>

 <span style="color:#75715e">#main_driver</span>
 mapp<span style="color:#f92672">.</span>main_driver(mode, indir, time_list, level)

</code></pre></div><p>このコードで工夫した点は下記の点でした。</p>
<ul>
<li>風速ベクトルを10m/s以上のみ描画する。</li>
<li>各高度の大きい値を斜線で描画する。</li>
<li>gif形式の画像作成とスナップショットの画像作成をモードで選択できるようにする。</li>
</ul>
<p>###台風進路の描画コード(図２)<br>
次に過去20年の台風進路度合いと特定の台風の進路を作成したコードを紹介します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:typhoon_csv2plot.py" data-lang="python:typhoon_csv2plot.py"><span style="color:#75715e"># -*- coding: utf-8 -*-</span>
<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Created on 2019.12.11
</span><span style="color:#e6db74">@author: Toyo_Daichi
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>

<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> glob
<span style="color:#f92672">import</span> itertools
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">import</span> matplotlib.cm <span style="color:#f92672">as</span> cm
<span style="color:#f92672">from</span> mpl_toolkits.basemap <span style="color:#f92672">import</span> Basemap

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">mapping</span>:

 <span style="color:#66d9ef">def</span> __init__(self):
  <span style="color:#66d9ef">pass</span>

 <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">setup_csv_filelist</span>(self, path, <span style="color:#f92672">*</span>, year<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;*&#39;</span>):
  filelist <span style="color:#f92672">=</span> []
  filelist <span style="color:#f92672">=</span> glob<span style="color:#f92672">.</span>glob(path <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;table&#39;</span> <span style="color:#f92672">+</span> str(year) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.csv&#39;</span>)
  <span style="color:#66d9ef">return</span> filelist

 <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">open_csv_filelist</span>(self, csv_filelist, <span style="color:#f92672">*</span>, typhoon_number<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;None&#39;</span>):
  csv_datalist <span style="color:#f92672">=</span> [ []<span style="color:#f92672">*</span>i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(csv_filelist)) ]
  list_num     <span style="color:#f92672">=</span> list(range(<span style="color:#ae81ff">11</span>)) 
  list_option  <span style="color:#f92672">=</span> ( <span style="color:#e6db74">&#39;year&#39;</span>, <span style="color:#e6db74">&#39;month&#39;</span>, <span style="color:#e6db74">&#39;day&#39;</span>, <span style="color:#e6db74">&#39;hour(UTC)&#39;</span>, <span style="color:#e6db74">&#39;typhoon_number&#39;</span>, <span style="color:#e6db74">&#39;typhoon_name&#39;</span>, <span style="color:#e6db74">&#39;rank&#39;</span>,<span style="color:#e6db74">&#39;latitude&#39;</span>, <span style="color:#e6db74">&#39;longitude&#39;</span>, <span style="color:#e6db74">&#39;central_pressure&#39;</span>, <span style="color:#e6db74">&#39;max_wind&#39;</span>)
  <span style="color:#66d9ef">for</span> num_file, infile <span style="color:#f92672">in</span> enumerate(csv_filelist):
   <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;..... Preparating data for &#39;</span> <span style="color:#f92672">+</span> str(num_file) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; &#39;</span> <span style="color:#f92672">+</span> str(infile))
   tmp_data <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(infile, usecols<span style="color:#f92672">=</span>list_num, skiprows<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, names<span style="color:#f92672">=</span>list_option, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;,&#39;</span>)
   <span style="color:#66d9ef">if</span> typhoon_number <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;None&#34;</span>:tmp_lat_list  <span style="color:#f92672">=</span> tmp_data[<span style="color:#e6db74">&#39;latitude&#39;</span>]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>tolist()
    csv_datalist[num_file]<span style="color:#f92672">.</span>append(tmp_lat_list)
    tmp_lon_list <span style="color:#f92672">=</span> tmp_data[<span style="color:#e6db74">&#39;longitude&#39;</span>]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>tolist()
    csv_datalist[num_file]<span style="color:#f92672">.</span>append(tmp_lon_list)
    tmp_centpre_list <span style="color:#f92672">=</span> tmp_data[<span style="color:#e6db74">&#39;central_pressure&#39;</span>]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>tolist()
    csv_datalist[num_file]<span style="color:#f92672">.</span>append(tmp_centpre_list)

   <span style="color:#66d9ef">else</span>:
    csv_datalist <span style="color:#f92672">=</span> []
    specific_data <span style="color:#f92672">=</span> tmp_data<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#39;typhoon_number == </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> typhoon_number) 
    tmp_lat_list  <span style="color:#f92672">=</span> specific_data[<span style="color:#e6db74">&#39;latitude&#39;</span>]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>tolist()
    csv_datalist<span style="color:#f92672">.</span>append(tmp_lat_list)
    tmp_lon_list <span style="color:#f92672">=</span> specific_data[<span style="color:#e6db74">&#39;longitude&#39;</span>]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>tolist()
    csv_datalist<span style="color:#f92672">.</span>append(tmp_lon_list)
    tmp_centpre_list <span style="color:#f92672">=</span> specific_data[<span style="color:#e6db74">&#39;central_pressure&#39;</span>]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>tolist()
    csv_datalist<span style="color:#f92672">.</span>append(tmp_centpre_list)

  <span style="color:#66d9ef">return</span> csv_datalist

 <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main_mapping_tool</span>(self, path, csv_datalist, csv_specific_datalist<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;None&#39;</span>, typhoon_info<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;None&#39;</span>):
  fig, ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots()
  outpath <span style="color:#f92672">=</span> path <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/fig/&#39;</span> 

  lat_min, lat_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">50</span>
  lon_min, lon_max <span style="color:#f92672">=</span> <span style="color:#ae81ff">120</span>, <span style="color:#ae81ff">155</span>

  mapping <span style="color:#f92672">=</span> Basemap( projection<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lcc&#39;</span>, resolution<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;i&#34;</span>, lat_0<span style="color:#f92672">=</span><span style="color:#ae81ff">35</span>, lon_0<span style="color:#f92672">=</span><span style="color:#ae81ff">140</span>, fix_aspect<span style="color:#f92672">=</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>), llcrnrlat<span style="color:#f92672">=</span>lat_min, urcrnrlat<span style="color:#f92672">=</span>lat_max, llcrnrlon<span style="color:#f92672">=</span>lon_min, urcrnrlon<span style="color:#f92672">=</span>lon_max )

  mapping<span style="color:#f92672">.</span>drawcoastlines(color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;black&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
  mapping<span style="color:#f92672">.</span>drawmeridians(np<span style="color:#f92672">.</span>arange(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">360</span>, <span style="color:#ae81ff">5</span>),  labels<span style="color:#f92672">=</span>[False, True, False, True], fontsize<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;small&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)
  mapping<span style="color:#f92672">.</span>drawparallels(np<span style="color:#f92672">.</span>arange(<span style="color:#f92672">-</span><span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">5</span>), labels<span style="color:#f92672">=</span>[True, False, False, True], fontsize<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;small&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>)

  full_lat_list  <span style="color:#f92672">=</span> list(map(<span style="color:#66d9ef">lambda</span> x: x[<span style="color:#ae81ff">0</span>], csv_datalist))
  full_lon_list  <span style="color:#f92672">=</span> list(map(<span style="color:#66d9ef">lambda</span> x: x[<span style="color:#ae81ff">1</span>], csv_datalist))
 
  full_lat_list <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sum(full_lat_list, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
  full_lon_list <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sum(full_lon_list, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
  
  lat_list, lon_list <span style="color:#f92672">=</span> [], []
  <span style="color:#66d9ef">for</span> i_num <span style="color:#f92672">in</span> range(len(full_lat_list)):
   <span style="color:#66d9ef">if</span>(lat_min <span style="color:#f92672">&lt;=</span> full_lat_list[i_num] <span style="color:#f92672">&lt;=</span> lat_max <span style="color:#f92672">and</span> lon_min <span style="color:#f92672">&lt;=</span> full_lon_list[i_num] <span style="color:#f92672">&lt;=</span> lon_max):
    lat_list<span style="color:#f92672">.</span>append(full_lat_list[i_num]) 
    lon_list<span style="color:#f92672">.</span>append(full_lon_list[i_num]) 

  x, y <span style="color:#f92672">=</span> mapping(lon_list, lat_list)
  hexbin <span style="color:#f92672">=</span> mapping<span style="color:#f92672">.</span>hexbin(np<span style="color:#f92672">.</span>array(x), np<span style="color:#f92672">.</span>array(y), gridsize<span style="color:#f92672">=</span>[<span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">30</span>], cmap<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Blues&#39;</span>, edgecolors<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gray&#39;</span>, mincnt<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>)

  <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> csv_specific_datalist <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;None&#34;</span>:
   specific_lat_list, specific_lon_list <span style="color:#f92672">=</span> csv_specific_datalist[<span style="color:#ae81ff">0</span>], csv_specific_datalist[<span style="color:#ae81ff">1</span>]
   specific_centpre_list <span style="color:#f92672">=</span> csv_specific_datalist[<span style="color:#ae81ff">2</span>]

   lat_list, lon_list, centpre_list <span style="color:#f92672">=</span> [], [], []
   <span style="color:#66d9ef">for</span> i_num <span style="color:#f92672">in</span> range(len(specific_lon_list)):
    <span style="color:#66d9ef">if</span>(lat_min <span style="color:#f92672">&lt;=</span> specific_lat_list[i_num] <span style="color:#f92672">&lt;=</span> lat_max <span style="color:#f92672">and</span> lon_min <span style="color:#f92672">&lt;=</span> specific_lon_list[i_num] <span style="color:#f92672">&lt;=</span> lon_max):
     lat_list<span style="color:#f92672">.</span>append(specific_lat_list[i_num])
     lon_list<span style="color:#f92672">.</span>append(specific_lon_list[i_num]) 
     centpre_list<span style="color:#f92672">.</span>append(specific_centpre_list[i_num]) 

   case_x, case_y <span style="color:#f92672">=</span> mapping(lon_list, lat_list)

   mapping<span style="color:#f92672">.</span>plot(case_x, case_y, linewidth<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;red&#39;</span>, ls<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>, marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;o&#39;</span>, ms<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)

  cbar <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>colorbar(hexbin)
  cbar<span style="color:#f92672">.</span>set_label(<span style="color:#e6db74">&#39;number&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>)
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> csv_specific_datalist <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;None&#34;</span>:
   plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Course of typhoon 2000-2019&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;, &#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;Typhoon track: &#39;</span> <span style="color:#f92672">+</span> str(typhoon_info[<span style="color:#ae81ff">1</span>]), loc<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;left&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">9</span>)
  <span style="color:#66d9ef">else</span>:
   plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Course of typhoon 2000-2019&#39;</span>, loc<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;left&#39;</span>, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
  plt<span style="color:#f92672">.</span>savefig(outpath <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;typhoon_strength2000-2019&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;_track_&#39;</span> <span style="color:#f92672">+</span> str(typhoon_info[<span style="color:#ae81ff">1</span>]) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.png&#39;</span>)
  <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;..... savefig &#39;</span> <span style="color:#f92672">+</span> outpath <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;typhoon_strength2000-2019&#39;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;_track_&#39;</span> <span style="color:#f92672">+</span> str(typhoon_info[<span style="color:#ae81ff">1</span>]) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;.png&#39;</span>)
  <span style="color:#75715e">#plt.show()</span>

 <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main_driver</span>(self, indir, <span style="color:#f92672">*</span>, typhoon_info<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;None&#39;</span>):
  csv_filelist <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>setup_csv_filelist(indir)
  csv_datalist <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>open_csv_filelist(csv_filelist)
  <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">  csv_datalist.shape = [year][latitude][longitude][central_pressure]
</span><span style="color:#e6db74">  &#34;&#34;&#34;</span>

  <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> typhoon_info <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;None&#34;</span>: 
   <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;..... Check specific case filelist&#39;</span>)
   csv_specific_filelist <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>setup_csv_filelist(indir, year<span style="color:#f92672">=</span>typhoon_info[<span style="color:#ae81ff">0</span>])
   csv_specific_datalist <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>open_csv_filelist(csv_specific_filelist, typhoon_number<span style="color:#f92672">=</span>typhoon_info[<span style="color:#ae81ff">1</span>])
   self<span style="color:#f92672">.</span>main_mapping_tool(indir, csv_datalist, csv_specific_datalist<span style="color:#f92672">=</span>csv_specific_datalist, typhoon_info<span style="color:#f92672">=</span>typhoon_info)
  <span style="color:#66d9ef">else</span>:
   self<span style="color:#f92672">.</span>main_mapping_tool(indir, csv_datalist)

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
 mapp <span style="color:#f92672">=</span> mapping()

 <span style="color:#75715e">#input dir</span>
 indir <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/your_directory/&#39;</span>

 <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74"> If you want to write a specific typhoon route, enter the typhoon information.
</span><span style="color:#e6db74"> typhoon_info = [year, typhoon_number]
</span><span style="color:#e6db74"> &#34;&#34;&#34;</span>
 typhoon_info <span style="color:#f92672">=</span> [<span style="color:#ae81ff">2016</span>, <span style="color:#ae81ff">1610</span>]

 <span style="color:#75715e">#main_driver</span>
 mapp<span style="color:#f92672">.</span>main_driver(indir, typhoon_info<span style="color:#f92672">=</span>typhoon_info)

 <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Normal END&#39;</span>)

</code></pre></div><p>このコードで工夫した点は下記の点でした。</p>
<ul>
<li>２０年間の台風経路の頻度をヘキサグリッドで描画する。</li>
<li>特定の台風番号を記述することで、その台風の経路を描画する。</li>
</ul>
<p>##今回使用した使用環境
申し訳程度の環境を記述しました。</p>
<ul>
<li>Python 3.6.7</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-requirement.txt" data-lang="requirement.txt">basemap==1.2.0 
matplotlib==3.1.1
</code></pre></div><p>##最後に</p>
<p>作成したコードの中には細々としていますが、いくつかの自分なりの工夫をしているので今後紹介していきたいです。
より良い書き方などお気づきになった方はコメント等でご教授いただければ幸いです。</p>
<p>最後まで読んでくださり、ありがとうございました。</p>
<p>##参考にしたサイト</p>
<ul>
<li>気象×Python　〜衛星降水データ〜   <a href="https://qiita.com/OSAKO/items/d54da432fff34d4be1d8">https://qiita.com/OSAKO/items/d54da432fff34d4be1d8</a></li>
</ul>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
