<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Automate web processes with Heroku &#43; Selenium &#43; Chrome | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Automate web processes with Heroku + Selenium + Chrome</h1>
<p>
  <small class="text-secondary">
  
  
  Nov 17, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/chrome">Chrome</a></code></small>


<small><code><a href="https://memotut.com/tags/selenium">Selenium</a></code></small>


<small><code><a href="https://memotut.com/tags/heroku">Heroku</a></code></small>


<small><code><a href="https://memotut.com/tags/chromedriver">chromedriver</a></code></small>

</p>
<pre><code># Automate web process with Heroku + Selenium + Chrome
</code></pre>
<ul>
<li><a href="#heroku--selenium--chrome%e3%81%a7web%e3%83%97%e3%83%ad%e3%82%bb%e3%82%b9%e3%82%92%e8%87%aa%e5%8b%95%e5%8c%96%e3%81%99%e3%82%8b">Automate web process with Heroku + Selenium + Chrome</a>
-<a href="#%e3%81%af%e3%81%98%e3%82%81%e3%81%ab">Introduction</a>
-<a href="#%e7%9b%ae%e7%9a%84">Purpose</a>
-<a href="#%e9%96%a2%e9%80%a3%e3%81%99%e3%82%8b%e8%a8%98%e4%ba%8b">Related Article</a>
-<a href="#%e5%ae%9f%e8%a1%8c%e7%92%b0%e5%a2%83">Execution environment</a>
-<a href="#%e3%82%bd%e3%83%bc%e3%82%b9%e3%82%b3%e3%83%bc%e3%83%89">Source Code</a>
-<a href="#%e3%82%b7%e3%83%8a%e3%83%aa%e3%82%aa%e3%81%a8%e5%89%8d%e6%8f%90%e6%9d%a1%e4%bb%b6">Scenario and Assumptions</a>
-<a href="#%e8%87%aa%e5%8b%95%e3%83%97%e3%83%ad%e3%82%bb%e3%82%b9%e3%81%ae%e4%bd%9c%e6%88%90">Create Automatic Process</a>
-<a href="#python-api%e6%a7%8b%e6%88%90">Python API configuration</a>
-<a href="#api%e3%83%a1%e3%82%a4%e3%83%b3%e3%83%95%e3%83%ac%e3%83%bc%e3%83%a0">API mainframe</a>
-<a href="#fx%e3%83%ac%e3%83%bc%e3%83%88%e5%8f%96%e5%be%97">FX rate acquisition</a>
-<a href="#heroku%e3%81%ae%e8%a8%ad%e5%ae%9a">Heroku Settings</a>
-<a href="#chrome%e3%81%a8driver%e3%81%ae%e8%a8%ad%e5%ae%9a">Chrome and Driver Settings</a>
-[Driver version setting](#driver%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b3%e3%81%ae%e8%a8(%ad%e5%ae%9a)</li>
</ul>
<h2 id="introduction">Introduction</h2>
<p>This article is for Mac environment, but the procedure is the same for Windows environment. Please read the environment-dependent part and try again.</p>
<h3 id="purpose">Purpose</h3>
<p>After reading this article, you&rsquo;ll be able to:</p>
<ul>
<li>Automate web processes with Selenium and Chrome Driver</li>
<li>Configure Chrome and Driver on Heroku</li>
</ul>
<p><code>Web process automation</code></p>
<p>Obtain and display <strong>USD/JPY</strong> from Yahoo! Finance FX chart rates.</p>
<p>| Display manually from browser | Display automatically acquired data |
| &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;- &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash; &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash; &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;- | &mdash;&mdash;&mdash;&mdash;&mdash;&mdash; &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash; &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash; &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash; &mdash;&mdash;&mdash;&ndash; |
<img width="400" alt=" screenshot 2019-11-17 16.21.49.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/326996/6ad5419b-a901-06d9-a985-376ebae40f9b.png"> | <img width="400" alt=" screenshot 2019-11-17 0.33.50.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/326996/8094825c-7ad6-d6de-bb98-2e48e08dd740.png"> |</p>
<h3 id="related-articles">Related articles</h3>
<ul>
<li><a href="https://pypi.org/project/selenium/">Selenium</a></li>
<li><a href="https://github.com/heroku/heroku-buildpack-chromedriver.git">heroku-buildpack-chromedriver.git</a></li>
<li><a href="https://github.com/heroku/heroku-buildpack-google-chrome.git">heroku-buildpack-google-chrome.git</a></li>
</ul>
<h3 id="execution-environment">Execution environment</h3>
<table>
<thead>
<tr>
<th>Environment</th>
<th>Ver.</th>
</tr>
</thead>
<tbody>
<tr>
<td>macOS Mojave</td>
<td>10.14.6</td>
</tr>
<tr>
<td>Python</td>
<td>3.7.3</td>
</tr>
<tr>
<td>Flask</td>
<td>1.1.1</td>
</tr>
<tr>
<td>selenium</td>
<td>3.141.0</td>
</tr>
<tr>
<td>chromedrive</td>
<td>78.0.3904.70</td>
</tr>
<tr>
<td>google-chrome</td>
<td>78.0.3904.97</td>
</tr>
</tbody>
</table>
<h3 id="source-code">Source code</h3>
<p>I think that understanding will be deepened if you read it while following the implementation contents and source code. Please use it by all means.</p>
<p><a href="https://github.com/nsuhara/python-Selenium.git">GitHub</a></p>
<h2 id="scenarios-and-prerequisites">Scenarios and prerequisites</h2>
<ol>
<li>Obtain and display <strong>USD/JPY</strong> from Yahoo! Finance FX chart rates.</li>
<li>It is supposed to be stored in MySQL or PostgreSQL, but it is for the purpose of explaining automation, so DB related is out of scope.</li>
<li>The API framework adopts Flask.</li>
</ol>
<h2 id="creating-an-automated-process">Creating an automated process</h2>
<h3 id="python-api-configuration">Python API configuration</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tree.sh" data-lang="tree.sh">python-Selenium
  ├── fx_rate
  │  ├── __init__.py
  │  └── utility.py
  └── main.py
</code></pre></div><h3 id="api-mainframe">API mainframe</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-main.py" data-lang="main.py"><span style="color:#f92672">import</span> datetime
<span style="color:#f92672">import</span> logging
<span style="color:#f92672">import</span> os

<span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> Flask

<span style="color:#f92672">from</span> fx_rate.utility <span style="color:#f92672">import</span> get_fx_rate

logging<span style="color:#f92672">.</span>basicConfig(level<span style="color:#f92672">=</span>logging<span style="color:#f92672">.</span>INFO)
logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger(__name__)

app <span style="color:#f92672">=</span> Flask(__name__)


<span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/fx-rate&#39;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;GET&#39;</span>])
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get</span>():
    usd_jpy <span style="color:#f92672">=</span> get_fx_rate()
    res <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;timestamp={}, USDJPY={}&#39;</span><span style="color:#f92672">.</span>format(
        datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>utcnow() <span style="color:#f92672">+</span> datetime<span style="color:#f92672">.</span>timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">9</span>), usd_jpy)
    logger<span style="color:#f92672">.</span>info(res)
    <span style="color:#66d9ef">return</span> res, <span style="color:#ae81ff">200</span>


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;__main__&#39;</span>:
    host <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>getenv(<span style="color:#e6db74">&#39;HOST&#39;</span>, <span style="color:#e6db74">&#39;0.0.0.0&#39;</span>)
    port <span style="color:#f92672">=</span> int(os<span style="color:#f92672">.</span>getenv(<span style="color:#e6db74">&#39;PORT&#39;</span>, <span style="color:#ae81ff">5000</span>))
    app<span style="color:#f92672">.</span>run(host<span style="color:#f92672">=</span>host, port<span style="color:#f92672">=</span>port, debug<span style="color:#f92672">=</span>True)
</code></pre></div><h3 id="get-fx-rate">Get FX rate</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-utility.py" data-lang="utility.py"><span style="color:#f92672">import</span> datetime

<span style="color:#f92672">from</span> selenium <span style="color:#f92672">import</span> webdriver
<span style="color:#f92672">from</span> selenium.webdriver.chrome.options <span style="color:#f92672">import</span> Options
<span style="color:#f92672">from</span> selenium.webdriver.common.by <span style="color:#f92672">import</span> By


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_fx_rate</span>():
    options <span style="color:#f92672">=</span> Options()
    options<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--headless&#39;</span>)
    driver <span style="color:#f92672">=</span> webdriver<span style="color:#f92672">.</span>Chrome(options<span style="color:#f92672">=</span>options)
    driver<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;https://info.finance.yahoo.co.jp/fx/&#39;</span>)
    usd_jpy <span style="color:#f92672">=</span> driver<span style="color:#f92672">.</span>find_element(By<span style="color:#f92672">.</span>ID,<span style="color:#e6db74">&#39;USDJPY_top_bid&#39;</span>)<span style="color:#f92672">.</span>text
    driver<span style="color:#f92672">.</span>quit()
    <span style="color:#66d9ef">return</span> usd_jpy


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;__main__&#39;</span>:
    usd_jpy <span style="color:#f92672">=</span> get_fx_rate()
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;timestamp={}, USDJPY={}&#39;</span><span style="color:#f92672">.</span>format(datetime<span style="color:#f92672">.</span>datetime<span style="color:#f92672">.</span>utcnow() <span style="color:#f92672">+</span>
                                           datetime<span style="color:#f92672">.</span>timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">9</span>), usd_jpy))
</code></pre></div><h2 id="heroku-settings">Heroku settings</h2>
<h3 id="chrome-and-driver-settings">Chrome and Driver settings</h3>
<p>Add the following from <strong>Add buildpack</strong> in the Settings&gt; Buildpacks section.</p>
<p><img width="700" alt="Screenshots 2019-11-16 21.12.36.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/326996/3767f0ec-f523-69e3-9be2-0879dce1bb78.png">| Buildpack | URL |
| &mdash;&mdash;&mdash;&mdash;- | &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash; &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;- |
| chromedrive | <a href="https://github.com/heroku/heroku-buildpack-chromedriver.git">https://github.com/heroku/heroku-buildpack-chromedriver.git</a> |
google-chrome | <a href="https://github.com/heroku/heroku-buildpack-google-chrome.git">https://github.com/heroku/heroku-buildpack-google-chrome.git</a> |</p>
<p><code>When you deploy to Heroku, it will be installed automatically. Please register in advance. If you have already deployed or want to redeploy without changing the source code, try the empty commit below. </code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-allow_empty.sh" data-lang="allow_empty.sh">~$ git commit --allow-empty -m <span style="color:#e6db74">&#34;allow empty commit&#34;</span>
~$ git push heroku master
</code></pre></div><h3 id="driver-version-setting">Driver version setting</h3>
<p>Normally, no setting is required. If the version is different between <strong>chromedrive</strong> and <strong>google-chrome</strong>, such as when Chrome is upgraded, you need to specify the version of <strong>chromedrive</strong>.</p>
<ol>
<li>Click <strong>Reveal Config Vars</strong> in the Settings &gt;Config Vars section.</li>
<li>Enter <strong>KEY</strong> and <strong>VALUE</strong> and click <strong>Add</strong>.</li>
</ol>
<img width="700" alt="Screenshots 2019-11-16 21.12.25.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/326996/07ab69cc-b1fd-85a4-c114-aa0308e6fea3.png">
<p>| KEY | VALUE |
| &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash; | &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;- &mdash;&mdash;&mdash; |
CHROMEDRIVER_VERSION | Support version (eg 78.0.3904.70) |</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
