<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Introducing her with Python ~Tinder automation project~ Episode 6 | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Introducing her with Python ~Tinder automation project~ Episode 6</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 13, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/data-analysis"> data analysis</a></code></small>


<small><code><a href="https://memotut.com/tags/cnn"> CNN</a></code></small>


<small><code><a href="https://memotut.com/tags/tinder"> tinder</a></code></small>

</p>
<pre><code>#table of contents
</code></pre>
<table>
<thead>
<tr>
<th></th>
<th>What I did</th>
<th>Main events</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://qiita.com/Fulltea/items/fe4d4214552476c28e88">Episode 1</a></td>
<td><a href="https://qiita.com/Fulltea/items/fe4d4214552476c28e88">Automatic right swipe</a></td>
<td></td>
</tr>
<tr>
<td><a href="https://qiita.com/Fulltea/items/4083c75f74e8a78a797b">Episode 2</a></td>
<td><a href="https://qiita.com/Fulltea/items/4083c75f74e8a78a797b">Automatic message transmission</a></td>
<td>Matched with a woman</td>
</tr>
<tr>
<td>[Episode 3] <a href="https://qiita.com/Fulltea/items/aab00dba8daecb71f1e4">ep.3</a></td>
<td>[Library] <a href="https://qiita.com/Fulltea/items/aab00dba8daecb71f1e4">ep.3</a></td>
<td>Exchanged LINE with a matched woman</td>
</tr>
<tr>
<td><a href="https://qiita.com/Fulltea/items/b1d0b26e5a6ae3f3a5fb">Episode 3.5</a></td>
<td><a href="https://qiita.com/Fulltea/items/b1d0b26e5a6ae3f3a5fb">Re-obtaining access token</a></td>
<td>The token could not be obtained with the code so far</td>
</tr>
<tr>
<td><a href="https://qiita.com/Fulltea/items/6a6a88eb595f5b39a605">Episode 4</a></td>
<td><a href="https://qiita.com/Fulltea/items/6a6a88eb595f5b39a605">Data collection</a></td>
<td>LINE no longer responds</td>
</tr>
<tr>
<td><a href="https://qiita.com/Fulltea/items/75fc75cb9e159e59ffbc">Episode 5</a></td>
<td><a href="https://qiita.com/Fulltea/items/75fc75cb9e159e59ffbc">Data analysis profile sentence</a></td>
<td>I was recommended by the people I became friends with for information products</td>
</tr>
<tr>
<td><a href="https://qiita.com/Fulltea/items/4a70f6ffe0c798326292">Episode 6</a></td>
<td><a href="https://qiita.com/Fulltea/items/4a70f6ffe0c798326292">Data analysis image edition</a></td>
<td>Recent acquaintance girls call me late at night (?)</td>
</tr>
<tr>
<td>The code can be viewed from <a href="https://github.com/FullteaOfEEIC/tinpy2">GitHub</a>.</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>#Synopsis up to the last time</p>
<ul>
<li>Created a library to easily hit the Tinder API</li>
<li>Collected data to find a match</li>
<li>Profile sentences were analyzed</li>
</ul>
<p>#Current status
I haven&rsquo;t slept recently.
It seems that another person, an acquaintance, has created her. This traitor&hellip;
Speaking of which, I got a GPU the other day, so I&rsquo;m learning from this time.</p>
<h1 id="previous-research-story">Previous research story</h1>
<p>I&rsquo;m not the first to think of some model for Tinder&rsquo;s swipe strategy.
Even if I just looked it up, people who swipe only the person who posted the face photo [1], those who swipe by letting DNN learn their favorite photo [2] [3], face I found a person [4] who judged whether it was processed.</p>
<p>&hellip;What did we want to do?</p>
<p>Machine learning is awkward, and it&rsquo;s fun to move, so when you notice it, your aim and purpose will shift from the original goal. When we went back to the starting point, we started writing the code for her.
Most of the information out there is code that &ldquo;doesn&rsquo;t match unwanted people,&rdquo; but what we need is code that &ldquo;matches as many people as possible.&rdquo; Anyway, at present, it is a situation to match one person per day, so if you match a person you do not like, you can cancel it manually <a href="manymatchoccurrencesandmanualcancellationThisisofcoursenotthecaseforpeoplewhoarehavingtroublecatchingupwith.">^ 1</a> What do you do by narrowing the width of your encounter <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>.</p>
<p>In terms of efforts to create her, [5] is helpful. Instead of looking for people who are likely to match like we are now trying, we are trying to meet with the approach of &ldquo;creating a profile that allows as many people as possible to get Like&rdquo;. Different matching services used can have different user evaluation strategies, so simple application is not possible, but I think it is an interesting attempt. I&rsquo;d like to try it with Tinder someday, but in that case, will multiple profiles with different self-introduction sentences be prepared for A/B testing <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>, or will reinforcement learning be performed based on that score? .. This policy is on hold for me because it is expected that it will take a long time and a large number of phone numbers to collect enough data, and honestly it will be troublesome.
According to [5], if you include appropriate descriptions about &ldquo;educational background&rdquo;, &ldquo;want a child&rdquo;, &ldquo;sociality&rdquo;, and &ldquo;alcohol&rdquo; in your profile, it is easier for women to swipe right <sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>.</p>
<p>#Image recognition
I wrote something extra long above, but the point is</p>
<ul>
<li>In: Profile picture</li>
<li>Out: Whether to match</li>
</ul>
<p>I want to make a machine learning machine.</p>
<h2 id="model-building">Model building</h2>
<p>Speaking of image recognition, CNN is used to estimate whether or not there is a match from a profile image.
First, load the image from the data folder.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-analytics.py" data-lang="analytics.py"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> cv2
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">from</span> tqdm.notebook <span style="color:#f92672">import</span> tqdm
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> re

filePath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;data/tinder.xlsx&#34;</span>
imagePath <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;data/photos&#34;</span>

df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_excel(filePath)
df<span style="color:#f92672">.</span>drop_duplicates(inplace<span style="color:#f92672">=</span>True, subset<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;id&#34;</span>)
df<span style="color:#f92672">.</span>set_index(<span style="color:#e6db74">&#34;id&#34;</span>, inplace<span style="color:#f92672">=</span>True)

X<span style="color:#f92672">=</span>[]
y<span style="color:#f92672">=</span>[]
<span style="color:#66d9ef">for</span> fileName <span style="color:#f92672">in</span> tqdm(os<span style="color:#f92672">.</span>listdir(imagePath)):
    <span style="color:#66d9ef">try</span>:
        id_ <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>match(<span style="color:#e6db74">&#34;([a-z0-9]*)-\d( \(\d\))?.jpg&#34;</span>,fileName)<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>)
        match <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>loc[id_][<span style="color:#e6db74">&#34;match&#34;</span>]
        filePath <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(imagePath, fileName)
        img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(filePath)
        img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>resize(img, (<span style="color:#ae81ff">120</span>,<span style="color:#ae81ff">120</span>))
        X<span style="color:#f92672">.</span>append(img)
        y<span style="color:#f92672">.</span>append(match)
    <span style="color:#66d9ef">except</span>:
        <span style="color:#66d9ef">pass</span>
X<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>asarray(X)
y<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>asarray(y)
</code></pre></div><p>The image size is 120*120.
Divide the read image by 255 and put it in the range of 0-1 and divide into train and test.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-analytics.py" data-lang="analytics.py"><span style="color:#f92672">from</span> sklearn.model_selection <span style="color:#f92672">import</span> train_test_split

X <span style="color:#f92672">=</span> X<span style="color:#f92672">/</span><span style="color:#ae81ff">255</span>
X_train, X_test, y_train, y_test <span style="color:#f92672">=</span> train_test_split(X, y, random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">8888</span>)
</code></pre></div><p>Now that the data is ready, we can build the CNN. This time, we prepared a model of 2 convolutional layers + 2 fully connected layers.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-analytics.py" data-lang="analytics.py"><span style="color:#f92672">import</span> keras
<span style="color:#f92672">from</span> keras.models <span style="color:#f92672">import</span> Sequential
<span style="color:#f92672">from</span> keras.layers <span style="color:#f92672">import</span> Conv2D, Dense, ReLU, Dropout, Flatten, MaxPool2D

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getModel</span>():
    model<span style="color:#f92672">=</span>Sequential()
    model<span style="color:#f92672">.</span>add(Conv2D(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>,input_shape<span style="color:#f92672">=</span>(<span style="color:#ae81ff">120</span>,<span style="color:#ae81ff">120</span>,<span style="color:#ae81ff">3</span>)))
    model<span style="color:#f92672">.</span>add(ReLU())
    model<span style="color:#f92672">.</span>add(MaxPool2D((<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>)))
    model<span style="color:#f92672">.</span>add(Dropout(<span style="color:#ae81ff">0.25</span>))
    model<span style="color:#f92672">.</span>add(Conv2D(<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">3</span>,padding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;same&#34;</span>))
    model<span style="color:#f92672">.</span>add(ReLU())
    model<span style="color:#f92672">.</span>add(MaxPool2D((<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>)))
    model<span style="color:#f92672">.</span>add(Dropout(<span style="color:#ae81ff">0.25</span>))
    model<span style="color:#f92672">.</span>add(Flatten())
    model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">1024</span>))
    model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">2</span>,activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;softmax&#34;</span>))
    <span style="color:#66d9ef">return</span> model
</code></pre></div><p>Conduct training and prediction.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-analytics.py" data-lang="analytics.py">model <span style="color:#f92672">=</span> getModel()
model<span style="color:#f92672">.</span>compile(optimizer<span style="color:#f92672">=</span>Adam(), loss<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;categorical_crossentropy&#39;</span>, metrics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;accuracy&#34;</span>])
model<span style="color:#f92672">.</span>fit(X_train, to_categorical(y_train), epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">30</span>, validation_data<span style="color:#f92672">=</span>(X_test, to_categorical(y_test)))

y_pred <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_test)
y_pred <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>exp(y_pred)
y_pred <span style="color:#f92672">=</span> (y_pred<span style="color:#f92672">/</span>np<span style="color:#f92672">.</span>sum(y_pred, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>reshape(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>))[:,<span style="color:#ae81ff">1</span>]
<span style="color:#66d9ef">print</span>(roc_auc_score(y_test, y_pred))
<span style="color:#75715e">#&gt;&gt;0.5116927510028815</span>
</code></pre></div><p>auc0.51&hellip;Is it better than random?
Not very useful. There are few matched data&hellip;</p>
<p>Therefore, I would like to try transfer learning.
In transfer learning, a model in which some task has been learned in advance is applied to another task. In the image recognition model of CNN, it is empirically known that universal features of the image are likely to be extracted in the convolutional layer, and there is a model that performs another task only by properly recreating the final fully connected layer. It&rsquo;s done [6].</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/303209/2269bedd-be0a-0a22-1869-b05809ca99e0.png" alt="image.png">
<a href="http://cs231n.stanford.edu/syllabus.html">From CS231n: Convolutional Neural Networks for Visual Recognition Lecture 7</a></p>
<p>This time, based on VGG16, I will add a fully connected layer and output the match probability.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-analytics.py" data-lang="analytics.py"><span style="color:#75715e">#Preparing the data is the same as before, assuming that X_train, y_train, X_test, y_test have already been prepared.</span>
<span style="color:#f92672">from</span> keras.applications.vgg16 <span style="color:#f92672">import</span> VGG16

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">getModel</span>():
    model <span style="color:#f92672">=</span> VGG16(weights<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;imagenet&#34;</span>, include_top<span style="color:#f92672">=</span>False)
    x <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>output
    x <span style="color:#f92672">=</span> GlobalAveragePooling2D()(x)
    predictions <span style="color:#f92672">=</span> Dense(<span style="color:#ae81ff">1</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;linear&#34;</span>)(x)
    model <span style="color:#f92672">=</span> Model(inputs<span style="color:#f92672">=</span>model<span style="color:#f92672">.</span>input, outputs<span style="color:#f92672">=</span>predictions)
    <span style="color:#66d9ef">for</span> layer <span style="color:#f92672">in</span> model<span style="color:#f92672">.</span>layers[:<span style="color:#f92672">-</span><span style="color:#ae81ff">3</span>]:layer<span style="color:#f92672">.</span>trainable<span style="color:#f92672">=</span>False
    <span style="color:#66d9ef">return</span> model

model <span style="color:#f92672">=</span> getModel()
model<span style="color:#f92672">.</span>compile(optimizer<span style="color:#f92672">=</span>Adam(), loss<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mse&#34;</span>, metrics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;mse&#34;</span>])
model<span style="color:#f92672">.</span>fit(X_train, y_train, epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>, validation_data<span style="color:#f92672">=</span>(X_test, y_test))
y_pred <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_test)
<span style="color:#66d9ef">print</span>(roc_auc_score(y_test, y_pred))
<span style="color:#75715e">#&gt;&gt;0.6025131864722308</span>
</code></pre></div><p>Auc safely exceeded 0.6. I think we have finally completed a usable model.
Next time, we will finally find a matching person based on the text, the image, and the table data. I want to complete it before Christmas.</p>
<p>Please wait! My future girlfriend! !</p>
<h1 id="references">References</h1>
<p>[1]https://note.mu/sarasara201512/n/n20ec9765a387
[2]https://qiita.com/KR_bangkok/items/00b5ed45f5a8c1428960
[3]https://github.com/joelbarmettlerUZH/auto-tinder
[4] <a href="https://blog.aidemy.net/entry/2018/07/05/172157">https://blog.aidemy.net/entry/2018/07/05/172157</a>
[5]https://qiita.com/data_psyence/items/54bab846337fe1ca61e4
[6]https://qiita.com/ANNEX_IBS/items/55c7a8984fe88a756965</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Of course, the presence or absence of a face can be used as a feature quantity. <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>The other day, I got along with a Google guy, but a colleague from that person came from Kyoto University, and he said he did an A/B test with or without filling in the self-introduction academic history column. As a result, he said, &ldquo;Both with and without the name of the university (Kyoto University) were matched with 0 women and there was no significant difference.&rdquo; It was so sad that I couldn&rsquo;t ask for more details. <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>The question item &ldquo;Do you want children?&rdquo; is working because it exists by default, and I feel reluctant to write this kind of content in Tinder, which is a free description. <a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
