<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Python] AI engineers want to be aware of Python implementation know-how / tips summary | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] AI engineers want to be aware of Python implementation know-how / tips summary</h1>
<p>
  <small class="text-secondary">
  
  
  May 4, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/machine-learning"> machine learning</a></code></small>


<small><code><a href="https://memotut.com/tags/deeplearning"> DeepLearning</a></code></small>


<small><code><a href="https://memotut.com/tags/ai"> AI</a></code></small>


<small><code><a href="https://memotut.com/tags/deep-learning"> deep learning</a></code></small>

</p>
<pre><code>This article summarizes the points, tips, and know-how that data scientists and AI engineers should be aware of when implementing programs in Python.
</code></pre>
<hr>
<p>● May 16, 2020: Added
<a href="https://qiita.com/sugulu/items/c0e8a5e6b177bfe05e99?&amp;utm_source=public_comment#comment-a55990aab1c4988b01ad">Book: Self-propelled programmer author: Mr. Shimizukawa, provided detailed explanations to this article and answers to my questions. Click this link to move to the comment. </a></p>
<hr>
<p>We published a book in April 2020.</p>
<p>[Qiita]
<a href="https://qiita.com/sugulu/items/db5c5fa1f42c581e7bc7">I wrote a book that teaches a good balance between machine learning implementation and algorithms</a></p>
<p>[Book]
<a href="https://www.amazon.co.jp/dp/4297112094/">Introduction to machine learning for people aiming to become AI engineers, learning the algorithm flow while implementing it (Dentsu International Information Service Takuya Shimizu, Yutaro Ogawa, Technical Review)</a>
<a href="https://www.amazon.co.jp/dp/4297112094/">https://www.amazon.co.jp/dp/4297112094/</a></p>
<p>This post could not be written in the above book
** &ldquo;A summary of what AI engineers should be aware of when implementing a program in Python&rdquo; **
is.</p>
<p>The contents of this article are the points that I am aware of.
This is not the only answer, but I hope you find it helpful.</p>
<p>First, the contents of this article are shown.</p>
<p>After that, the explanation of each content is described.</p>
<h2 id="python-implementation-points-ai-engineers-should-be-aware-of">Python implementation points AI engineers should be aware of</h2>
<p>Level 1
1.1 Observe the naming conventions for variables, functions, classes and methods
1.2 Naming method 1: Remove redundant parts from variable names and method names
1.3 The description of import follows the rules
1.4 Fix random number seeds to ensure reproducibility
1.5 Program is executed as a function</p>
<p>Level 2
2.1 Naming method 2: Use reverse notation to make it easier to read
2.2 Keep SOLID&rsquo;s S in mind and keep functions and methods short with a single responsibility
2.3 Type hints for functions and methods
2.4 Write docstrings for classes, methods and functions
2.5 Save information such as preprocessing and hyperparameters when saving the trained model</p>
<p>Level 3
3.1 Naming method 3: Use proper English words and part-of-speech names
3.2 Implement exception handling appropriately
3.3 Implement logging properly
3.4 Keep the number of arguments for functions and methods to 3 or less
3.5 Properly use <code>*args</code> and <code>**kwargs</code></p>
<p>Level 4
4.1 Write short if statement with ternary operator
4.2 Implement sklearn-compliant preprocessing and model classes
4.3 Proper use of decorators
4.4 Unify editor settings for team development
4.5 Prepare GitHub pull request template and note the points</p>
<h2 id="explanation">Explanation</h2>
<h3 id="level-1">Level 1</h3>
<h3 id="11-follow-the-naming-conventions-for-variables-functions-classes-and-methods">1.1 Follow the naming conventions for variables, functions, classes and methods</h3>
<p>How to name functions and variables is a problem.
The naming method is also important, but first of all, follow the naming convention as a rule.
(The naming convention is <a href="https://pep8-ja.readthedocs.io/ja/latest/">[PEP8: Python Code Style Guide]</a>.)</p>
<p>● Variables, functions, methods, modules
⇒ Lowercase letters only, with words separated by underscores as needed
Example <code>lower_case_with_underscores</code></p>
<p>● Class name
⇒ Connect uppercase words only at the beginning, do not use underscore
Example <code>CapWords</code></p>
<p>● Private variables used only within the class
⇒ Underscore before variable name
Example <code>_single_leading_underscores</code></p>
<p>&ldquo;Private methods used only in the class&rdquo;
⇒ Underscore before method name
Example <code>_single_leading_underscore(self, ...)</code></p>
<p>● Constant
⇒ Separate words with underscores only in capital letters
Example <code>ALL_CAPS_WITH_UNDERSCORES</code></p>
<p>● Package name
⇒Only lowercase letters
Example <code>lowers</code></p>
<p>** * Remark 1 **: Difference between function and method
Functions are independent procedures that are not in a class. Method refers to a function within a class.</p>
<p><strong>Note 2</strong>: Module and package
The largest package is the top level. Modules are files within a package.
For example, sklearn is a package. sklearn.linear_model linear_model is a module.</p>
<h3 id="12-naming-method-1-remove-redundant-parts-from-variable-names-and-method-names">1.2 Naming method 1: Remove redundant parts from variable names and method names</h3>
<p>For example, if the class class_1 has a variable max_length, the name of the member variable is</p>
<p>Instead of <code>class_1_max_length</code>, simply set it to <code>max_length</code>.</p>
<p>Because when accessing this class variable from another class,</p>
<p><code>class_1.class_1_max_length = 10</code></p>
<p>This is because the class name becomes redundant, as in.</p>
<p><code>class_1.max_length = 10</code></p>
<p>Is better.</p>
<p>Imagine that a member variable, when used, would be &ldquo;classname.variablename&rdquo;.</p>
<h3 id="13-the-description-of-import-follows-the-rules">1.3 The description of import follows the rules</h3>
<p>Here are three points to keep in mind when importing external classes and functions.</p>
<p>● Order to list import
Describe the three types of libraries by separating them with blank lines as shown below.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> standard library
Blank line
<span style="color:#f92672">import</span> Related to third party (pip installed <span style="color:#f92672">from</span> PyPI)
Blank line
<span style="color:#f92672">import</span> what we created for this time<span style="color:#960050;background-color:#1e0010">`</span>
Blank line
</code></pre></div><p>●How to describe import
Import the whole module.
For example, if there is a class class_1 of module module_1 of package pkg,</p>
<p><code>from pkg.module_1 import class_1</code>
Not</p>
<p><code>from pkg import module_1</code>
As</p>
<p>In the program, for example
<code>my_class = module_1.class_1()</code>
And at the module level.</p>
<p>●How to describe import 2
Do not import multiple packages with import.</p>
<p><code>import pkg, pkg2</code>
Not
<code>import pkg import pkg2</code></p>
<p>Is described.</p>
<p>However, multiple entries are OK for modules.
For example:</p>
<p><code>from pkg import module_1, module_2</code></p>
<p>** * Note **
I also have a fairly appropriate way of importing.
It’s not good.
Autoformatter and other tools will correct the import statement, so it is recommended to use them.</p>
<h3 id="14-fix-random-number-seeds-to-ensure-reproducibility">1.4 Fix random number seeds to ensure reproducibility</h3>
<p>Since there are many random parts when implementing data science and AI, the seed of random numbers is always fixed to ensure the reproducibility of the program.</p>
<p>Implementation example is as follows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> random
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> torch

SEED_VALUE <span style="color:#f92672">=</span> <span style="color:#ae81ff">1234</span> <span style="color:#75715e"># This can be anything</span>
os<span style="color:#f92672">.</span>environ[<span style="color:#e6db74">&#39;PYTHONHASHSEED&#39;</span>] <span style="color:#f92672">=</span> str(SEED_VALUE)
random<span style="color:#f92672">.</span>seed(SEED_VALUE)
np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>seed(SEED_VALUE)
torch<span style="color:#f92672">.</span>manual_seed(SEED_VALUE) <span style="color:#75715e"># When using PyTorch</span>
</code></pre></div><p>However, if you use GPU with PyTorch,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">torch<span style="color:#f92672">.</span>backends<span style="color:#f92672">.</span>cudnn<span style="color:#f92672">.</span>deterministic <span style="color:#f92672">=</span> True
torch<span style="color:#f92672">.</span>backends<span style="color:#f92672">.</span>cudnn<span style="color:#f92672">.</span>benchmark <span style="color:#f92672">=</span> False
</code></pre></div><p>Is set. If these are not set, reproducibility cannot be guaranteed when using the GPU.</p>
<p>However, <code>torch.backends.cudnn.deterministic = True</code> slows down the calculation speed on the GPU.
Therefore, in my case, I give priority to execution speed and do not seek to ensure reproducibility of learning on GPU.</p>
<p>For details on how to ensure reproducibility with PyTorch, click here.
<a href="https://pytorch.org/docs/stable/notes/randomness.html">PyTorch REPRODUCIBILITY</a></p>
<p>Also, in the case of scikit-learn, there is also a part that receives a random number seed in each algorithm, so this is also fixed.</p>
<p>Example: scikit-learn</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> sklearn.linear_model <span style="color:#f92672">import</span> LogisticRegression

SEED_VALUE <span style="color:#f92672">=</span> <span style="color:#ae81ff">1234</span> <span style="color:#75715e"># This can be anything</span>
clf <span style="color:#f92672">=</span> LogisticRegression(random_state<span style="color:#f92672">=</span>SEED_VALUE)
</code></pre></div><h3 id="15-program-is-executed-as-a-function">1.5 Program is executed as a function</h3>
<p>Both Jupyter Notebook and Python command line execution will slow down non-functionalized programs.</p>
<p>For example, on Google Colaboratory,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> time
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np

start <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()

data <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand(<span style="color:#ae81ff">5000</span>)
sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(data)):
    <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(len(data)):
        sum <span style="color:#f92672">+=</span> data[j]

elapsed_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()<span style="color:#f92672">-</span>start
<span style="color:#66d9ef">print</span>(elapsed_time)
</code></pre></div><p>And it took 8.4 seconds.</p>
<p>This is the state where the program is written in one cell and executed.</p>
<p>In the same way, it is executed in one cell, but let&rsquo;s make a function around the main for statement and execute it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> time
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
    data <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>rand(<span style="color:#ae81ff">5000</span>)
    sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(data)):
        <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(len(data)):
            sum <span style="color:#f92672">+=</span> data[j]
    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>


start <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
main()
elapsed_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()<span style="color:#f92672">-</span>start
<span style="color:#66d9ef">print</span>(elapsed_time)
</code></pre></div><p>The result is 6.2 seconds. What took 8 seconds became 6 seconds.Even if you execute it in Jupyter Notebook like this, instead of executing a process that takes a long time in solid writing, make it a function like main() and execute that function.</p>
<p>The same applies when implementing a python file that is executed from the command line, for example hogehoge.py.</p>
<p><code>python hogehoge.py</code>
When running with, hogehoge.py is written as follows so that it will not be slow.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># import system</span>
<span style="color:#f92672">import</span> fuga

<span style="color:#75715e"># Function or class used in the main function</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">piyo</span>():
    your code

<span style="color:#75715e"># main function</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
    your code

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    main()
</code></pre></div><p>Finally, in the <code>if __name__ == &quot;__main__&quot;:</code>, the execution of <code>main()</code> is put in the if statement.</p>
<p><code>import hogehoge</code>
This is to prevent this main() function from being executed when</p>
<p>Without this if statement, main() would be executed just by importing.</p>
<h3 id="level-2">Level 2</h3>
<h3 id="21-naming-method-2-use-reverse-notation-to-make-it-easier-to-read">2.1 Naming method 2: Use reverse notation to make it easier to read</h3>
<p>For example, if you want to make 3 types of variables such as length of a, length of b, length of c,
<code>a_length b_length c_length</code>
Without
<code>length_a length_b length_c</code>
will do.</p>
<p>This way of writing is called reverse notation.</p>
<p>With reverse notation, the words start at the same point, making the program easier to read.</p>
<p>Also, if you are focusing on a, not length,
<code>a_length a_width a_max_length</code>
It will be written like this.</p>
<p>As a feeling, &ldquo;write the focused object at the beginning and unify the beginnings of variables&rdquo;.</p>
<h3 id="22-keep-the-number-of-function-and-method-lines-as-short-as-possible-while-being-aware-of-s-in-solid">2.2 Keep the number of function and method lines as short as possible while being aware of S in SOLID</h3>
<p>Books <a href="https://www.amazon.co.jp/%E6%9C%AC-%E3%83%AD%E3%83%90%E3%83%BC%E3%83%88%E3%83%BBC%E3%83%BB%E3%83%9E%E3%83%BC%E3%83%81%E3%83%B3/s?rh=n%3A465392%2Cp_27%3A%E3%83%AD%E3%83%90%E3%83%BC%E3%83%88%E3%83%BBC%E3%83%BB%E3%83%9E%E3%83%BC%E3%83%81%E3%83%B3">Mystery of Agile software development, Clean Code, Clean Coder, Clean Architecture, etc.</a>
Is the author of
Robert C. Martin (one of the agile software development declaration members)
SOLID is the principle of software design proposed by.</p>
<p>However, at the level of this post, you don&rsquo;t have to be aware of SOLID.</p>
<p>However, please be aware of the first SOLID, <strong>S: Single responsibility principle</strong>.</p>
<p>Single responsibility means that a function, class, and method should have only one responsibility.</p>
<p>It is difficult to balance the definition of size, abstraction and concreteness shown by <strong>&ldquo;single&rdquo;</strong> here.
<strong>The point is that functions, classes, and methods are as short as possible and are not affected by changes in superordinate concepts</strong>.</p>
<p>The work handled by data scientists and AI engineers is
It has a very procedural and flow-like content such as &ldquo;data preprocessing, learning, inference,&hellip;&rdquo;.</p>
<p>Then, the program to be implemented becomes procedural, and one main class and method are enlarged,
A single class or method tends to do a lot of things (have many responsibilities) from top to bottom.</p>
<p>Jupyter Notebook is good at closing level, but this state is difficult to introduce data science and AI into system development.</p>
<p>*I also write long classes and methods in the AI implementation guidebook in order to make them easier for beginners to understand, but at the time of system development, divide them into smaller pieces.</p>
<p>Development of SoE (System of Engagement) like AI system
There are many agile developments, rather than waterfall developments such as SoR (System of Records), where requirement definition and external/internal design are done exactly.</p>
<p>In agile development, it is fundamental to carry out CI (Continuous Integration) ≒ automatic test.
And because it&rsquo;s agile, you&rsquo;ll actually make it, look at the behavior at the prototype level, find Kaizen changes, and aim for better things.</p>
<p>At the time of this Kaizen, if the responsibility of a single class or method is large, the number of lines of code to recreate will increase.</p>
<p>The more lines of code you recreate, the wider the impact.</p>
<p>Then there will be many new unit tests that need to be created.</p>
<p>At the same time, you will throw away many of the unit tests you&rsquo;ve made.</p>
<p>** If you proceed with the development in such a situation that the unit tests are frequently replaced, the unit tests will not be written properly and the system quality will deteriorate. **</p>
<p>In addition, reworking with kaizen will affect unexpected places and cause bugs to occur more easily.</p>
<p>Data scientists, AI engineers, to actively accept Kaizen in agile development,
The functions, classes, and methods to implement should be short content that fulfills a single responsibility,
<strong>Implement strong implementation against Kaizen changes</strong>.</p>
<p>Rather than having one long function, class, or method
**Is it too short? It&rsquo;s better to have a lot of functions, classes and methods to worry about.</p>
<p>Depending on the book or article, it may be said that &ldquo;the number of lines for one function or method should be within 5 lines&rdquo;.
I think that using 5 lines as a reference is counterproductive, because AI implementation is too short and severe.</p>
<p>Rather than the standard of how many lines, we should keep in mind the length that fulfills a single responsibility, the implementation with a narrow impact range when changing Kaizen, and the implementation that rarely throws away unit tests.</p>
<p>One tip for that is to comment at the beginning of a function, class or method,
&ldquo;&ldquo;&ldquo;This method is responsible for implementing ●●.&rdquo;&rdquo;&rdquo;</p>
<p>It is also a good practice to write the responsibility explicitly, such as.</p>
<h3 id="23-add-type-hints-to-functions-and-methods">2.3 Add type hints to functions and methods</h3>
<p>Many functions and methods can be created by dividing the functions and methods while keeping in mind &ldquo;SOLID S: Single responsibility&rdquo;.</p>
<p>It is difficult to understand if there are many functions and methods.
It&rsquo;s okay when I&rsquo;m writing the code, but if I review this code three months later or someone else tries to use it,</p>
<p>&ldquo;What is in the argument of this function, what kind of output is output?&rdquo;</p>
<p>Will be confused.</p>
<p>Therefore, type hints are added when implementing a function.
The type hint is written as follows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calc_billing_amount</span>(amount: int, price: int) <span style="color:#f92672">-&gt;</span> int:
    billing_amount <span style="color:#f92672">=</span> amount<span style="color:#f92672">*</span>price
    <span style="color:#66d9ef">return</span> billing_amount
</code></pre></div><p>Describe the type after the argument name so that you know what the variable type of the argument is.</p>
<p>Also, describe the type so that you can see the type of the variable output from the function.</p>
<p>This type hint, as the name implies, is a hint, not a coercion.
So in the above function I give the first amount a float instead of an int,</p>
<p><code>calc_billing_amount(0.5, 100)</code></p>
<p>Can be executed as No error will occur. That point needs attention.</p>
<p>If you use a list or dictionary with type hints, or if multiple types such as int and float are OK, use the following format.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> typing <span style="color:#f92672">import</span> Dict, List, Union


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calc_billing_amount</span>(
    amount_list: List[int], price_dictionary: Dict[str, Union[int, float]]
) <span style="color:#f92672">-&gt;</span> int:
    billing_amount <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">for</span> index, (key, value) <span style="color:#f92672">in</span> enumerate(price_dictionary<span style="color:#f92672">.</span>items()):
        billing_amount <span style="color:#f92672">+=</span> amount_list[index] <span style="color:#f92672">*</span> value

    <span style="color:#66d9ef">return</span> int(billing_amount)
</code></pre></div><p>Use <code>from typing import List, Dict, Union</code> to import a list for type hints, a dictionary, and Union to use when both are acceptable.</p>
<p>And, for example, if the element is a list of type int, use <code>List[int]</code>.
The dictionary when key is a string type and value is either int or float
<code>Dict[str, Union[int, float]]</code>
Is written.</p>
<p>Run</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">amount <span style="color:#f92672">=</span> [<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">10</span>]
price <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;item1&#34;</span>: <span style="color:#ae81ff">100</span>, <span style="color:#e6db74">&#34;item2&#34;</span>: <span style="color:#ae81ff">30.5</span>}
calc_billing_amount(amount, price)
</code></pre></div><p>Will output <code>605</code>.</p>
<p>If you want to use the original class defined by yourself as a type hint, write it as follows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>:
    <span style="color:#66d9ef">def</span> __init__(self, name: str, user_type: str):
        self<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> name
        self<span style="color:#f92672">.</span>user_type <span style="color:#f92672">=</span> user_type


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">print_user_type</span>(user: <span style="color:#e6db74">&#34;User&#34;</span>) <span style="color:#f92672">-&gt;</span> str:
    <span style="color:#66d9ef">print</span>(user<span style="color:#f92672">.</span>user_type)
</code></pre></div><p>I define my own class User and define a function print_user_type which is executed with this User as an argument.</p>
<p>If Python version 3.7 or later,
<code>from __future__ import annotations</code>
You can change &ldquo;User&rdquo; to User by using Google Colaboratory, Python version is still 3.6, and the above method is recommended.</p>
<p>To run the class given the type hint above, as usual:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">taro <span style="color:#f92672">=</span> User(<span style="color:#e6db74">&#34;taro&#34;</span>, <span style="color:#e6db74">&#34;admin&#34;</span>)
print_user_type(taro)
</code></pre></div><p>will do. The output will then show <code>admin</code>.</p>
<p>Writing type hints is tedious, but if you divide it into many classes and methods with a single responsibility and implement it, it will be a problem later.</p>
<p>Especially at work, team members often see and use the code they write,
<strong>Implement an implementation that is easy for others to use and easy for Kaizen</strong>.</p>
<h3 id="24-describe-docstrings-for-classes-methods-and-functions">2.4 Describe docstrings for classes, methods and functions</h3>
<p>A docstring is a description of a class, method, function specification or usage.When it comes to a lot of classes and functions with a single responsibility, it is difficult to understand when reusing them.</p>
<p>Since it is difficult to understand only with type hints, I will write a docstring as a more detailed explanation.</p>
<p>However, it&rsquo;s a hassle, so I think a single-line docstring is fine for private methods and methods with a small number of lines.</p>
<p>On the other hand, classes and methods used by other team members, main classes that occupy an important position in the AI system, classes with long processing, etc.</p>
<p>Write a docstring in detail if it is easier for other members to use the detailed explanation.</p>
<p>The docstring can be written in any way, but normally,
・ReStructuredText
・Google style
・Numpy style
Write either.</p>
<p>I write it in one of these three types because it can then be automatically documented using Sphinx.
Therefore, the docstring notation that supports Sphinx is adopted.</p>
<p>Here is a detailed explanation of the three types of docstrings.
<a href="https://qiita.com/yokoc1322/items/ebf25c9cb779ff5ebc9c">Example of 3 styles of docstring</a></p>
<p>I like reStructuredText because Google style and Numpy style tend to be long vertically.</p>
<p>The docstring for reStructuredText is written as follows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>:
    <span style="color:#e6db74">&#34;&#34;&#34; This class indicates the account user who uses this system.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    :param name: User account name
</span><span style="color:#e6db74">    :param user_type: Account type (admin or normal)
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    :Example:
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    &gt;&gt;&gt; import User
</span><span style="color:#e6db74">    &gt;&gt;&gt; taro = User(&#34;taro&#34;, &#34;admin&#34;)
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>

    <span style="color:#66d9ef">def</span> __init__(self, name: str, user_type: str):
        self<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> name
        self<span style="color:#f92672">.</span>user_type <span style="color:#f92672">=</span> user_type

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">print_user_type</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34; Print the type of user with a print statement
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">        :pram None: No input argument
</span><span style="color:#e6db74">        :return: output user_type as a string
</span><span style="color:#e6db74">        :rtype: str
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">        :Example:
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">        &gt;&gt;&gt; import User
</span><span style="color:#e6db74">        &gt;&gt;&gt; taro = User(&#34;taro&#34;, &#34;admin&#34;)
</span><span style="color:#e6db74">        &gt;&gt;&gt; taro.print_user_type()
</span><span style="color:#e6db74">        admin
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">print</span>(self<span style="color:#f92672">.</span>user_type)
</code></pre></div><p>I&rsquo;ll like it because it&rsquo;s easy for other people to use because I can easily understand how to use it even if I write up to Example.
It depends on the situation how much detail is written, and how to describe Example, arguments, and return.</p>
<p>If you describe as above, in Editor such as VS code,
As shown in the figure below, if you move the mouse cursor to the relevant program part, this docstring will be displayed, so it is easy to understand the program.
(In the figure below, the mouse cursor is placed on print_user_type())</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/191401/87939454-12e5-dde1-325c-49191506a009.png" alt="Figure 1.png"></p>
<h3 id="25-when-saving-a-trained-model-save-information-such-as-preprocessing-and-hyperparameters-together">2.5 When saving a trained model, save information such as preprocessing and hyperparameters together</h3>
<p>In AI, machine learning, and deep learning, not only the trained model is saved, but the information that can reproduce the learning such as preprocessing pipeline, setting hyperparameters of the model, and all objects necessary for inference. Save</p>
<p>Any method can be used as long as all the above information is included, but an example of saving with scikit-learn and PyTorch is shown below.</p>
<p>Example: For scikit-learn</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta, timezone

<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">from</span> joblib <span style="color:#f92672">import</span> dump, load
<span style="color:#f92672">from</span> sklearn.datasets <span style="color:#f92672">import</span> load_iris
<span style="color:#f92672">from</span> sklearn.linear_model <span style="color:#f92672">import</span> LogisticRegression
<span style="color:#f92672">from</span> sklearn.pipeline <span style="color:#f92672">import</span> Pipeline
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> PolynomialFeatures, StandardScaler

<span style="color:#75715e"># Prepare iris as appropriate data</span>
X, y <span style="color:#f92672">=</span> load_iris(return_X_y<span style="color:#f92672">=</span>True)

<span style="color:#75715e"># Pre-processing (standardized and added squared feature quantity)</span>
preprocess_pipeline <span style="color:#f92672">=</span> Pipeline(steps<span style="color:#f92672">=</span>[(<span style="color:#e6db74">&#34;standard_scaler&#34;</span>, StandardScaler())])
preprocess_pipeline<span style="color:#f92672">.</span>steps<span style="color:#f92672">.</span>append((<span style="color:#e6db74">&#34;polynominal_features_2&#34;</span>, PolynomialFeatures(<span style="color:#ae81ff">2</span>)))

<span style="color:#75715e">#Apply pre-processing</span>
X_preprocessed <span style="color:#f92672">=</span> preprocess_pipeline<span style="color:#f92672">.</span>fit_transform(X)

<span style="color:#75715e">#Preparing a learning device</span>
C <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.2</span> <span style="color:#75715e"># Set hyperparameter</span>
model <span style="color:#f92672">=</span> LogisticRegression(random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, C<span style="color:#f92672">=</span>C)

<span style="color:#75715e"># Conduct learning</span>
model<span style="color:#f92672">.</span>fit(X_preprocessed, y)

<span style="color:#75715e">#Performance with learning data</span>
accuracy_training <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>score(X_preprocessed, y)

<span style="color:#75715e"># Ready to save various data</span>
JST <span style="color:#f92672">=</span> timezone(timedelta(hours<span style="color:#f92672">=+</span><span style="color:#ae81ff">9</span>), <span style="color:#e6db74">&#34;JST&#34;</span>) <span style="color:#75715e"># in Japan time</span>
now <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>now(JST)<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#34;%Y%m</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">_%H%M%S&#34;</span>) <span style="color:#75715e"># Get current time</span>

training_info <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;training_data&#34;</span>: <span style="color:#e6db74">&#34;iris&#34;</span>,
    <span style="color:#e6db74">&#34;model_type&#34;</span>: <span style="color:#e6db74">&#34;LogisticRegression&#34;</span>,
    <span style="color:#e6db74">&#34;hyper_pram_logreg_C&#34;</span>: C,
    <span style="color:#e6db74">&#34;accuracy_training&#34;</span>: accuracy_training,
    <span style="color:#e6db74">&#34;save_date&#34;</span>: now,
}

save_data <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;preprocess_pipeline&#34;</span>: preprocess_pipeline,
    <span style="color:#e6db74">&#34;trained_mode&#34;</span>: model,
    <span style="color:#e6db74">&#34;training_info&#34;</span>: training_info,
}
filename <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./iris_model_&#34;</span> <span style="color:#f92672">+</span> now <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.joblib&#34;</span>

<span style="color:#75715e">#Save</span>
dump(save_data, filename)
</code></pre></div><p>If you want to load the saved contents,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">load_data <span style="color:#f92672">=</span> load(filename)

<span style="color:#75715e"># Load the loaded contents</span>
preprocess_pipeline <span style="color:#f92672">=</span> load_data[<span style="color:#e6db74">&#34;preprocess_pipeline&#34;</span>]
model <span style="color:#f92672">=</span> load_data[<span style="color:#e6db74">&#34;trained_mode&#34;</span>]
<span style="color:#66d9ef">print</span>(load_data[<span style="color:#e6db74">&#34;training_info&#34;</span>])
</code></pre></div><p>is.
In this load example, we are printing training_info, so
<code>{'training_data':'iris','model_type':'LogisticRegression','hyper_pram_logreg_C': 1.2,'accuracy_training': 0.9866666666666667,'save_date': '20200503_205145'}</code>
Something like is output.</p>
<p>Example: PyTorch
Reference <a href="https://pytorch.org/tutorials/beginner/saving_loading_models.html">PyTorch SAVING AND LOADING MODELS</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">PATH <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;./checkpoint_&#39;</span> <span style="color:#f92672">+</span> str(epoch) <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;.pt&#39;</span>

torch<span style="color:#f92672">.</span>save({
    <span style="color:#e6db74">&#39;epoch&#39;</span>: epoch,
    <span style="color:#e6db74">&#39;total_epoch&#39;</span>: total_epoch,
    <span style="color:#e6db74">&#39;model_state_dict&#39;</span>: model<span style="color:#f92672">.</span>state_dict(),
    <span style="color:#e6db74">&#39;scheduler.state_dict&#39;</span>: scheduler<span style="color:#f92672">.</span>state_dict()
    <span style="color:#e6db74">&#39;optimizer_state_dict&#39;</span>: optimizer<span style="color:#f92672">.</span>state_dict(),
    <span style="color:#e6db74">&#39;loss_train&#39;</span>: loss_train,
    <span style="color:#e6db74">&#39;loss_eval&#39;</span>: loss_eval,
}, PATH)
</code></pre></div><p>When loading</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Make objects such as models first</span>
model <span style="color:#f92672">=</span> TheModelClass() <span style="color:#75715e"># This is the same model we saved</span>
scheduler <span style="color:#f92672">=</span> TheSchedulerClass() <span style="color:#75715e"># This is the same Scheduler Class we saved</span>
optimizer <span style="color:#f92672">=</span> TheOptimizerClass() <span style="color:#75715e"># This is the same Optimizer Class you saved</span>

<span style="color:#75715e">#Load and give</span>
checkpoint <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>load(PATH)
model<span style="color:#f92672">.</span>load_state_dict(checkpoint[<span style="color:#e6db74">&#39;model_state_dict&#39;</span>])
scheduler<span style="color:#f92672">.</span>load_state_dict(checkpoint[<span style="color:#e6db74">&#39;scheduler_state_dict&#39;</span>])
optimizer<span style="color:#f92672">.</span>load_state_dict(checkpoint[<span style="color:#e6db74">&#39;optimizer_state_dict&#39;</span>])
total_epoch <span style="color:#f92672">=</span> checkpoint[<span style="color:#e6db74">&#39;total_epoch&#39;</span>]
epoch <span style="color:#f92672">=</span> checkpoint[<span style="color:#e6db74">&#39;epoch&#39;</span>]
loss_train <span style="color:#f92672">=</span> checkpoint[<span style="color:#e6db74">&#39;loss_train&#39;</span>]
loss_eval <span style="color:#f92672">=</span> checkpoint[<span style="color:#e6db74">&#39;loss_eval&#39;</span>]

<span style="color:#75715e"># Do the following depending on learning or reasoning</span>
model<span style="color:#f92672">.</span>train()
<span style="color:#75715e"># model.eval()</span>
</code></pre></div><p>If you save even deep learning dataset and data loader to checkpoint, save files will be too big, so save them separately.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Save data set, data loader</span>
torch<span style="color:#f92672">.</span>save(trainset,<span style="color:#e6db74">&#39;./trainset.pt&#39;</span>)
torch<span style="color:#f92672">.</span>save(trainloader,<span style="color:#e6db74">&#39;./dataloader.pt&#39;</span>)
</code></pre></div><p>When loading</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">trainset <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>load(<span style="color:#e6db74">&#39;./trainset.pt&#39;</span>)trainloader <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>load(<span style="color:#e6db74">&#39;./dataloader.pt&#39;</span>)
</code></pre></div><p>That&rsquo;s it for saving and loading with PyTorch.</p>
<p>Whether it&rsquo;s scikit-learn or PyTorch, the details of how to save are all fine.</p>
<p>However, I saved only the model, and later</p>
<p>**&ldquo;How was this model learned?&rdquo; **
<strong>&ldquo;What is the performance of this model?&quot;</strong>
<strong>&ldquo;There is no pre-processed pipe that has been trained to input data to this model!!&quot;</strong></p>
<p>Be careful not to be in such a situation.</p>
<p>** ※ Remarks 1 **: The reason that preprocessing and model are not made into one pipeline in the example of scikit-learn is that preprocessing may be performed by another resource and thrown into the model API.
Especially when you want to process a large amount of data at high speed, I would like to make it easy to use when preprocessing is distributed to other locations and executed.
Also, preprocessing is the same, and when training different models, there is also the desire to divert only this preprocessing pipeline.</p>
<p><strong>Note 2</strong>: The points to note when creating your own preprocessing class will be explained later. Here, when loading a pre-processing pipeline that uses a self-made class, etc., in addition to importing the normal sckit-learn pre-processing class before loading, also import the self-made class, Then load it.
When loading, if the class to be expanded is not imported, an error will occur when loading, so be careful.</p>
<h3 id="level-3">Level 3</h3>
<h3 id="31-naming-method-3-use-proper-english-words-and-parts-of-speech-to-name-your-responsibilities">3.1 Naming Method 3: Use proper English words and parts of speech to name your responsibilities</h3>
<p>The more subdivided your classes, methods, and functions, the more important their naming becomes.</p>
<p>If you look at the name, &ldquo;What are you doing? What kind of responsibility do you have, what is input, what is output?&rdquo;
Ideally, you know this.</p>
<p>However, it is difficult for Japanese people.</p>
<p>Comments are unnecessary in the programming world, if you look at the code naming, it&rsquo;s a comment,
There is also a general idea,
The ability of the Japanese to understand the difference in vocabulary and nuances of English is challenging.</p>
<p>In the case of data science and AI, the algorithm itself is complicated,
It is difficult for first-timers to see the uncommented implementation and understand the contents of the class or method.</p>
<p>However, the naming method aims to convey the intention as easily as possible.</p>
<p>At least I want to protect</p>
<p>[1] Use class names and variable names as nouns</p>
<p>[2] Method and function names start with a verb</p>
<p>[3] In the case of the truth value (boolean type) of a member variable, it may start with the verb as follows.
(Example) is_admin, has_item, can_drive, etc.</p>
<p>[4] Use codic etc.
<a href="https://codic.jp/engine">https://codic.jp/engine</a></p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/191401/462f5567-41be-0261-2896-fa799ce5329d.png" alt="Capture.PNG"></p>
<h3 id="32-implement-exception-handling-properly">3.2 Implement exception handling properly</h3>
<p>Error (exception) try-catch is a troublesome part that is not fun at all, and it is painful (I think) for data scientists and AI engineers.</p>
<p>There is no problem if the project scale is only Jupyter Notebook, but error handling is important when implementing AI in the system.
When an exception is thrown, the whole system process stops.</p>
<p>Therefore, in the implementation code,
Make sure try is at the top level (that is, avoid situations where code is not inside try:).</p>
<p>Be sure to read the official Python description.
<a href="https://docs.python.org/ja/3/tutorial/errors.html">Official 8. Errors and Exceptions</a></p>
<p>Example: When defining a function that performs division</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func_division</span>(a, b):
    ret <span style="color:#f92672">=</span> a<span style="color:#f92672">/</span>b
    <span style="color:#66d9ef">return</span> ret
</code></pre></div><p>If you do this,
<code>ans = func_division(10, 0)</code>
When something like this comes, an error occurs and the whole program stops.</p>
<p>So</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func_division</span>(a, b):
   <span style="color:#66d9ef">try</span>:
      ret <span style="color:#f92672">=</span> a<span style="color:#f92672">/</span>b
      <span style="color:#66d9ef">return</span> ret
   <span style="color:#66d9ef">except</span>:
      <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Exception occurred&#34;</span>)
</code></pre></div><p>Is written.</p>
<p>However, this is not enough.
If you can expect an exception that occurs from the processing content, handle it properly and handle the exception accordingly.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func_division</span>(a, b):
   <span style="color:#66d9ef">try</span>:
      ret <span style="color:#f92672">=</span> a<span style="color:#f92672">/</span>b
      <span style="color:#66d9ef">return</span> ret
   <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">ZeroDivisionError</span> <span style="color:#66d9ef">as</span> err:
      <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Divide by 0 exception:&#39;</span>, err)
   <span style="color:#66d9ef">except</span>:
      <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unexpected exception occurred&#34;</span>)
</code></pre></div><p>If this is</p>
<p><code>ans = func_division(10, 0)</code>
Comes,
<code>Divide by 0 exception: division by zero</code>
Is output,</p>
<p><code>ans = func_division(&quot;hoge&quot;, &quot;fuga&quot;)</code>
And given a non-numeric input,</p>
<p><code>Unexpected exception</code>
Is output.</p>
<p>Since the implementation of AI on real systems will accelerate in the future, people who can write programs only at the Jupyter Notebook level will be troubled (I think).</p>
<p>The point is to be aware that &ldquo;try is at the top level (that is, avoid situations where code is not inside try:)&rdquo;.</p>
<p><strong>※ Remark</strong>: Narrow the range of try
I think trying-catch alone can be tedious, but that&rsquo;s why you shouldn&rsquo;t put big things (lots of lines) in one try. I don&rsquo;t know where the exception occurred.
Try-catch in one meaningful unit of processing.
Also, as I will explain later, when there are many lines in a method, it is often necessary to split it into another method.</p>
<h3 id="33-implement-logging-properly">3.3 Implement logging properly</h3>
<p>Data scientists and AI engineers generally use a print statement to check the status, but when incorporating it into a system, the print statement is a problem, so write it properly as a log.</p>
<p>The image of how to use the log is as follows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> logging

logger <span style="color:#f92672">=</span> logging<span style="color:#f92672">.</span>getLogger(__name__)

<span style="color:#75715e"># create a value to put in log</span>
total_epoch <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>
epoch <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
loss_train <span style="color:#f92672">=</span> <span style="color:#ae81ff">5.44444</span>

<span style="color:#75715e"># Log content</span>
log_list <span style="color:#f92672">=</span> [total_epoch, epoch, loss_train]

Log <span style="color:#f92672">in</span> <span style="color:#75715e">#log</span>
logger<span style="color:#f92672">.</span>info(
    <span style="color:#e6db74">&#34;total_epoch: {0[0]}, epoch: {0[1]}, loss_train: {0[2]:.2f}&#34;</span><span style="color:#f92672">.</span>format(log_list)
)

Check the contents recorded <span style="color:#f92672">in</span> <span style="color:#75715e"># log by outputting them (for confirmation now, originally unnecessary)</span>
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;total_epoch: {0[0]}, epoch: {0[1]}, loss_train: {0[2]:.2f}&#34;</span><span style="color:#f92672">.</span>format(log_list))
</code></pre></div><p>In this case, if you check the logged contents with a print statement,
<code>total_epoch: 1000, epoch: 100, loss_train: 5.44</code>
Has become.</p>
<p>Here, <code>{0[2]:.2f}</code> means to display the second of the list received by .format with two decimal places.</p>
<p>There are various ways to write in Python, whether it is a logger or a print statement,
If there are many variables to write, I write them as a list and pass them as above.</p>
<p>Not only logger.info but also logger.debug, logger.warning, logger.error, etc. The log level changes according to the situation.</p>
<p>At a minimum, the atmosphere in the example above is fine, but the log world is deep.</p>
<p>You may also want to read the official log documentation.</p>
<p><a href="https://docs.python.org/ja/3/howto/logging.html">Python Logging</a></p>
<hr>
<p>More advice from @paulxll, add: sunny:</p>
<p>I received an example using f-string (assuming Python 3.8). Please refer to this as well♪</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># create a value to put in log</span>
total_epoch <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>
epoch <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
loss_train <span style="color:#f92672">=</span> <span style="color:#ae81ff">5.44444</span>

Log <span style="color:#f92672">in</span> <span style="color:#75715e">#log</span>
logger<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#34;{total_epoch=}, {epoch=}, loss_train: {loss_train=:.2f}&#34;</span>)
</code></pre></div><p>Note: The above is how to write in Python 3.8 or above. For version 3.7 and below,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">logger<span style="color:#f92672">.</span>info(f<span style="color:#e6db74">&#34;total_epoch: {total_epoch}, epoch: {epoch}, loss_train: {loss_train:.2f}&#34;</span>)
</code></pre></div><p>(Thanks for your advice :sunny:).</p>
<hr>
<h3 id="34-the-number-of-arguments-for-functions-and-methods-should-be-3-or-less">3.4 The number of arguments for functions and methods should be 3 or less</h3>
<p>There are at most three arguments for functions and methods. Avoid four or more (in my case).</p>
<p>If there are many arguments, it will be difficult to understand how to use the function, and preparation and management of unit tests will be troublesome.</p>
<p>If you want to take a lot of arguments, make it a dictionary variable such as hogehoge_config, and pass it to the function as one dictionary variable.</p>
<p>Example: Complex calculation function
(I&rsquo;m sorry to explain that I&rsquo;m trying to write exception handling, but I&rsquo;m sorry, but exception handling is omitted.)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func_many_calculation</span>(a, b, c, d, e):
    ret <span style="color:#f92672">=</span> a<span style="color:#f92672">*</span>b<span style="color:#f92672">*</span>c<span style="color:#f92672">/</span>d<span style="color:#f92672">/</span>e
    <span style="color:#66d9ef">return</span> ret
</code></pre></div><p>Define as <code>ans = func_many_calculation(10, 2, 3, 5, 2)</code>
It is troublesome to use too many arguments.
It can be a source of mistakes.</p>
<p>So, for example,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func_many_calculation</span>(func_config):
    a <span style="color:#f92672">=</span> func_config[<span style="color:#e6db74">&#34;a&#34;</span>]
    b <span style="color:#f92672">=</span> func_config[<span style="color:#e6db74">&#34;b&#34;</span>]
    c <span style="color:#f92672">=</span> func_config[<span style="color:#e6db74">&#34;c&#34;</span>]
    d <span style="color:#f92672">=</span> func_config[<span style="color:#e6db74">&#34;d&#34;</span>]
    e <span style="color:#f92672">=</span> func_config[<span style="color:#e6db74">&#34;e&#34;</span>]
    ret <span style="color:#f92672">=</span> a<span style="color:#f92672">*</span>b<span style="color:#f92672">*</span>c<span style="color:#f92672">/</span>d<span style="color:#f92672">/</span>e
    <span style="color:#66d9ef">return</span> ret
</code></pre></div><p>And define
func_config = {&ldquo;a&rdquo;: 10, &ldquo;b&rdquo;: 2, &ldquo;c&rdquo;: 3, &ldquo;d&rdquo;: 5, &ldquo;e&rdquo;: 2}`
Create a variable to substitute with a dictionary</p>
<p><code>ans = func_many_calculation(func_config)</code>
And run.However, since the definition of the function is too cumbersome in this way of writing,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func_many_calculation</span>(a, b, c, d, e):
    ret <span style="color:#f92672">=</span> a<span style="color:#f92672">*</span>b<span style="color:#f92672">*</span>c<span style="color:#f92672">/</span>d<span style="color:#f92672">/</span>e
    <span style="color:#66d9ef">return</span> ret
</code></pre></div><p>And write a lot of arguments in the function definition,</p>
<p>In the execution part, try to reduce the arguments,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">func_config <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;a&#34;</span>: <span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#34;b&#34;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;c&#34;</span>: <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;d&#34;</span>: <span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#34;e&#34;</span>: <span style="color:#ae81ff">2</span>}
ans <span style="color:#f92672">=</span> func_many_calculation(<span style="color:#f92672">**</span>func_config)
</code></pre></div><p>It is good to say</p>
<p>** * Note **: <code>**func_config</code> is an unfamiliar way of writing arguments.
This <code>**</code> means the unpack operation of the dictionary type variable.
So here,
<code>func_many_calculation(**func_config)</code>
Is
<code>func_many_calculation(func_config[&quot;a&quot;], func_config[&quot;b&quot;], ..., func_config[&quot;e&quot;])</code>
Means
Unpacking dictionary variables with <code>**</code> is convenient, so let&rsquo;s use it.</p>
<h3 id="35-use-args-kwargs-properly">3.5 Use <code>*args</code>, <code>**kwargs</code> properly</h3>
<p>I don&rsquo;t know what <code>*args</code> and <code>**kwargs</code> are, but use them actively! !
There are no such data scientists or AI engineers,</p>
<p>&ldquo;I don&rsquo;t know for some reason, but when I look at the paper implementation repository, I see a lot of <code>*args</code> and <code>**kwargs</code>.&rdquo;</p>
<p>I think there are many such experiences. Make friends with <code>*args</code> and <code>**kwargs</code>.</p>
<p>After the explanation of unpacking dictionary variables in 3.4, I&rsquo;m not afraid of <code>*args</code> and <code>**kwargs</code>.</p>
<p><code>args</code> is an abbreviation for arguments, and argument means the arguments in Japanese.
<code>kwargs</code> stands for keyword arguments.</p>
<p>Here, <code>*</code> is the unpack operation of the list variable.
<code>**</code> is the unpacking operation of the dictionary type variable as explained in 3.4.</p>
<p>If you use this <code>*</code>, <code>**</code> as a function argument, it will be as follows.</p>
<p>For example</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func_args_kwargs</span>(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
    <span style="color:#66d9ef">print</span>(args)
    <span style="color:#66d9ef">if</span> len(args) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">2</span>:
        <span style="color:#66d9ef">print</span>(args[<span style="color:#ae81ff">1</span>])
    <span style="color:#66d9ef">print</span>(kwargs)
    flg_a <span style="color:#f92672">=</span> kwargs<span style="color:#f92672">.</span>pop(<span style="color:#e6db74">&#34;flg_a&#34;</span>, False)
    <span style="color:#66d9ef">print</span>(flg_a)
</code></pre></div><p>If you define a function like</p>
<p><code>func_args_kwargs(10, 20)</code>
And then the input arguments 10 and 20 go into args,
<code>(10, 20) 20 {} False</code>
Is output.</p>
<p>Next, we also use a dictionary variable for input,
<code>func_args_kwargs(10, **{&quot;flg_a&quot;:True})</code>
When I run, the arguments other than the first dictionary go into args, the dictionary goes into kwargs,</p>
<p><code>(10,) {'flg_a': True} True</code>
Is output.</p>
<p><code>*args</code> and <code>**kwargs</code> are called <strong>variable length arguments</strong>.</p>
<p>We will explain why we use such variable length arguments <code>*args</code>, <code>**kwargs</code>.</p>
<p>There are three reasons to use variadic arguments.</p>
<p>The first reason is that it can be executed even if the function has extra arguments.</p>
<p>For example</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func_args_kwargs2</span>(a, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
    <span style="color:#66d9ef">print</span>(a)
</code></pre></div><p>When you run
<code>func_args_kwargs2(10, 20, 30)</code>
The output of
<code>10</code></p>
<p>And can be executed without an error.</p>
<p>The second reason is that if you want to expand the function and increase the number of arguments later, if you receive it with <code>*args</code>, you do not have to rewrite the contents of the function and the argument definition part.</p>
<p>The third reason is that <code>*args</code> and <code>**kwargs</code> are used as the part that receives the arguments that may or may not be passed at the time of execution as the arguments when executing the function or method. To do.</p>
<p>In this case, set the default value when you do not receive <code>*args</code> or <code>**kwargs</code>.</p>
<p>Example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func_args_kwargs3</span>(a, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
    b <span style="color:#f92672">=</span> kwargs<span style="color:#f92672">.</span>pop(<span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#ae81ff">2.0</span>)
    <span style="color:#66d9ef">print</span>(a<span style="color:#f92672">*</span>b)
</code></pre></div><p>Is defined as</p>
<p><code>func_args_kwargs3(3.0)</code>
Will output 6.0. The default 2.0 is used for b in the function.</p>
<p><code>func_args_kwargs3(3, **{&quot;b&quot;:4.0})</code>
, The output will be 12.0. B in the function will be 4.0 given by the argument.</p>
<p>The above is the operation of <code>*args</code> and <code>**kwargs</code>.</p>
<p>** * Remarks **: In the implementation, it is rare for me to use <code>*args</code> and <code>**kwargs</code>.
For OSS and published paper implementations, <code>*args</code> and <code>**kwargs</code> are often used.
In the case of these developments, there is a high degree of uncertainty as many people use the implementation code.
Therefore, as I mentioned in the first reason, are you using <code>*args</code> and <code>**kwargs</code> so that it works even if unnecessary arguments are included? I think.</p>
<h3 id="level-4">Level 4</h3>
<h3 id="41-get-used-to-the-if-statement-in-the-ternary-operator">4.1 Get used to the if statement in the ternary operator</h3>
<p>In Python, if statements are often written in ternary operators and put together on one line.
Let&rsquo;s get used to it.
(I don&rsquo;t often use it when writing books, but I use it because the implementation code has fewer lines and is easier to read.)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Determine if even or odd</span>
num <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>

<span style="color:#66d9ef">if</span> num <span style="color:#f92672">%</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;even&#34;</span>)
<span style="color:#66d9ef">else</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;odd&#34;</span>)
</code></pre></div><p>Is</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Determine if even or odd</span>
num <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;even&#34;</span>) <span style="color:#66d9ef">if</span> num <span style="color:#f92672">%</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;odd&#34;</span>)
</code></pre></div><p>Is written.</p>
<p>The sample print statement is not good.
At the time of substitution, it becomes as follows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">num <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
a <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;even&#34;</span> <span style="color:#66d9ef">if</span> num <span style="color:#f92672">%</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;odd&#34;</span>
<span style="color:#75715e"># a = &#34;even&#34; if num %2 == 0 else a = &#34;odd&#34; # This is an error</span>

<span style="color:#66d9ef">print</span>(a)
</code></pre></div><hr>
<p>More advice from @Nabetani-sama: Sunny:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;even&#34;</span>) <span style="color:#66d9ef">if</span> num <span style="color:#f92672">%</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;odd&#34;</span>)
<span style="color:#75715e"># Than</span>
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;even&#34;</span> <span style="color:#66d9ef">if</span> num <span style="color:#f92672">%</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#34;odd&#34;</span>)
I feel that <span style="color:#75715e"># is preferable.</span>
</code></pre></div><p>My situation</p>
<ul>
<li>Use foo if cond else bar if you want the value of the result of the conditional operation.</li>
<li>Avoid foo if cond else bar if you don&rsquo;t need the result of conditional operation, use if cond:<newline>foo<newline>else:<newline>bar</li>
</ul>
<p>I am.</p>
<hr>
<h3 id="42-implement-sklearn-compliant-preprocessing-and-model-classes">4.2 Implement sklearn compliant preprocessing and model classes</h3>
<p>Sklearn compliant is a class that inherits BaseEstimator, TransformerMixin, ClassifierMixin, etc. of scikit-learn and is implemented so that it can be handled by Pipeline class of scikit-learn together with other objects of scikit-learn.</p>
<p>If you make your own preprocessing class or model sklearn compliant, it is convenient because you can use it by incorporating it in the Pipeline of scikit-learn.</p>
<p>For example, if it is a preprocessing class, write as follows. Extend TransformerMixin and BaseEstimator.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> sklearn.base <span style="color:#f92672">import</span> BaseEstimator, ClassifierMixin, TransformerMixin
<span style="color:#f92672">from</span> sklearn.utils.validation <span style="color:#f92672">import</span> check_array, check_is_fitted, check_X_y


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TemplateTransformer</span>(TransformerMixin, BaseEstimator):
    <span style="color:#e6db74">&#34;&#34;&#34; Sample preprocessing class &#34;&#34;&#34;</span>

    <span style="color:#66d9ef">def</span> __init__(self, demo_param<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;demo&#39;</span>):
        Parameters used after self<span style="color:#f92672">.</span>demo_param <span style="color:#f92672">=</span> demo_param <span style="color:#75715e"># are prepared in init</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fit</span>(self, X, y<span style="color:#f92672">=</span>None):
        <span style="color:#e6db74">&#34;&#34;&#34;Perform necessary learning in pre-processing. Even if y does not exist, give y=None&#34;&#34;&#34;</span>
        
        X <span style="color:#f92672">=</span> check_array(X, accept_sparse<span style="color:#f92672">=</span>True) <span style="color:#75715e"># check_array is the sklearn input validation function</span>

        <span style="color:#75715e"># The process of learning something. Here, as an example, we are learning a parameter called n_features_</span>
        self<span style="color:#f92672">.</span>n_features_ <span style="color:#f92672">=</span> X<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>]

        <span style="color:#75715e">#Return the pre-processing Transformer itself</span>
        <span style="color:#66d9ef">return</span> self

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">transform</span>(self, X):
        <span style="color:#e6db74">&#34;&#34;&#34; Apply preprocessing to argument X &#34;&#34;&#34;</span>

        <span style="color:#75715e">#Check if there is a parameter (n_features_ here) that should be learned when applying preprocessing</span>
        check_is_fitted(self,<span style="color:#e6db74">&#39;n_features_&#39;</span>)

        <span style="color:#75715e">#sklearn input validation</span>
        X <span style="color:#f92672">=</span> check_array(X, accept_sparse<span style="color:#f92672">=</span>True)

        <span style="color:#75715e"># Some conversion process</span>
        X_transformed <span style="color:#f92672">=</span> hogehoge(X)

        <span style="color:#66d9ef">return</span> X_transformed
</code></pre></div><p>Also, in case of model class, make ClassifierMixin and BaseEstimator inherit.
The following is based on the image of supervised learning, but the same applies to unsupervised learning.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> sklearn.base <span style="color:#f92672">import</span> BaseEstimator, ClassifierMixin, TransformerMixin
<span style="color:#f92672">from</span> sklearn.utils.validation <span style="color:#f92672">import</span> check_array, check_is_fitted, check_X_y


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TemplateClassifier</span>(ClassifierMixin, BaseEstimator):
    <span style="color:#e6db74">&#34;&#34;&#34; Model class sample &#34;&#34;&#34;</span>

    <span style="color:#66d9ef">def</span> __init__(self, demo_param<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;demo&#34;</span>):Parameters used after self<span style="color:#f92672">.</span>demo_param <span style="color:#f92672">=</span> demo_param <span style="color:#75715e"># are prepared in init</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">fit</span>(self, X, y):
        <span style="color:#e6db74">&#34;&#34;&#34; Implementation of learning. Even if y does not exist due to supervised learning, etc., it is given with y=None.&#34;&#34;&#34;</span>

        <span style="color:#75715e">#sklearn input validation</span>
        X, y <span style="color:#f92672">=</span> check_X_y(X, y)

        <span style="color:#75715e"># Something to learn</span>
        self<span style="color:#f92672">.</span>fugafuga <span style="color:#f92672">=</span> piyopiyo(X, y)

        <span style="color:#75715e"># Returns the learned learner (model) itself</span>
        <span style="color:#66d9ef">return</span> self

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">predict</span>(self, X):
        <span style="color:#e6db74">&#34;&#34;&#34; Inference of unknown data &#34;&#34;&#34;</span>

        <span style="color:#75715e"># Check if there is a parameter (here, fugafuga) that should be learned before inference</span>
        check_is_fitted(self, [<span style="color:#e6db74">&#34;fugafuga&#34;</span>])

        <span style="color:#75715e">#sklearn input validation</span>
        X <span style="color:#f92672">=</span> check_array(X)

        <span style="color:#75715e"># Infer</span>
        y_predicted <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>fugafuga(X)

        <span style="color:#66d9ef">return</span> y_predicted
</code></pre></div><p>When implementing sklearn compliant, the template is published by scikit-learn, so it is recommended to change it based on it.</p>
<p><a href="https://scikit-learn.org/stable/developers/develop.html?highlight=own%20estimator">Developing scikit-learn estimators</a></p>
<p><a href="https://github.com/scikit-learn-contrib/project-template/blob/master/skltemplate/_template.py">Click here for sklearn-compliant implementation template</a></p>
<h3 id="43-proper-use-of-decorators">4.3 Proper use of decorators</h3>
<p>A decorator is something like <code>@hogehoge</code>.
I often see it on the method name or function name, what is it? I think that I will pass through.</p>
<p>But make friends with decorators.</p>
<p>There are standard decorators in Python and home-made decorators.</p>
<p>Often seen in Python standard decorator,
<code>@property</code>, <code>@staticmethod</code>, <code>@classmethod</code>, <code>@abstractmethod</code>
It is around.</p>
<p>Check each one.</p>
<p><code>@property</code> makes its member variables immutable from outside the class.</p>
<p>(Example)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>:
    <span style="color:#66d9ef">def</span> __init__(self, name: str, user_type: str):
        self<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> name
        self<span style="color:#f92672">.</span>__user_type <span style="color:#f92672">=</span> user_type
        
    <span style="color:#a6e22e">@property</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">user_type</span>(self):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__user_type

</code></pre></div><p>, User_type of User class is defined by <code>@property</code>.</p>
<p>Then,
<code>taro = User(&quot;taro&quot;, &quot;admin&quot;)</code>
<code>print(taro.user_type)</code>
Can be executed without any problems and outputs <code>admin</code>.</p>
<p>but,
<code>taro.user_type=&quot;normal&quot;</code>
And when I try to change the member variable defined in <code>@property</code>, an error occurs.</p>
<p>This way you can define variables that cannot be changed externally.</p>
<p>(Example)
<code>@staticmethod</code>, <code>@classmethod</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>:
    <span style="color:#66d9ef">def</span> __init__(self, name: str, user_type: str):
        self<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> name
        self<span style="color:#f92672">.</span>user_type <span style="color:#f92672">=</span> user_type

    <span style="color:#a6e22e">@staticmethod</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">say_hello</span>(name):
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Hello &#34;</span><span style="color:#f92672">+</span> name)
</code></pre></div><p><code>@staticmethod</code> and <code>@classmethod</code> make a method available without instantiating the class as an object.</p>
<p>If you define it as above and execute the following,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">User<span style="color:#f92672">.</span>say_hello(<span style="color:#e6db74">&#34;Hanako&#34;</span>)
</code></pre></div><p>The output is <code>Hello Hanako</code>.</p>
<p>The difference between <code>@staticmethod</code> and <code>@classmethod</code> can be found again when faced with it.</p>
<p>Another standard Python decorator you can see is <code>@abstractmethod</code>.</p>
<p>When a method of a class has this <code>@abstractmethod</code>, the child class that inherits this class must implement that method.
If not implemented, an error will occur.</p>
<p>Use <code>@abstractmethod</code> when defining an abstract class and forcing the method definition in inherited child classes.</p>
<p>Generally, if I understand this, I think that data science and AI are all right.</p>
<p>When you create a web application with Django, another Django decorator comes out, which you can check at that time.</p>
<p>Next, I will explain about my own decorator.</p>
<p>Suppose there is a process that can be executed only when user_type is admin in the User class.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>:
    <span style="color:#66d9ef">def</span> __init__(self, name: str, user_type: str):
        self<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> name
        self<span style="color:#f92672">.</span>user_type <span style="color:#f92672">=</span> user_type
        
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func_admin_can_do</span>(self):
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>user_type<span style="color:#f92672">==</span><span style="color:#e6db74">&#34;admin&#34;</span>:
          <span style="color:#75715e"># Something that only admin can do</span>
          <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;I&#39;m admin.&#34;</span>)
        <span style="color:#66d9ef">else</span>:
          <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;cannot do this func with auth error.&#34;</span>)
</code></pre></div><p>You can write it like this, but if there are many other processes that can be executed only when user_type is admin, it is troublesome to check with an if statement each time.</p>
<p>So using a decorator would look like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">admin_only</span>(func):
    <span style="color:#e6db74">&#34;&#34;&#34; Decorator definition &#34;&#34;&#34;</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">wrapper</span>(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>user_type <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;admin&#34;</span>:
            <span style="color:#75715e"># Process that only admin can do</span>
            <span style="color:#66d9ef">return</span> func(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs)
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;cannot do this func with auth error.&#34;</span>)

    <span style="color:#66d9ef">return</span> wrapper


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span>:
    <span style="color:#66d9ef">def</span> __init__(self, name: str, user_type: str):
        self<span style="color:#f92672">.</span>name <span style="color:#f92672">=</span> name
        self<span style="color:#f92672">.</span>user_type <span style="color:#f92672">=</span> user_type

    <span style="color:#a6e22e">@admin_only</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">func_admin_can_do</span>(self):
        <span style="color:#75715e"># Something that only admin can do</span>
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Im admin.&#34;</span>)
</code></pre></div><p>If you define it like this, you can execute the process only when the user is admin, just by adding the decorator <code>@admin_only</code>.</p>
<p>In the case of writing the same thing many times, such as many methods that judge whether it is admin and process it, use a decorator.</p>
<h3 id="44-unify-editor-settings-for-team-development">4.4 Unify editor settings for team development</h3>
<p>It is convenient to use the auto formatter when coding because it will be formatted automatically.
For Python, black has become common these days.</p>
<p>However, if the team members use different formatters, the format change will increase the chances of files being overwritten and saved, and the contents of git commit will be messed up.</p>
<p>Therefore, when developing as a team, the auto formatters will be unified.</p>
<p>For example, create a folder &ldquo;.vscode&rdquo; directly under the repository and put the file &ldquo;settings.json&rdquo; in it.</p>
<p>in setting.json
<code>&quot;python.formatting.provider&quot;: &quot;black&quot;</code>
Write around it so that it will be formatted in black.</p>
<p>When a member codes, if you open this folder with VS code and execute it,
It reflects the settings in the .vscode setting.json in the repository, so everyone has the same coding style.</p>
<p>This article is very good for setting up VS code for Python.</p>
<p><a href="http://shunk031.hatenablog.com/entry/how-to-setup-vscode-for-developing-deep-learning-model?utm_campaign=piqcy&amp;utm_medium=email&amp;utm_source=Revue%20newsletter">Memo of VS Code that makes deep learning model implementation explosive</a></p>
<h3 id="45-prepare-github-pull-request-template-and-note-the-points">4.5 Prepare GitHub pull request template and note the points</h3>
<p>The contents listed in this post and other points that you should be aware of are prepared as a pull request template on GitHub.</p>
<p>Create a folder &ldquo;.github&rdquo; directly under the repository and create a file &ldquo;PULL_REQUEST_TEMPLATE.md&rdquo; in it.</p>
<p>This PULL_REQUEST_TEMPLATE.md will be displayed as a template of the post contents at the time of pull request.</p>
<p>If you write down the contents listed in this post,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-markdown" data-lang="markdown">
Level 1
<span style="color:#66d9ef">-</span> [] Do you follow the naming convention for variables, functions, classes and methods?
<span style="color:#66d9ef">-</span> [] Naming method 1: Are redundant parts removed from variable names and method names?
<span style="color:#66d9ef">-</span> Does the description of [] import comply with the rules?
<span style="color:#66d9ef">-</span> [] Is the random number seed fixed to ensure reproducibility?
<span style="color:#66d9ef">-</span> [] Is the program executed as a function?

Level 2
<span style="color:#66d9ef">-</span> [] Naming method 2: Is it named by reverse notation and easy to read?
<span style="color:#66d9ef">-</span> [] Considering S of SOLID, is the function or method short with a single responsibility?
<span style="color:#66d9ef">-</span> [] Do you have type hints for functions and methods?
<span style="color:#66d9ef">-</span> [] Does the class, method, or function have a docstring?
<span style="color:#66d9ef">-</span> [] Is information such as preprocessing and hyperparameters saved with the saved model?

Level 3-[] Naming method 3: Are you given a name with a proper English word and part-of-speech that understands your responsibilities?
<span style="color:#66d9ef">-</span> [] Is exception handling properly implemented?
<span style="color:#66d9ef">-</span> [] Are logs properly implemented?
<span style="color:#66d9ef">-</span> [] Does the function or method have three or less arguments?
<span style="color:#66d9ef">-</span> [] Are you properly using <span style="color:#e6db74">`*args`</span> and <span style="color:#e6db74">`**kwargs`</span>?

Level 4
<span style="color:#66d9ef">-</span> [] Is the if statement written short with the ternary operator?
<span style="color:#66d9ef">-</span> [] Are sklearn compliant and preprocessing and model classes implemented?
<span style="color:#66d9ef">-</span> [] Are you using decorators properly?
<span style="color:#66d9ef">-</span> [] Are the editor settings uniform within the team?
<span style="color:#66d9ef">-</span> [] Are you preparing and using a pull request template?

</code></pre></div><p>is.</p>
<h2 id="summary">Summary</h2>
<p>So far, we have summarized the points that data scientists and AI engineers should be aware of when implementing with Python, and the know-how and tips for implementation.</p>
<p>I wrote a post, but there are some rules that I haven&rsquo;t completely followed.
Also, since I myself am a young person and have little experience, I would appreciate any advice from my predecessors that it is better to do this.</p>
<p>And it&rsquo;s not good to be overly disciplined and cramped,
&ldquo;Everyone on the team can develop comfortably and quality is guaranteed.&rdquo;
It may be a good idea to make rules for such a loss for each team.</p>
<p>Thank you for reading this.</p>
<hr>
<p><strong>Recent serialization list</strong>
<a href="https://qiita.com/sugulu/items/e522a38b812b8edb8a54">[1] [Implementation Description] How to use Japanese version BERT with Google Colaboratory (PyTorch)</a>
<a href="https://qiita.com/sugulu/items/697bd03499c1de9cf082">[2] [Implementation Description] Japanese version BERT with livedoor news classification: Google Colaboratory (PyTorch)</a>
<a href="https://qiita.com/sugulu/items/e3c01a0776a5df3ad552">[3] [Implementation explanation] Brain science and unsupervised learning. Classify MNIST by information maximization clustering</a>
<a href="https://qiita.com/sugulu/items/6a887e612edda9e35c0b">[4] [Implementation explanation] Japanese BERT x unsupervised learning (information maximization clustering) to classify livedoor news</a></p>
<hr>
<p>[Remarks] <a href="https://www.isidgroup.com/u/job.phtml?job_code=430">The AI Technology Development Team, which I lead, is looking for members. Click here if you are interested</a></p>
<p>[Disclaimer] The content itself of this article is the opinion/dissemination of the author, not the official opinion of the company to which the author belongs.</p>
<hr>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
