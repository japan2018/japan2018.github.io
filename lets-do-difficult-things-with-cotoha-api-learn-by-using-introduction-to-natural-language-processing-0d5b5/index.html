<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Let&#39;s do difficult things with COTOHA API-Learn by using Introduction to natural language processing- | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Let&rsquo;s do difficult things with COTOHA API-Learn by using Introduction to natural language processing-</h1>
<p>
  <small class="text-secondary">
  
  
  Feb 15, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/natural-language-processing"> natural language processing</a></code></small>


<small><code><a href="https://memotut.com/tags/introduction"> introduction</a></code></small>


<small><code><a href="https://memotut.com/tags/cotoha"> COTOHA</a></code></small>

</p>
<pre><code>Recently, the world of natural language processing (NLP) has continued to make remarkable progress. I think many people would like to enter the world of such natural language processing. However, even though it is generally natural language processing, the number of tasks contained in the word is enormous.
</code></pre>
<p>&ldquo;What should I start with after all!?&rdquo;</p>
<p>This article is to answer such a voice.</p>
<h1 id="1first-of-all">1.First of all</h1>
<p>This article aims to raise the level of &ldquo;natural language processing. I know many tasks, and have used it!&rdquo; even for an amateur. However, if you explain all the tasks one by one, it will not fit in one article. Not only that, but the more detailed the explanation, the higher the difficulty, which could end up in a situation where you couldn&rsquo;t get anything.</p>
<h2 id="11-purpose-of-this-article">1.1 Purpose of this article</h2>
<p>Therefore, in this article, I will leave the story of <font color="Red">difficult algorithms for the time being, and aim to &ldquo;use&rdquo; </font> for natural language processing with ease. This does not mean to just show the copy and paste to show, but it means to simplify the implementation by using a convenient API and explain the details to make the difficulty easier.</p>
<p>Let <a href="https://api.ce-cotoha.com/contents/index.html">COTOHA API</a> do the difficult things.</p>
<p>COTOHA API is an API that can easily use natural language processing based on the research results of NTT Group <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>. Implementation of a difficult algorithm is simplified by hitting this API.</p>
<p>When it comes to APIs, a difficult image may come up. However, this API is very easy to use, and in this article, I explained how to use it more carefully and in detail (I intend). I also implemented all the sample code in this article in Python so that it will be useful if you want to implement your own difficult algorithms in the future. No prior knowledge of API is required! (Because I want you to rest assured)</p>
<h2 id="12-types-of-natural-language-processing-that-can-be-used-in-this-article">1.2 Types of natural language processing that can be used in this article</h2>
<p><strong>Sentence summary, syntactic analysis, proper expression extraction, anaphora analysis, keyword extraction, similarity calculation between two sentences, sentence type estimation, person attribute estimation such as age/occupation, stagnation removal (er, er, etc.), Speech recognition error detection, emotion analysis</strong></p>
<p>All of these are natural language processing that can be used by free users (for Developpers) of COTOHA API. This article introduces these tasks and explains the working code. (However, it is against the intention of this article to finish it with copy and paste, so we do not provide an implementation that can use all natural language processing.There are three types that can actually be copied and copied: summary, parsing, and entity extraction. It is.)</p>
<h2 id="13-final-results">1.3 Final results</h2>
<p>As an example, let&rsquo;s look at the results of a text summary. I wrote <a href="https://qiita.com/MonaCat/items/5123d2f970cba1acd897">Qiita&rsquo;s article</a>writtenbyme(@MonaCat) as input text.</p>
<pre><code class="language-terminal" data-lang="terminal">&gt; python cotoha_test.py -f data/input.txt -s 3

&lt;Summary&gt;

The text summary is divided into extraction type and generation type (abstract type), but currently the generation type (a combination of extraction type) is the mainstream.
Introducing Neural Sentence Summarization Model-M3 Tech Blog seq2seq-based automatic summarization method is summarized.
Attention Is All You Need (Transformer)-Deep Learning Blog If you read this first, there is no doubt.
</code></pre><p>Let me briefly explain.</p>
<p>The program is executed with <code>python cotoha_test.py</code>. Also, by passing various options as arguments, you can specify which API to call. In the above figure, the part <code>-f data/input.txt -s 3</code> is optional. This refers to a file called <code>input.txt</code> and specifies that the auto-summary API should be used with a summary count of 3. So the output should be a three sentence summary.</p>
<p>By changing this option, I was able to use other APIs and change the settings (for example, summarizing with 5 sentences instead of 3 sentences). Although it became a little difficult, the supplementary explanation of the option implementation was added. Since we are careful not to be concerned with the main story, it would be greatly appreciated if only those who can afford it can read it.</p>
<p>#2 Get to know natural language processing</p>
<p>Before implementing it, let&rsquo;s study a little about natural language processing. Natural language is a language such as Japanese or English that we use every day. That is, natural language processing refers to the technical field of &ldquo;processing&rdquo; &ldquo;natural language&rdquo;.</p>
<p>This chapter briefly describes the natural language processing technology that can be used with the COTOHA API. (Partially omitted)</p>
<ul>
<li>Parsing</li>
</ul>
<p>The syntactic analysis is to divide a sentence (character string) into morphemes and analyze the structural relationship between them. For example, the sentence &ldquo;I saw&rdquo; is composed of &ldquo;noun&rdquo; + &ldquo;particle&rdquo; + &ldquo;verb&rdquo;. By parsing, you can clarify the structural relationship of unmarked strings.</p>
<ul>
<li>Named entity extraction</li>
</ul>
<p>Proper expression extraction is a technology that automatically extracts proper nouns (person names, place names, etc.). There are countless proper nouns in the world, but registering all of them in a dictionary is not realistic. By automating the extraction, a large amount of text can be processed.</p>
<ul>
<li>Anaphora analysis</li>
</ul>
<p>Pronouns and pronouns such as &ldquo;this&rdquo; and &ldquo;he&rdquo; are used as the same as antecedents, but we can read it because we understand the relations with nature when we understand sentences. is there. This relationship is called an anaphoric relationship, and the technique for analyzing this is called anaphoric analysis.</p>
<ul>
<li>Keyword extraction</li>
</ul>
<p>Keywords have various meanings, but COTOHA API calculates characteristic phrases and words and extracts them as keywords. In other words, it can be regarded as a typical phrase or word in a sentence.</p>
<ul>
<li>Attribute estimation</li>
</ul>
<p>It is a technique to estimate attributes (age, gender, hobbies, occupation, etc.). The COTOHA API aims to estimate the attributes of Twitter users.</p>
<ul>
<li>Stagnation removal</li>
</ul>
<p>Iyodomi is a word that is used between sentences when talking such as &ldquo;ah&rdquo; and &ldquo;uu&rdquo;. For example, a sentence transcribed by voice recognition may include unnecessary stagnation when it is turned into text. In such a case, by removing the stagnation, the text can be processed into data that is easy to use.</p>
<ul>
<li>Sentiment analysis</li>
</ul>
<p>Emotional analysis (negative/positive judgment) is the classification of emotions written from sentences into two values, negative and positive. Analysis using deep learning will be more active than the fields introduced above.</p>
<ul>
<li>Text summary</li>
</ul>
<p>It is a technology that automatically summarizes sentences into one sentence or multiple sentences. Recently, it has become commonplace for news sites to come with a three-sentence summary. It can be said that this task is similar to keyword extraction in that it analyzes important phrases and sentences from long sentences.</p>
<p>If you are interested in text summarization, I recommend this article. Although the title is &ldquo;Introduction of papers&rdquo;, it should be helpful because it summarizes the information from the basics to the latest technology: [Introduce the paper &ldquo;BERTSUM&rdquo; that automatically summarizes with BERT + α-Qiita](https(://qiita.com/MonaCat/items/5123d2f970cba1acd897)</p>
<p>#3 Let&rsquo;s actually use</p>
<p>I kept you waiting. Let&rsquo;s experience natural language processing using COTOHA API.</p>
<h2 id="31-common-part">3.1 Common part</h2>
<p>First of all, from the common parts required regardless of the API you want to use.</p>
<p>The COTOHA API can be registered and used for free, so register from <a href="https://api.ce-cotoha.com/contents/index.html">COTOHA API</a>.</p>
<p>The registration information requires your name and affiliation, but you do not need credit card information. If you register, you will receive the information shown below.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/167534/5d5a865f-3e77-4454-4195-ad1ad63d0d93.png" alt="img012.png"></p>
<p>Depending on the person, the &ldquo;Client ID&rdquo; and &ldquo;Client secret&rdquo; are different, so be prepared to copy and paste them later.</p>
<h3 id="311-get-access-token">3.1.1 Get access token</h3>
<p>From here on, it will be implemented in Python. We will leave the Python environment to you, but please install the necessary modules appropriately as pip or conda so that you can use it.</p>
<p>First, define the function to get the access token.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">CLIENT_ID <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Rewrite appropriately&#39;</span>
CLIENT_SECRET <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Rewrite appropriately&#39;</span>


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">auth</span>(client_id, client_secret):
    token_url <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;https://api.ce-cotoha.com/v1/oauth/accesstokens&#39;</span>
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;Content-Type&#39;</span>:<span style="color:#e6db74">&#39;application/json&#39;</span>,
        <span style="color:#e6db74">&#39;charset&#39;</span>:<span style="color:#e6db74">&#39;UTF-8&#39;</span>
    }
    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;grantType&#39;</span>:<span style="color:#e6db74">&#39;client_credentials&#39;</span>,
        <span style="color:#e6db74">&#39;clientId&#39;</span>: client_id,
        <span style="color:#e6db74">&#39;clientSecret&#39;</span>: client_secret
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(token_url,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))

    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#39;access_token&#39;</span>]


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:

    access_token <span style="color:#f92672">=</span> auth(CLIENT_ID, CLIENT_SECRET) <span style="color:#75715e"># Get access token</span>
</code></pre></div><p>You may suddenly find it difficult. But it&rsquo;s very simple. Let&rsquo;s look at them in order.</p>
<p>First, auth() is called with the above authentication information as an argument.</p>
<p>auth() fetches an access token by using the authentication information. In <a href="https://api.ce-cotoha.com/contents/gettingStarted.html">Start Guide</a>, it is acquired by command, but this time, the same thing is implemented in Python. You can get the json file on success, but note that all you want here is the access token. Therefore, it returns <code>r.json['access_token']</code>.</p>
<p>You can use the API by using this access token.</p>
<h3 id="312-specify-arguments-optional">3.1.2 Specify arguments (optional)</h3>
<p>In this sample code, the argument can be specified using the <code>argparse</code> module. This was explained in Section 1.3, but the reason why the argument can be specified is that switching is convenient because it is assumed to use multiple APIs.</p>
<p>In this section, we briefly explain <code>argparse</code>, but since it has nothing to do with the main line, please skip this if you cannot afford it.</p>
<p>First, before getting the access token</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:document <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Text used when no input text is specified. In this implementation, you can use two patterns, &#34;Specify text with argument&#34; and &#34;Specify text file with argument&#34;. Please try it. &#39;</span>
    args <span style="color:#f92672">=</span> get_args(document) <span style="color:#75715e"># get arguments</span>

    access_token <span style="color:#f92672">=</span> auth(CLIENT_ID, CLIENT_SECRET) <span style="color:#75715e"># Get access token</span>
</code></pre></div><p>Let&rsquo;s call get_args() with. The contents of this function are as follows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_args</span>(document):
    argparser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser(description<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Code to play natural language processing using Cotoha API&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-t&#39;</span>,<span style="color:#e6db74">&#39;--text&#39;</span>, type<span style="color:#f92672">=</span>str, default<span style="color:#f92672">=</span>document, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Sentence to parse&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-f&#39;</span>,<span style="color:#e6db74">&#39;--file_name&#39;</span>, type<span style="color:#f92672">=</span>str, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;I want to parse .txt path&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-p&#39;</span>,<span style="color:#e6db74">&#39;--parse&#39;</span>, action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_true&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Specify if parsing&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-s&#39;</span>,<span style="color:#e6db74">&#39;--summarize&#39;</span>, type<span style="color:#f92672">=</span>int, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Specify the number of summary sentences for automatic summarization&#39;</span>)

    <span style="color:#66d9ef">return</span> argparser<span style="color:#f92672">.</span>parse_args()
</code></pre></div><p>The first line describes the code with description. This is printed when <code>-h</code> is a command line argument.</p>
<p>Example when <code>-h</code> is specified.</p>
<pre><code class="language-terminal" data-lang="terminal">&gt; python cotoha_test.py -h
usage: cotoha_test.py [-h] [-t TEXT] [-f FILE_NAME] [-p] [-s SUMMARIZE]

Code to play natural language processing using Cotoha API

optional arguments:
  -h, --help show this help message and exit
  -t TEXT, --text TEXT Text to analyze
  -f FILE_NAME, --file_name FILE_NAME
                        Path of the text file you want to analyze
  -p, --parse parsing
  -n, --ne entity extraction
  -s SUMMARIZE, --summarize SUMMARIZE
                        Number of summary sentences in automatic summarization
</code></pre><p>Subsequent lines define arguments in order with <code>add_argument</code>.</p>
<p>Of course, if you set an argument and you don&rsquo;t implement what happens when that argument is specified, nothing happens. This time, I want to perform parsing when <code>-p</code> is specified. If this is the case, it seems to work just by conditionalizing with an if statement. Let&rsquo;s do it now.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">if</span> (args<span style="color:#f92672">.</span>parse):
    parse(doc, access_token) <span style="color:#75715e"># function call</span>
</code></pre></div><p>If <code>args.parse</code> is True, call the parse function. The function parse hasn&rsquo;t appeared so far, so you probably don&rsquo;t know what it is. Think of it as just a function that performs parsing. Details will be explained in a later chapter.</p>
<p><code>args.parse</code> is the option we added earlier with <code>argparser.add_argument</code>. Note that it must be <code>args.parse</code>, not <code>args.p</code>. Similarly, for example, <code>args.summarize</code> can be used for a summary.</p>
<p>By the way, in the future, if a lot of tasks other than parsing and summarizing are conditionalized by if statements, it will look a little unattractive. So let&rsquo;s simplify it a little.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># API call</span>
l <span style="color:#f92672">=</span> [doc, access_token] <span style="color:#75715e"># Common arguments</span>
parse(<span style="color:#f92672">*</span>l) <span style="color:#66d9ef">if</span> (args<span style="color:#f92672">.</span>parse) <span style="color:#66d9ef">else</span> None <span style="color:#75715e"># Parsing</span>
</code></pre></div><p>What I&rsquo;m doing is nothing the same as before, but I wrote the if statement on one line, put it in a list considering that there are many common arguments, expanded it and passed it to a function to call.</p>
<p>Finally, let&rsquo;s implement when a file is specified with <code>-f</code>. If you specify a file, it will take precedence, but an error may occur unless you check whether the specified file exists before it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#If a file is specified, that will be prioritized</span>
<span style="color:#66d9ef">if</span> (args<span style="color:#f92672">.</span>file_name <span style="color:#f92672">!=</span> None <span style="color:#f92672">and</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(args<span style="color:#f92672">.</span>file_name)):
    <span style="color:#66d9ef">with</span> open(args<span style="color:#f92672">.</span>file_name,<span style="color:#e6db74">&#39;r&#39;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#66d9ef">as</span> f:
        doc <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>read()
<span style="color:#66d9ef">else</span>:
    doc <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>text
</code></pre></div><p>If you have followed this far, you should have the following implementation.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> argparse
<span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> os


BASE_URL <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;https://api.ce-cotoha.com/api/dev/&#39;</span>
CLIENT_ID <span style="color:#f92672">=</span> <span style="color:#e6db74">``</span> <span style="color:#75715e"># Rewrite appropriately</span>
CLIENT_SECRET <span style="color:#f92672">=</span> <span style="color:#e6db74">``</span> <span style="color:#75715e"># rewrite appropriately</span>


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_args</span>(document):
    argparser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser(description<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Code to play natural language processing using Cotoha API&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-t&#39;</span>,<span style="color:#e6db74">&#39;--text&#39;</span>, type<span style="color:#f92672">=</span>str, default<span style="color:#f92672">=</span>document, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;text to parse&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-f&#39;</span>,<span style="color:#e6db74">&#39;--file_name&#39;</span>, type<span style="color:#f92672">=</span>str, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;path of text file to parse&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-p&#39;</span>,<span style="color:#e6db74">&#39;--parse&#39;</span>, action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_true&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;parse&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-n&#39;</span>,<span style="color:#e6db74">&#39;--ne&#39;</span>, action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_true&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;property extraction&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-c&#39;</span>,<span style="color:#e6db74">&#39;--coreference&#39;</span>, action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_true&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;anaphora analysis&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-k&#39;</span>,<span style="color:#e6db74">&#39;--keyword&#39;</span>, action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_true&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;keyword extraction&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-s&#39;</span>,<span style="color:#e6db74">&#39;--summarize&#39;</span>, type<span style="color:#f92672">=</span>int, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Number of summary sentences in automatic summarization&#39;</span>)

    <span style="color:#66d9ef">return</span> argparser<span style="color:#f92672">.</span>parse_args()


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">auth</span>(client_id, client_secret):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Function to get access token
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    token_url <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;https://api.ce-cotoha.com/v1/oauth/accesstokens&#39;</span>
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;Content-Type&#39;</span>:<span style="color:#e6db74">&#39;application/json&#39;</span>,
        <span style="color:#e6db74">&#39;charset&#39;</span>:<span style="color:#e6db74">&#39;UTF-8&#39;</span>
    }
    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;grantType&#39;</span>:<span style="color:#e6db74">&#39;client_credentials&#39;</span>,
        <span style="color:#e6db74">&#39;clientId&#39;</span>: client_id,
        <span style="color:#e6db74">&#39;clientSecret&#39;</span>: client_secret
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(token_url,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))

    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#39;access_token&#39;</span>]


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">base_api</span>(data, document, api_url, access_token):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Header etc. which are common to all APIs
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    base_url <span style="color:#f92672">=</span> BASE_URL
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;Content-Type&#39;</span>:<span style="color:#e6db74">&#39;application/json; charset=UTF-8&#39;</span>,
        <span style="color:#e6db74">&#39;Authorization&#39;</span>:<span style="color:#e6db74">&#39;Bearer {}&#39;</span><span style="color:#f92672">.</span>format(access_token)
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(base_url <span style="color:#f92672">+</span> api_url,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))

    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:

    doc <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;I met Michael at Tokyo station yesterday. I started dating him a month ago. &#39;</span>
    args <span style="color:#f92672">=</span> get_args(doc) <span style="color:#75715e"># get arguments</span>

    <span style="color:#75715e">#If a file is specified, that will be prioritized</span>
    <span style="color:#66d9ef">if</span> (args<span style="color:#f92672">.</span>file_name <span style="color:#f92672">!=</span> None <span style="color:#f92672">and</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(args<span style="color:#f92672">.</span>file_name)):
        <span style="color:#66d9ef">with</span> open(args<span style="color:#f92672">.</span>file_name,<span style="color:#e6db74">&#39;r&#39;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#66d9ef">as</span> f:
            doc <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>read()
    <span style="color:#66d9ef">else</span>:
        doc <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>text

    access_token <span style="color:#f92672">=</span> auth(CLIENT_ID, CLIENT_SECRET) <span style="color:#75715e"># Get access token</span>
    
    <span style="color:#75715e"># API call</span>
    l <span style="color:#f92672">=</span> [doc, access_token] <span style="color:#75715e"># Common arguments</span>

    parse(<span style="color:#f92672">*</span>l) <span style="color:#66d9ef">if</span> (args<span style="color:#f92672">.</span>parse) <span style="color:#66d9ef">else</span> None <span style="color:#75715e"># Parsing</span>
    ne(<span style="color:#f92672">*</span>l) <span style="color:#66d9ef">if</span> (args<span style="color:#f92672">.</span>ne) <span style="color:#66d9ef">else</span> None <span style="color:#75715e"># Entity extraction</span>
    coreference(<span style="color:#f92672">*</span>l) <span style="color:#66d9ef">if</span> (args<span style="color:#f92672">.</span>coreference) <span style="color:#66d9ef">else</span> None <span style="color:#75715e"># anaphora analysis</span>
    keyword(<span style="color:#f92672">*</span>l) <span style="color:#66d9ef">if</span> (args<span style="color:#f92672">.</span>keyword) <span style="color:#66d9ef">else</span> None <span style="color:#75715e"># keyword extraction</span>
    summarize(<span style="color:#f92672">*</span>l, args<span style="color:#f92672">.</span>summarize) <span style="color:#66d9ef">if</span> (args<span style="color:#f92672">.</span>summarize) <span style="color:#66d9ef">else</span> None <span style="color:#75715e"># summary</span>
</code></pre></div><p>Of course, this program still doesn&rsquo;t work. This is because we have not defined functions such as parse() and ne(). It will be implemented in the following sections.</p>
<h2 id="32-different-parts-for-each-taskfor-those-who-skipped-312-here-we-use-a-program-that-only-performs-parsing-such-as-the-following-program">3.2 Different parts for each taskFor those who skipped 3.1.2, here we use a program that only performs parsing, such as the following program.</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> argparse
<span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> os


BASE_URL <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;https://api.ce-cotoha.com/api/dev/&#39;</span>
CLIENT_ID <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Rewrite appropriately&#39;</span>
CLIENT_SECRET <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Rewrite appropriately&#39;</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">auth</span>(client_id, client_secret):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Function to get access token
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    token_url <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;https://api.ce-cotoha.com/v1/oauth/accesstokens&#39;</span>
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;Content-Type&#39;</span>:<span style="color:#e6db74">&#39;application/json; charset: UTF-8&#39;</span>,
    }
    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;grantType&#39;</span>:<span style="color:#e6db74">&#39;client_credentials&#39;</span>,
        <span style="color:#e6db74">&#39;clientId&#39;</span>: client_id,
        <span style="color:#e6db74">&#39;clientSecret&#39;</span>: client_secret
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(token_url,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))

    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#39;access_token&#39;</span>]


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:

    doc <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;I met Michael at Tokyo station yesterday. I started dating him a month ago. &#39;</span>

    access_token <span style="color:#f92672">=</span> auth(CLIENT_ID, CLIENT_SECRET) <span style="color:#75715e"># Get access token</span>
    parse(doc, access_token) <span style="color:#75715e"># Parsing</span>
</code></pre></div><p>Those who follow 3.1.2 should just use that implementation. In any case, what is implemented here is a function that calls APIs such as parse() and ne() to perform natural language processing.</p>
<h3 id="321-parsing">3.2.1 Parsing</h3>
<p>When you read <a href="https://api.ce-cotoha.com/contents/reference/apireference.html#entity">Parsing Reference</a>,therearerequestheaders,requestbodies,etc.,anditisnecessarytospecifythekey.Youwillunderstand.However,therequestheaderisactuallycommontoallCOTOHAAPIs.Therefore,thecommonpartssuchasrequestheadersareimplementedbythefunctioncalledbase_api(),andthepartsuniquetoparsingareimplementedbythefunctioncalledparse().</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">base_api</span>(data, document, api_url, access_token):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Header etc. which are common to all APIs
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    base_url <span style="color:#f92672">=</span> BASE_URL
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;Content-Type&#39;</span>:<span style="color:#e6db74">&#39;application/json; charset=UTF-8&#39;</span>,
        <span style="color:#e6db74">&#39;Authorization&#39;</span>:<span style="color:#e6db74">&#39;Bearer {}&#39;</span><span style="color:#f92672">.</span>format(access_token)
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(base_url <span style="color:#f92672">+</span> api_url,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))

    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse</span>(sentence, access_token):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Parsing
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    data <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;sentence&#39;</span>: sentence}
    result <span style="color:#f92672">=</span> base_api(data, sentence,<span style="color:#e6db74">&#39;nlp/v1/parse&#39;</span>, access_token)

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;parsing&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
    result_list <span style="color:#f92672">=</span> list()
    
    <span style="color:#66d9ef">for</span> chunks <span style="color:#f92672">in</span> result[<span style="color:#e6db74">&#39;result&#39;</span>]:
        <span style="color:#66d9ef">for</span> token <span style="color:#f92672">in</span> chunks[<span style="color:#e6db74">&#39;tokens&#39;</span>]:
            result_list<span style="color:#f92672">.</span>append(token[<span style="color:#e6db74">&#39;form&#39;</span>])

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(result_list))
</code></pre></div><p>Let&rsquo;s start with base_api(). What we have specified in headers is the request header we saw earlier. It can be seen that the request is sent with this value, the request body, the text to be analyzed, and the URL of the API as arguments. The json file obtained at the end is returned.</p>
<p>In parse(), the request body is specified by the variable data first. This time, the key sentence is specified by the variable sentence (it may be wondering what you are saying, but it is the same meaning).</p>
<p>Next, the value of base_api(), that is, the json file is put in the result variable.</p>
<p>This json file contains the result of parsing, so read it. The format of the format is described in the response sample of the same reference. When I read the response sample for parsing, it seems that the key form of the morpheme information object was what I was looking for, so I will add this to the list.</p>
<p>If you do this, you will get the following result:</p>
<pre><code class="language-terminal" data-lang="terminal">&gt; python cotoha_test.py

&lt;syntax analysis&gt;

Yesterday, I met up with Michael at Tokyo Station. I started dating him a month ago.
</code></pre><h3 id="322-named-entity-extraction">3.2.2 Named entity extraction</h3>
<p>Next, we will extract proper expressions, but we will omit it because we will only repeat the same explanation as before. In fact, you can use most other APIs just as you did before.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ne</span>(sentence, access_token):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Proper expression extraction
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    data <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;sentence&#39;</span>: sentence}
    result <span style="color:#f92672">=</span> base_api(data, sentence,<span style="color:#e6db74">&#39;nlp/v1/ne&#39;</span>, access_token)
    
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;property extraction&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
    result_list <span style="color:#f92672">=</span> list()

    <span style="color:#66d9ef">for</span> chunks <span style="color:#f92672">in</span> result[<span style="color:#e6db74">&#39;result&#39;</span>]:
        result_list<span style="color:#f92672">.</span>append(chunks[<span style="color:#e6db74">&#39;form&#39;</span>])

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;,&#39;</span><span style="color:#f92672">.</span>join(result_list))
</code></pre></div><pre><code class="language-terminal" data-lang="terminal">&gt; python cotoha_test.py

&lt;property extraction&gt;

Yesterday, michael, tokyo station, one month
</code></pre><h3 id="323-summary">3.2.3 Summary</h3>
<p>Let&rsquo;s try something a little different because it&rsquo;s a big deal. If you read the summary reference, there will be a <code>sent_len</code> in the request body where you can specify the number of summary sentences. This is also a big deal so I would like to use it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">summarize</span>(document, access_token, sent_len):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        wrap up
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;document&#39;</span>: document,
        <span style="color:#e6db74">&#39;sent_len&#39;</span>: sent_len
    }
    result <span style="color:#f92672">=</span> base_api(data, document,<span style="color:#e6db74">&#39;nlp/beta/summary&#39;</span>, access_token)

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;summary&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
    result_list <span style="color:#f92672">=</span> list()

    <span style="color:#66d9ef">for</span> result <span style="color:#f92672">in</span> result[<span style="color:#e6db74">&#39;result&#39;</span>]:
        result_list<span style="color:#f92672">.</span>append(result)
    
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(result_list))
</code></pre></div><p>Now you can put in a concrete value for <code>sent_len</code> and summarize as many as you like. If you have implemented the options in 3.1.2 it would be useful to be able to specify <code>sent_len</code> as an argument.</p>
<pre><code class="language-terminal" data-lang="terminal">&gt; python cotoha_test.py -s 1

&lt;Summary&gt;

I met Michael at Tokyo station yesterday.
</code></pre><h3 id="333-other-natural-language-processing">3.3.3 Other natural language processing</h3>
<p>I will omit it because other APIs can be implemented in the same way.</p>
<p>#4 Summary</p>
<p>Finally, we present and summarize a program that can perform syntactic analysis, named entity extraction, and summary execution. Again, other APIs can be implemented in the same way, so if you are interested in natural language processing, please do it yourself.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> argparse
<span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> os


BASE_URL <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;https://api.ce-cotoha.com/api/dev/&#39;</span>
CLIENT_ID <span style="color:#f92672">=</span> <span style="color:#e6db74">``</span> <span style="color:#75715e"># Rewrite appropriately</span>
CLIENT_SECRET <span style="color:#f92672">=</span> <span style="color:#e6db74">``</span> <span style="color:#75715e"># rewrite appropriately</span>


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_args</span>(document):
    argparser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser(description<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Code to play natural language processing using Cotoha API&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-t&#39;</span>,<span style="color:#e6db74">&#39;--text&#39;</span>, type<span style="color:#f92672">=</span>str, default<span style="color:#f92672">=</span>document, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;text to parse&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-f&#39;</span>,<span style="color:#e6db74">&#39;--file_name&#39;</span>, type<span style="color:#f92672">=</span>str, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;path of text file to parse&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-p&#39;</span>,<span style="color:#e6db74">&#39;--parse&#39;</span>, action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_true&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;parse&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-n&#39;</span>,<span style="color:#e6db74">&#39;--ne&#39;</span>, action<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;store_true&#39;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;property extraction&#39;</span>)
    argparser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;-s&#39;</span>,<span style="color:#e6db74">&#39;--summarize&#39;</span>, type<span style="color:#f92672">=</span>int, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Number of summary sentences in automatic summarization&#39;</span>)

    <span style="color:#66d9ef">return</span> argparser<span style="color:#f92672">.</span>parse_args()


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">auth</span>(client_id, client_secret):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        Function to get access token
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    token_url <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;https://api.ce-cotoha.com/v1/oauth/accesstokens&#39;</span>
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;Content-Type&#39;</span>:<span style="color:#e6db74">&#39;application/json&#39;</span>,
        <span style="color:#e6db74">&#39;charset&#39;</span>:<span style="color:#e6db74">&#39;UTF-8&#39;</span>
    }
    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;grantType&#39;</span>:<span style="color:#e6db74">&#39;client_credentials&#39;</span>,<span style="color:#e6db74">&#39;clientId&#39;</span>: client_id,
        <span style="color:#e6db74">&#39;clientSecret&#39;</span>: client_secret
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(token_url,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))

    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#39;access_token&#39;</span>]


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">base_api</span>(data, document, api_url, access_token):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        全てのAPIで共通となるheader等
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    base_url <span style="color:#f92672">=</span> BASE_URL
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;Content-Type&#39;</span>: <span style="color:#e6db74">&#39;application/json; charset=UTF-8&#39;</span>,
        <span style="color:#e6db74">&#39;Authorization&#39;</span>: <span style="color:#e6db74">&#39;Bearer {}&#39;</span><span style="color:#f92672">.</span>format(access_token)
    }
    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(base_url <span style="color:#f92672">+</span> api_url,
                      headers<span style="color:#f92672">=</span>headers,
                      data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(data))

    <span style="color:#66d9ef">return</span> r<span style="color:#f92672">.</span>json()


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">parse</span>(sentence, access_token):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        構文解析
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    data <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;sentence&#39;</span>: sentence}
    result <span style="color:#f92672">=</span> base_api(data, sentence, <span style="color:#e6db74">&#39;nlp/v1/parse&#39;</span>, access_token)

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;構文解析&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
    result_list <span style="color:#f92672">=</span> list()
    
    <span style="color:#66d9ef">for</span> chunks <span style="color:#f92672">in</span> result[<span style="color:#e6db74">&#39;result&#39;</span>]:
        <span style="color:#66d9ef">for</span> token <span style="color:#f92672">in</span> chunks[<span style="color:#e6db74">&#39;tokens&#39;</span>]:
            result_list<span style="color:#f92672">.</span>append(token[<span style="color:#e6db74">&#39;form&#39;</span>])

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">.</span>join(result_list))


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">ne</span>(sentence, access_token):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        固有表現抽出
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    data <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;sentence&#39;</span>: sentence}
    result <span style="color:#f92672">=</span> base_api(data, sentence, <span style="color:#e6db74">&#39;nlp/v1/ne&#39;</span>, access_token)
    
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;固有表現抽出&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
    result_list <span style="color:#f92672">=</span> list()

    <span style="color:#66d9ef">for</span> chunks <span style="color:#f92672">in</span> result[<span style="color:#e6db74">&#39;result&#39;</span>]:
        result_list<span style="color:#f92672">.</span>append(chunks[<span style="color:#e6db74">&#39;form&#39;</span>])

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;, &#39;</span><span style="color:#f92672">.</span>join(result_list))


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">summarize</span>(document, access_token, sent_len):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        要約
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;document&#39;</span>: document,
        <span style="color:#e6db74">&#39;sent_len&#39;</span>: sent_len
    }
    result <span style="color:#f92672">=</span> base_api(data, document, <span style="color:#e6db74">&#39;nlp/beta/summary&#39;</span>, access_token)

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">＜要約＞</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
    result_list <span style="color:#f92672">=</span> list()

    <span style="color:#66d9ef">for</span> result <span style="color:#f92672">in</span> result[<span style="color:#e6db74">&#39;result&#39;</span>]:
        result_list<span style="color:#f92672">.</span>append(result)
    
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join(result_list))


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:

    doc <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;昨日、マイケルと東京駅で待ち合わせした。彼とはひと月前から付き合い始めた。&#39;</span>
    args <span style="color:#f92672">=</span> get_args(doc)  <span style="color:#75715e"># 引数取得</span>

    <span style="color:#75715e"># ファイルを指定した場合はそちらを優先</span>
    <span style="color:#66d9ef">if</span> (args<span style="color:#f92672">.</span>file_name <span style="color:#f92672">!=</span> None <span style="color:#f92672">and</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(args<span style="color:#f92672">.</span>file_name)):
        <span style="color:#66d9ef">with</span> open(args<span style="color:#f92672">.</span>file_name, <span style="color:#e6db74">&#39;r&#39;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#66d9ef">as</span> f:
            doc <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>read()
    <span style="color:#66d9ef">else</span>:
        doc <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>text

    access_token <span style="color:#f92672">=</span> auth(CLIENT_ID, CLIENT_SECRET)  <span style="color:#75715e"># アクセストークン取得</span>
    
    <span style="color:#75715e"># API呼び出し</span>
    l <span style="color:#f92672">=</span> [doc, access_token]  <span style="color:#75715e"># 共通の引数</span>

    parse(<span style="color:#f92672">*</span>l) <span style="color:#66d9ef">if</span> (args<span style="color:#f92672">.</span>parse) <span style="color:#66d9ef">else</span> None  <span style="color:#75715e"># 構文解析</span>
    ne(<span style="color:#f92672">*</span>l) <span style="color:#66d9ef">if</span> (args<span style="color:#f92672">.</span>ne) <span style="color:#66d9ef">else</span> None  <span style="color:#75715e"># 固有表現抽出</span>
    summarize(<span style="color:#f92672">*</span>l, args<span style="color:#f92672">.</span>summarize) <span style="color:#66d9ef">if</span> (args<span style="color:#f92672">.</span>summarize) <span style="color:#66d9ef">else</span> None  <span style="color:#75715e"># 要約</span>
</code></pre></div><section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>商用プラン(for Enterpriseプラン)では辞書の種類やコール数の制限が緩くなるだけでなく、音声認識や音声合成のAPIも使えるようになります。しかし個人で使うには現実的でないので本記事では扱っていません。 <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
