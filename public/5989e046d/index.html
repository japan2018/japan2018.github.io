<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Python] Hospitable animal shogi AI was born! A story of making a hospitality entertaining AI. | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] Hospitable animal shogi AI was born! A story of making a hospitality entertaining AI.</h1>
<p>
  <small class="text-secondary">
  
  
  May 24, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/javascript"> JavaScript</a></code></small>


<small><code><a href="https://memotut.com/tags/flask"> Flask</a></code></small>


<small><code><a href="https://memotut.com/tags/monaca"> monaca</a></code></small>


<small><code><a href="https://memotut.com/tags/pwa"> PWA</a></code></small>

</p>
<pre><code>#Introduction
</code></pre>
<p>It&rsquo;s been a long time since AI became stronger than professional shogi players.</p>
<p>On the other hand, Professor Zenji Hanyu**
&ldquo;** Things like entertaining shogi are difficult for AI**,&rdquo; he said.</p>
<p>Then, what kind of point is difficult when actually trying to make entertainment AI,
What level of &ldquo;entertainment&rdquo; can we do?</p>
<p>This is a development diary record of the difficult challenge of &ldquo;entertainment shogi&rdquo;.
It is a story up to the idea of the entertainment AI obtained.</p>
<p>Reference: <a href="https://wired.jp/2017/02/14/habu-ishiyama/">Artificial intelligence cannot be &ldquo;entertainment shogi&rdquo;&mdash;the evolution of shogi and AI talked by Yoshiharu Hanyu and Ko Ishiyama</a></p>
<h1 id="describe-the-finished-product-first-actual-url">Describe the finished product first (actual URL)</h1>
<p>In conclusion, with a simple implementation policy,
I was able to obtain an implementation that I was satisfied with to some extent.
Below is the result (entertainment AI) and an application that you can actually play.
Compatible with both PC and smartphone.</p>
<p><a href="https://doubutu-64e43.web.app/">https://doubutu-64e43.web.app/</a></p>
<p><a href="https://doubutu-64e43.web.app/" target="_blank"> <img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/193512/e2bc5fdb-8a27-918e-0761-18e28f0d6bd1.png" alt="App screen capture" width="60%" ></a></p>
<p>&ldquo;Shogi&rdquo; is too difficult, so I made it with &ldquo;Shogi&rdquo;.</p>
<p>&ldquo;Doubutsushogi&rdquo;, considering its users,
In fact, it seems to be the game that requires the most entertainment on the planet.
The rules should be carefully adapted.</p>
<p>We have prepared 3 modes: entertaining/strongest/small fish.
As an &ldquo;aesthetic of entertainment,&rdquo; the player is always the first player.</p>
<p>Therefore, in the &ldquo;Doubutsu Shogi&rdquo;, where the second hand victory is known,
<strong>I can never beat the &ldquo;strongest&rdquo; opponent</strong> (has).
It was really implemented as &ldquo;strongest&rdquo;.</p>
<p>&ldquo;Miscellaneous fish&rdquo; is a random AI that only knows if you will lose next.
If you can&rsquo;t understand the lion&rsquo;s catch or try,
Because it does not understand the rule in the first place,
It can be said that it is almost the same as the weakest human beings who can enjoy animal shogi.</p>
<p>The &ldquo;entertainment&rdquo; mode is the AI mentioned in this article.
Perhaps the more advanced, the more entertaining AI feels,
On the other hand, even beginners will win enough.</p>
<p>Originally due to the heavy volume of game analysis data
It is an application exclusively for the author that should be executed only on the server/PC,
Forcibly turn the algorithm that returns the move into an API,
Use PWA to support all PC/smartphones,
It is designed to be used by a wide range of human beings (*mainly children).
The front part is a bonus afterwards like this, a rough mounting,
The UI is a bit shabby. Please forgive me.</p>
<h1 id="again-what-is-entertaining-shogi">Again, what is entertaining shogi?</h1>
<p>First of all, normal shogi is &ldquo;the government army if it wins.&rdquo;
Then, is entertainment shogi &ldquo;absolutely losing shogi&rdquo;?
No, not so.</p>
<p>It’s difficult to lose
&ldquo;World&rsquo;s weakest Othello AI&rdquo; became a hot topic.
This is an interesting attempt, but
It can be said that the &ldquo;strongest AI&rdquo; is just the reverse of the rules.
~~ (I feel lost because I can&rsquo;t lose) ~~</p>
<p>** “Entertainment” means “hospitality”. **
Even if you only point at the worst hand that you can give the freight car to your opponent for free,
It&rsquo;s no entertainment.</p>
<p>Even though it was in a state of competing to some extent,
For the most part, the customer wins.
It&rsquo;s important that it doesn&rsquo;t look deliberate.</p>
<p>*Also, in terms of application implementation,
Don&rsquo;t let me know that this is &ldquo;entertainment&rdquo;,
When &ldquo;Commentary OFF&rdquo; is set, characters such as &ldquo;entertainment&rdquo; have disappeared,
It can be handed over to children and friends.</p>
<p>At entertainment, &ldquo;cut out to the extent that the other person does not understand&rdquo;
Is a <strong>difficult technique than winning normally</strong>.</p>
<p>Furthermore, it is necessary to change the strength according to the opponent.
&ldquo;Even against advanced players, fight to some extent and then lose&rdquo;
Is also required.
If you don&rsquo;t, you&rsquo;re just a &ldquo;weak AI.&rdquo;</p>
<p>An AI that estimates the opponent&rsquo;s level and then moderately adjusts the strength.
What&rsquo;s more, it&rsquo;s so natural that you can&rsquo;t realize it&rsquo;s adjusted.
Certainly, as Mr. Hanyu said, implementation seems to be difficult.</p>
<h1 id="why-entertainment">Why &ldquo;entertainment&rdquo;</h1>
<p>&ldquo;Entertainment&rdquo; x &ldquo;Shooting animals&rdquo;
There are two reasons for choosing the theme.</p>
<p>** Reason ①: Complete analysis has been completed and the analysis results can be used **</p>
<p>For &ldquo;Shooting animals&rdquo;,
Completely analyzed by Professor Tetsuro Tanaka in 2009,
It is a victory for the second hand with 78 hands.</p>
<p>However, to do this winning method,
It is necessary to memorize more than 2.4 million phases,
Because it can&rsquo;t be done very humanly,
As a game played by humans, it&rsquo;s not boring.</p>
<p>Reference: <a href="https://www.tanaka.ecc.u-tokyo.ac.jp/ktanaka/dobutsushogi/">Complete analysis of &ldquo;Douboutsushogi&rdquo;</a></p>
<p>Although it is difficult to create entertaining AI,
If it&rsquo;s a fully analyzed game, there is a possibility that it will be something.
Also, as compared to games such as 〇 ×,
It&rsquo;s a sufficiently complex game for humanity,
It seems that the knowledge obtained from this can be applied to other games.</p>
<p>Professor Tanaka has published the results of complete analysis with an easy-to-use license,
In the latter part of this article, we will also describe how to implement the program/data from Python.</p>
<p>** Reason ②: &ldquo;Shooting animals&rdquo; is the most entertaining game on the planet**</p>
<p>&ldquo;Shooting animals&rdquo; is a game developed mainly for children,
Anpanman, Shimajiro, etc.
Packages of various popular characters can be seen here and there.</p>
<p>You can&rsquo;t win against &ldquo;children&rdquo; without being too mature,
However, pointing out too stupid hands is not good for education.
No more in current Japan
It can be said that there is no game with a high &ldquo;entertainment&rdquo; application rate.</p>
<p>Also, the growth of &ldquo;children&rdquo; is very fast, and their playing power is
From super beginners to advanced players who are not good at adults, there is a huge variety.
Normally, it is interesting to play against an AI that is as strong as you,
It is difficult to choose the right AI.</p>
<p>It would be convenient to adjust your strength in the process of pointing, as in &ldquo;entertainment AI&rdquo;.</p>
<p>I also provide <strong>business entertainment by animal health</strong>
I&rsquo;ve been there, and at that time I have a hard time pulling my hands,
I really feel the need.</p>
<p>#Definition requirements for entertaining animal shogi</p>
<p>To summarize the story so far,
The desired entertaining AI is likely to meet the following three requirements at the same time.</p>
<ul>
<li>
<p>① Basically ** Customer wins **
(*Not necessarily every time, if the win rate exceeds it)</p>
</li>
<li>
<p>② Customers cannot understand the omission **
▽ (*Hands down according to the opponent&rsquo;s level)</p>
</li>
<li>
<p>③ Not too weak for customers **
(*Strength according to opponent&rsquo;s level)</p>
</li>
</ul>
<p>&ldquo;Entertainment&rdquo; = &ldquo;Hospitality&rdquo; = &ldquo;Interesting and pleasant match&rdquo;
⇒ Win a close battle against an opponent of the same strength as yourself!
In other words, it means to realize that.</p>
<p>Even a strong person can make mistakes,
Beginners often point exactly the same as professionals.
It is extremely difficult to match the opponent&rsquo;s level,
Moreover, when trying to match, it becomes incompatible with &ldquo;the customer wins&rdquo;.
(At first, it looks like a professional on Jojo-dori, but actually there are many people who are weak in the middle and late stages.)</p>
<p>As expected, it is a difficult problem that Professor Hanyu also says.</p>
<h1 id="entertaining-policy-examination-failure-plan">Entertaining policy examination (failure plan)</h1>
<p>First, in order to satisfy &ldquo;(1) the customer wins&rdquo;,
It is necessary to make the AI weak and weak, but if it is too weak,
I cannot satisfy &ldquo;② I can&rsquo;t understand the omission&rdquo;.</p>
<p>To match the opponent&rsquo;s level or make the game a close battle,
Judging the shape of the board,
Point the hands so that they are almost even,
The idea would come to mind first.</p>
<p>When you are winning, point your bad hand
When losing, point good hands, keep the balance of the board,
Make the game a close battle.</p>
<p>However, that would make it impossible to win or lose **.</p>
<p>As the hand progresses, the target situation is 50-50 ⇒ 60-40 ⇒ 70-30 etc.
I wish I could adjust it,
Then, just going to be stupid from the middle,
The end of the originally interesting hum is boring.
At the end, you will be in a state where you will &ldquo;know your omission&rdquo;.
The super-typical &ldquo;I&rsquo;ve cut my hand to lose&rdquo;
It is an entertaining pattern that can be understood.</p>
<p>Another alternative is
Choose the hand that takes the most time to the end = Close battle
I also come up with the policy.</p>
<p>However, the strongest AI in shogi
If you take &ldquo;the best way to make the length as long as possible&rdquo;,
First of all, take the opponent’s frame
After completely sealing the opponent&rsquo;s movement,
(In that state, you can stretch it to any number of steps)
Returning the tricks and pieces when it was near the planned number
I will die as it is,
It will be the worst move.
I can&rsquo;t talk about this.</p>
<p>Usually, the AI of board games is
By &ldquo;N pre-reading&rdquo; &amp; &ldquo;board evaluation function&rdquo;,
There are many implementations that consider MIN-MAX and move it so that the evaluation is the best.</p>
<p>Considering the implementation according to the level of the other party,
Aiming for it is that the normal evaluation function is 50-50,
(If the previous opponent is bad, this is also bad, and the evaluation value is returned with)
It&rsquo;s a long way to settle = aim at it, thinking that it is even
▽ (Hand that stretches out which one wins)
Although it is a natural idea,
&ldquo;Entertainment AI&rdquo; is unlikely to be possible with this.
It is necessary to change the way of thinking.</p>
<h1 id="entertaining-policy-consideration-recruitment-proposal-this-time">Entertaining policy consideration (recruitment proposal this time)</h1>
<p>As conclusion,
It was based on the &ldquo;tit-back strategy&rdquo; of the prisoner&rsquo;s dilemma.</p>
<p>If the opponent points to the &ldquo;Nth best hand&rdquo; on the board,
Next, entertaining AI has a policy of pointing to &ldquo;N+1 best hand&rdquo;.</p>
<p>Since I am not trying to return the board to 50-50,
The miso is that the entertaining AI side will gradually become disadvantageous.</p>
<p>However, if you simply make this policy,
&ldquo;When the check is the best and there is only one escape&rdquo;
The entertainment AI side could not choose the best reception,
There are many cases where the game ends just by making a check.
(*I actually made it and noticed it)</p>
<p>Even if you are not a checker,
The interaction where the answer is a straight road is annihilation.
It&rsquo;s completely entertaining if some advanced people do it.
It does not satisfy &ldquo;③ not too weak&rdquo;.</p>
<p>Then, for “Nth best hand”,
How about returning the &ldquo;Nth best hand&rdquo;? (Allow equivalent hands)</p>
<p>This depends on the state of the board
Since which “Nth” is more advantageous,
There is a high possibility that “1) the customer wins” cannot be met.
Or it will not end.</p>
<p>See the situation and take it properly
If you become too advantageous, you must cut out suddenly,
&ldquo;② I can&rsquo;t understand the omission&rdquo; is caught.</p>
<p>As a result of trial and error after thinking variously,
** Make the &ldquo;best hand deviation degree&rdquo; equal or less **
I came up with the new concept.</p>
<h1 id="what-is-the-best-hand-deviation-degree">What is the &ldquo;best hand deviation degree&rdquo;?</h1>
<p>First of all, for the evaluation value of the board, referring to Professor Tanaka&rsquo;s concept of complete analysis,
If both point to the best move
・You win = 100 points minus [the effort required until then]
・I lose = -100 points plus [the effort required until then]
It was evaluated as.
By this, by evaluating the board surface immediately after pointing a hand,
It is possible to rank from best to worst.</p>
<p>&ldquo;Best hand deviation degree&rdquo; is an index value that evaluates the opponent&rsquo;s hand on the board,
&ldquo;Evaluation value of opponent&rsquo;s hand / Evaluation value of the best hand on the board&rdquo;
It is a value calculated by.To exclude things like negative numbers ÷ negative numbers,
It is calculated by adding +300 to the board evaluation value.</p>
<p>The best move will always be &ldquo;1&rdquo;,
The farther it is from the best hand, the lower it goes, such as &ldquo;0.9&rdquo; or &ldquo;0.8&rdquo;.
If you make a defeat that changes the win or loss, it will be around &ldquo;0.5&rdquo; and &ldquo;0.6&rdquo;.
(With one win of 100+300,
▽ It is the worst to lose immediately at -100 + 300, so in that case 0.5)</p>
<p>The simple implementation policy adopted this time is
Just hit &ldquo;the best move of the opponent&rsquo;s best hand deviation degree ** or less **&rdquo;.</p>
<p>If the other person takes the best move, this also returns the best move.
If the opponent makes a bad move, this too will return a bad move.
Can be implemented with only this one logic.</p>
<p>If it is the N-th best system, how many options are there in the first place?
NG because it depends heavily on the size of the hand.
It is a plan to compare with the average value of options instead of comparing with the best hand,
It is NG because it fails in the situation where there is only one correct answer as described above.
Also, if it is set to &ldquo;less than&rdquo;, the best return of the best hand will not be included, so
&ldquo;Below&rdquo; is considered best.</p>
<p>If the opponent is the best &ldquo;1.0&rdquo;, the entertainment AI is also &ldquo;1.0&rdquo;,
If you point your hand at some disadvantage somewhere,
If you want to return with the same number exactly under &ldquo;less than that&rdquo;,
Because it doesn&rsquo;t exist every time,
A system in which the entertaining AI becomes a disadvantage little by little.</p>
<p>Only if you repeat the perfect strongest,
It will be settled with the board evaluation value at that time.
(That is, the pattern in which the &ldquo;entertainment&rdquo; side wins is
Abandoning the trick and the king when there are considerably few choices,
ㆍPerform the best moves from the disadvantageous state to the end,
2 patterns)</p>
<p>Also, regarding the degree of omission,
Since you will always choose hands that are almost at the same level as your customers,
From the point of view of customers who carry out that level of hand
It is impossible to judge whether or not they are neglected.
(The customer points to a better hand if you can tell that it has gone unnoticed)
In theory, the feeling of suddenly becoming stronger or weaker does not occur.</p>
<p>Incidentally,
Such as &ldquo;accumulating and evaluating the hands of the other person who pointed in the past&rdquo;,
Since it is not a complicated implementation that really measures the opponent&rsquo;s playing strength,
You no longer need to have a &ldquo;past state or history&rdquo;
It is a big advantage that it is easy to make API.
(When trying to evaluate past accumulation,
The need to keep the state of each client in the server,
▽ History and board management for each user will be required.
(User authentication for each API will occur)</p>
<p>Conclusion: This idea is the only basic implementation of entertaining AI!</p>
<p><strong>Calculate the best hand deviation of the opponent&rsquo;s last hand,</strong>
<strong>AI returns the best move that is less than or equal to its best move deviation degree</strong></p>
<p>*However, as with &ldquo;Complete Analysis&rdquo;, only hands that lose one shot are excluded.</p>
<p>Please try playing the following apps again.</p>
<p><a href="https://doubutu-64e43.web.app/">https://doubutu-64e43.web.app/</a></p>
<p>From super beginners to advanced adults,
While leaving a moderate texture to everyone,
I think you can really feel that the winning rate is for humans to win.</p>
<h1 id="the-bonus-of-analysis--strongest">The bonus of &ldquo;analysis&rdquo; &amp; &ldquo;strongest&rdquo;</h1>
<p>I thought it was interesting as a byproduct, so
Directly log the &ldquo;evaluation result/best hand deviation&rdquo; of this AI
It is output on the app.</p>
<p>The hand I pointed to earlier
How good your hand was
What was the correct answer? Is known each time,
It will also be useful for improving shogi power.</p>
<p>Also, because we are searching for &ldquo;complete analysis&rdquo; results,
The &ldquo;strongest&rdquo; AI is really strong.
~~ Being nicknamed the &ldquo;strongest&rdquo; is also ~~
~~ May be &ldquo;entertainment&rdquo; for masochistic people. ~~</p>
<p>However, if you switch AI on the way,
When a rare aspect occurs that is not included in the complete analysis,
It is not always possible to return the best move.</p>
<h1 id="implemented-content--technology-used">Implemented content / technology used</h1>
<p>What kind of development did you do here? of
Describe the mounting aspect.
*Some codes and points for implementation will be described later.</p>
<p>First, the results of Tanaka&rsquo;s complete analysis,
Download the program for searching (about 2GB)
I made it moveable. (C language)</p>
<p>Then I wanted to get it working in Python, so
Run that program via Python&rsquo;s subprocess,
Made it possible to handle complete analysis data from Python.</p>
<p>The big miscalculation was
&ldquo;Results of complete analysis&rdquo; are really
The response is not posted.</p>
<p>What is &ldquo;complete analysis&rdquo;?
In two person zero sum finite definite complete information game
Theoretically, the first victory or the second victory or a draw has been decided,
It means that I have searched all the way to that point,
For example, &ldquo;missing the check&rdquo;
Hands/faces that would not normally occur are not included in the analysis.</p>
<p>For general theory of perfect information games,
See Dr. Drken&rsquo;s wonderful commentary.
<a href="https://qiita.com/drken/items/4e1bcf8413af16cb62da">https://qiita.com/drken/items/4e1bcf8413af16cb62da</a></p>
<p>If you only have &ldquo;complete analysis&rdquo; data, the extreme story,
Even if you do not program the movement of the frame here,
Is it possible to make a game only by the transition of the board? I thought
It was a miscalculation that I imagined only with the name &ldquo;perfect&rdquo;.</p>
<p>After all, including &ldquo;try&rdquo; judgment etc.
I had to re-implement all the rules in Python.</p>
<p>After implementing the rules, AI
(*AI here means a mechanism to select a hand on the board, the degree of it)
Was implemented so that they could play against each other.
At this point, the trial and error of entertaining AI policy.</p>
<p>2GB inquiries and result parse processing are being carried out each time
Because it&rsquo;s too late
Create a Sqlite DB that caches query results,
The results of inquiries in the past are returned from the cache.
(*The currently released app also uses cache,
If there is a situation that you have not experienced in the past,
(It may take about 15 seconds for the hand to come back)</p>
<p>It’s hard for me to continue studying with CUI,
The AI part is converted to API for GUI,
If you give the pointed hand and its board as input,
The structure was changed to return the hand pointed to by the AI.
(*“Sennicate” is originally a draw and has been implemented in the CUI version,
The policy that is currently open to the public is to have as little history as possible,
(It is not subject to implementation)</p>
<p>Adopting &ldquo;Flask&rdquo; as the API server,
Made on a completely free instance of GCP (Goocle Cloud Platform).
Since we are doing heavy processing on the minimum configuration,
If there are many accesses, the server may go down.</p>
<p>On the client side, you can play on your smartphone
I decided to implement it in &ldquo;PWA&rdquo; using &ldquo;Monaca&rdquo;.
API is called from JavaScript.</p>
<p>When displaying the movable range of the frame selected in the application in color
It’s not good to communicate every time,
To draw the board after moving without waiting for the response from the server,
After all, even on the JavaScript side, I got to implement almost all the rules of animal shogi.</p>
<p>The PWA deployment destination is Google
&ldquo;Firebase&rdquo; is adopted.</p>
<p>What I was addicted to here is related to HTTPS communication.
Firebase automatically becomes HTTPS communication,
There is a tip that can be easily deployed from Monaca
This is useful when deploying PWA,
Since the API server side was plain HTTP,
Even if you execute it from your PC and it is OK,
When you run it from your smartphone,
It doesn&rsquo;t work due to the restriction that &ldquo;it&rsquo;s HTTPS but don&rsquo;t change to HTTP on the way.&rdquo;
(* Translate the error cause because there is no debug mode on the smartphone side)</p>
<p>Put the so-called &ldquo;Oleore Certificate&rdquo; on the API server side
Even if it looks like HTTPS, the situation does not improve,
I really made HTTPS using &ldquo;letsencript&rdquo;.</p>
<p>I also got a free domain because I need it when using letsencript.
I had no plans to do this
It was a lot more work than I had expected.</p>
<p>Entertaining is another difficult task (</p>
<h1 id="implementation-points">Implementation points</h1>
<p>PWA+Firebase and GCP+Flask
As I mentioned in my past article,
Mainly how to operate the complete animal analysis
I will write down the points focusing on the know-how of Flask&rsquo;s conversion to https.</p>
<p>◆ About Monaca + PWA + Firebase
<a href="https://qiita.com/youwht/items/6c7712bfc7fd088223a2">https://qiita.com/youwht/items/6c7712bfc7fd088223a2</a></p>
<p>◆ About GCP + Flask + Free Domain
<a href="https://qiita.com/youwht/items/9851c2ac9024633fc04e">https://qiita.com/youwht/items/9851c2ac9024633fc04e</a></p>
<h2 id="how-to-run-animal-cross-analysis-from-python">How to run Animal Cross Analysis from Python</h2>
<p>As a premise, this time
I installed ubuntu with WSL2 (β) on Windows 10 and moved it.
By the way, it has been confirmed that it can be moved on the colaboratory.</p>
<p>Download the code and data from Dr. Tanaka&rsquo;s site.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">wget https://dell.tanaka.ecc.u-tokyo.ac.jp/~ktanaka/dobutsushogi/dobutsu-src-20150109.tar.gz
wget https://dell.tanaka.ecc.u-tokyo.ac.jp/~ktanaka/dobutsushogi/dobutsu-dat.tar.gz
</code></pre></div><p>Check the following site for the correct URL and usage status.
<a href="https://dell.tanaka.ecc.u-tokyo.ac.jp/~ktanaka/dobutsushogi/">https://dell.tanaka.ecc.u-tokyo.ac.jp/~ktanaka/dobutsushogi/</a></p>
<p>Extract the downloaded file</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">tar -xzf dobutsu-src-20150109.tar.gz
tar -xzf dobutsu-dat.tar.gz
</code></pre></div><p>Was it deployed? Check below</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">du -sh dobutsu/*
cat <span style="color:#e6db74">&#34;dobutsu/Makefile&#34;</span>
</code></pre></div><p>Make below.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">make -f Makefile
</code></pre></div><p>Before that, if there is an error in this,
You need to install gcc and make.
(Not necessary if implemented in colaboratory, since it is included from the beginning)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo apt-get install build-essential g++
sudo apt install make
</code></pre></div><p>Make a place to put the game data file etc. and create the game data file.
In Tanaka&rsquo;s program,
The game data file format is strictly defined,
If you write the game record in a wrong way, you will get an error.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mkdir data
<span style="color:#75715e"># An example of downloading the game file sample in the initial arrangement state</span>
wget -P <span style="color:#e6db74">&#34;data/&#34;</span> <span style="color:#e6db74">&#34;https://www.tanaka.ecc.u-tokyo.ac.jp/ktanaka/dobutsushogi/init.txt&#34;</span>
<span style="color:#75715e"># Example of creating a game record file by outputting with redirect</span>
echo -e <span style="color:#e6db74">&#34;. -LI .\n-KI-ZO .\n .+ZO+KI\n .+LI .\n100100\n-&#34;</span>&gt; <span style="color:#e6db74">&#34;data/B3B2HI-C4C3KI.txt&#34;</span>
</code></pre></div><p>As mentioned above, specify the game file created by downloading or echo,
Run a program called &ldquo;checkState&rdquo;.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">./checkState data/init.txt
./checkState data/B3B2HI-C4C3KI.txt
<span style="color:#e6db74">```</span>With this, the complete analysis result <span style="color:#66d9ef">for</span> the initial board <span style="color:#66d9ef">until</span> the end is displayed. Wow.

In order to handle this result from the Python program side,
By subprocess as below,
Hit the command from Python and receive the result.

The point here is that the result string of <span style="color:#e6db74">&#34;checkState&#34;</span> is not standard output
As it appears on the standard error output side, get it.

<span style="color:#e6db74">```</span>py
import subprocess
import os
<span style="color:#75715e">#checkState body</span>
def EXEC_checkState<span style="color:#f92672">(</span>banmen_path<span style="color:#f92672">)</span>:
    <span style="color:#75715e"># ./checkState data/init.txt</span>
    <span style="color:#75715e"># Instead of executing the above command</span>
    <span style="color:#75715e"># stderror seems to return the result in the character string, so I added stderr=subprocess.STDOUT</span>
    checkState_result <span style="color:#f92672">=</span> subprocess.check_output<span style="color:#f92672">([</span><span style="color:#e6db74">&#39;./checkState&#39;</span>, banmen_path<span style="color:#f92672">]</span>, stderr<span style="color:#f92672">=</span>subprocess.STDOUT<span style="color:#f92672">)</span>
    
    <span style="color:#75715e">#print(type(checkState_result)) ⇒ &lt;class&#39;bytes&#39;&gt;</span>
    The <span style="color:#66d9ef">return</span> value of <span style="color:#75715e">#check_output is a binary character string, so it is necessary to convert it into a character string with decode.</span>
    checkState_result_str <span style="color:#f92672">=</span> checkState_result.decode<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;utf8&#39;</span><span style="color:#f92672">)</span>

    <span style="color:#66d9ef">return</span> checkState_result_str
</code></pre></div><p>With this know-how,
Even if you do not go to the mysterious theme of &ldquo;entertainment AI&rdquo;,
Some kind of data analysis with Python for the result of complete analysis,
You will be able to do machine learning.</p>
<h2 id="flask--letsencript-struggled-a-little">Flask + letsencript struggled a little</h2>
<p>First, install the command to create the certificate</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"> sudo apt install certbot
</code></pre></div><p>letsencript accesses the following path
ttp://[domain name)/.well-known/acme-challenge/(random file name)
I&rsquo;m trying to confirm the existence of the site.
Make this saucer as a template on Flask</p>
<pre><code class="language-py:letsencript" data-lang="py:letsencript">from flask import Flask, request, jsonify, render_template, redirect

#Flask initialization
app = Flask(__name__)

@app.route('/.well-known/acme-challenge/&lt;filename&gt;')
def well_known(filename):
    return render_template('.well-known/acme-challenge/'+ filename)

if __name__ =='__main__':
    ## Start with HTTP communication
    # *Letsencript mainly works here (*Communication comes on the default port 80 without port specification)
    #app.run(host='0.0.0.0', port=80, debug=True)
</code></pre><p>Try accessing Flask with the following command.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo certbot certonly --webroot -w <span style="color:#f92672">(</span>absolute path of the folder where Flask is running<span style="color:#f92672">)</span>
</code></pre></div><p>If successful, a log like this will appear and a .pem file will be generated.
If an error occurs,
Domain name resolution, public settings related to ports (FW settings on GCP side),
Is it a common cause such as Flask&rsquo;s public settings, presence of template folder, etc.?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"> -Congratulations! Your certificate and chain have been saved at:
   /etc/letsencrypt/live/※※※/fullchain.pem
   Your key file has been saved at:
   /etc/letsencrypt/live/※※※/privkey.pem
</code></pre></div><p>With the pem file generated as the SSL certificate specified as below,
Start Flask with HTTPS status OK</p>
<pre><code class="language-py:" data-lang="py:">from flask import Flask, request, jsonify, render_template, redirect
import ssl

app = Flask(__name__)

## SSL certificate
context = ssl.SSLContext(ssl.PROTOCOL_TLSv1_2)
context.load_cert_chain(
    '※※ Location of the file created above※※/fullchain.pem',
    '※※ Location of the file created above※※/privkey.pem'
)

if __name__ =='__main__':
    ## Start with HTTPS communication
    #Firebase assumes HTTPS
    app.run(host='0.0.0.0', port=443, ssl_context=context, debug=True)
</code></pre><p>This will allow HTTPS communication,
Since communication on the letsencrypt side will fail,
For renewal when the certificate expires,
There is also a program for starting a server with HTTP
It seems better to leave it.
(Set one port to 80,
▽ May I start both at the same time? )</p>
<p>We have not implemented automatic certificate renewal settings,
It may be a little unlucky way.</p>
<h1 id="consideration-on-the-created-entertainment-animal-ai">Consideration on the created &ldquo;entertainment animal AI&rdquo;</h1>
<p>&ldquo;Miscellaneous fish&rdquo; is random except for the next hand win/loss judgment.
It is the weakest class AI that does not ignore the check,
In the case of the first &ldquo;small fish&rdquo; vs. the second &ldquo;entertainment&rdquo;,
70% or more &ldquo;Miscellaneous fish&rdquo; wins.
I think that &ldquo;entertainment&rdquo; has been defeated well.</p>
<p>On the other hand,
In the first &ldquo;strongest&rdquo; vs the second &ldquo;entertainment&rdquo;,
Since there is no randomness on the strongest side,
** 100% of &ldquo;Entertainment&rdquo; wins **.</p>
<p>If you say &ldquo;entertainment&rdquo; in the same way,
If the opponent points the wrong hand, you make a bigger mistake,
Because it is made with the implementation.</p>
<p>In this game, which is a victory for the second hand, because the &ldquo;strongest&rdquo; is not mistaken,
&ldquo;Entertainment&rdquo; wins only when the &ldquo;strongest&rdquo; is played.</p>
<p>Of course, it was possible to implement to lose on the way,
&ldquo;Entertainment&rdquo;, which is weaker than the weakest,
**I think it would be more interesting to win only the &ldquo;strongest&rdquo;. **</p>
<p>Human beings always make mistakes somewhere, so they generally win &ldquo;entertainment&rdquo;.</p>
<p>・&ldquo;The strongest&rdquo; beats &ldquo;human&rdquo;
・&ldquo;Human&rdquo; beats &ldquo;small fish&rdquo;
・&ldquo;Miscellaneous fish&rdquo; beats &ldquo;entertainment&rdquo;
・&ldquo;Entertainment&rdquo; beats &ldquo;strongest&rdquo;</p>
<p>It can be said that this relationship represents the novelty of entertainment AI.</p>
<p>However, the mystery of this entertaining AI is &ldquo;hospitality&rdquo;.
As an evaluator of this AI,
<strong>The &ldquo;child&rdquo; used without reading this article is most desirable</strong>.</p>
<p>~~ Well, if you try after reading the material of this article, ~~
~~ One of the entertainment requirements &ldquo;I can&rsquo;t understand the omission&rdquo; is violated. ~~</p>
<p>I know the rules of how to hit animals,
Someone who tried,
Although there is a flow of struggling a little,
Is it fun to win at the end?</p>
<p>Also, even though it is an AI that even children can win,
Are advanced users willing to try and be surprised at the texture?</p>
<p>As far as the author does,
Fight evenly with people of almost every level,
&ldquo;Entertainment&rdquo; that almost everyone can win
I think it was realized, but what about everyone?</p>
<p>Only by implementing a simple idea (= best deviation)
We were able to achieve a high level of &ldquo;entertainment&rdquo; at this level.</p>
<p>In other games that have not been completely analyzed,
If the evaluation function is correct to some extent,
<strong>It is expected that &ldquo;Entertainment AI&rdquo; can be created in the same way</strong>.</p>
<p>Already shogi and go AI have moved far beyond human intelligence.
These strongest AIs can be used to entertain more people
Shouldn&rsquo;t it be applied?</p>
<p>#Postscript</p>
<p>First of all,
After I wanted to make it, after a long and long study in the brain,
Finally I recently came up with this idea,
I am happy because it has become one form.</p>
<p>The most annoying point is
About the excessively human act of &ldquo;entertainment&rdquo;,
What kind of situation should I make? To
Expressing with a definition that can be handled in the computer world,
And connecting it with a feasible implementation policy.
The long sentence of this paper records the process of trial and error.</p>
<p><strong>As an implementation plan</strong> that realizes &ldquo;hospitality&rdquo; programmatically,
Also, as &ldquo;<strong>Entertainment for children</strong>&rdquo;,
I hope you enjoy it.</p>
<p>that&rsquo;s all.
Thank you for your support.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
