<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Python] Continue making stock price forecasting AI for 10 hours a day 1st month | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] Continue making stock price forecasting AI for 10 hours a day 1st month</h1>
<p>
  <small class="text-secondary">
  
  
  Jan 2, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/ai"> AI</a></code></small>


<small><code><a href="https://memotut.com/tags/stock-prices"> stock prices</a></code></small>


<small><code><a href="https://memotut.com/tags/deep-learning"> deep learning</a></code></small>


<small><code><a href="https://memotut.com/tags/keras"> Keras</a></code></small>

</p>
<pre><code>I resumed learning Python last December 3rd. I was wondering if I could make something for practice, but I came up with the idea of creating an AI for stock price forecasting, so I decided to give it a try. As a result, we have AI that can predict (and possibly even predict) that stock prices will rise or fall by more than 1% with 64% accuracy. Project 1 is the main subject because of the process of getting into the main subject of Project 1.
</code></pre>
<p>#Project 1
Use linear regression to visually determine if the current stock market is a bubble. I also wanted to embed the results in a website so that anyone could generate an image of their favorite ETF or company stock, or an image at any time to use it as a reference for determining whether the current price is a bubble.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/558316/d63e161a-d087-4923-528b-f6cf79020302.png" alt="image.png">
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/558316/1cd758fa-fc9d-e0ca-b1f6-adc26e8c2a93.png" alt="image.png"></p>
<p>As a result, I thought I was successful using Django in my local environment, but I couldn&rsquo;t really deploy it. I think I didn&rsquo;t have enough knowledge of databases and Django.
It&rsquo;s a code.
<a href="https://github.com/LulutasoAI/LRQiita/blob/master/LRgenerator">https://github.com/LulutasoAI/LRQiita/blob/master/LRgenerator</a></p>
<p>#Project 2
Predict future stock prices by image analysis.</p>
<h2 id="attempt-1">Attempt 1</h2>
<p>A large amount of stock price data is converted into a candlestick chart image every two months, the price and the date and time when the chart was last displayed are taken, and it is divided into two types depending on whether the price has risen after two months.
Predict whether stock prices will go up or down in the same way that dogs and cats are distinguished.
The data is about 500 sheets Nikkei Stock Average, S&amp;P500, APPLE inc. and data from Toyota Motor Corporation from 2001 to the present.
<a href="https://github.com/LulutasoAI/Datasetpricechart1">https://github.com/LulutasoAI/Datasetpricechart1</a> Please for learning</p>
<p>The data looks like this
Category 0: After image price increases (up)
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/558316/9022676b-d445-f3b3-2e9d-bbaff8306293.png" alt="image.png">
Category 1: Post-image price down
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/558316/047e93a4-a529-e5b5-1e61-b93882e142d5.png" alt="image.png"></p>
<p>###result
Accuracy did not change with validation of learning, but accuracy is temporarily 58%
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/558316/e92b9e38-21aa-283b-0b80-841276c51b47.png" alt="image.png">
55.8% when tested with a test set
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/558316/c97bd874-9cca-1674-ec84-10989ad39688.png" alt="image.png">
Hmm subtle</p>
<h2 id="attempt-2">Attempt 2</h2>
<p>I tried to classify the candlestick chart into four categories for prediction.
There are four groups in the dataset: the group whose price has increased by 4.8% or more in the two months after the image, the group whose price has dropped by 4.8% or more, the group whose price has increased slightly (4.7% or less) with the other images, and the group whose price has dropped. I learned by dividing into two. The result is an AI that can guess which group the image belongs to with 36% accuracy. I tried to think about the meaning of this accuracy of 36%, but I was not sure. I thought it would be much better than the 25% you could get by random prediction because it was just 4 categories, but the proportion of the 4 categories of the dataset used this time is &ldquo;down 13.36%&rdquo;, &ldquo;drastically-down 23.22%&rdquo; , &ldquo;drastically-up 38.23%&rdquo;, &ldquo;up 25.17%&rdquo;, so it&rsquo;s not so easy to think. For example, as an obvious overtraining example, an AI that predicts that it is &ldquo;drastically up&rdquo; for all images can have an accuracy of around 38% (from this dataset, a random training or test set). Because you can). I didn&rsquo;t really know if 36% was good or bad.</p>
<h2 id="attempt-3">Attempt 3</h2>
<p>I decided to make it simpler.
We decided to train using only the two groups in the above data set that had a price movement of 4.8% or more.
as a result
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/558316/79db7998-e789-d5dc-83a0-7f1937b2bc10.png" alt="image.png">
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/558316/836a9ade-218b-6089-375c-982daddb491d.png" alt="image.png">
In this way, overlearning has happened.
I think this trial still has room for research. It seems that improvements can be expected by playing with the keras model and layers.</p>
<h2 id="attempt-4">Attempt 4</h2>
<p>I will simply create a dataset by dividing it into two depending on whether the price went up or down in the two months after the image, but this time I tried to learn using a large amount of data. We have obtained the stock price data for the period from 2001-01-01 to the present.</p>
<ul>
<li>^N225 nikkei 225</li>
<li>AAPL Apple Inc.</li>
<li>^ GSPC S%P 500</li>
<li>TM TOYOTA</li>
<li>GOOGL Alphabet Inc Class A</li>
<li>BA Boeing Company</li>
<li>AMZN Amazon.com Inc.</li>
<li>PYPL PayPal</li>
<li>TWTR Twitter, Inc.</li>
<li>V Visa Inc.</li>
</ul>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/558316/6ce2b35d-937e-d14a-ddee-d621418297d0.png" alt="image.png"></p>
<p>It was a pretty good result.</p>
<h2 id="attempt-5">Attempt 5</h2>
<p>In the above classification method, it is possible to assume that something that might have been classified as &ldquo;down&rdquo; with a slight difference (for example, a difference of 2 cents) would be classified as &ldquo;up&rdquo;, and the price would be small. I thought that things that did not change might confuse the model during training, so I decided not to put in the dataset those with price fluctuations of 1% or less. Is the result of learning on that dataset
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/558316/440d20f2-9daf-65ea-95d9-69726ec7774f.png" alt="image.png"></p>
<p>I realized that the problem might be in the keras model or layer, not in the dataset.</p>
<h2 id="attempt-6">Attempt 6</h2>
<p>I tried to make the most of what I learned.
The data set is large, and the chart of 3753 candlesticks excluding the images whose price has moved less than 1% 2001-
I was conscious of avoiding over-learning.</p>
<p>And the result of trying with a certain model
After 150 epochs
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/558316/7b089b19-5f90-600c-4851-ca85da957ced.png" alt="image.png"></p>
<p>After 250 epochs
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/558316/ef3a02eb-1eeb-7c52-cce3-bf2c377d307f.png" alt="image.png">
Not bad</p>
<p>But be patient, if you think about it, the charts from 2007 to 2009, when there was a Lehman shock, may be noisy.
I came up with the idea of learning only charts from 2010 onwards.
The data set has become 1875, but it is a challenge
By playing with the model all day long, trial and error</p>
<p>After 500 epochs
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/558316/4cb92c9b-58cf-0cc3-cb93-5e3c27b9ed21.png" alt="image.png"></p>
<p>The test set has an accuracy of 64%. This is what happened today. I would like to write about the models and layers after studying a little more.</p>
<p>#Conclusion
By letting Python learn candlestick charts, we&rsquo;ve found that predicting the future of the stock market can be a daunting task for computers. But on the other hand, the 64% accuracy also suggests that there is something behind the chart that allows some prediction.</p>
<p>I would like to continue my research as long as the funds (living costs) continue. Once I have a good AI, I want to embed it in a website so that anyone can use it.
Last but not least, I&rsquo;m also writing in English so please take a look
<a href="https://lulitech.nihoninanutshell.com">https://lulitech.nihoninanutshell.com</a></p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
