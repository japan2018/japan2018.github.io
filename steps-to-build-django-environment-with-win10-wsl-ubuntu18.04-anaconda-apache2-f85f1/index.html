<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>Steps to build Django environment with Win10 WSL Ubuntu18.04 &#43; Anaconda &#43; Apache2 | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Steps to build Django environment with Win10 WSL Ubuntu18.04 + Anaconda + Apache2</h1>
<p>
  <small class="text-secondary">
  
  
  May 6, 2020
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/django">Django</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/apache">Apache</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/vscode">VSCode</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/windowssubsystemforlinux">WindowsSubsystemForLinux</a></code></small>

</p>
<pre><code>I will summarize the procedure to create a development environment of Django + Apache on Ubuntu 18.04 of Windows 10 WSL
</code></pre>
<h2 id="procedure">Procedure</h2>
<p>Allow apache2 to access python via mod_wsgi. Also, we will make VScode usable as a remote IDE that can be used with WSL.</p>
<ol>
<li>Install anaconda3</li>
<li>Install django</li>
<li>Create a django project and migrate</li>
<li>Install apache2</li>
<li>Install mod_wsgi</li>
<li>Add to apache2 configuration file</li>
<li>Enable vscode</li>
</ol>
<p>Since WSL cannot use systemctl, the operation of apache changes a little, when using anaconda, you need to change the reference setting by yourself unless you install mod_wsgi with pip, it is hard to understand the setting of apache2.conf, it is easy to stumble around I think that is the place.</p>
<h2 id="1-install-wsl">1. Install WSL</h2>
<p>Install Ubuntu 18.04 with WSL enabled
<a href="https://qiita.com/matarillo/items/61a9ead4bfe2868a0b86">https://qiita.com/matarillo/items/61a9ead4bfe2868a0b86</a></p>
<p>I will update</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">sudo apt update
sudo apt upgrade
</code></pre><h2 id="2-install-apache2">2. Install Apache2</h2>
<p>Install and start apache2 and apache2-dev</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">sudo apt install apache2
sudo apt install apache2-dev
sudo /etc/init.d/apache2 start
</code></pre><p>Now apache should listen on http://localhost. If you open it with a browser, index.html in the document root /var/www/html/ will open.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/277233/d0cd47a0-9fc9-d046-6679-d8b7eb2c1b72.png" alt="image.png">
Stop when you stop</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">sudo /etc/init.d/apache2 stop
</code></pre><p>When restarting to reflect the setting change, restart</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">sudo /etc/init.d/apache2 restart
</code></pre><h2 id="3-installing-anaconda">3. Installing Anaconda</h2>
<p>install pyenv</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">git clone https://github.com/yyuu/pyenv.git ~/.pyenv
</code></pre><p>Through PATH</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">echo'export PYENV_ROOT=&quot;$HOME/.pyenv&quot;' &gt;&gt; ~/.bashrc
echo'export PATH=&quot;$PYENV_ROOT/bin:$PATH&quot;' &gt;&gt; ~/.bashrc
echo'eval &quot;$(pyenv init -)&quot;' &gt;&gt; ~/.bashrc
source ~/.bashrc
</code></pre><p>Check the version of anaconda that can be installed</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">pyenv install -l | grep anaconda
</code></pre><p>Install the selected version of anaconda. In the following, we have installed version 2020.02.</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">pyenv install anaconda3-2020.02
pyenv rehash
pyenv global anaconda3-2020.02
</code></pre><p>Pass through PATH.</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">echo'export PATH=&quot;$PYENV_ROOT/versions/anaconda3-2020.2/bin/:$PATH&quot;' &gt;&gt; ~/.bashrc
conda init
source ~/.bashrc
</code></pre><p>Create a conda environment. The following creates a python3.7 environment called django. xxxx is the user name.</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">conda create -n django python=3.7
echo'export PYTHONHOME=/home/xxxx/.pyenv/versions/anaconda3-2020.02' &gt;&gt; ~/.bashrc
echo'export PYTHONPATH=/home/xxxx/.pyenv/versions/anaconda3-2020.02/bin:/home/xxxx/.pyenv/versions/anaconda3-2020.02/lib/python3.7/site-packages' &gt;&gt; ~/. bashrc
conda create django
</code></pre><h2 id="4-install-django">4. Install django</h2>
<p>Install and check the version</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">pip install django
django-admin --version
</code></pre><p>Let&rsquo;s make a project and run it. You can create a project named hoge by creating a directory and using django-admin startproject hoge.</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">mkdir django
cd django
django-admin startproject proj1
</code></pre><p>Execute the manage.py created in the created directory from python and run the simple server to check the operation.</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">cd proj1
python manage.py migrate
python manage.py runserver
</code></pre><p>If you open http://localhost:8000 in your browser, you should see the django sample page.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/277233/d5ff3be2-02cd-2bea-10fc-0a084b86f538.png" width=50%></p>
<h2 id="5-installing-mod_wsgi">5. Installing mod_wsgi</h2>
<p>mod_wsgi can be installed from apt, but mod_wsgi installed with apt is the default setting to go to python when apt install python instead of anaconda. If you use anaconda, I think it&rsquo;s easier to install from pip.</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">pip install mod_wsgi
pip install mod-wsgi-httpd
</code></pre><p>Pass through PATH.
xxxx is the user name.</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">echo'export PATH=/home/xxxx/.pyenv/versions/anaconda3-2020.02/bin:$PATH' &gt;&gt; ~/.bashrc
source ~/.bashrc
</code></pre><p>Now mod_wsgi should work. Let&rsquo;s run a simple server and check the operation. With the following command, the simple server will wait at http://localhost:8000, so open it in a browser.</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">mod_wsgi-express start-server
</code></pre><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/277233/273f2dbd-ae83-faca-f47a-329ee5579e94.png" width=50%>
If the mod_wsgi-express server is operating normally, the image that does not look like the sample page above is displayed.
<p>Finally, get the information to write to the Apache2 configuration file.</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">mod_wsgi-express module-config
</code></pre><pre><code class="language-terminal:terminal" data-lang="terminal:terminal">LoadModule wsgi_module &quot;/home/xxxx/.pyenv/versions/anaconda3-2020.02/lib/python3.7/site-packages/mod_wsgi/server/mod_wsgi-py37.cpython-37m-x86_64-linux-gnu.so&quot;
WSGIPythonHome &quot;/home/xxxx/.pyenv/versions/anaconda3-2020.02&quot;
</code></pre><p>Let&rsquo;s copy and paste the above somewhere.</p>
<h2 id="6-associate-apache-with-mod_wsgi">6. Associate apache with mod_wsgi</h2>
<p>Add apache2.conf according to the official django.
<a href="https://docs.djangoproject.com/ja/2.0/howto/deployment/wsgi/modwsgi/">https://docs.djangoproject.com/ja/2.0/howto/deployment/wsgi/modwsgi/</a></p>
<p>If you create a django project in /home/xxxx/django/ it will look like this: The first two lines are a copy and paste of the contents displayed by mod_wsgi-express module-config, PATH of wsgi.py created in the directory of django project created by WSGIScriptAlias, manage.py of django project created by WSGIPythonPath. The directory PATH and Direcoty become the directory PATH of the above wsgi.py.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vim:/etc/apache2/apache2.conf" data-lang="vim:/etc/apache2/apache2.conf">LoadModule wsgi_module <span style="color:#e6db74">/home/xxxx/.pyenv/versions/anaconda3-2020.02/lib/python3.7/site-packages/mod_wsgi/server/mod_wsgi-py37.cpython-37m-x86_64-linux-gnu.so</span>
WSGIPythonHome <span style="color:#e6db74">/home/xxxx/.pyenv/versions/anaconda3-2020.02</span>

WSGIScriptAlias / <span style="color:#e6db74">/home/xxxx/django/proj1/proj1/wsgi.py</span>
WSGIPythonPath <span style="color:#e6db74">/home/xxxx/django/proj1</span>


<span style="color:#f92672">&lt;Directory</span> <span style="color:#e6db74">/home/xxxx/django/proj1/proj1</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;Files</span> <span style="color:#e6db74">wsgi.py</span><span style="color:#f92672">&gt;</span>
Require <span style="color:#66d9ef">all</span> granted
<span style="color:#f92672">&lt;/Files&gt;</span>
<span style="color:#f92672">&lt;/Directory&gt;</span>
</code></pre></div><p>The apache settings have been changed, so restart.</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">sudo /etc/init.d/apache2 restart
</code></pre><p>Verify by opening http://localhost in your browser.<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/277233/f9b63823-2804-f91b-bd8a-32f29f0de349.png" alt="image.png">
It is OK if it becomes like the above.</p>
<p>If the contents of apache2.conf are incorrect or some packages cannot be installed, an internal server error will occur as shown below.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/277233/dd3f6472-462b-7f3f-333a-532954e3f47c.png" alt="image.png">
Since it is difficult to understand the cause if it is only this, let&rsquo;s judge by looking at the apache error log. The default settings can be seen below.</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">tail -f /var/log/apache2/error.log
</code></pre><p>I think either I&rsquo;ve forgotten something or my PATH is wrong.</p>
<h2 id="7-allow-development-with-vscode">7. Allow development with VScode</h2>
<p>WSL does not have GUI, but you can develop with GUI by using WSL extension of VScode. After installing VScode on Windows 10, enable the WSL extension.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/277233/4877987d-e9a8-c32b-82c3-241da41beb92.png" alt="image.png">
When you start VS code from WSL with the following command, it seems that WSL will come to run VS code on Windows side.</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">cd test
code.
</code></pre><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/277233/c190d651-fe81-f062-6fb2-cb6116263f12.png" alt="image.png"></p>
<p>By the way, the permission restriction is as it is in Ubuntu, so it will be edited with the permission when executing code. For example, in /var/www/html/ where the static file of apahce is stored, the owner is root, so if you try to change it from the user account, you will get an error like the image below. You can change it if you change the owner, but I don&rsquo;t know if that is good for security, so please let me know. By the way, sudo code.</p>
<pre><code class="language-terminal:terminal" data-lang="terminal:terminal">Unable to write file'vscode-remote://wsl+ubuntu-18.04/var/www/html/test.html' (NoPermissions (FileSystemError): Error: EACCES: permission denied, open'/var/www/html/test .html')
</code></pre><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/277233/af0f4b16-f8da-32f0-93cf-8fe8c45cf335.png" alt="image.png"></p>
<h2 id="reference">Reference</h2>
<p><a href="https://docs.djangoproject.com/ja/2.0/howto/deployment/wsgi/modwsgi/">https://docs.djangoproject.com/ja/2.0/howto/deployment/wsgi/modwsgi/</a>
<a href="https://codelab.website/anaconda-django/">https://codelab.website/anaconda-django/</a>
<a href="https://qiita.com/itisyuu/items/dafa535adc8197208af1">https://qiita.com/itisyuu/items/dafa535adc8197208af1</a>
<a href="https://blog.capilano-fw.com/?p=369">https://blog.capilano-fw.com/?p=369</a></p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
