<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Trace the data structure of Blender and extract the vertex coordinates from fbx | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Trace the data structure of Blender and extract the vertex coordinates from fbx</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 5, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/blender">Blender</a></code></small>


<small><code><a href="https://memotut.com/tags/fbx">FBX</a></code></small>

</p>
<pre><code>Using Blender, I created a script that extracts only the vertex coordinates from the FBX data and arranges it, so I will introduce it after explanation.
</code></pre>
<h1 id="blender-data-structure">Blender data structure</h1>
<p>First of all, about this figure (initial state) that you are familiar with.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288125/b89b4ebf-6e80-a635-b88d-af8e8a93c23d.png" alt="image.png"></p>
<p>By the way, the 3D view of Blender is managed as follows.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288125/1e92b571-61bb-8f86-0856-af1aab37d996.png" alt="image.png"></p>
<p>In Python script</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">bpy<span style="color:#f92672">.</span>context<span style="color:#f92672">.</span>scene<span style="color:#f92672">.</span>collection
</code></pre></div><p>It is a place to hit.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288125/ef7ea6ba-9d13-c93b-b457-8d2d2b49bcdf.png" alt="image.png"></p>
<p>This is the GUI here.</p>
<p>There is a scene in the base → a collection, and there are objects in the collection. I&rsquo;m not sure about the difference between a scene and a collection. However, objects (so-called cubes, cameras, etc.) that exist as data are called to the collection by linking them as links. This means that only the linked objects will appear in the view, <strong>some objects may exist as data even if they are not visible</strong>. By doing so, it seems that the same data will be reused. Although it is complicated for those who operate it.</p>
<p>And like objects, there is a data list in the meshes and materials that are attached to it, and by linking it, we will use only the necessary amount.</p>
<p>For example, here</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">bpy<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;hoge&#34;</span>, bpy<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>meshes<span style="color:#f92672">.</span>new(<span style="color:#e6db74">&#34;fuga&#34;</span>))
</code></pre></div><p>If you give the command, nothing will change in the apparent scene,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> bpy<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>objects:
    <span style="color:#66d9ef">print</span>(i)
</code></pre></div><p>so,</p>
<pre><code class="language-Python:Output" data-lang="Python:Output">&lt;bpy_struct, Object(&quot;Camera&quot;)&gt;
&lt;bpy_struct, Object(&quot;Cube&quot;)&gt;
&lt;bpy_struct, Object(&quot;hoge&quot;)&gt;
&lt;bpy_struct, Object(&quot;Light&quot;)&gt;
</code></pre><p>As you get back, you can see that a mysterious object called <code>hoge</code> has been added. Also,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">bpy<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>objects[<span style="color:#e6db74">&#39;hoge&#39;</span>]<span style="color:#f92672">.</span>to_mesh()
</code></pre></div><p>so,</p>
<pre><code class="language-Python:Output" data-lang="Python:Output">bpy.data.meshes['fuga']
</code></pre><p>As you can see from this, you can see that this object is linked to the mesh called <code>fuga</code>. Of course, this is just empty data with a name, so even if you link <code>hoge</code> to the collection now, nothing but a name with no vertices will be summoned.</p>
<p>We are looking at mesh in detail. The vertex information of the mesh is managed as follows.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288125/2fd8d393-d1d4-c8c1-534b-90eabed82cf8.png" alt="image.png"></p>
<p>The object links the mesh.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288125/9306bba7-b4c0-af01-d73b-1e0b54ca7e24.png" alt="image.png"></p>
<p>This is the GUI here.</p>
<p>Since the mesh data further stores vertex data, if you want the vertex information, you will access it. Now let&rsquo;s do a cube with a proper shape.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">bpy<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>objects[<span style="color:#e6db74">&#39;Cube&#39;</span>]<span style="color:#f92672">.</span>to_mesh()<span style="color:#f92672">.</span>vertices
</code></pre></div><p>This is a trace of the above picture.</p>
<pre><code class="language-Python:Output" data-lang="Python:Output">bpy.data.meshes['Cube'].vertices
</code></pre><p>Looking at this contents,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> bpy<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>meshes[<span style="color:#e6db74">&#39;Cube&#39;</span>]<span style="color:#f92672">.</span>vertices:
    <span style="color:#66d9ef">print</span>(i)
</code></pre></div><pre><code class="language-Python:Output" data-lang="Python:Output">&lt;bpy_struct, MeshVertex at 0x0000024A9FA28038&gt;
&lt;bpy_struct, MeshVertex at 0x0000024A9FA2804C&gt;
&lt;bpy_struct, MeshVertex at 0x0000024A9FA28060&gt;
&lt;bpy_struct, MeshVertex at 0x0000024A9FA28074&gt;
&lt;bpy_struct, MeshVertex at 0x0000024A9FA28088&gt;
&lt;bpy_struct, MeshVertex at 0x0000024A9FA2809C&gt;
&lt;bpy_struct, MeshVertex at 0x0000024A9FA280B0&gt;
&lt;bpy_struct, MeshVertex at 0x0000024A9FA280C4&gt;
</code></pre><p>Binary data will be returned. It seems that there is no doubt that it is a cube because there are 8 properly, but I would like you to return a numerical value if possible. If you look at <a href="https://docs.blender.org/api/current/bpy.types.MeshVertex.html#bpy.types.MeshVertex">Reference</a>, you can see that you can get the numerical value with the attribute <code>co</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> bpy<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>meshes[<span style="color:#e6db74">&#39;Cube&#39;</span>]<span style="color:#f92672">.</span>vertices:
    <span style="color:#66d9ef">print</span>(i<span style="color:#f92672">.</span>co)
</code></pre></div><pre><code class="language-Python:Output" data-lang="Python:Output">&lt;Vector (1.0000, 1.0000, 1.0000)&gt;
&lt;Vector (1.0000, 1.0000, -1.0000)&gt;
&lt;Vector (1.0000, -1.0000, 1.0000)&gt;
&lt;Vector (1.0000, -1.0000, -1.0000)&gt;
&lt;Vector (-1.0000, 1.0000, 1.0000)&gt;
&lt;Vector (-1.0000, 1.0000, -1.0000)&gt;
&lt;Vector (-1.0000, -1.0000, 1.0000)&gt;
&lt;Vector (-1.0000, -1.0000, -1.0000)&gt;
</code></pre><p>Finally, you have an array of vertex coordinates.</p>
<p>Apply to #fbx</p>
<p>Do the same for the imported fbx.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288125/53bd1454-e172-7ad2-ff16-66207a92e497.png" alt="image.png"></p>
<p>In principle, if you extract vertices for all mesh data, the same shape as above should be obtained.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> bpy<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>meshes:
    <span style="color:#66d9ef">print</span>(i)
</code></pre></div><pre><code class="language-Python:Output" data-lang="Python:Output">&lt;bpy_struct, Mesh(&quot;Cube&quot;)&gt;
&lt;bpy_struct, Mesh(&quot;Mesh&quot;)&gt;
&lt;bpy_struct, Mesh(&quot;Mesh.001&quot;)&gt;
&lt;bpy_struct, Mesh(&quot;Mesh.002&quot;)&gt;
&lt;bpy_struct, Mesh(&quot;Mesh.003&quot;)&gt;
&lt;bpy_struct, Mesh(&quot;Mesh.004&quot;)&gt;
&lt;bpy_struct, Mesh(&quot;Mesh.005&quot;)&gt;
&lt;bpy_struct, Mesh(&quot;Mesh.006&quot;)&gt;
&lt;bpy_struct, Mesh(&quot;Mesh.007&quot;)&gt;
</code></pre><p>……. There is a mysterious <code>Cube</code>.
Yes, <strong>the first cube that exists when Blender is launched</strong>. Even if you remove it from the scene (unlink it to be exact), the data in it will not disappear. If you leave it as it is, you will pick up the top of the cube. Let&rsquo;s disappear.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">bpy<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>meshes<span style="color:#f92672">.</span>remove(bpy<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>meshes[<span style="color:#e6db74">&#39;Cube&#39;</span>])
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> bpy<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>meshes:
    <span style="color:#66d9ef">print</span>(i)
</code></pre></div><pre><code class="language-Python:Output" data-lang="Python:Output">&lt;bpy_struct, Mesh(&quot;Mesh&quot;)&gt;
&lt;bpy_struct, Mesh(&quot;Mesh.001&quot;)&gt;
&lt;bpy_struct, Mesh(&quot;Mesh.002&quot;)&gt;
&lt;bpy_struct, Mesh(&quot;Mesh.003&quot;)&gt;
&lt;bpy_struct, Mesh(&quot;Mesh.004&quot;)&gt;
&lt;bpy_struct, Mesh(&quot;Mesh.005&quot;)&gt;
&lt;bpy_struct, Mesh(&quot;Mesh.006&quot;)&gt;
&lt;bpy_struct, Mesh(&quot;Mesh.007&quot;)&gt;
</code></pre><p>‥
It has disappeared.
After that, write a script that extracts the vertex coordinates for all these mesh data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#f92672">import</span> bpy
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np

vts <span style="color:#f92672">=</span> []

<span style="color:#66d9ef">for</span> m <span style="color:#f92672">in</span> bpy<span style="color:#f92672">.</span>data<span style="color:#f92672">.</span>meshes:
    <span style="color:#66d9ef">for</span> v <span style="color:#f92672">in</span> m<span style="color:#f92672">.</span>vertices:
        vts<span style="color:#f92672">.</span>append(v<span style="color:#f92672">.</span>co)

vts <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(vts)

</code></pre></div><p>Since the number obtained with <code>co</code> is a type called <code>Vector</code>, it is converted with <code>np.array</code> for easy handling.</p>
<p>Verified whether the array obtained here really represents the original form. If the vertices accurately hold the 3D information, then just a scatter plot should show the original shape.</p>
<p>The array <code>vts</code> obtained earlier</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python">np<span style="color:#f92672">.</span>savetxt(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;arbitrary path\vts.txt&#39;</span>, vts)
</code></pre></div><p>Export with. Draw a scatter plot in another Python file (since Blender&rsquo;s built-in Python doesn&rsquo;t have matplotlib&hellip;).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">from</span> mpl_toolkits.mplot3d <span style="color:#f92672">import</span> Axes3D

data <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>loadtxt(<span style="color:#e6db74">&#39;vts.txt&#39;</span>)

X <span style="color:#f92672">=</span> data[:,<span style="color:#ae81ff">0</span>]
Y <span style="color:#f92672">=</span> data[:,<span style="color:#ae81ff">1</span>]
Z <span style="color:#f92672">=</span> data[:,<span style="color:#ae81ff">2</span>]

fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure()
ax <span style="color:#f92672">=</span> Axes3D(fig)
ax<span style="color:#f92672">.</span>set_xlabel(<span style="color:#e6db74">&#34;X&#34;</span>)
ax<span style="color:#f92672">.</span>set_ylabel(<span style="color:#e6db74">&#34;Y&#34;</span>)
ax<span style="color:#f92672">.</span>set_zlabel(<span style="color:#e6db74">&#34;Z&#34;</span>)ax<span style="color:#f92672">.</span>plot(X,Y,Z,marker<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;o&#34;</span>,linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;None&#39;</span>,ms<span style="color:#f92672">=</span><span style="color:#ae81ff">0.2</span>)

plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288125/b3f6e89c-654b-e665-bced-35afccddce5f.png" alt="image.png"></p>
<p>It turned out that the vertices of the original 3D data can be accurately arranged.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
