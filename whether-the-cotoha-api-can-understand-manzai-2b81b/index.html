<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Whether the COTOHA API can understand Manzai | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Whether the COTOHA API can understand Manzai</h1>
<p>
  <small class="text-secondary">
  
  
  Feb 15, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/nlp"> NLP</a></code></small>


<small><code><a href="https://memotut.com/tags/news-item"> news item</a></code></small>


<small><code><a href="https://memotut.com/tags/cotoha"> COTOHA</a></code></small>

</p>
<pre><code>#Introduction
</code></pre>
<p>This article has been entered in <a href="https://zine.qiita.com/event/collaboration-cotoha-api/">Qiita x COTOHA API Present Project</a>.</p>
<p>What is #COTOHA API?
It is a service provided by NTT Communications so that APIs can easily use natural language processing technology and speech recognition/synthesis technology that make use of the research results of the NTT Group for over 40 years.</p>
<p>Natural language processing such as syntactic analysis and proper expression extraction, and characteristic &ldquo;summary&rdquo; and &ldquo;user attribute estimation&rdquo; can also be used.</p>
<p>■ Service introduction link
<a href="https://api.ce-cotoha.com/contents/index.html">https://api.ce-cotoha.com/contents/index.html</a></p>
<p>#What is Milk Boy?
Milk Boy is a comedy duo who belongs to Yoshimoto Kogyo. Formed in July 2007. 2019 M-1 champion.</p>
<blockquote>
<p>On the M-1 1st stage, using &ldquo;corn flakes&rdquo; as a theme, we showcase the features that are likely to correspond to corn flakes and the features that do not seem to correspond to each other in light interplay.
Recorded &ldquo;681 points&rdquo;, the highest score ever!
<a href="https://www.youtube.com/watch?v=VjBQtr4lH0k">Click here for details</a></p>
</blockquote>
<p>=== Omitting because there is no technical relationship ===</p>
<p>#I investigated
Finally the main subject. This milkboy manzai repeats the &ldquo;characteristics that are likely to apply to the target object&rdquo; and the &ldquo;characteristics that are unlikely to apply&rdquo; to create laughter.
Perhaps this manzai can be understood by AI, who is good at meaning reading, that is, COTOHA?</p>
<p><em>Note: Just saying &ldquo;I understand&rdquo; does not cover fun or humor</em></p>
<p><strong>Let&rsquo;s authenticate first</strong>
・COTOHA API has a free Developer plan, so register first.
・Get Client ID and Client Secret from the portal</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#COTOHA API authentication with Python</span>

<span style="color:#f92672">import</span> requests<span style="color:#f92672">,</span>json

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">authorization</span>():
    cotoha_url_auth <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.ce-cotoha.com/v1/oauth/accesstokens&#34;</span>
    headers <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;Content-Type&#34;</span> :<span style="color:#e6db74">&#34;application/json&#34;</span>}
    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;grantType&#34;</span>: <span style="color:#e6db74">&#34;client_credentials&#34;</span>,
        <span style="color:#e6db74">&#34;clientId&#34;</span>: cotoha_clientId, <span style="color:#75715e"># user specific value here</span>
        <span style="color:#e6db74">&#34;clientSecret&#34;</span>: cotoha_clientSecret <span style="color:#75715e"># user specific value here</span>
    }

    res <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(cotoha_url_auth, headers<span style="color:#f92672">=</span>headers, json<span style="color:#f92672">=</span>data)
    token <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(res<span style="color:#f92672">.</span>text)[<span style="color:#e6db74">&#34;access_token&#34;</span>]
    <span style="color:#75715e">#print(&#34;COTOHA API authenticated&#34;)</span>
    
    <span style="color:#66d9ef">return</span> token <span style="color:#75715e"># Returns the access token string and ends</span>
</code></pre></div><p><strong>Try using the similarity judgment API</strong>
This time, I will use ** &ldquo;Similarity judgment&rdquo; ** in COTOHA API</p>
<blockquote>
<p>What is similarity determination?
A RESTful API that calculates the semantic similarity between two sentences.
The similarity is output in the domain of 0-1, and the closer to 1, the greater the similarity between the two sentences.
Since the similarity is calculated using the semantic information of the words included in the sentence, the similarity between texts containing different words can also be estimated.</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Similarity judgment</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">similar</span>(sentence1, sentence2, token):
    url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.ce-cotoha.com/api/dev&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/nlp/v1/similarity&#34;</span>
    header <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json;charset=UTF-8&#34;</span>,
        <span style="color:#e6db74">&#34;Authorization&#34;</span> :<span style="color:#e6db74">&#34;Bearer &#34;</span><span style="color:#f92672">+</span>token
    }
    data <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;s1&#34;</span>: sentence1,
        <span style="color:#e6db74">&#34;s2&#34;</span>: sentence2
    }
    req <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(url, headers <span style="color:#f92672">=</span> header, json <span style="color:#f92672">=</span> data)
    <span style="color:#66d9ef">return</span> req<span style="color:#f92672">.</span>text
</code></pre></div><p>For the <code>token</code>, use the Access token output by the previous authentication.
If you put two sentences side by side and request, the similarity will be returned.</p>
<p>Example: (&ldquo;I am good at exercise&rdquo;, &ldquo;I love sports&rdquo;)
⇒ Similarity: {&lsquo;result&rsquo;: {&lsquo;score&rsquo;: 0.94150746},&lsquo;status&rsquo;: 0,&lsquo;message&rsquo;:&lsquo;OK&rsquo;}</p>
<p>Even though there are almost no same words, this match rate&hellip;! Great!</p>
<p><strong>It’s okay, it’s cornflakes.</strong>
The introduction became longer, but by combining the above two and processing it gently,
I made a function to judge whether the input sentence is corn flakes.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Cornflake function</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">cornflake</span>(sentence, obj <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;corn flakes&#34;</span>):
    <span style="color:#66d9ef">try</span>:
        token <span style="color:#f92672">=</span> authorization()
        sim <span style="color:#f92672">=</span> float(json<span style="color:#f92672">.</span>loads(similar(obj, sentence, token))[<span style="color:#e6db74">&#34;result&#34;</span>][<span style="color:#e6db74">&#34;score&#34;</span>])
        <span style="color:#66d9ef">if</span> sim<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0.4</span>:
            rep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;That,&#34;</span> <span style="color:#f92672">+</span> obj <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;I&#39;m sorry! (Similarity: {:.2f})&#34;</span><span style="color:#f92672">.</span>format(sim)
        <span style="color:#66d9ef">else</span>:
            rep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hona&#34;</span> <span style="color:#f92672">+</span> obj <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;I think (similarity: {:.2f})&#34;</span><span style="color:#f92672">.</span>format(sim)
    <span style="color:#66d9ef">except</span>:
        rep <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Error occurred during API request&#34;</span>
    <span style="color:#66d9ef">return</span> rep
</code></pre></div><p>I made. In vain, it is a specification that can judge other than corn flakes by specifying the argument <code>obj</code>.</p>
<p><strong>Start of survey</strong></p>
<p>**Note: From here on, the spoilers of &ldquo;Milk Boy&rdquo; are included. Please be careful! ! **</p>
<blockquote>
<p>I&rsquo;ll think about it together with my favorite breakfast, so please let me know what characteristics you have.</p>
</blockquote>
<p><code>cornflake(&quot;sweet and crunchy and eat with milk or something&quot;)</code></p>
<p>Output:&lsquo;That, corn flakes or not! (Similarity: 0.74)&rsquo;</p>
<p><code>cornflake(&quot;You say, that is the last meal before you die.&quot;)</code></p>
<p>Output:&lsquo;Hana corn flakes (similarity: 0.25)&rsquo;</p>
<p><code>cornflake(&quot;I don't know why there are so many nutritionally balanced pentagons.&quot;)</code></p>
<p>Output: &ldquo;Hana corn flakes (similarity: 0.16)&rdquo;</p>
<p><code>cornflake(&quot;The producer's face doesn't come up when eating.&quot;)</code>
Output:&lsquo;That, corn flakes or not! (Similarity: 0.56)&rsquo;</p>
<p><code>cornflake(&quot;You say, Chinese in terms of genre.&quot;)</code></p>
<p>Output:&lsquo;Hana corn flakes (similarity: 0.15)&rsquo;</p>
<h1 id="result-commentary">Result commentary</h1>
<p>**I feel like corn flakes. .. .. **
The similarity determination used this time is just * &ldquo;determining the semantic similarity between sentences&rdquo; *, but it is * &ldquo;determining whether or not the object has the characteristics.&rdquo; * But it seems to be <strong>somewhat accurate</strong>.
(I tried various other than the above, but the overall similarity was low.</p>
<p>When you think about it, &ldquo;corn flakes&rdquo; and &ldquo;wide nutritionally balanced pentagon&rdquo; are not the same meaning, so that&rsquo;s right. .. ..</p>
<p>#ending
<code>cornflake(&quot;There seems to be a company that offers strong services in Japanese&quot;,&quot;NTT&quot;)</code></p>
<p>Output:&lsquo;That, NTT or not! (Similarity: 0.44)&rsquo;</p>
<p>Thank you very much.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
