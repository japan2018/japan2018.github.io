<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Wai Can JOIN be done with Django? | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Wai Can JOIN be done with Django?</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 29, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/django">Django</a></code></small>


<small><code><a href="https://memotut.com/tags/python3">Python3</a></code></small>

</p>
<pre><code>(Note) This article is in Wy notation. Respect Taro @Yametaro with respect.
</code></pre>
<p>#One day my home
Wai &ldquo;<a href="https://note.com/shimayu22/n/n3a320a86a915">I&rsquo;m making a Django app as a hobby</a> Naya&rdquo;
Wai &ldquo;You can make a table just by writing a model.&rdquo;
Wai &ldquo;Django is too hungry to create an admin screen!&rdquo;</p>
<h1 id="db-normalized">DB normalized</h1>
<p>Y &ldquo;Easy setting of external keys&rdquo;
Wai &ldquo;For example, it would be better to have separate tables for player data and performance for each player <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>.&rdquo;</p>
<h3 id="players">Players</h3>
<table>
<thead>
<tr>
<th align="center">id</th>
<th align="center">year</th>
<th align="center">name</th>
<th align="center">position</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1</td>
<td align="center">2019</td>
<td align="center">Tanaka</td>
<td align="center">Pitcher</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">2019</td>
<td align="center">Suzuki</td>
<td align="center">First Baseman</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">2020</td>
<td align="center">Takahashi</td>
<td align="center">Outfielder</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">2020</td>
<td align="center">Yamada</td>
<td align="center">Second baseman</td>
</tr>
</tbody>
</table>
<h3 id="fieldertotalresults">FielderTotalResults</h3>
<table>
<thead>
<tr>
<th align="center">id</th>
<th align="center">player_id</th>
<th align="center">at_bat</th>
<th align="center">hit</th>
<th align="center">homerun</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">4</td>
<td align="center">1</td>
<td align="center">1</td>
<td></td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">3</td>
<td align="center">0</td>
<td></td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">3</td>
<td align="center">5</td>
<td align="center">2</td>
<td align="center">1</td>
<td></td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">4</td>
<td align="center">4</td>
<td align="center">1</td>
<td align="center">0</td>
<td></td>
</tr>
<tr>
<td align="center">*Simplified for explanation</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Wai &ldquo;FielderTotalResults <code>player_id</code> is a foreign key&rdquo;
Wai &ldquo;It corresponds to the <code>id</code> of the Players table.&rdquo;</p>
<p>Wai &ldquo;In this example, FieldeTotalResults has an id of 1 and Tanaka has a record of 2 for Suzuki.&rdquo;
Wai &ldquo;I can clearly see that 3 is Takahashi and 4 is Yamada.&rdquo;</p>
<p>#INNER JOIN
Wai &ldquo;The Fielder Total Results table is the result of totaling the results for each player.&rdquo;
Wai &ldquo;I want to combine the results with Players and display them on the screen.&rdquo;</p>
<p>year | name | position | at_bat | hit | homerun |
|:-:|:-:|:-:|:-:|:-:|:::
| 2019 | Tanaka | Pitcher | 4 | 1 | 1 |
| 2019 | Suzuki | First Baseman | 3 | 3 | 0 |
2020 | Takahashi | Outfielder | 5 | 2 | 1 |
2020 | Yamada | Second baseman | 4 | 1 | 0 |</p>
<p>Wai &ldquo;I feel like this.&rdquo;
Wai &ldquo;Isn&rsquo;t it possible to write so that the <code>id</code> of Players and the <code>player_id</code> of FielderTotalResults match?&rdquo;
Wai &ldquo;For example, if you want to combine Suzuki player information and results&rdquo;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> django.db <span style="color:#f92672">import</span> models
<span style="color:#f92672">from</span> eikan.models <span style="color:#f92672">import</span> Players, FielderTotalResults

p <span style="color:#f92672">=</span> Players<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>get(pk<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
f <span style="color:#f92672">=</span> FielderTotalResults<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>get(player_id<span style="color:#f92672">=</span>p<span style="color:#f92672">.</span>id)
</code></pre></div><p>Wai &ldquo;Hmm? This just got the record of the same player at each table!&rdquo;
Wai &ldquo;I want to combine them and pass them as one data to Template.&rdquo;
Wai &ldquo;Hmm, there is no JOIN description even if you look at the official document.&rdquo;
Wai &ldquo;In such cases, do you acquire them separately and do something with Template?&rdquo;</p>
<h1 id="actually-inner-join-already">Actually INNER JOIN already</h1>
<p>Daughter (<strong>2 years old</strong>) <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> &ldquo;Daddy! If you get a child table with Django&rdquo;</p>
<p>Wai &ldquo;What?!&rdquo;
Wai &ldquo;(At age 2, you already understand Django better than Wye&hellip;!)&rdquo;</p>
<p>Wai &ldquo;Daughter, where did you know that?&rdquo;
Daughter &ldquo;I remembered playing with a friend at the nursery&rdquo;</p>
<p>Wai “(Is it possible to play at Django in a nursery&hellip;?”)
Wai &ldquo;(I didn&rsquo;t know because Wai was in kindergarten&hellip;)&rdquo;</p>
<p>Wai &ldquo;But my daughter, is it really combined with the parent table?&rdquo;
Wai &ldquo;If you write <code>f.name</code>&rdquo;
Wai &ldquo;I don&rsquo;t think I&rsquo;m angry.&rdquo;</p>
<p>Daughter &ldquo;If you daddy, it&rsquo;s a manual person&rdquo;
Daughter &ldquo;At times like this, you first get the child table records, right?&rdquo;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">f <span style="color:#f92672">=</span> FielderTotalResults<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>get(player_id<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</code></pre></div><p>Daughter &ldquo;If you write &ldquo;child table.foreign key.column name of parent table&rdquo; in this state, you can get the value.&rdquo;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">f<span style="color:#f92672">.</span>player_id<span style="color:#f92672">.</span>name
<span style="color:#f92672">&gt;&gt;&gt;</span> Suzuki
</code></pre></div><p>Wai &ldquo;Honomaya! (Manual human&hellip;?)&rdquo;</p>
<p>Daughter &ldquo;If you write the same in Template&rdquo;
Daughter &ldquo;You can use the values of the parent table column without having to hand over the parent table.&rdquo;
Daughter &ldquo;If parent-&gt;child-&gt;grandchild has a relation&rdquo;
Daughter &ldquo;<code>Grandson table.Child foreign key.Parent foreign key.Parent element</code>&rdquo;
Daughter &ldquo;I can write&rdquo;</p>
<p>Wai &ldquo;Wow, that&rsquo;s amazing&hellip;&rdquo;
Wai &ldquo;I can&rsquo;t join anywhere but Django can easily join.&rdquo;</p>
<p>Daughter &ldquo;Dad isn&rsquo;t referenced by anyone.&rdquo;
Wai &ldquo;Say, no&hellip;&rdquo;
Wai &ldquo;(What a destructive 2-year-old child&hellip;)&rdquo;</p>
<p>――
<strong>The following is added based on comments</strong></p>
<h1 id="another-day">Another day</h1>
<p>Wai &ldquo;It&rsquo;s finally completed!&rdquo;
Wai &ldquo;I couldn&rsquo;t sleep more than 8 hours because I missed it!&rdquo;</p>
<p>Yome (Is it sleeping enough?)</p>
<p>Wai &ldquo;Is this a sample for Heroku?&rdquo;
Wai &ldquo;Well, <a href="https://note.com/shimayu22/n/n3a320a86a915">contents are contents</a> It&rsquo;s hard not to use other than Wai!&rdquo;</p>
<p>Daughter &ldquo;I&rsquo;ve done it&rdquo;
Daughter &ldquo;I think this is a difficult thing.&rdquo;
Daughter &ldquo;This is education.&rdquo;</p>
<p>Wai &ldquo;Fat!?&rdquo;
Wai (Stress like the former director of the Kansai team&hellip;!)
Wai &ldquo;Daughter-chan, isn&rsquo;t Hyundai the view that stealing is not so high in scoring value?&rdquo;</p>
<p>Daughter &ldquo;Daddy, not Saber Metrics, Django&rsquo;s story&rdquo;
Daughter &ldquo;No matter how much you can get while being INNER JOIN&rdquo;
Daughter &ldquo;Every time I try to use a value with the current writing style&rdquo;
Daughter &ldquo;A lot of queries are issued and it gets very heavy&rdquo;
Daughter &ldquo;So-called N+1 problem&rdquo;
Daughter &ldquo;In fact, the one that daddy deployed to Heroku is also issuing a lot of queries.&rdquo;</p>
<p>Wai &ldquo;I thought it was kind of heavy, but I wonder if this is&hellip;&rdquo;
Wai &ldquo;How did your daughter find out how many queries were issued?&rdquo;</p>
<p>Daughter &ldquo;Using django-debug-toolbar, I can see the queries that are issued.&rdquo;
Daughter &ldquo;I&rsquo;ll omit how to use it if I google it.&rdquo;
Daughter &ldquo;The query issued by Daddy&rsquo;s app looks like this&rdquo;</p>
<table>
<thead>
<tr>
<th align="center">Page name</th>
<th align="right">Number of queries</th>
<th align="right">Processing time (ms)</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Current Team</td>
<td align="right">48</td>
<td align="right">959</td>
</tr>
<tr>
<td align="center">Team List</td>
<td align="right">7</td>
<td align="right">115</td>
</tr>
<tr>
<td align="center">Team Details</td>
<td align="right">324</td>
<td align="right">4576</td>
</tr>
<tr>
<td align="center">Fielders List</td>
<td align="right">43</td>
<td align="right">770</td>
</tr>
<tr>
<td align="center">Pitcher List</td>
<td align="right">15</td>
<td align="right">416</td>
</tr>
<tr>
<td align="center">Pitcher details</td>
<td align="right">76</td>
<td align="right">1426</td>
</tr>
<tr>
<td align="center">Batter Details</td>
<td align="right">66</td>
<td align="right">1261</td>
</tr>
<tr>
<td align="center">Match List</td>
<td align="right">29</td>
<td align="right">453</td>
</tr>
<tr>
<td align="center">Match Details</td>
<td align="right">20</td>
<td align="right">345</td>
</tr>
<tr>
<td align="center">*Partial increase or decrease depending on the number of registered records</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Wai &ldquo;I get the team details from various tables.&rdquo;
Wai &ldquo;It&rsquo;s really heavy&rdquo;
Wai &ldquo;If this gets lighter, I&rsquo;m not happy.&rdquo;</p>
<p>Daughter &ldquo;If you want to get and process related records in various places&rdquo;
Daughter &ldquo;as commented&rdquo;
Daughter &ldquo;By using select_related(), we will not issue unnecessary queries.&rdquo;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">f <span style="color:#f92672">=</span> FielderTotalResults<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>select_related(<span style="color:#e6db74">&#39;player_id&#39;</span>)<span style="color:#f92672">.</span>get(player_id<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
f<span style="color:#f92672">.</span>player_id<span style="color:#f92672">.</span>name
<span style="color:#f92672">&gt;&gt;&gt;</span> Suzuki
</code></pre></div><p>Daughter &ldquo;This is how it looks like&rdquo;
Daughter &ldquo;By doing this, no matter how many times I use <code>f.player_id.name</code>&rdquo;
Daughter &ldquo;The query is issued only once.&rdquo;</p>
<p>Wai &ldquo;Wow, that&rsquo;s amazing&hellip;&rdquo;
Wai &ldquo;Then I&rsquo;ll fix all that if applicable.&rdquo;</p>
<p>#n weeks later</p>
<p>Wai &ldquo;It&rsquo;s getting lighter now~&rdquo;
Wai &ldquo;It&rsquo;s pretty effective just by using select_related()&rdquo;
Wai &ldquo;Check with django-debug-toolbar&rdquo;
Wai &ldquo;Easy to review the overall processing&rdquo;
Wai &ldquo;This is the result of a major rework&rdquo;</p>
<table>
<thead>
<tr>
<th align="center">Page Name</th>
<th align="right">Number of Queries (Previous)</th>
<th align="right">Number of Queries (After)</th>
<th align="right">Processing Time (Previous) (ms)</th>
<th align="right">Processing Time (Post) (ms)</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Current Team</td>
<td align="right">48</td>
<td align="right">7</td>
<td align="right">959</td>
<td align="right">183</td>
<td></td>
</tr>
<tr>
<td align="center">Team List</td>
<td align="right">7</td>
<td align="right">3</td>
<td align="right">115</td>
<td align="right">75</td>
<td></td>
</tr>
<tr>
<td align="center">Team Details</td>
<td align="right">324</td>
<td align="right">15</td>
<td align="right">4576</td>
<td align="right">110</td>
<td></td>
</tr>
<tr>
<td align="center">Fielders List</td>
<td align="right">43</td>
<td align="right">3</td>
<td align="right">770</td>
<td align="right">92</td>
<td></td>
</tr>
<tr>
<td align="center">Batter Details</td>
<td align="right">66</td>
<td align="right">6</td>
<td align="right">1261</td>
<td align="right">212</td>
<td></td>
</tr>
<tr>
<td align="center">Pitcher List</td>
<td align="right">15</td>
<td align="right">3</td>
<td align="right">416</td>
<td align="right">71</td>
<td></td>
</tr>
<tr>
<td align="center">Pitcher details</td>
<td align="right">76</td>
<td align="right">12</td>
<td align="right">1426</td>
<td align="right">137</td>
<td></td>
</tr>
<tr>
<td align="center">Match List</td>
<td align="right">29</td>
<td align="right">3</td>
<td align="right">453</td>
<td align="right">1</td>
<td></td>
</tr>
<tr>
<td align="center">Match Details</td>
<td align="right">20</td>
<td align="right">6</td>
<td align="right">345</td>
<td align="right">2</td>
<td></td>
</tr>
<tr>
<td align="center">*Partial increase or decrease depending on the number of registered records</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>Wai &ldquo;Because I fixed it so as not to issue queries as much as possible&rdquo;
Wai &ldquo;Everywhere I displayed it, it was crispy!&rdquo;
Wai &ldquo;If you compare it, it&rsquo;s obvious!&rdquo;
Wai &ldquo;And even if you add more data&rdquo;
Wai &ldquo;The number of queries has stopped increasing.&rdquo;
Wai &ldquo;If you feel like it, please touch it and compare it.&rdquo;</p>
<p>Heavy: <a href="https://trial-endb-v1.herokuapp.com/">https://trial-endb-v1.herokuapp.com/</a>
Lighter: <a href="https://trial-endb-v2.herokuapp.com/">https://trial-endb-v2.herokuapp.com/</a></p>
<ul>
<li>Contains the same data</li>
</ul>
<p>#In the bath
Wai &ldquo;I was so impressed by this feature that I wrote this article.&rdquo;
Wai &ldquo;Honma is <a href="https://teratail.com/questions/219332">posting this teratail</a>, but you can read this article for a long time.&rdquo;
Wai &ldquo;I&rsquo;m talking about a solution right away&rdquo;
Wai &ldquo;This article may be a noise to many people.&rdquo;</p>
<p>Daughter &ldquo;daddy&rdquo;
Daughter &ldquo;I think the article that supplements teratail&rsquo;s answer will also help someone?&rdquo;
Daughter &ldquo;And by writing in Wy notation like this&rdquo;
Daughter &ldquo;By replaying success from failure&rdquo;
Daughter &ldquo;It will take root in everyone&rsquo;s memory&rdquo;
Daughter &ldquo;Actually, give me a comment&rdquo;
Daughter &ldquo;Isn&rsquo;t it familiar with the comparison?&rdquo;</p>
<p>Wai &ldquo;Seyana&rdquo;
Wai &ldquo;Wai herself, sometimes I can&rsquo;t feel the benefit even if I suddenly say best practice, saying, &ldquo;This one is yeah!&rdquo;
Wai &ldquo;I wish someone could read this article and feel the horse mackerel.&rdquo;
Daughter &ldquo;Umma!&ldquo;Wai &ldquo;Can I eat ice cream when I get out of the bath?&rdquo;
Daughter &ldquo;Wow, eat!&rdquo;</p>
<p>Wai “(I walked around until this time)”
Wai “(This is what the child who carried him tells me)”</p>
<p>**~~</p>
<h1 id="github">Github</h1>
<p><a href="https://github.com/shimayu22/Eikan-Database">https://github.com/shimayu22/Eikan-Database</a></p>
<p>#Reference
<a href="https://qiita.com/naoki_mochizuki/items/3fda1ad6594c11d7b43c">Table joins that can be understood even by SQL amateurs (inner join and outer join)</a>
<a href="https://qiita.com/okoppe8/items/66a8747cf179a538355b">Summary of Django database operations</a>
<a href="https://qiita.com/nakkun/items/76248f02ecaa434643db">When I checked the query generated by Django, it was issued in large numbers</a>
<a href="https://qiita.com/shati-taro/items/f6fb5bef70c6c6d57542">[Django] Devices for reducing the number of queries (planned to be added at any time)</a>
<a href="https://qiita.com/uenosy/items/54136aff0f6373957d22">Django reverse pull cheat sheet (QuerySet)</a>
<a href="https://qiita.com/ragnar1904/items/1afaeb6601cc490fb70a">[Django 2.2] How to display the relation destination in Django? [List View]</a>
<a href="https://qiita.com/yoko8ma/items/feb7776727911ddda8f1">Search for grandchild table in Django</a>
<a href="https://qiita.com/d9magai/items/7157c325a70a987dded1">How to find and eradicate N+1 issues during Django development</a></p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>It doesn&rsquo;t seem to be necessary if you look only here, but I&rsquo;m also using it&hellip; <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>In reality
Daughter &ldquo;I&rsquo;ve already been able to get INNER JOIN with the parent table.&rdquo; <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
