<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>I tried sentiment analysis of the whole novel Weather&#39;s Child ☔️ | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>I tried sentiment analysis of the whole novel Weather&rsquo;s Child ☔️</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 22, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/natural-language-processing"> natural language processing</a></code></small>


<small><code><a href="https://memotut.com/tags/python3"> Python3</a></code></small>


<small><code><a href="https://memotut.com/tags/sentiment-analysis"> sentiment analysis</a></code></small>

</p>
<pre><code>![752B7BFA-4985-442D-904C-BEB091269C6C.gif](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/327405/05e5f803-dc12-4db0-bcf5-47661a8e5329.gif)
</code></pre>
<p>#1. A brief overview
In this article, I will explain how to analyze sentiment by natural language processing the text of the novel <font color="DeepSkyBlue">**&ldquo;Weather Child&rdquo;**</font>!</p>
<p>In general, <strong>emotional analysis</strong> is to discover and quantify <strong>&ldquo;emotion&rdquo;</strong> contained in a sentence and judge the opinion of the sentence.
This is an area of current interest because it allows us to mechanically categorize user opinions about our products and services.</p>
<p>On the other hand,
&ldquo;Isn&rsquo;t it possible to use sentiment analysis in addition to reviews and reviews?&rdquo;
So, I decided to challenge the sentiment analysis using <font color="OrangeRed">**&ldquo;Novel&rdquo;**</font>, which is rarely done in this article.</p>
<p>If we analyze the sentiment of the novel, <strong>&ldquo;Is it possible to guess the rough development of the story and the character of the characters?</strong>&rdquo; is the purpose of this article.</p>
<p>For example, in a story,
・If the ups and downs of emotional values are intense, it is a very dramatic development.
・If you find a turning point from <font color="Orange Red">positive</font> to <font color="Blue">negative </font> according to emotional value, you can objectively discover the origin of the story. it can
And so on.</p>
<p>And the subject selected this time is <font color="Blue">Child of weather</font>!
It is a work that continued to be a big hit after the previous work ** &ldquo;Your name is.&rdquo; **, and many of you may have seen the movie.</p>
<blockquote>
</blockquote>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/47d4dfa4-4d8d-1043-ebe4-1ad01e3f2ec4.png" alt="image.png">
<a href="https://www.amazon.co.jp/%E5%B0%8F%E8%AA%AC-%E5%A4%A9%E6%B0%97%E3%81%AE%E5%AD%90-%E8%A7%92%E5%B7%9D%E6%96%87%E5%BA%AB-%E6%96%B0%E6%B5%B7-%E8%AA%A0/dp/4041026407">Novel Weather Child (Kadokawa Bunko)-amazon</a></p>
<p>I still think that it is new to my memory ~~ (I forgot it as expected) ~~, so I think that those who went to the theater can enjoy it by remembering the movie scene.</p>
<h2 id="difference-between-movie-and-novel">Difference between movie and novel</h2>
<ul>
<li>In the novel, the story progresses while the viewpoints (first person) of the characters are switched.</li>
<li>The main point of view is the main character, Hotaka, but there are also chapters on Haruna and Natsumi.</li>
<li>The story is basically the same. The novel has a more detailed explanation.</li>
</ul>
<p>It&rsquo;s a personal impression, but you can enjoy the story from a slightly different perspective than the movie.</p>
<p>#2. How to analyze emotions</p>
<p>This time, we performed the simplest sentiment analysis <strong>&ldquo;Positive negative analysis&rdquo;</strong>.
<strong>&ldquo;Positive negative analysis&rdquo;</strong> means whether the text is a <font color="OrangeRed">positive</font> opinion, a <font color="Blue">negative </font> opinion, or It is a classification method that determines whether or not it is neutral from a series of words.
First, I will explain the general flow of sentiment analysis by giving a simple example.
First, the sentence is morphologically analyzed and decomposed into morphemes (words) as follows.</p>
<p>** “Natsumi-san raises his hand and Suga-san ignores it. ] **</p>
<p>↓</p>
<p><strong>[&lsquo;Ha&rsquo;,&rsquo; and&rsquo;,&rsquo; Natsumi&rsquo;,&lsquo;san&rsquo;,&lsquo;ga&rsquo;,&lsquo;energy&rsquo;,&lsquo;to&rsquo;,&lsquo;hand&rsquo;,&lsquo;to&rsquo;,&lsquo;raise&rsquo;,&rsquo;,&rsquo;,&lsquo;suga&rsquo; , &ldquo;San&rdquo;, &ldquo;wa&rdquo;, &ldquo;it&rdquo;, &ldquo;to&rdquo;, &ldquo;ignore&rdquo;, &ldquo;do&rdquo;]</strong>
It&rsquo;s a sequel.
Then, it is judged for each word whether it is <font color="OrangeRed">positive</font> or <font color="Blue">negative</font>, and an emotional value is given to each.</p>
<p>**[&lsquo;Hai&rsquo;, 0],[&lsquo;and&rsquo;, 0],[&lsquo;Natsumi&rsquo;, 0], [&lsquo;san&rsquo;, 0], [&lsquo;wa&rsquo;, 0], [&lsquo;genki&rsquo;, 1], [&lsquo;To&rsquo;, 0], [&lsquo;hand&rsquo;, 0], [&lsquo;to&rsquo;, 0], [&lsquo;increase&rsquo;, 0],[&rsquo;,&rsquo;, 0],[&lsquo;suga&rsquo;, 0],[&rsquo; San&rsquo;, 0],[&lsquo;wa&rsquo;, 0],[&lsquo;it&rsquo;, 0],[&lsquo;to&rsquo;, 0],[&lsquo;ignore&rsquo;, -1],[&lsquo;do&rsquo;, 0]
**</p>
<p>In this sentence, I&rsquo;m enthusiastic and neglected with emotional polarity,
Fine: +1
Ignore: -1
The emotional value of was added.</p>
<p>Finally, the total value is calculated to calculate the sentence sentiment value. In the case of the above sentence, 1+(-1) means that the emotional value is 0. In this way, the emotional value is output for each sentence.</p>
<p>To determine the positiveness of a word, we use an emotion dictionary.
The emotion dictionary is a dictionary that describes in advance which words are <font color="OrangeRed">positive</font> or <font color="Blue">negative</font> as shown below. is.
In this dictionary, if there is a word that contains negative (evaluation), the emotional value is -1 and if positive (evaluation) comes, it is +1 and so on.</p>
<p>Emotional values will be issued based on this dictionary.
![Screenshot 2019-12-15 16.43.49.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/f5698898-b467-b40e-adce-(75623ad909a0.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/f5698898-b467-b40e-adce-(75623ad909a0.png)</a></p>
<p>In addition, it is also designed to enable positive/negative judgment with multiple words as shown below.
[Mouth corner + rise, +1] [Voice + pop, +1] [Energy + no, -1]</p>
<p>#3. Creating a corpus
First, create the base corpus.
I had my friend cooperate with me, and I made it like this. ↓
![Screenshot 2019-12-19 10.09.57.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/2f22d38f-4077-e3aa-1b74-(675a3c25105b.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/2f22d38f-4077-e3aa-1b74-(675a3c25105b.png)</a>
** <em>Because of the copyright, the corpus cannot be published, so only some of them will be introduced</em>*</p>
<blockquote>
<p>A word from friend S, the corpus creator
This time, I accepted the transcription with the intuition that &ldquo;I&rsquo;m not sure but it&rsquo;s definitely an interesting guy.&rdquo;
It took a whole week to copy and paste a few sentences using Kindle&rsquo;s &ldquo;Notes and Highlights&rdquo;. To be honest, it was very difficult.
You can copy and enter pages and weather by dragging sentences, but if you do this while you are exhausted from copy and paste work, it feels like a lariho.
I was told &ldquo;Thank you for the corpus!&rdquo; at the time of delivery, but I confess here that I was secretly googled because I didn&rsquo;t understand the &ldquo;corpus.&rdquo;</p>
</blockquote>
<p>#4. Prepare emotion dictionary
As mentioned above, prepare for sentiment analysis.
This time, the Inui-Okazaki laboratory of Tohoku University is open <a href="http://www.cl.ecei.tohoku.ac.jp/index.php?Open%20Resources%2FJapanese%20Sentiment%20Polarity%20Dictionary">[Japanese evaluation polar dictionary]</a> will be partially reorganized and used according to the contents of the weather child.
I made a self-made manpower for the <strong>&ldquo;multi-word dictionary&rdquo;</strong> for the positive/negative judgment by multiple words like [Mouth corner + Go up, +1].</p>
<p>#5. Give emotional value for each sentence
Import the emotion dictionary and output the emotion value for each sentence.
The code is given at the end of this article, but if you want a quick Japanese sentiment analysis, the library &ldquo;<strong>oseti&rdquo;</strong> is very useful. I also referred to it.</p>
<p><a href="https://qiita.com/yukinoi/items/46aa016d83bb0e64f598">Opened Sentiment Analysis library oseti for Python using Japanese evaluation polarity dictionary</a></p>
<p>I created a script that returns emotion value as a return value when I input text, and added the emotion value to the corpus dataframe as shown below.
![Screenshot 2019-12-21 17.47.05.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/5b545670-905a-d70f-d5de-(b209d68fc598.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/5b545670-905a-d70f-d5de-(b209d68fc598.png)</a></p>
<h2 id="column-description">Column description</h2>
<p>total_word_score_pair_list_abs1: Morpheme with emotion polarity value and list of emotion values
sum_positive_srore: Sum of positive values
sum_pegative_srore: Sum of negative values
new_srore_sum: Value obtained by adding positive and negative values</p>
<p>#6. Graph the transition of emotional values and compare with the contents of the novel
Let&rsquo;s make a graph of emotional values using the seaborn visualization library.
Summarize emotional values for each page and look at <strong>Time series</strong>.
The x-axis is the number of pages and the y-axis is the emotional value.
*<em><font color="Red"> <em>Maybe spoilers are included from here. be careful. </font></em></em></p>
<pre><code class="language-python:" data-lang="python:">import matplotlib.pyplot as plt
from statistics import mean, median
from matplotlib import pyplot as plt
import seaborn as sns; sns.set()
import re
%matplotlib inline

page_sum_df = df_tenki2.groupby(&quot;page_num&quot;).new_score_sum.sum().reset_index()
sns.lineplot(x=&quot;page_num&quot;, y=&quot;new_score_sum&quot;, data=page_sum_df)
</code></pre><p>The result is here!
![Screenshot 2019-12-18 22.39.29.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/d889c3a9-594a-f3aa-4a6c-(78dff7cd40b9.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/d889c3a9-594a-f3aa-4a6c-(78dff7cd40b9.png)</a></p>
<p>The emotional ups and downs are quite intense! <font color="OrangeRed">Positive</font> and <font color="Blue">Negative</font> appear alternately.
What you can read from this graph</p>
<ul>
<li>Each page clearly shows positive and negative as undulations</li>
<li>Some pages have extremely high positive and negative values</li>
<li>Emotional value is changing depending on story and development (may)
However, in the graph, the undulations are very detailed and the features are a bit difficult to understand&hellip;In order to grasp a little more rough feature, I will replace the ** page unit of the x-axis from the chapter unit ** and add up.</li>
</ul>
<pre><code class="language-python:" data-lang="python:">chapter_sum_df = df_tenki2.groupby(&quot;chapter_flag&quot;).new_score_sum.sum().reset_index()
sns.lineplot(x=&quot;chapter_flag&quot;, y=&quot;new_score_sum&quot;, data=chapter_sum_df)
</code></pre><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/59a94e1f-83f6-9e14-b1ae-54ac252d4f30.png" alt="Screenshot 2019-12-18 22.43.30.png"></p>
<h2 id="what-can-be-read-from-the-graph">What can be read from the graph</h2>
<ul>
<li>Capturing features in a chapter-wide way rather than page-based</li>
<li>Each chapter has a large ups and downs of emotional value, and the emotional value tends to be large and positive in the chapter immediately after the emotional value falls.</li>
<li>Looking at each chapter, there are no chapters with negative emotional values</li>
</ul>
<p>It&rsquo;s easier to understand and interpret the emotional ups and downs than before!</p>
<p>But&hellip;
Pay attention to the value on the y-axis of the graph.
There are almost no <font color="Blue">negative </font> values.
I think people who watched movies and novels felt strange.</p>
<p><strong>&ldquo;Isn&rsquo;t the weather boy such a peace-blurred work&hellip;?&quot;</strong></p>
<p>So let&rsquo;s take a step further and analyze it.
Next, the emotional value is divided into two parts, <font color="OrangeRed">positive value</font> and <font color="Blue">negative value</font>**, not the total value** Draw the graph.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">chapter_sum_df <span style="color:#f92672">=</span> df_tenki2<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#34;chapter_flag&#34;</span>)<span style="color:#f92672">.</span>sum_positive_scores<span style="color:#f92672">.</span>sum()<span style="color:#f92672">.</span>reset_index()
sns<span style="color:#f92672">.</span>lineplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;chapter_flag&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sum_positive_scores&#34;</span>, data<span style="color:#f92672">=</span>chapter_sum_df,color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;red&#34;</span>)
chapter_sum_df2 <span style="color:#f92672">=</span> df_tenki2<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#34;chapter_flag&#34;</span>)<span style="color:#f92672">.</span>sum_negative_scores<span style="color:#f92672">.</span>sum()<span style="color:#f92672">.</span>reset_index()
sns<span style="color:#f92672">.</span>lineplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;chapter_flag&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sum_negative_scores&#34;</span>, data<span style="color:#f92672">=</span>chapter_sum_df2,color<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;blue&#34;</span>)
</code></pre></div><p>The red graph is the transition of <font color="OrangeRed">Positive value</font>, and the blue is the transition of <font color="Blue">Negative value</font>.
![Screenshot 2019-12-19 11.23.04.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/ca6b7ca5-911c-e138-026d-(0aa00a44d85e.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/ca6b7ca5-911c-e138-026d-(0aa00a44d85e.png)</a></p>
<p>Both positive and negative features are now clearly visible!
As mentioned earlier, when the positive and negative values are summed and expressed in one graph,
** &ldquo;When both the positive and negative values were high, the values were offset and it became difficult to see the features.&rdquo; **
It seems.</p>
<p>Now, let&rsquo;s briefly consider the contents of the novel as well.</p>
<p>Looking at the whole feeling, the fluctuation range of emotional value is large in the first and second half of the story.
In chapter 2 and chapter 8 and subsequent chapters, both <font color="OrangeRed">positive value</font> and <font color="Blue">negative value</font> have remained fairly high.
Is it the &quot;&rdquo;&rdquo;&rdquo; part and the &quot;&rdquo;&rdquo; part of the &ldquo;initiated&rdquo; ** part of what is referred to as &ldquo;introduction&rdquo;?</p>
<p>Next, let&rsquo;s look at the magnitude of the value.</p>
<p>From this graph, you can see that chapter8 and chapter10 have the largest <font color="OrangeRed">positive value</font> and chapter2 the most <font color="Blue">negative</font>.</p>
<h2 id="chapter8">chapter8</h2>
<p>chapter8 is a relatively peaceful scene.
In order to play together in the park, and to confess <strong>Honaka</strong> to <strong>Hina</strong>, consult with Haruna&rsquo;s younger brother <strong>Nagi</strong> or buy a ring. I&rsquo;m about to go. No wonder why <font color="OrangeRed">positive value</font> is high.</p>
<h2 id="chapter10">chapter10</h2>
<p>chapter10 is the climax of the story.
This is the scene where &ldquo;Hotaka&rdquo; ** struggles to help ** Haruna **. Not only <font color="OrangeRed">Positive value</font> but also <font color="Blue">Negative value</font> are high, so the feeling of <strong>&ldquo;Sail height&rdquo;</strong> is intense. I can imagine that</p>
<h2 id="chapter2">chapter2</h2>
<p>chapter2 is the beginning of the story.
&ldquo;Hotaka,&rdquo; who left home, came to Tokyo and tried to find a part-time job, but was struck by the waves of the city and finally visited the &ldquo;Suga&rdquo; office to work. Does the <font color="Blue">negative value</font> appear where you are being rubbed by the waves of the city or being scolded by <strong>&ldquo;Suga&rdquo;</strong>?</p>
<p>#7. Compare emotional values for each character
From here, I will compare the emotional values for each character.
Let&rsquo;s calculate the average emotional value per sentence of each character.</p>
<h3 id="how-to-calculate-the-average-value">How to calculate the average value</h3>
<p>** Total emotional value of each character&rsquo;s lines / Number of lines of each character **</p>
<p>This time, let&rsquo;s compare four people, the main characters ** &ldquo;Hotaka&rdquo; **, ** &ldquo;Hina&rdquo; **, ** &ldquo;Suga&rdquo; **, ** &ldquo;Natsumi&rdquo; **.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_tenki3<span style="color:#f92672">=</span>df_tenki2<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74">&#39;speaker_name&#39;</span>])[<span style="color:#e6db74">&#39;new_score_sum&#39;</span>]<span style="color:#f92672">.</span>mean()<span style="color:#f92672">.</span>reset_index()
df_tenki4 <span style="color:#f92672">=</span> df_tenki3<span style="color:#f92672">.</span>sort_values(<span style="color:#e6db74">&#39;new_score_sum&#39;</span>, ascending<span style="color:#f92672">=</span>False)
df_tenki_person <span style="color:#f92672">=</span> df_tenki4[(df_tenki4[<span style="color:#e6db74">&#34;speaker_name&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;suga&#34;</span>) <span style="color:#f92672">|</span> (df_tenki4[<span style="color:#e6db74">&#34;speaker_name&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;hodaka&#34;</span>) <span style="color:#f92672">|</span> (df_tenki4[<span style="color:#e6db74">&#34;speaker_name&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;natsumi&#34;</span>) <span style="color:#f92672">|</span> (df_tenki4[<span style="color:#e6db74">&#34; speaker_name&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;hina&#34;</span>)]
sns<span style="color:#f92672">.</span>catplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;speaker_name&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;new_score_sum&#34;</span>, data<span style="color:#f92672">=</span>df_tenki_person,height<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>,kind<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bar&#34;</span>,palette<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;muted&#34;</span>)
</code></pre></div><p>![Screenshot 2019-12-21 15.56.58.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/189e3a1a-b37f-8663-ff88-(edbb3b539bb7.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/189e3a1a-b37f-8663-ff88-(edbb3b539bb7.png)</a></p>
<p>The positive negative was clearly divided between men and women.</p>
<p>The women are really <font color="OrangeRed">Positive</font>!
On the other hand, the two men are quite <font color="Blue">negative</font>.</p>
<p>Both of them are quite close.
In fact, even in the novel, the protagonists Hotaka and Suga</p>
<p><strong>&ldquo;These two are very similar&rdquo;</strong></p>
<p>There is a depiction that is said from the surroundings, but you can see that it is similar in terms of emotional value.</p>
<p>Let&rsquo;s also look at <font color="OrangeRed">positive values</font> and <font color="Blue">negative values</font>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">df_tenki3<span style="color:#f92672">=</span>df_tenki2<span style="color:#f92672">.</span>groupby([<span style="color:#e6db74">&#39;speaker_name&#39;</span>])[<span style="color:#e6db74">&#39;sum_positive_scores&#39;</span>,<span style="color:#e6db74">&#39;sum_negative_scores&#39;</span>]<span style="color:#f92672">.</span>mean()<span style="color:#f92672">.</span>reset_index()
df_tenki4 <span style="color:#f92672">=</span> df_tenki3<span style="color:#f92672">.</span>sort_values(<span style="color:#e6db74">&#39;sum_positive_scores&#39;</span>, ascending<span style="color:#f92672">=</span>False)<span style="color:#f92672">.</span>reset_index()
df_tenki_person2 <span style="color:#f92672">=</span> df_tenki4[(df_tenki4[<span style="color:#e6db74">&#34;speaker_name&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;suga&#34;</span>) <span style="color:#f92672">|</span> (df_tenki4[<span style="color:#e6db74">&#34;speaker_name&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;hodaka&#34;</span>) <span style="color:#f92672">|</span> (df_tenki4[<span style="color:#e6db74">&#34;speaker_name&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;natsumi&#34;</span>) <span style="color:#f92672">|</span> (df_tenki4[<span style="color:#e6db74">&#34; speaker_name&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;hina&#34;</span>)]
sns<span style="color:#f92672">.</span>catplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;speaker_name&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sum_positive_scores&#34;</span>, data<span style="color:#f92672">=</span>df_tenki_person2,kind<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bar&#34;</span>,palette<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;muted&#34;</span>)
sns<span style="color:#f92672">.</span>catplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;speaker_name&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sum_negative_scores&#34;</span>, data<span style="color:#f92672">=</span>df_tenki_person2,kind<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bar&#34;</span>,palette<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;muted&#34;</span>)
</code></pre></div><p>![Screenshot 2019-12-21 16.29.50.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/e6430c77-8717-cbc5-572e-(307c7131640e.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/e6430c77-8717-cbc5-572e-(307c7131640e.png)</a></p>
<p><strong>&ldquo;Hina&rdquo;</strong> seems to have hardly spoken the <font color="Blue">negative</font> words compared to the three people. What a strong girl&hellip;
<strong>&ldquo;Natsumi&rdquo;</strong> has the highest <font color="OrangeRed">positive value</font>, but the <font color="Blue">negative value</font> is also high.
<strong>&ldquo;Natsumi&rdquo;</strong> is usually quite bright, but there are various words such as <font color="Blue">negative</font> such as self-loathing because of job hunting and complaints to Suga. I have the impression that he is talking.
And the <font color="OrangeRed">positive value</font> of <strong>&ldquo;Sail height&rdquo;</strong> is quite low. Certainly, I don&rsquo;t have a bright impression&hellip;
But if the <font color="OrangeRed">Positive</font> of **&ldquo;Hina&rdquo; pulls us, these two may be a good combination (?).</p>
<p>#8. Is there a relationship between weather and emotional value?
Finally, let&rsquo;s examine the relationship between emotional values and <font color="Red">&quot;weather&quot;</font>, which is the key to this story.
As with the characters, the method is to calculate the average value for each weather scene.
The types of weather are classified into the following 6 categories based on the description when creating the corpus.&ldquo;Sunny,&rdquo; &ldquo;rain,&rdquo; &ldquo;light rain,&rdquo; &ldquo;heavy rain,&rdquo; &ldquo;clear,&rdquo; &ldquo;snow.&rdquo;
Since there are three types of rain intensity, you can see the relationship between rain intensity and emotional value.
By the way, except for when the heroine&rsquo;s &ldquo;Hina&rdquo; ** wishes for fine weather and <strong>when something happens</strong>, the story stage (Tokyo) is basically &ldquo;rain&rdquo; in the story setting. Is the state.
Because of the daily rain, everyone in the city wants to be sunny.</p>
<h2 id="hypothesis">Hypothesis</h2>
<p>**As a hypothesis, it is possible that a sunny scene will become large <font color="OrangeRed">positive</font>, and the stronger the rain, the more it becomes <font color="Blue">negative</font>. ? **</p>
<p>I expected it.
Let&rsquo;s see the result!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">sns<span style="color:#f92672">.</span>catplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;weather_flag&#34;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;new_score_sum&#34;</span>, data<span style="color:#f92672">=</span>df_tenki2_edited,height<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>,kind<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bar&#34;</span>,palette<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;muted&#34;</span>)
</code></pre></div><p>![Screenshot 2019-12-21 15.50.09.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/3c5492fb-d8eb-c584-ebb3-(eeeb4919b05d.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/546087/3c5492fb-d8eb-c584-ebb3-(eeeb4919b05d.png)</a></p>
<p>After all, fine weather is the most <font color="OrangeRed">positive</font>! It is predictable!
It seems that the intensity of rain is not so relevant.
However, although &ldquo;clear&rdquo; is very positive, &ldquo;clear&rdquo; does not change to <font color="OrangeRed">positive</font>. Why&hellip;?
As mentioned above, the weather is clear only when Harina wishes for fine weather and **when something happens, but what is **that&hellip;..
so,</p>
<p><font color="Red">&quot;Hina has disappeared&quot;</font></p>
<p>With the disappearance of Haruna, the city, which had been raining until now, becomes clear at once.
However, the general public, who does not know that &ldquo;Hina&rdquo; has been sacrificed, is very pleased with the sunny weather.
However, only the protagonist <strong>&ldquo;Hatsutaka&rdquo;</strong> knows this and is very sad. It&rsquo;s supposed to be the best weather in the story, but here the feeling of <strong>&ldquo;Hotaka&rdquo;</strong> goes in the opposite direction to the world. So even though it&rsquo;s sunny, it doesn&rsquo;t become very positive.</p>
<p>Finally, regarding snow, this is the most <font color="Blue">negative</font>. If you&rsquo;ve ever seen a movie, it&rsquo;s a perfect fit.
This is a climax scene where <strong>&ldquo;Hotaka&rdquo;</strong> and <strong>&ldquo;Hina&rdquo;</strong> escape from the police and escape to a love hotel.
Due to the extremely abnormal weather that it snows even in August, the world and sail heights are confused, and it is a scene with a lot of <font color="Blue">negative</font> expressions.</p>
<p>#9. Conclusion
What I found by doing a sentiment analysis of a novel</p>
<ul>
<li>You can read the development of the story and the turning point of the succession</li>
<li>You can roughly judge the character of the character from the positive negative value</li>
<li>The transition of emotional values for each time series can be easily interpreted if divided into positive values and negative values in chapter units
And this time, I tried to find out the relation between the weather and the emotional value, which is the easiest to understand, but it seems that interesting results will come out when I examine the relation with other factors.
If you have an idea like &ldquo;It would be interesting to do this analysis!&rdquo;, I would appreciate it if you could comment.</li>
</ul>
<p>#10. Challenge</p>
<h2 id="wide-range-of-novel-expressions">Wide range of novel expressions</h2>
<p>Of course, I was prepared, but the range of novel expressions was wider than I expected, and it was difficult to give a positive negative to each word.
In the last scene, there is a line where <strong>&ldquo;Hotaka&rdquo;</strong> shouts, &ldquo;The weather can be crazy&rdquo;, but it is the strongest <font color="OrangeRed">Positive</font> in the story. It is a scene, but if you take it exactly as you say it will be negative.
There is a limit in just giving emotional values in units of words, and this is a very difficult place.</p>
<p>#11.code</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Function to import emotional polarity dictionary</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_make_dict</span>():
    
    <span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
    
    df_word_dict <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;./dict/edited_target_pair_list_word_out.csv&#39;</span>)<span style="color:#75715e">#noun</span>
    df_wago_dict <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;./dict/edited_target_pair_list_wago_out.csv&#39;</span>)<span style="color:#75715e">#</span>
    df_one_gram_dict <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;./dict/one_gram_dict_out.csv&#39;</span>)<span style="color:#75715e">#Multiple words</span>

    word_dict <span style="color:#f92672">=</span> {}
    <span style="color:#66d9ef">for</span> pair_list <span style="color:#f92672">in</span> df_word_dict[[<span style="color:#e6db74">&#39;word&#39;</span>,<span style="color:#e6db74">&#39;count&#39;</span>]]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>tolist():
        <span style="color:#66d9ef">if</span> pair_list[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;0&#39;</span>:
            word_dict[pair_list[<span style="color:#ae81ff">0</span>]] <span style="color:#f92672">=</span> pair_list[<span style="color:#ae81ff">1</span>]

    wago_dict <span style="color:#f92672">=</span> {}
    <span style="color:#66d9ef">for</span> pair_list <span style="color:#f92672">in</span> df_wago_dict[[<span style="color:#e6db74">&#39;word&#39;</span>,<span style="color:#e6db74">&#39;count&#39;</span>]]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>tolist():
        <span style="color:#66d9ef">if</span> pair_list[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;0&#39;</span>:
            wago_dict[pair_list[<span style="color:#ae81ff">0</span>]] <span style="color:#f92672">=</span> pair_list[<span style="color:#ae81ff">1</span>]

    one_gram_dict <span style="color:#f92672">=</span> {}
    <span style="color:#66d9ef">for</span> pair_list <span style="color:#f92672">in</span> df_one_gram_dict[[<span style="color:#e6db74">&#39;word1&#39;</span>,<span style="color:#e6db74">&#39;word2&#39;</span>,<span style="color:#e6db74">&#39;score&#39;</span>]]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>tolist():
        one_gram_dict[(str(pair_list[<span style="color:#ae81ff">0</span>]),str(pair_list[<span style="color:#ae81ff">1</span>]))] <span style="color:#f92672">=</span> pair_list[<span style="color:#ae81ff">2</span>]
    
    <span style="color:#66d9ef">return</span> word_dict,wago_dict,one_gram_dict

<span style="color:#75715e"># Function that splits text by sentence</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_split_per_sentence</span>(text):
    <span style="color:#f92672">import</span> re
    re_delimiter <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>compile(<span style="color:#e6db74">&#34;[.,.!\?!?]]&#34;</span>)
    <span style="color:#66d9ef">for</span> sentence <span style="color:#f92672">in</span> re_delimiter<span style="color:#f92672">.</span>split(text):
        <span style="color:#66d9ef">if</span> sentence <span style="color:#f92672">and</span> <span style="color:#f92672">not</span> re_delimiter<span style="color:#f92672">.</span>match(sentence):
            <span style="color:#66d9ef">yield</span> sentence

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_sorted_second_list</span>(polarities_and_lemmanum):
    <span style="color:#f92672">from</span> operator <span style="color:#f92672">import</span> item getter

    sorted_polarities_and_lemmanum<span style="color:#f92672">=</span>sorted(polarities_and_lemmanum, key<span style="color:#f92672">=</span>itemgetter(<span style="color:#ae81ff">1</span>))
    <span style="color:#66d9ef">return</span> [i[<span style="color:#ae81ff">0</span>] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> sorted_polarities_and_lemmanum]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_calc_sentiment_polarity</span>(sentence):
        <span style="color:#f92672">import</span> MeCab
        word_dict,wago_dict,one_gram_dict <span style="color:#f92672">=</span> _make_dict()

        NEGATION <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#39;No&#39;</span>,<span style="color:#e6db74">&#39;Zu&#39;</span>,<span style="color:#e6db74">&#39;Nu&#39;</span>,<span style="color:#e6db74">&#39;N&#39;</span>)
        tagger <span style="color:#f92672">=</span> MeCab<span style="color:#f92672">.</span>Tagger(<span style="color:#e6db74">&#39;-Owakati -d /usr/local/lib/mecab/dic/mecab-ipadic-neologd&#39;</span>)
        tagger<span style="color:#f92672">.</span>parse(<span style="color:#e6db74">&#39;&#39;</span>) <span style="color:#75715e"># for avoiding bug</span>
        word_polarities <span style="color:#f92672">=</span> [] <span style="color:#75715e"># list of emotion values corresponding to word_dict</span>
        wago_polarities <span style="color:#f92672">=</span> [] <span style="color:#75715e"># list of emotion values corresponding to wago_dict</span>
        polarities_and_lemmanum <span style="color:#f92672">=</span> [] <span style="color:#75715e"># list of final emotional values and lemmanum</span>
        lemmas <span style="color:#f92672">=</span> [] <span style="color:#75715e"># Headwords, dictionary words</span>
        word_polarity_apeared <span style="color:#f92672">=</span> False
        wago_polarity_apeared <span style="color:#f92672">=</span> False
        
        word_nutoral_polarity_apeared <span style="color:#f92672">=</span> False
        wago_nutoral_polarity_apeared <span style="color:#f92672">=</span> False
        
        word_out_polarity_apeared <span style="color:#f92672">=</span> False
        wago_out_polarity_apeared <span style="color:#f92672">=</span> False
        
        word_polarity_word <span style="color:#f92672">=</span> <span style="color:#e6db74">``</span> <span style="color:#75715e"># Provisional for error handling</span>
        wago_polarity_word <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span> <span style="color:#75715e"># Provisional for error handling</span>
        
        word_nutoral_word <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>
        wago_nutoral_word <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>
        
        word_out_polarity_word <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>
        wago_out_polarity_word <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>
        
        last_hinsi <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>
        last_word <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>
        
        node <span style="color:#f92672">=</span> tagger<span style="color:#f92672">.</span>parseToNode(sentence)
        word_score_pair_list <span style="color:#f92672">=</span> []
        lemma_num <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span> <span style="color:#75715e">#for writing down word order</span>
        lemma_dict <span style="color:#f92672">=</span> {}
        <span style="color:#66d9ef">while</span> node:
            <span style="color:#66d9ef">if</span><span style="color:#e6db74">&#39;BOS/EOS&#39;</span> <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> node<span style="color:#f92672">.</span>feature:
 
                surface <span style="color:#f92672">=</span> node<span style="color:#f92672">.</span>surface
                feature <span style="color:#f92672">=</span> node<span style="color:#f92672">.</span>feature<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;,&#39;</span>)
                lemma <span style="color:#f92672">=</span> feature[<span style="color:#ae81ff">6</span>] <span style="color:#66d9ef">if</span> feature[<span style="color:#ae81ff">6</span>] <span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;*&#39;</span> <span style="color:#66d9ef">else</span> node<span style="color:#f92672">.</span>surface
                lemma_num <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
                lemma_dict[lemma] <span style="color:#f92672">=</span> lemma_num
                <span style="color:#75715e">#Processing of lemma for dictionaries of words in dictionary format</span>
                <span style="color:#75715e">#Processing when the word is in word_dictif word_polarity_apeared and (feature[0] not in [&#39;auxiliary verb&#39;,&#39;particle&#39;]] and last_hinsi not in [&#39;auxiliary verb&#39;,&#39;particle&#39;] and last_word not in [&#39;al&#39;,&#39;oru&#39;,&#39;ru&#39;]) and last_word not in word_dict:</span>
                    word_polarity_apeared <span style="color:#f92672">=</span> False
                <span style="color:#66d9ef">elif</span> wago_polarity_apeared <span style="color:#f92672">and</span> (feature[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;auxiliary verb&#39;</span>,<span style="color:#e6db74">&#39;particle&#39;</span>]] <span style="color:#f92672">and</span> last_hinsi <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;auxiliary verb&#39;</span>,<span style="color:#e6db74">&#39;particle&#39;</span>] <span style="color:#f92672">and</span> last_word <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;Aru&#39;</span>,<span style="color:#e6db74">&#39;Oru&#39;</span>,<span style="color:#e6db74">&#39;Suru&#39;</span>]) <span style="color:#f92672">and</span> last_word <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> wago_dict:
                    wago_polarity_apeared <span style="color:#f92672">=</span> False
                <span style="color:#66d9ef">elif</span> word_nutoral_polarity_apeared <span style="color:#f92672">and</span> (feature[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;auxiliary verb&#39;</span>,<span style="color:#e6db74">&#39;particle&#39;</span>]] <span style="color:#f92672">and</span> last_hinsi <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;auxiliary verb&#39;</span>,<span style="color:#e6db74">&#39;particle&#39;</span>] <span style="color:#f92672">and</span> last_word <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;alu&#39;</span>,<span style="color:#e6db74">&#39;ol&#39;</span>,<span style="color:#e6db74">&#39;ru&#39;</span>]] <span style="color:#f92672">and</span> last_word <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> word_dict:
                    word_nutoral_polarity_apeared <span style="color:#f92672">=</span> False
                <span style="color:#66d9ef">elif</span> wago_nutoral_polarity_apeared <span style="color:#f92672">and</span> (feature[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;Auxiliary verb&#39;</span>,<span style="color:#e6db74">&#39;Adjective&#39;</span>]] <span style="color:#f92672">and</span> last_hinsi <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;Auxiliary verb&#39;</span>,<span style="color:#e6db74">&#39;Adjective&#39;</span>] <span style="color:#f92672">and</span> last_word <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;Aru&#39;</span>,<span style="color:#e6db74">&#39;Oru&#39;</span>,<span style="color:#e6db74">&#39;Suru&#39;</span>]) <span style="color:#f92672">and</span> last_word <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> wago_dict:
                    wago_nutoral_polarity_apeared <span style="color:#f92672">=</span> False

                    
                <span style="color:#66d9ef">try</span>:
                    <span style="color:#66d9ef">if</span> word_dict[lemma] <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;p&#39;</span>,<span style="color:#e6db74">&#39;n&#39;</span>]:
                        polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> word_dict[lemma] <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;p&#39;</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
                        word_polarities<span style="color:#f92672">.</span>append([polarity,lemma_dict[lemma]])
                        word_polarity_apeared <span style="color:#f92672">=</span> True
                        word_polarity_word <span style="color:#f92672">=</span> lemma
                    <span style="color:#66d9ef">elif</span> word_dict[lemma] <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;f&#39;</span>:
                        word_polarities<span style="color:#f92672">.</span>append([<span style="color:#ae81ff">0</span>,lemma_dict[lemma]])
                        word_nutoral_polarity_apeared <span style="color:#f92672">=</span> True
                        word_nutoral_word <span style="color:#f92672">=</span> lemma
                        polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                        Since <span style="color:#ae81ff">0</span> <span style="color:#f92672">is</span> deleted <span style="color:#f92672">in</span> advance <span style="color:#f92672">in</span> <span style="color:#75715e">#word_dict, the processing of else is unnecessary, but leave it in consideration of readability.</span>
                    <span style="color:#66d9ef">else</span>:
                        polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                When there are no words <span style="color:#f92672">in</span> <span style="color:#75715e">#word_dict</span>
                <span style="color:#66d9ef">except</span>:
                    When there <span style="color:#f92672">is</span> a word <span style="color:#f92672">in</span> <span style="color:#75715e">#wago_dict</span>
                    <span style="color:#66d9ef">try</span>:
                        <span style="color:#66d9ef">if</span> wago_dict[lemma] <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;Positive (Experience)&#39;</span>,<span style="color:#e6db74">&#39;Negative (Experience)&#39;</span>,<span style="color:#e6db74">&#39;Positive (Evaluation)&#39;</span>,<span style="color:#e6db74">&#39;Negative (Evaluation)&#39;</span>]:
                            polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> wago_dict[lemma] <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;Positive (Experience)&#39;</span>,<span style="color:#e6db74">&#39;Positive (Evaluation)&#39;</span>] <span style="color:#66d9ef">else</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
<span style="color:#75715e"># print(polarity)</span>
                            wago_polarities<span style="color:#f92672">.</span>append([polarity,lemma_dict[lemma]])
                            wago_polarity_apeared <span style="color:#f92672">=</span> True
                            wago_polarity_word <span style="color:#f92672">=</span> lemma
                        <span style="color:#66d9ef">elif</span> wago_dict[lemma] <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;Neutral&#39;</span>:
                            wago_polarities<span style="color:#f92672">.</span>append([<span style="color:#ae81ff">0</span>,lemma_dict[lemma]])
                            wago_nutoral_polarity_apeared <span style="color:#f92672">=</span> True
                            wago_nutoral_word <span style="color:#f92672">=</span> lemma
                            polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                        <span style="color:#66d9ef">else</span>:
                            polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                     Processing when there <span style="color:#f92672">is</span> no word <span style="color:#f92672">in</span> <span style="color:#75715e">#word_dict or wago_dict</span>
                    <span style="color:#66d9ef">except</span>:
                        <span style="color:#66d9ef">if</span> word_polarity_apeared <span style="color:#f92672">and</span> surface <span style="color:#f92672">in</span> NEGATION <span style="color:#f92672">and</span> wago_nutoral_polarity_apeared <span style="color:#f92672">is</span> False:

                            <span style="color:#66d9ef">if</span> last_hinsi <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;noun&#39;</span>,<span style="color:#e6db74">&#39;particle&#39;</span>,<span style="color:#e6db74">&#39;auxiliary verb&#39;</span>,<span style="color:#e6db74">&#39;verb&#39;</span>,<span style="color:#e6db74">&#39;adjective&#39;</span>]:

                                word_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
                                <span style="color:#66d9ef">try</span>:
                                    reverse_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> reversed(word_score_pair_list)]<span style="color:#f92672">.</span>index([word_polarity_word,<span style="color:#ae81ff">1</span>])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
                                <span style="color:#66d9ef">except</span>:
                                    reverse_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> reversed(word_score_pair_list)]<span style="color:#f92672">.</span>index([word_polarity_word,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
                                <span style="color:#66d9ef">finally</span>:

                                    word_score_pair_list[reverse_num]<span style="color:#f92672">=</span>[word_polarity_word<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;+&#39;</span><span style="color:#f92672">+</span>lemma,word_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]]
                                    word_polarity_apeared <span style="color:#f92672">=</span> False
                                    word_polarity_word <span style="color:#f92672">=</span> <span style="color:#e6db74">``</span>
                                    polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                            <span style="color:#66d9ef">else</span>:
                                polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                        <span style="color:#75715e">#Processing to set &#34;Please fix&#34; and &#34;Please improve&#34; to -1</span>
                        <span style="color:#66d9ef">elif</span> lemma <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;Give me&#39;</span>,<span style="color:#e6db74">&#39;I want&#39;</span>,<span style="color:#e6db74">&#39;hope&#39;</span>]:
                            
                            <span style="color:#66d9ef">try</span>:
                                <span style="color:#66d9ef">if</span> word_polarity_word <span style="color:#f92672">or</span> word_nutoral_word <span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;&#39;</span>:
                                    last_polarities_word <span style="color:#f92672">=</span> [i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> [word_polarity_word,word_nutoral_word] <span style="color:#66d9ef">if</span> i <span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;&#39;</span>][<span style="color:#ae81ff">0</span>]
                                    <span style="color:#66d9ef">try</span>:
                                        reverse_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> reversed(word_score_pair_list)]<span style="color:#f92672">.</span>index([last_polarities_word,word_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
                                    <span style="color:#66d9ef">except</span>:
                                        reverse_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> reversed(word_score_pair_list)]<span style="color:#f92672">.</span>index([last_polarities_word,word_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
                                    <span style="color:#66d9ef">finally</span>:
                                        word_score_pair_list[reverse_num]<span style="color:#f92672">=</span>[last_polarities_word<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;+&#39;</span><span style="color:#f92672">+</span>surface,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#75715e"># give emotion value -1</span>
                                        word_polarity_apeared <span style="color:#f92672">=</span> False
                                        word_polarity_word <span style="color:#f92672">=</span> <span style="color:#e6db74">``</span>
                                        word_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
                                        polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#66d9ef">elif</span> wago_polarity_word <span style="color:#f92672">or</span> wago_nutoral_word <span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;&#39;</span>:
                                    last_polarities_word <span style="color:#f92672">=</span> [i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> [wago_polarity_word,wago_nutoral_word] <span style="color:#66d9ef">if</span> i <span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;&#39;</span>][<span style="color:#ae81ff">0</span>]
                                    <span style="color:#66d9ef">try</span>:
                                        reverse_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> reversed(word_score_pair_list)]<span style="color:#f92672">.</span>index([last_polarities_word,wago_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
                                    <span style="color:#66d9ef">except</span>:
                                        reverse_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> reversed(word_score_pair_list)]<span style="color:#f92672">.</span>index([last_polarities_word,wago_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
                                    <span style="color:#66d9ef">finally</span>:
                                        word_score_pair_list[reverse_num]<span style="color:#f92672">=</span>[last_polarities_word<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;+&#39;</span><span style="color:#f92672">+</span>surface,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#75715e">#感情値-1を付与</span>
                                        wago_polarity_apeared <span style="color:#f92672">=</span> False
                                        wago_polarity_word <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
                                        wago_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
                                        polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                            <span style="color:#66d9ef">except</span>:
                                polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                                <span style="color:#75715e">#文末に「か」があったとき-1にする処理</span>
                        <span style="color:#66d9ef">elif</span> last_hinsi <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;助動詞&#39;</span>,<span style="color:#e6db74">&#39;助詞&#39;</span>] <span style="color:#f92672">and</span> lemma <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;か&#39;</span>:
                            
                            <span style="color:#66d9ef">try</span>:
                                <span style="color:#66d9ef">if</span> word_polarity_word <span style="color:#f92672">or</span> word_nutoral_word <span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;&#39;</span>:
                                    last_polarities_word <span style="color:#f92672">=</span> [i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> [word_polarity_word,word_nutoral_word] <span style="color:#66d9ef">if</span> i <span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;&#39;</span>][<span style="color:#ae81ff">0</span>]
                                    <span style="color:#66d9ef">try</span>:
                                        reverse_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> reversed(word_score_pair_list)]<span style="color:#f92672">.</span>index([last_polarities_word,word_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
                                    <span style="color:#66d9ef">except</span>:
                                        reverse_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> reversed(word_score_pair_list)]<span style="color:#f92672">.</span>index([last_polarities_word,word_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
                                    <span style="color:#66d9ef">finally</span>:
                                        word_score_pair_list[reverse_num]<span style="color:#f92672">=</span>[last_polarities_word<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;+&#39;</span><span style="color:#f92672">+</span>surface,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#75715e">#感情値-1を付与</span>
                                        word_polarity_apeared <span style="color:#f92672">=</span> False
                                        word_polarity_word <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
                                        word_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
                                        polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                                    
                                <span style="color:#66d9ef">elif</span> wago_polarity_word <span style="color:#f92672">or</span> wago_nutoral_word <span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;&#39;</span>:
                                    last_polarities_word <span style="color:#f92672">=</span> [i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> [wago_polarity_word,wago_nutoral_word] <span style="color:#66d9ef">if</span> i <span style="color:#f92672">!=</span><span style="color:#e6db74">&#39;&#39;</span>][<span style="color:#ae81ff">0</span>]
                                    <span style="color:#66d9ef">try</span>:
                                        reverse_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> reversed(word_score_pair_list)]<span style="color:#f92672">.</span>index([last_polarities_word,wago_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
                                    <span style="color:#66d9ef">except</span>:
                                        reverse_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> reversed(word_score_pair_list)]<span style="color:#f92672">.</span>index([last_polarities_word,wago_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
                                    <span style="color:#66d9ef">finally</span>:
                                        word_score_pair_list[reverse_num]<span style="color:#f92672">=</span>[last_polarities_word<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;+&#39;</span><span style="color:#f92672">+</span>surface,<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#75715e">#感情値-1を付与</span>
                                        wago_polarity_apeared <span style="color:#f92672">=</span> False
                                        wago_polarity_word <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
                                        wago_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
                                        polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                            <span style="color:#66d9ef">except</span>:
                                polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                            
                        <span style="color:#66d9ef">elif</span> word_nutoral_polarity_apeared:

                            <span style="color:#66d9ef">if</span> last_hinsi <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;名詞&#39;</span>,<span style="color:#e6db74">&#39;助詞&#39;</span>,<span style="color:#e6db74">&#39;助動詞&#39;</span>,<span style="color:#e6db74">&#39;動詞&#39;</span>] <span style="color:#f92672">and</span> lemma <span style="color:#f92672">in</span> NEGATION:
                                lemma_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;否定&#39;</span>
                                <span style="color:#66d9ef">try</span>:
                                    word_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+=</span> one_gram_dict[(word_nutoral_word,lemma_type)]
                                    reverse_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> reversed(word_score_pair_list)]<span style="color:#f92672">.</span>index([word_nutoral_word,<span style="color:#ae81ff">0</span>])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
                                    word_score_pair_list[reverse_num]<span style="color:#f92672">=</span>[word_nutoral_word<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;+&#39;</span><span style="color:#f92672">+</span>lemma,one_gram_dict[(word_nutoral_word,lemma)]]
                                    word_nutoral_polarity_apeared <span style="color:#f92672">=</span> False
                                    word_nutoral_word <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
                                <span style="color:#66d9ef">except</span>:
                                    polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                            <span style="color:#66d9ef">elif</span> last_hinsi <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;名詞&#39;</span>,<span style="color:#e6db74">&#39;助詞&#39;</span>,<span style="color:#e6db74">&#39;助動詞&#39;</span>,<span style="color:#e6db74">&#39;動詞&#39;</span>] <span style="color:#f92672">and</span> lemma <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> NEGATION:
                                <span style="color:#66d9ef">try</span>:
                                    word_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+=</span> one_gram_dict[(word_nutoral_word,lemma)]
                                    reverse_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> reversed(word_score_pair_list)]<span style="color:#f92672">.</span>index([word_nutoral_word,<span style="color:#ae81ff">0</span>])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
                                    word_score_pair_list[reverse_num]<span style="color:#f92672">=</span>[word_nutoral_word<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;+&#39;</span><span style="color:#f92672">+</span>lemma,one_gram_dict[(word_nutoral_word,lemma)]]
                                    word_nutoral_polarity_apeared <span style="color:#f92672">=</span> False
                                    word_nutoral_word <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span><span style="color:#66d9ef">except</span>:
                                    polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                    <span style="color:#75715e">#Processing when the word is not in word_dict</span>
                        <span style="color:#66d9ef">else</span>:
                        <span style="color:#75715e">#If the word is not&#39;,&#39;zu&#39;, or&#39;nu&#39;, reverse the polarity of the previous word</span>
                            <span style="color:#66d9ef">if</span> wago_polarity_apeared <span style="color:#f92672">and</span> surface <span style="color:#f92672">in</span> NEGATION <span style="color:#f92672">and</span> wago_nutoral_polarity_apeared <span style="color:#f92672">is</span> False\
                            <span style="color:#f92672">and</span> word_polarity_apeared <span style="color:#f92672">is</span> False <span style="color:#f92672">and</span> word_nutoral_polarity_apeared <span style="color:#f92672">is</span> False:

                                <span style="color:#66d9ef">if</span> last_hinsi <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;noun&#39;</span>,<span style="color:#e6db74">&#39;adjective&#39;</span>,<span style="color:#e6db74">&#39;auxiliary verb&#39;</span>]:

                                    wago_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">*=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
                                    reverse_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> reversed(word_score_pair_list)]<span style="color:#f92672">.</span>index([wago_polarity_word,wago_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]<span style="color:#f92672">*</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
                                    word_score_pair_list[reverse_num]<span style="color:#f92672">=</span>[wago_polarity_word<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;+&#39;</span><span style="color:#f92672">+</span>lemma,wago_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]]
                                    wago_polarity_apeared <span style="color:#f92672">=</span> False
                                    word_polarity_word <span style="color:#f92672">=</span> <span style="color:#e6db74">``</span>
                                    polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                                <span style="color:#66d9ef">else</span>:
                                    polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                            
                            <span style="color:#66d9ef">elif</span> wago_nutoral_polarity_apeared:
                                <span style="color:#75715e">#Neutral + Negative processing</span>
                                <span style="color:#66d9ef">if</span> last_hinsi <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;verb&#39;</span>,<span style="color:#e6db74">&#39;particle&#39;</span>,<span style="color:#e6db74">&#39;auxilary&#39;</span>] <span style="color:#f92672">and</span> lemma <span style="color:#f92672">in</span> NEGATION:
                                    lemma_type <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;negative&#39;</span>
                                    <span style="color:#66d9ef">try</span>:
                                        lemma_type <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;negative&#39;</span>
                                        wago_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+=</span> one_gram_dict[(wago_nutoral_word,lemma_type)]
                                        <span style="color:#75715e">#Process to trace the list backwards</span>
                                        reverse_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> reversed(word_score_pair_list)]<span style="color:#f92672">.</span>index([wago_nutoral_word,<span style="color:#ae81ff">0</span>])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
                                        word_score_pair_list[reverse_num]<span style="color:#f92672">=</span>[wago_nutoral_word<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;+&#39;</span><span style="color:#f92672">+</span>lemma,one_gram_dict[(wago_nutoral_word,lemma_type)]]
                                        wago_nutoral_polarity_apeared <span style="color:#f92672">=</span> False
                                        wago_nutoral_word <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>
                                    <span style="color:#66d9ef">except</span>:
                                        polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                                <span style="color:#75715e">#Neutral + processing other than negation</span>
                                <span style="color:#66d9ef">elif</span> last_hinsi <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;noun&#39;</span>,<span style="color:#e6db74">&#39;verb&#39;</span>,<span style="color:#e6db74">&#39;adjective&#39;</span>,<span style="color:#e6db74">&#39;particle&#39;</span>,<span style="color:#e6db74">&#39;auxiliary&#39;</span>]:
                                    <span style="color:#66d9ef">try</span>:
                                        wago_polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+=</span> one_gram_dict[(wago_nutoral_word,lemma)]
                                        <span style="color:#75715e">#Process to trace the list backwards</span>
                                        reverse_num <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>([i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> reversed(word_score_pair_list)]<span style="color:#f92672">.</span>index([wago_nutoral_word,<span style="color:#ae81ff">0</span>])<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)
                                        word_score_pair_list[reverse_num]<span style="color:#f92672">=</span>[wago_nutoral_word<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;+&#39;</span><span style="color:#f92672">+</span>lemma,one_gram_dict[(wago_nutoral_word,lemma)]]
                                        wago_nutoral_polarity_apeared <span style="color:#f92672">=</span> False
                                        wago_nutoral_word <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>
                                    <span style="color:#66d9ef">except</span>:
                                        polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                                <span style="color:#66d9ef">else</span>:
                                    polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
                            <span style="color:#66d9ef">else</span>:
                                polarity <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>

          
                word_score_pair <span style="color:#f92672">=</span> [lemma,polarity]
                word_score_pair_list<span style="color:#f92672">.</span>append(word_score_pair)

                last_hinsi <span style="color:#f92672">=</span> node<span style="color:#f92672">.</span>feature<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;,&#39;</span>)[<span style="color:#ae81ff">0</span>]
                last_word <span style="color:#f92672">=</span> lemma
            node <span style="color:#f92672">=</span> node<span style="color:#f92672">.</span>next
        <span style="color:#66d9ef">if</span> word_polarities:
            polarities_and_lemmanum<span style="color:#f92672">.</span>extend(word_polarities)
        <span style="color:#66d9ef">if</span> wago_polarities:
            polarities_and_lemmanum<span style="color:#f92672">.</span>extend(wago_polarities)
        Sort by <span style="color:#75715e">#lemma_num in ascending order</span>
        <span style="color:#66d9ef">try</span>:
            polarities <span style="color:#f92672">=</span> _sorted_second_list(polarities_and_lemmanum)
        Use only polarity values other than <span style="color:#75715e">#0. If 0 remains, an error will occur in the subsequent processing.</span>
            polarities <span style="color:#f92672">=</span> [i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> polarities <span style="color:#66d9ef">if</span> i <span style="color:#f92672">!=</span><span style="color:#ae81ff">0</span>]
        <span style="color:#66d9ef">except</span>:
            polarities <span style="color:#f92672">=</span> []
        
        <span style="color:#66d9ef">try</span>:
            <span style="color:#66d9ef">if</span> sum(polarities) <span style="color:#f92672">/</span> len(polarities) <span style="color:#f92672">==</span><span style="color:#ae81ff">0</span>:
                score <span style="color:#f92672">=</span> float(polarities[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
<span style="color:#75715e"># print(&#39;=============================================== ===&#39;)</span>
                <span style="color:#66d9ef">print</span>(sentence<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;→→ Give priority to emotion value at the end of sentence&#39;</span>)
<span style="color:#75715e"># print(&#39;=============================================== ===&#39;)</span>
                
            <span style="color:#66d9ef">else</span>:
                score <span style="color:#f92672">=</span> sum(polarities) <span style="color:#f92672">/</span> len(polarities)
        <span style="color:#66d9ef">except</span>:
                score <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> polarities:
            <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>,word_score_pair_list
        <span style="color:#66d9ef">return</span> score,sum(i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> polarities <span style="color:#66d9ef">if</span> i <span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0</span>),sum(i <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> polarities <span style="color:#66d9ef">if</span> i <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0</span>),word_score_pair_list
    
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_analyze</span>(text):
        scores,total_word_score_pair_list,positive_word_cnt_list,negative_word_cnt_list <span style="color:#f92672">=</span> [],[],[],[]
        
        <span style="color:#66d9ef">for</span> sentence <span style="color:#f92672">in</span> _split_per_sentence(text):
            <span style="color:#75715e">#Replace sentences for sentiment analysis Example: No → No</span>
            replaced_sentence <span style="color:#f92672">=</span> _emotion_replace_text(sentence)
            score,positive_word_cnt,negative_word_cnt,word_score_pair_list <span style="color:#f92672">=</span> _calc_sentiment_polarity(replaced_sentence)scores<span style="color:#f92672">.</span>append(score)
            positive_word_cnt_list<span style="color:#f92672">.</span>append(positive_word_cnt)
            negative_word_cnt_list<span style="color:#f92672">.</span>append(negative_word_cnt)
            total_word_score_pair_list<span style="color:#f92672">.</span>append(word_score_pair_list)

        <span style="color:#66d9ef">return</span> scores, positive_word_cnt_list, negative_word_cnt_list, total_word_score_pair_list

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_flatten_abs1</span>(x):
    <span style="color:#75715e">#A function that flattens a double list to make a list of only pairs with emotional values</span>
    <span style="color:#66d9ef">return</span> [e <span style="color:#66d9ef">for</span> inner_list <span style="color:#f92672">in</span> x <span style="color:#66d9ef">for</span> e <span style="color:#f92672">in</span> inner_list <span style="color:#66d9ef">if</span> e[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">!=</span><span style="color:#ae81ff">0</span>]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">score_sum_get</span>(x):
    Function that sums the emotional values generated by <span style="color:#75715e">#_flatten_abs1</span>
    emo_list<span style="color:#f92672">=</span>[]
    <span style="color:#66d9ef">for</span> inner_list <span style="color:#f92672">in</span> x:
        <span style="color:#66d9ef">for</span> e <span style="color:#f92672">in</span> inner_list:
            <span style="color:#66d9ef">if</span> e[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">!=</span><span style="color:#ae81ff">0</span>:
                emo_list<span style="color:#f92672">.</span>append(e[<span style="color:#ae81ff">1</span>])
    <span style="color:#66d9ef">return</span> sum(emo_list)


<span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime <span style="color:#66d9ef">as</span> dt
<span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> date


<span style="color:#75715e">#Read learning data</span>
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
path<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;./data/tenkinoko.csv&#39;</span>
df_tenki <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(path,encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;SHIFT-JIS&#34;</span>)
df_tenki[<span style="color:#e6db74">&#34;chapter_flag&#34;</span>] <span style="color:#f92672">=</span> df_tenki<span style="color:#f92672">.</span>chapter<span style="color:#f92672">.</span>apply(chapter_flag)

add_col_name<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;scores&#39;</span>,<span style="color:#e6db74">&#39;positive_word_cnt_list&#39;</span>,<span style="color:#e6db74">&#39;negative_word_cnt_list&#39;</span>,<span style="color:#e6db74">&#39;total_word_score_pair_list&#39;</span>]
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(add_col_name)):
    col_name<span style="color:#f92672">=</span>add_col_name[i]
    df_tenki2[col_name]<span style="color:#f92672">=</span>df_tenki2[<span style="color:#e6db74">&#39;text&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x:_analyze(x)[i])

df_tenki2[<span style="color:#e6db74">&#39;score_sum&#39;</span>]<span style="color:#f92672">=</span>df_tenki2[<span style="color:#e6db74">&#39;scores&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x:sum(x))
<span style="color:#75715e">#Count the number of positive words</span>
df_tenki2[<span style="color:#e6db74">&#39;sum_positive_scores&#39;</span>]<span style="color:#f92672">=</span>df_tenki2[<span style="color:#e6db74">&#39;positive_word_cnt_list&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x:sum(x))
<span style="color:#75715e">#Count the number of negatives in word units</span>
df_tenki2[<span style="color:#e6db74">&#39;sum_negative_scores&#39;</span>]<span style="color:#f92672">=</span>df_tenki2[<span style="color:#e6db74">&#39;negative_word_cnt_list&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x:sum(x))
<span style="color:#75715e">#Emotional polarity Processing of only [morpheme, emotional value] pairs with words</span>
df_tenki2[<span style="color:#e6db74">&#39;total_word_score_pair_list_abs1&#39;</span>]<span style="color:#f92672">=</span>df_tenki2[<span style="color:#e6db74">&#39;total_word_score_pair_list&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x:_flatten_abs1(x))

<span style="color:#75715e"># Total emotional value</span>
df_tenki2[<span style="color:#e6db74">&#39;new_score_sum&#39;</span>]<span style="color:#f92672">=</span>df_tenki2[<span style="color:#e6db74">&#39;total_word_score_pair_list&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x:score_sum_get(x))
</code></pre></div>
    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
