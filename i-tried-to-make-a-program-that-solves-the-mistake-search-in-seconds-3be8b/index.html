<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Python] I tried to make a program that solves the mistake search in seconds | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] I tried to make a program that solves the mistake search in seconds</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 14, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/image-processing"> image processing</a></code></small>


<small><code><a href="https://memotut.com/tags/opencv"> OpenCV</a></code></small>

</p>
<pre><code>[Fujitsu Systems Web Technology Advent Calendar 2019](https://qiita.com/advent-calendar/2019/fsweb) This is the 16th day post.
</code></pre>
<p>All content in the article is the personal opinion, and the content of the writing is the author&rsquo;s own responsibility. It does not matter which organization you belong to.</p>
<p>#Introduction
This time on the 16th day, I am familiar as I have never cleared the search for mistakes of Saizeria</p>
<p><strong>A program that can display the difference between two images and display the difference easily and easily</strong></p>
<p>I will write about how to make</p>
<p>#Rough image diagram
<img width="624" alt="Screenshots 2019-12-13 21.04.06.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/529160/2ec63332-b50d-de86-b817-6ecd4a6501a3.png">
<img width="624" alt="Screenshots 2019-12-13 21.04.16.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/529160/510e87a7-12a2-1229-95e1-f0cab1a5aa2f.png"></p>
<h1 id="implementation-environment">Implementation environment</h1>
<ul>
<li>OS
<ul>
<li>MacOS Mojave 10.14.5</li>
</ul>
</li>
<li>Language
<ul>
<li>python 3.7.4</li>
</ul>
</li>
<li>Library
<ul>
<li>openCV 3.4.2</li>
<li>NumPy 1.17.4</li>
<li>matplotlib 3.1.1</li>
</ul>
</li>
<li>Other
<ul>
<li>jupyter notebook 6.0.1</li>
<li>anaconda navigator</li>
</ul>
</li>
</ul>
<h1 id="advance-preparation">Advance preparation</h1>
<p>(There is no guarantee, but I think that it will work normally if python and various libraries can be used, so please take a look around)</p>
<ul>
<li>Insert a tool that can handle anaconda easily with a gui called anaconda navigator.</li>
<li>I think it&rsquo;s better to install python in parallel (not necessarily in parallel).</li>
<li>Use anaconda navigator to insert jupyter and various libraries.</li>
</ul>
<p>(For detailed installation method, refer to [<a href="https://www.google.com/search?q=anaconda+navigator+jupyter+%E3%82%A4%E3%83%B3%E3%82%B9(%E3%83%88%E3%83%BC%E3%83%AB)',Ithinkitwillcomeout.">anaconda navigator jupyter installation</a></p>
<h1 id="source-commentary">Source commentary</h1>
<p>From here on, it&rsquo;s about the production and the contents of the source.</p>
<p>There are three major parts.</p>
<ul>
<li>Create difference mask image</li>
<li>Add color to the mask part of the mask image</li>
<li>Change transparency of mask image and combine</li>
</ul>
<p>And feel like a mouse</p>
<h3 id="import-or-variable-setting">import or variable setting</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#f92672">import</span> cv2<span style="color:#f92672">,</span> matplotlib
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">from</span> IPython.display <span style="color:#f92672">import</span> Image, display_png

<span style="color:#75715e"># Original image 1</span>
img_01 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sample1.png&#34;</span>
<span style="color:#75715e"># Original image 2</span>
img_02 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;sample2.png&#34;</span>
<span style="color:#75715e"># Please enter the name you want to give to the output image</span>
outImg <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;output.png&#34;</span>
</code></pre></div><h3 id="create-difference-mask-image">Create difference mask image</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#75715e"># Read original image 1 in color</span>
img_src01 <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(img_01, <span style="color:#ae81ff">1</span>)
 
<span style="color:#75715e"># Read original image 2 in color</span>
img_src02 <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(img_02, <span style="color:#ae81ff">1</span>)
 
<span style="color:#75715e"># It seems that the foreground/background region segmentation algorithm is based on Gaussian Mixture.</span>
bg <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>bgsegm<span style="color:#f92672">.</span>createBackgroundSubtractorMOG()
 
<span style="color:#75715e"># Generate mask image</span>
mask <span style="color:#f92672">=</span> bg<span style="color:#f92672">.</span>apply(img_src01)
mask <span style="color:#f92672">=</span> bg<span style="color:#f92672">.</span>apply(img_src02)

<span style="color:#75715e"># Output mask image</span>
cv2<span style="color:#f92672">.</span>imwrite(<span style="color:#e6db74">&#34;output/machigai_mask.png&#34;</span>, mask)

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;original image 1&#34;</span>)
display_png(Image(img_01))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;original image 2&#34;</span>)
display_png(Image(img_02))
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;mask image&#34;</span>)
display_png(Image(<span style="color:#e6db74">&#34;output/machigai_mask.png&#34;</span>))
</code></pre></div><p>The output result here is as follows.
![Screenshot 2019-12-13 22.21.20.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/529160/7be1e3bf-3560-7f70-bc43-(4c7d48456a9d.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/529160/7be1e3bf-3560-7f70-bc43-(4c7d48456a9d.png)</a></p>
<h3 id="add-color-to-the-mask-part-of-the-mask-image">Add color to the mask part of the mask image</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
mask_img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(<span style="color:#e6db74">&#34;output/machigai_mask.png&#34;</span>, <span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># Replace the white part of the image with red</span>
red <span style="color:#f92672">=</span> [<span style="color:#ae81ff">240</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>]
white <span style="color:#f92672">=</span> [<span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">255</span>]
mask_img[np<span style="color:#f92672">.</span>where((mask_img <span style="color:#f92672">==</span> white)<span style="color:#f92672">.</span>all(axis<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>))] <span style="color:#f92672">=</span> red

<span style="color:#75715e"># BGR to RGB</span>
mask_img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>cvtColor(mask_img, cv2<span style="color:#f92672">.</span>COLOR_BGR2RGB)

<span style="color:#75715e"># Save the result.</span>
cv2<span style="color:#f92672">.</span>imwrite(<span style="color:#e6db74">&#34;output/color_mask_img.png&#34;</span>, mask_img)

color_mask_img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(<span style="color:#e6db74">&#34;output/color_mask_img.png&#34;</span>, <span style="color:#ae81ff">1</span>)
display_png(Image(<span style="color:#e6db74">&#34;output/color_mask_img.png&#34;</span>))
</code></pre></div><p>The output result here is as follows.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/529160/601e05e1-7c9a-be61-946f-aa9df0d02226.png" alt="Screenshot 2019-12-14 0.05.36.png"></p>
<h3 id="change-transparency-of-mask-image-and-combine">Change transparency of mask image and combine</h3>
<p>Finally, if you can do this, you&rsquo;re done.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#75715e"># src1 = original image 1, src2 = mask image, alpha(beta) = It seems good to adjust at a ratio of 1 in total, gamma = 0 made me feel good</span>
diff_image <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>addWeighted(src1<span style="color:#f92672">=</span>img_src01,alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>,src2<span style="color:#f92672">=</span>color_mask_img,beta<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>,gamma<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
cv2<span style="color:#f92672">.</span>imwrite(outImg, diff_image)

display_png(Image(outImg))
</code></pre></div><p>Yes it&rsquo;s done
![Screenshot 2019-12-14 0.11.25.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/529160/e901f8fd-31cc-025e-c195-(f9836f64f553.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/529160/e901f8fd-31cc-025e-c195-(f9836f64f553.png)</a></p>
<h1 id="i-tried-with-an-image-that-looks-like-finding-a-mistake">I tried with an image that looks like finding a mistake</h1>
<p>I tried to find a mistake for this.
First of all, please try by yourself (There are 6 mistakes)</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/529160/1867d733-c9ac-ec25-cf89-5973750dee9c.png" alt="machigai_1_2.png">
――
――
――
――
――
――
――
――
――
――
――
――
――</p>
<p>So could you find the mistake?</p>
<p>Next, let&rsquo;s take a look at the result of being fully automated ~~ Egg breaker ~~</p>
<p>――
――
――
Here it is
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/529160/56f8f4b2-ea49-73df-1e29-c3ad8d0c888e.png" alt="diff_image (1).png"></p>
<p>How is it?
That&rsquo;s a great percentage of correct answers.</p>
<p>However, the detection accuracy of <strong>the teacher&rsquo;s wig had changed to watermelon</strong> is not very good.</p>
<h1 id="about-background-subtraction">About background subtraction</h1>
<p>In the first place, this background subtraction method is,
This is a method for detecting moving objects on moving images.</p>
<p>in short</p>
<p>With fixed point camera
<strong>Ah, people passed by</strong>
It’s a method to judge</p>
<p>There are two major problems when using this background subtraction method to search for mistakes.</p>
<ul>
<li>The size of the images to be subtracted must be the same</li>
<li>If the pixels are slightly misaligned, they are all judged differently.</li>
</ul>
<p>So, if you try to make something that can be used universally,</p>
<ul>
<li>Correct a little gap</li>
<li>Also, the tilt is corrected.</li>
<li>Correct the size</li>
<li>But recognition accuracy can be guaranteed to some extent</li>
</ul>
<p>I feel that I have to make such software ()</p>
<h1 id="finally">Finally</h1>
<ul>
<li>Correct a little gap</li>
<li>Also, the tilt is corrected.</li>
<li>Correct the size</li>
<li>But recognition accuracy can be guaranteed to some extent</li>
</ul>
<p>Let&rsquo;s try making such software next time (white eyes)</p>
<p>#Reference</p>
<ul>
<li><a href="https://qiita.com/goodboy_max/items/71a3b804d14f961c0d91">Background difference method</a></li>
<li><a href="https://postd.cc/image-processing-101/">Basic knowledge of openCV</a></li>
<li><a href="https://code-graffiti.com/blending-images-with-opencv-in-python/">Image composition/transparency</a></li>
<li><a href="https://www.pynote.info/entry/opencv-flood-fill">Image Fill</a></li>
</ul>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
