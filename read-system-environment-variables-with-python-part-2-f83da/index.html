<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>Read system environment variables with python-part 2 | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Read system environment variables with python-part 2</h1>
<p>
  <small class="text-secondary">
  
  
  May 17, 2020
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/batch-file"> batch file</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/shell-script"> shell script</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/environment-variable"> environment variable</a></code></small>

</p>
<pre><code># Overview
</code></pre>
<p>Create a python program that acquires system environment variables by applying <a href="https://qiita.com/UT_EE/items/e9ddf0073659fb183eac">Reading system environment variables with python-Part 1</a>.</p>
<h1 id="constitution">Constitution</h1>
<ul>
<li>EnvironWrapper.py&mdash;A python class that encapsulates system environment variables</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-EnvironWrapper.py" data-lang="EnvironWrapper.py"><span style="color:#f92672">import</span> os

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EnvironWrapper</span>:
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    class:EnvironWrapper
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    Overview: A class that holds startup parameters read from environment variables
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>

    <span style="color:#75715e"># Environment variable</span>
    defaultenv_context <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;SECRET_KEY&#34;</span> :<span style="color:#e6db74">&#39;naishokey&#39;</span>, <span style="color:#75715e"># SECRET_KEY</span>
        <span style="color:#e6db74">&#34;DEBUG_FLG&#34;</span> :<span style="color:#e6db74">&#39;true&#39;</span>, <span style="color:#75715e"># DEBUG_FLG</span>
        <span style="color:#e6db74">&#34;ALLOWED_HOSTS&#34;</span>: None, <span style="color:#75715e"># ALLOWED_HOSTS</span>
    }
    <span style="color:#75715e"># Environment variable</span>
    getenv_context <span style="color:#f92672">=</span> {}
    <span style="color:#66d9ef">def</span> __init__(self):
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        constructor
</span><span style="color:#e6db74">        read environment variables from os.environ
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">for</span> key, value <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>defaultenv_context<span style="color:#f92672">.</span>items():
            param <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>getenv(key, default<span style="color:#f92672">=</span>value)
            <span style="color:#66d9ef">if</span> key <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;DEBUG_FLG&#34;</span>:
                param <span style="color:#f92672">=</span> False <span style="color:#66d9ef">if</span> param<span style="color:#f92672">.</span>lower()<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#39;false&#39;</span>) <span style="color:#66d9ef">else</span> True
            self<span style="color:#f92672">.</span>getenv_context[key] <span style="color:#f92672">=</span> param

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">GetParams</span>(self, key :str) <span style="color:#f92672">-&gt;</span> object:
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        GetParams: Environment variable acquisition process
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">        Arguments:
</span><span style="color:#e6db74">            key {str}-environment variable key
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">        Returns:
</span><span style="color:#e6db74">            object-Environment variable value
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>getenv_context[key]

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    env <span style="color:#f92672">=</span> EnvironWrapper()

    <span style="color:#66d9ef">for</span> key, value <span style="color:#f92672">in</span> env<span style="color:#f92672">.</span>getenv_context<span style="color:#f92672">.</span>items():
        <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#34;key:{key}, value:{value}&#34;</span>)
</code></pre></div><p>System environment variables include persistent data such as %USERNAME% of windows, and I want to limit to only the necessary system environment variables.
Define the system environment variables to be used in <code>defaultenv_context</code> and their default values, and store the necessary system environment variables in getenv_context as a dictionary.
Since <code>os.environ</code> is a dictionary type in the first place, it is named as a wrapper class of environ.</p>
<hr>
<ul>
<li>EnvironWrapperRun.bat&mdash;for Windows startup</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-EnvironWrapperRun.bat" data-lang="EnvironWrapperRun.bat">@<span style="color:#66d9ef">ECHO</span> OFF

<span style="color:#66d9ef">ECHO</span> &lt;input value&gt;
Read REM setting file
<span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">/F</span> <span style="color:#e6db74">&#34;usebackq delims== tokens=1,2&#34;</span> <span style="color:#ae81ff">%%</span>i <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#34;setting.ini&#34;</span>) <span style="color:#66d9ef">do</span> (
    <span style="color:#66d9ef">SET</span> <span style="color:#ae81ff">%%</span>i=<span style="color:#ae81ff">%%</span>j
    <span style="color:#66d9ef">SET</span> <span style="color:#ae81ff">%%</span>i
)

<span style="color:#66d9ef">ECHO</span>:
<span style="color:#66d9ef">ECHO</span> &lt;acquired value&gt;
python EnvironWrapper.py
</code></pre></div><hr>
<ul>
<li>EnvironWrapperRun.sh&hellip; Linux startup</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-EnvironWrapperRun.sh" data-lang="EnvironWrapperRun.sh"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#Read configuration file</span>
echo &lt;input value&gt;
<span style="color:#66d9ef">while</span> read line
<span style="color:#66d9ef">do</span>
export $line
echo $line
<span style="color:#66d9ef">done</span> &lt;setting.ini

echo &lt;obtained value&gt;
python3 EnvironWrapper.py
</code></pre></div><hr>
<ul>
<li>setting.ini&mdash;Setting file that defines system environment variables</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-setting.ini" data-lang="setting.ini"><span style="color:#a6e22e">SECRET_KEY</span><span style="color:#f92672">=</span><span style="color:#e6db74">1234567890qwertyuiopasdfghjklzxcvbnm</span>
<span style="color:#a6e22e">DEBUG_FLG</span><span style="color:#f92672">=</span><span style="color:#e6db74">True</span>
<span style="color:#a6e22e">ALLOWED_HOSTS</span><span style="color:#f92672">=</span><span style="color:#e6db74">127.0.0.1</span>
</code></pre></div><p>The system environment variables set this time are summarized in setting.ini so that they do not depend on the OS.
Since the usage of system environment variables differs depending on the OS, the startup files are separated.
Execute the python program after reading setting.ini line by line in the startup file and setting it in the system environment variables.</p>
<ul>
<li>In windows, you can refer by <code>SET variable name=variable value</code>, <code>%variable value%</code></li>
<li>On Linux, you can refer by <code>export variable name=variable value</code>, <code>$variable value</code>,</li>
</ul>
<p>#Next task</p>
<p>As you can see from the contents of setting.ini, the setting values used in Django&rsquo;s setting.py are defined.
Consider a mechanism that allows DI at startup according to the setting value of setting.py according to the development status (develop-staging-release).</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
