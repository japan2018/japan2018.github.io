<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>Understand the number of input and output parameters of convolutional neural network | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Understand the number of input and output parameters of convolutional neural network</h1>
<p>
  <small class="text-secondary">
  
  
  Feb 11, 2020
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/hard"> Hard</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/cnn"> CNN</a></code></small>

</p>
<pre><code>Basically learning with keras and python
</code></pre>
<h2 id="what-i-learned">What I learned</h2>
<ol>
<li>Understand the number of input and output parameters of layers</li>
<li>Understand data processing after processing convolutional layer and pooling layer</li>
</ol>
<h2 id="code-used-for-learning">Code used for learning</h2>
<p>mnist cnn code from keras documentation.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> __future__ <span style="color:#f92672">import</span> print_function
<span style="color:#f92672">import</span> keras
<span style="color:#f92672">from</span> keras.datasets <span style="color:#f92672">import</span> mnist
<span style="color:#f92672">from</span> keras.models <span style="color:#f92672">import</span> Sequential
<span style="color:#f92672">from</span> keras.layers <span style="color:#f92672">import</span> Dense, Dropout, Flatten
<span style="color:#f92672">from</span> keras.layers <span style="color:#f92672">import</span> Conv2D, MaxPooling2D
<span style="color:#f92672">from</span> keras <span style="color:#f92672">import</span> backend <span style="color:#66d9ef">as</span> K

batch_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">128</span>
num_classes <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
epochs <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>

<span style="color:#75715e"># input image dimensions</span>
img_rows, img_cols <span style="color:#f92672">=</span> <span style="color:#ae81ff">28</span>, <span style="color:#ae81ff">28</span>

<span style="color:#75715e"># the data, split between train and test sets</span>
(x_train, y_train), (x_test, y_test) <span style="color:#f92672">=</span> mnist<span style="color:#f92672">.</span>load_data()

<span style="color:#66d9ef">if</span> K<span style="color:#f92672">.</span>image_data_format() <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;channels_first&#39;</span>:
    x_train <span style="color:#f92672">=</span> x_train<span style="color:#f92672">.</span>reshape(x_train<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], <span style="color:#ae81ff">1</span>, img_rows, img_cols)
    x_test <span style="color:#f92672">=</span> x_test<span style="color:#f92672">.</span>reshape(x_test<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], <span style="color:#ae81ff">1</span>, img_rows, img_cols)
    input_shape <span style="color:#f92672">=</span> (<span style="color:#ae81ff">1</span>, img_rows, img_cols)
<span style="color:#66d9ef">else</span>:
    x_train <span style="color:#f92672">=</span> x_train<span style="color:#f92672">.</span>reshape(x_train<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], img_rows, img_cols, <span style="color:#ae81ff">1</span>)
    x_test <span style="color:#f92672">=</span> x_test<span style="color:#f92672">.</span>reshape(x_test<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>], img_rows, img_cols, <span style="color:#ae81ff">1</span>)
    input_shape <span style="color:#f92672">=</span> (img_rows, img_cols, <span style="color:#ae81ff">1</span>)

x_train <span style="color:#f92672">=</span> x_train<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;float32&#39;</span>)
x_test <span style="color:#f92672">=</span> x_test<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;float32&#39;</span>)
x_train <span style="color:#f92672">/=</span> <span style="color:#ae81ff">255</span>
x_test <span style="color:#f92672">/=</span> <span style="color:#ae81ff">255</span>
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;x_train shape:&#39;</span>, x_train<span style="color:#f92672">.</span>shape)
<span style="color:#66d9ef">print</span>(x_train<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>],<span style="color:#e6db74">&#39;train samples&#39;</span>)
<span style="color:#66d9ef">print</span>(x_test<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>],<span style="color:#e6db74">&#39;test samples&#39;</span>)

<span style="color:#75715e"># convert class vectors to binary class matrices</span>
y_train <span style="color:#f92672">=</span> keras<span style="color:#f92672">.</span>utils<span style="color:#f92672">.</span>to_categorical(y_train, num_classes)
y_test <span style="color:#f92672">=</span> keras<span style="color:#f92672">.</span>utils<span style="color:#f92672">.</span>to_categorical(y_test, num_classes)

model <span style="color:#f92672">=</span> Sequential()
model<span style="color:#f92672">.</span>add(Conv2D(<span style="color:#ae81ff">32</span>, kernel_size<span style="color:#f92672">=</span>(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>),
                 activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>,
                 input_shape<span style="color:#f92672">=</span>input_shape))
model<span style="color:#f92672">.</span>add(Conv2D(<span style="color:#ae81ff">64</span>, (<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>), activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>))
model<span style="color:#f92672">.</span>add(MaxPooling2D(pool_size<span style="color:#f92672">=</span>(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>)))
model<span style="color:#f92672">.</span>add(Dropout(<span style="color:#ae81ff">0.25</span>))
model<span style="color:#f92672">.</span>add(Flatten())
model<span style="color:#f92672">.</span>add(Dense(<span style="color:#ae81ff">128</span>, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relu&#39;</span>))
model<span style="color:#f92672">.</span>add(Dropout(<span style="color:#ae81ff">0.5</span>))
model<span style="color:#f92672">.</span>add(Dense(num_classes, activation<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;softmax&#39;</span>))

model<span style="color:#f92672">.</span>compile(loss<span style="color:#f92672">=</span>keras<span style="color:#f92672">.</span>losses<span style="color:#f92672">.</span>categorical_crossentropy,
              optimizer<span style="color:#f92672">=</span>keras<span style="color:#f92672">.</span>optimizers<span style="color:#f92672">.</span>Adadelta(),
              metrics<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;accuracy&#39;</span>])

model<span style="color:#f92672">.</span>fit(x_train, y_train,
          batch_size<span style="color:#f92672">=</span>batch_size,
          epochs<span style="color:#f92672">=</span>epochs,
          verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,
          validation_data<span style="color:#f92672">=</span>(x_test, y_test))
score <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>evaluate(x_test, y_test, verbose<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Test loss:&#39;</span>, score[<span style="color:#ae81ff">0</span>])
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Test accuracy:&#39;</span>, score[<span style="color:#ae81ff">1</span>])
</code></pre></div><h2 id="what-was-the-question">What was the question</h2>
<p>The most questionable thing is the number of input and output dimensions. The result of model.summary is output below. There are two wonders here.</p>
<ol>
<li>&ldquo;Mnist data is 28 * 28 image data, but where did the first 26, 26, 32 come from?&rdquo;</li>
<li>&ldquo;What is Conv2D 32?&rdquo;</li>
</ol>
<pre><code>Model: &quot;sequential_2&quot;


_________________________________________________________________
Layer (type) Output Shape Param #
=================================================== ===============
conv2d_3 (Conv2D) (None, 26, 26, 32) 320
_________________________________________________________________
conv2d_4 (Conv2D) (None, 24, 24, 64) 18496
_________________________________________________________________
max_pooling2d_2 (MaxPooling2 (None, 12, 12, 64) 0
_________________________________________________________________
dropout_3 (Dropout) (None, 12, 12, 64) 0
_________________________________________________________________
flatten_2 (Flatten) (None, 9216) 0
_________________________________________________________________
dense_3 (Dense) (None, 128) 1179776
_________________________________________________________________
dropout_4 (Dropout) (None, 128) 0
_________________________________________________________________
dense_4 (Dense) (None, 10) 1290
=================================================== ===============
Total params: 1,199,882
Trainable params: 1,199,882
Non-trainable params: 0
</code></pre><h2 id="what-i-understand">What I understand</h2>
<p>32 of Conv2D function indicates the number of filters. In other words, 32 types of filters are used to perform various edge extractions. Furthermore, by performing a filter operation as stride 1, the image becomes smaller, and it is reduced by 2 dots in each of the vertical and horizontal directions of the image. There are 32 outputs because there is an output for each filter.
Also, unlike the convolutional layer, the pooling layer does not handle overlapping dots, so the number of outputs is greatly reduced.
(This is an aside, but the dropout layer only sets the value to 0, so the number of inputs and outputs does not change.)</p>
<h2 id="what-to-look-for-next">What to look for next</h2>
<ol>
<li>The specific value of the filter. Visualization</li>
</ol>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
