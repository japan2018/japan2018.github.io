<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Youtube live It analyzes the sentiment of the comment and judges the emo part from Youtube LIve. | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Youtube live It analyzes the sentiment of the comment and judges the emo part from Youtube LIve.</h1>
<p>
  <small class="text-secondary">
  
  
  Feb 14, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/natural-language-processing"> natural language processing</a></code></small>


<small><code><a href="https://memotut.com/tags/nlp"> NLP</a></code></small>


<small><code><a href="https://memotut.com/tags/youtube"> YouTube</a></code></small>


<small><code><a href="https://memotut.com/tags/cotoha"> COTOHA</a></code></small>

</p>
<pre><code># TL;DR
</code></pre>
<p>It is a suggestion and experiment that it is possible to extract &ldquo;emo&rdquo; and &ldquo;highlight&rdquo; with better accuracy than just the number of comments per hour by performing sentiment analysis of comments on Youtube live. ..</p>
<p>In fact, we were able to get the result that the accuracy is likely to improve compared to just looking at the number of comments.</p>
<p>#Introduction</p>
<p>Last time, I borrowed COTOHA API and tried to think freely, <del>not practical</del> <a href="https://qiita.com/mosamosa/items/e63f6e582a206659dc2b">Article</a>.</p>
<p>This time, I tried to make it more practical and applicable.
Since the background is shared in the early stages, there is no particular problem even if you skip it.</p>
<p>#YoutubeLive and eSports
I&rsquo;m sure many of you will ask, but the esports market has been developing in recent years. One of the indispensable relationships with the esports market is Live distribution via YouTube and other media.</p>
<p>Unlike conventional game live video posting, Live distribution is similar to esports because it has the advantages of ** less editing burden, communication, &ldquo;money&rdquo; culture, and real-time sharing of experiences as sports ** I think it is expanding. However, there are some problems around this Live distribution.</p>
<h1 id="live-distribution-problem">Live distribution problem.</h1>
<p>However, there are some problems with such live streaming.
Among them, the biggest one is the increased burden on viewers and the existence of &ldquo;thieves&rdquo; who use it.</p>
<p>To put it the other way around, Live distribution, which is less burdensome on the distribution side, imposes the viewers on the task of searching for the highlight. There is a problem that some people who noticed that cut out the distribution of famous distributors and earn money.</p>
<p>↓ The subject of this article is different, but it is easy to read because it is lightly written about the problem around this.
<a href="https://gigazine.net/news/20191216-youtuber-hired-youtuber-leech-off/">https://gigazine.net/news/20191216-youtuber-hired-youtuber-leech-off/</a></p>
<p>In the first place, I think that there are various difficulties because the distribution itself uses the copyright of the game company to earn profits, but I think that it is a problem when considering the Live distribution market etc.</p>
<h1 id="solution">solution?</h1>
<p>I think one solution to this problem is for the official (the person himself) to quickly make a crop and upload it.
However, this is because it is not done.</p>
<p>So I think this is where the motivation for automating some of this clipping is created.</p>
<h1 id="method">Method</h1>
<p>Various things have been proposed for automatic highlight creation, but those learning the video itself need a data set, and a moderate proportion is for the video that shows the real world first. , I think that some kind of ingenuity is needed to bring it directly to the context of esports.</p>
<p>Therefore, this time we focused on the comments that were being delivered live.</p>
<h1 id="precedent">Precedent</h1>
<p><a href="https://qiita.com/okamoto950712/items/0d4736c7be251532a03f">https://qiita.com/okamoto950712/items/0d4736c7be251532a03f</a></p>
<p>There was an article like this in the preceding example. This person extracted the highlights from the comment by using the word &ldquo;grass&rdquo; as a keyword. However, as this person says, the question remains in the criteria. Therefore, this time, I will update this criterion with some help from natural language processing.</p>
<p>#Comments, emotions and highlights
Thinking about what the highlight of live streaming is, it is thought that &ldquo;the emotions of many people are moved.&rdquo;
So the simplest example of what to expect in such a scene is the number of comments.</p>
<p>It is also intuitively clear that a lot of comments such as &ldquo;amazing&rdquo; flow in the highlight.
Therefore, I will try to analyze the highlight based on the number of comments. (But I will mention later, this is not enough)</p>
<h1 id="target-videos">Target videos</h1>
<p>This time I will borrow <a href="https://www.youtube.com/watch?v=vugS23pslwE">EGS&rsquo;s smartphone! #48</a>.Ichoseitbecauseitwasesports(smuggler) and the comment stream was turned on, not a selection that I thought about in particular.</p>
<p>This time, I&rsquo;ll select a comment that doesn&rsquo;t understand the video content as much as possible, so if you&rsquo;re curious about the content, please check out the original video.</p>
<p>#Getting comments</p>
<p>I referred to here to get the comment.
[Getting chat (comment) from YouTube Live archive in Python (revised version)]
(<a href="http://watagassy.hatenablog.com/entry/2018/10/08/132939">http://watagassy.hatenablog.com/entry/2018/10/08/132939</a>)</p>
<p>I was able to get it very easily. Thank you very much.
The time acquired from here will be converted into seconds and processed appropriately.</p>
<p>#Highlight judgment based on the number of comments per hour</p>
<p>Since the video time was about 10000 seconds, I will write a histogram with 500 divisions (about 20 seconds per section).</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244678/cbf3c3c5-0c74-acf1-7d5c-aaf0c47dd47d.png" alt="com_hist.png"></p>
<p>Since this peak is where comments are rapidly increasing, I think it can be said to be a highlight.</p>
<h1 id="a-spot-that-was-misjudged">A spot that was misjudged.</h1>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244678/f852b4aa-087e-5903-292c-f164e95e531c.png" alt="com_hist_min.png"></p>
<p>I would like you to pay attention to this part. In this part, a peak-like thing appeared around 5660 seconds, but this was due to the comment posted by the viewer who wondered how the delivery was cut off.</p>
<p>(It may be thought that this small peak should be overlooked from the beginning, but in general, the number of comments will increase as the live distribution etc. of the tournament approaches the end, so it is not possible to judge whether this peak is relatively small. (Not always possible.) (Time series data is difficult)</p>
<p>Consider using the sentiment value of the comment to remove this part.</p>
<p>Comment sentiment analysis by #COTOHA</p>
<p>I finally arrived here.
COTOHA is an API that allows NTT to easily process natural language.</p>
<p>If you register as a free user from <a href="https://api.ce-cotoha.com/contents/index.html">This COTOHA API PORTAL</a>, even free users can use the API for 1000/day. I will.</p>
<p>From registration of COTOHA to token issuance, I also explained in my <a href="https://qiita.com/mosamosa/items/e63f6e582a206659dc2b">article</a>infrontofme,and<a href="https://qiita.com/youwht/items/16e67f4ada666e679875">other</a><a href="https://qiita.com/Harusugi/items/f499e8707b36d0f570c4">Article</a> has also been explained, so please refer to that.</p>
<p>This time we will use sentiment analysis from COTOHA API.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_senti</span>(txt):
    header <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;Content-Type&#34;</span>:<span style="color:#e6db74">&#34;application/json&#34;</span>,
        <span style="color:#e6db74">&#34;Authorization&#34;</span>:<span style="color:#e6db74">&#34;Bearer &#34;</span><span style="color:#f92672">+</span> [token]
    }

    datas <span style="color:#f92672">=</span> {
         <span style="color:#e6db74">&#34;sentence&#34;</span>:txt,

    }

    r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(api_base<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;nlp/v1/sentiment&#34;</span>,headers<span style="color:#f92672">=</span>header,data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(datas))
    parsed <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(r<span style="color:#f92672">.</span>text)
    <span style="color:#66d9ef">return</span> parsed
</code></pre></div><p>We use a function like this to loop through sentiment analysis on comments.</p>
<h1 id="total-sentiment-analysis-results">Total sentiment analysis results</h1>
<p>It&rsquo;s a bit hard to understand because it&rsquo;s a part of the whole, but kouho contains comments to be analyzed, separated by sections. In this case, kouho[0] contains the comments of 5600-5800 seconds, which was the same as the previous one, in the form of an array of [comments, seconds].</p>
<p>The sentis contains the sentiment analysis result corresponding to the comment in the form of [Pos or Neg, sentiment score].
What the code is doing is calculating the percentage of comments in the past 20 seconds that have a positive or negative emotion, based on a certain point. **</p>
<p>Negative is also counted because it includes when the supporter loses or uses a word such as &ldquo;bad&rdquo; in a good sense by nature.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">buf <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">200</span>)]
doubled <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">200</span>)]
target <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(sentis[<span style="color:#ae81ff">0</span>])):
    <span style="color:#66d9ef">if</span> sentis[target][i][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Positive&#34;</span> <span style="color:#f92672">or</span> sentis[target][i][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Negative&#34;</span>:
        base <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">else</span>:
        base <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0001</span>
    buf[kouho[target][i][<span style="color:#ae81ff">1</span>]<span style="color:#f92672">-</span><span style="color:#ae81ff">5600</span>] <span style="color:#f92672">+=</span> base
    doubled[kouho[target][i][<span style="color:#ae81ff">1</span>]<span style="color:#f92672">-</span><span style="color:#ae81ff">5600</span>] <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">200</span>):
    <span style="color:#66d9ef">if</span> doubled[i] <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
        buf[i] <span style="color:#f92672">=</span> buf[i]<span style="color:#f92672">/</span>doubled[i]

buf <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>Series(buf)
rolled <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span> <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">200</span>)]
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">19</span>,<span style="color:#ae81ff">200</span>):
    temp <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    temp_c <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">20</span>):
        temp <span style="color:#f92672">+=</span> buf[i<span style="color:#f92672">-</span>j]
        <span style="color:#66d9ef">if</span> buf[i<span style="color:#f92672">-</span>j] <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>:
            temp_c <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">if</span> temp_c <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
        rolled[i] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    <span style="color:#66d9ef">else</span>:
        rolled[i] <span style="color:#f92672">=</span> temp<span style="color:#f92672">/</span>temp_c

</code></pre></div><h1 id="result-plot">Result plot</h1>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244678/658e12b2-c530-496c-0b83-7743cc2288c8.png" alt="5600.png"></p>
<p>Comment example</p>
<p>[&lsquo;Neutral&rsquo;, 0.5976078134278074] [&lsquo;Eh? &lsquo;5646]
[&lsquo;Neutral&rsquo;, 0.2972885953707938] [&lsquo;cut out&rsquo; 5646]
[&lsquo;Neutral&rsquo;, 0.5971540523081994] [&lsquo;Otsu? &lsquo;5648]</p>
<p>[&lsquo;Positive&rsquo;, 0.5905005661402767] [&lsquo;Good looking and &lsquo;5705][&lsquo;Positive&rsquo;, 0.6376353638242411] [&lsquo;Cool&rsquo; 5710]</p>
<p>[&lsquo;Positive&rsquo;, 0.5408603768859751] [&lsquo;I&rsquo;m good at using guns&rsquo; 5766]</p>
<p>[&lsquo;Neutral&rsquo;, 0.30682113884940243] [&lsquo;Umee&rsquo; 5795]
[&lsquo;Positive&rsquo;, 0.2976389932477489] [&lsquo;Understanding&rsquo; 5797]
[&lsquo;Neutral&rsquo;, 0.3140117003315527] [&lsquo;Horse&rsquo; 5799]</p>
<p>(Because I rent the video, I chose the one that is not related to the content as much as possible, so if you are interested in all the comments, please watch the video author.)</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244678/f852b4aa-087e-5903-292c-f164e95e531c.png" alt="com_hist_min.png"></p>
<p>At this time of day, the peak of ** comments was around 5660, but it was not the true highlight, but rather that around 5800 was closer to the highlight. **</p>
<p>#Result 2</p>
<p>I will also analyze the other scene.
Targeted around 9500-9700 seconds</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244678/cada518e-447d-dde6-a7b6-90424ea5f0e8.png" alt="com_hist_min.png"></p>
<p>It looks like the area where the victory was decided. I will analyze the sentiment also for the comment of this scene and plot it.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/244678/224cf8ef-1fbe-1d5c-31f8-4f48247498f4.png" alt="9500.png"></p>
<p>The result is shown in the graph above. Apparently around 9550 seconds is the most emotional moment.
Check the comment.</p>
<p>[&lsquo;Neutral&rsquo;, 0.3140117003315527] [&lsquo;Yes yeah yeah yeah yeah yeah yeah&rsquo; 9554]
[&lsquo;Positive&rsquo;, 0.5873145362524327] [&lsquo;Usugi&rsquo; 9554]
[&lsquo;Neutral&rsquo;, 0.5972752547353822] [&lsquo;Kamishifuto! ? &lsquo;9555]
[&lsquo;Neutral&rsquo;, 0.2932173519717803] [&lsquo;Ah~w&rsquo; 9555]
[&lsquo;Neutral&rsquo;, 0.30920978004290844] [&lsquo;Usumungi&rsquo; 9555]
[&lsquo;Neutral&rsquo;, 0.31430016829530116] [&lsquo;Uoooooooooo 9555]
[&lsquo;Positive&rsquo;, 0.6049280950215463] [&lsquo;Perfect&rsquo; 9555]
[&lsquo;Neutral&rsquo;, 0.31322001724349124] [&lsquo;Yabe eh&rsquo; 9555]
[&lsquo;Negative&rsquo;, 0.7934200331057456] [&lsquo;Negative&rsquo; 9555]</p>
<p>It seems that something actually happened. It&rsquo;s emo.</p>
<p>#Summary
By using the COTOHA sentiment analysis API, it was found that the accuracy of comment-based Youtube Live highlighting judgment could be improved.</p>
<h1 id="issues">Issues</h1>
<ul>
<li>Is the positive/negative ratio acceptable in the first place? How to use Sentiment score?</li>
<li>Some exclamation expressions etc. are judged as Neutral. → Is it more accurate if part-of-speech analysis is performed and some processing is performed?</li>
<li>What is the size of the time window?</li>
<li>In some colloquial expressions such as &ldquo;Umasungi&rdquo;, sentiment analysis may not work well.</li>
</ul>
<h1 id="other-delusions">Other delusions.</h1>
<p>I thought it would be interesting to see the emotion value of the viewer in real time.
This time, we aimed at a video with a lot of comments, but for personal live commenters with a small number of comments, by transcribing what the person said and then performing sentiment analysis on it I think it will be true that &ldquo;→&rdquo; something &ldquo;something interesting&rdquo; has occurred, so I thought it would be possible to cut out the highlights from such an approach.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
