<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>Let me know by voice when an article you are interested in is posted | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Let me know by voice when an article you are interested in is posted</h1>
<p>
  <small class="text-secondary">
  
  
  Apr 11, 2020
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/machine-learning"> machine learning</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/voiceroid2"> VOICEROID2</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/flair"> Flair</a></code></small>

</p>
<pre><code>You can detect updates of blogs that you are interested in through RSS feeds, but sometimes you see the title and say, &quot;Isn't it necessary to read it?&quot;
</code></pre>
<p>It&rsquo;s a hassle to read the titles one by one, so I decided to ask Itako Tohoku of Voiceroid to read the article when I was interested in it.</p>
<h1 id="extracting-articles-that-may-be-of-interest">Extracting articles that may be of interest</h1>
<h2 id="classification-of-articles-using-flair">Classification of articles using Flair</h2>
<p><a href="https://github.com/flairNLP/flair">Flair</a> is a library that can easily execute the latest natural language processing.
This time, using <a href="https://github.com/flairNLP/flair/blob/master/resources/docs/TUTORIAL_7_TRAINING_A_MODEL.md#training-a-text-classification-model">TextClassifier</a> Create a classifier that determines whether you are interested or not.</p>
<h2 id="article-labeling">Article labeling</h2>
<p>This time, we will get the article title from <a href="https://www.lifehacker.jp/feed/index.xml">RSS feed</a> of the latest LifeHacker article and label it.</p>
<p>Getting the latest title is easy with the following code (don&rsquo;t over request):</p>
<pre><code># !pip install -q feedparser
import feedparser

RSS_URL = &quot;https://www.lifehacker.jp/feed/index.xml&quot;

feed = feedparser.parse(RSS_URL)

for entry in feed.entries:
    print(entry.title)
</code></pre><details><summary>2020/04/08 execution result</summary><div>
<pre><code>To fix the error message that appears every time Windows starts
For key cases, &quot;Wunderkey&quot; made in Germany is multifunctional and recommended for outdoor use!
Just put it in the washing machine. With the power of natural &quot;iodine&quot;, it can prevent mildew for 3 months, and disinfect and deodorize laundry!
There are 3 things to prepare, easy to cook. 1 week make-it + use-up recipe summary
How to use Slack for remote work? Practical techniques to hear from Slack Japan representative Sasaki
[Today's sale information] Amazon time sale is a bargain for a multifunctional smart watch of 1,000 yen level and a folding desk light that becomes a mobile battery of 2,000 yen level
Think efficiency rather than messy effort. &quot;Do not be alone&quot; self-study method of active University of Tokyo students
A united bag that is perfect for business trips and easy excursions [Today's Life Hack Tool]
You can choose various illustrations and layouts, and you can also use English letters. Name stamp that you want to push
This new type of coronavirus will not end soon. Accepting reality and living
Eliminate lack of exercise! Recommended home fitness videos/games/apps
The problem that I noticed during remote work is that only the computer has slow Wi-Fi. What is the reason and what is the countermeasure?
Telework recommended goods! I tried using &quot;beblau&quot; that can carry a notebook PC and peripherals together
Easy and delicious anchovy butter can be used for any dish
[10% off for readers only] When a thing moves, we will notify you with a warning sound and a smartphone. &quot;Trac Mo Leaf&quot; that can be tracked and prevents theft and lost property
What is it like working with your family? What is the task? ｜Everyone's remote work
Precautions when making antiseptic solution at home ｜ It is dangerous if you put the ingredients in the wrong order.
[Today's sale information] At the Amazon time sale, mouthwash with 6 kinds of effects such as whitening and sterilization at 900 yen level and gel cushion for low back pain with good breathability are a bargain
Balance and calmness even in difficult and difficult situations. Two words that can't be translated
For those who do not want to keep their breast pockets twisted, a case where you can quickly take out several pens [Today's Life Hack Tool]
</code></pre></div></details>
<p>I&rsquo;ll label the acquired title as &ldquo;I&rsquo;m not interested&rdquo; (the data is a little too small in the above case, so I&rsquo;m actually collecting data from others).</p>
<details><summary>Result of labeling</summary><div>
<pre><code class="language-labeled_title.tsv" data-lang="labeled_title.tsv">label_topic text
__label__O To solve the problem that an error message is displayed every time Windows starts
__label__X If it's a key case, &quot;Wunderkey&quot; made in Germany is multifunctional and recommended for the outdoors!
__label__X Just put it in the washing machine. With the power of natural &quot;iodine&quot;, it can prevent mildew for 3 months, and disinfect and deodorize laundry!
__label__O Three things to prepare, easy to cook. 1 week make-it + use-up recipe summary
__label__O What are the tips for using Slack during remote work? Practical techniques to ask Slack Japan Sasaki representative
__label__O [Today's sale information] Amazon time sale is a bargain for a multifunctional smart watch of 1,000 yen level and a folding desk light that becomes a mobile battery of 2,000 yen level
__label__X think more efficient than messy efforts. &quot;Do not be alone&quot; self-study method of active University of Tokyo students
__label__O A united bag that is perfect for business trips and easy excursions [Today's life hack tool]
__label__O A variety of illustrations and layouts can be selected, and English characters are also possible. Name stamp that you want to push
__label__X This new type of coronavirus will not end soon. Accepting reality and living
__label__O Eliminate lack of exercise! Recommended home fitness videos/games/apps
__label__O The problem that I noticed in remote work is that only the computer has slow Wi-Fi. What is the reason and what is the countermeasure?
__label__X Telework recommended goods! I tried using &quot;beblau&quot; that can carry a notebook PC and peripherals together
__label__O Easy and delicious anchovy butter can be used for any dish
__label__X [10% off for readers only] Notify the alert sound &amp; smartphone when something moves. &quot;TracMoLeaf&quot; that can be tracked and prevents theft and lost property
__label__O How do you feel to work with your family? What is the task? ｜Everyone's remote work
__label__O Precautions when preparing antiseptic solution at home ｜ It is dangerous if you put the ingredients in the wrong order.
__label__X [Today's sale information] At the Amazon time sale, mouthwash with 6 kinds of effects such as whitening and sterilization at 900 yen level and gel cushion with low back pain with good ventilation are a bargain
__label__O Balance and calmness even in difficult and difficult situations. Two words that can't be translated
__label__O A case where you can quickly take out several pens for those who do not want to keep their breast pockets twisted [Today's life hack tool]
</code></pre></div></details>
<p>It is divided into train.tsv, dev.tsv, and test.tsv for training, testing during training, and testing output results.
And read it with the code like the following (note that column_name_map did not work well unless you started from 0. <a href="https://github.com/flairNLP/flair/blob/master/resources/docs/TUTORIAL_6_CORPUS.md#load-from-simple-csv-file">Sample</a>wasfrom1&hellip;).
In addition, flair&rsquo;s morphological analysis engine for Japanese is specified for tokenizer so that you can learn Japanese while performing morphological analysis (internally MeCab).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-learning.py" data-lang="learning.py"><span style="color:#75715e">#!apt install aptitude swig</span>
<span style="color:#75715e">#!aptitude install mecab libmecab-dev mecab-ipadic-utf8 git make curl xz-utils file -y</span>
<span style="color:#75715e">#!pip install mecab-python3</span>
<span style="color:#75715e">#!pip install konoha[mecab]</span>
<span style="color:#f92672">from</span> flair.data <span style="color:#f92672">import</span> Corpus
<span style="color:#f92672">from</span> flair.datasets <span style="color:#f92672">import</span> CSVClassificationCorpus
<span style="color:#f92672">from</span> flair.data <span style="color:#f92672">import</span> build_japanese_tokenizer
<span style="color:#f92672">from</span> flair.data <span style="color:#f92672">import</span> Sentence

<span style="color:#75715e"># instantiate Japanese tokenizer</span>
japanese_tokenizer <span style="color:#f92672">=</span> build_japanese_tokenizer()

<span style="color:#75715e"># this is the folder in which train, test and dev files reside</span>
data_folder <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;resources/data&#39;</span>

<span style="color:#75715e"># column format indicating which columns hold the text and label(s)</span>
column_name_map <span style="color:#f92672">=</span> {<span style="color:#ae81ff">1</span>: <span style="color:#e6db74">&#34;text&#34;</span>, <span style="color:#ae81ff">0</span>: <span style="color:#e6db74">&#34;label_topic&#34;</span>}

<span style="color:#75715e"># load corpus containing training, test and dev data and if CSV has a header, you can skip it</span>
corpus: Corpus <span style="color:#f92672">=</span> CSVClassificationCorpus(data_folder,
                                         column_name_map,
                                         skip_header<span style="color:#f92672">=</span>True,
                                         delimiter<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">&#39;</span>, <span style="color:#75715e"># tab-separated files</span>
                                         tokenizer<span style="color:#f92672">=</span>japanese_tokenizer,
)
</code></pre></div><p>And we will continue to learn.
Embedding uses a pre-learned language model of Japanese.</p>
<details><summary>Learning code</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-learning.py" data-lang="learning.py"><span style="color:#f92672">from</span> flair.data <span style="color:#f92672">import</span> Corpus
<span style="color:#f92672">from</span> flair.embeddings <span style="color:#f92672">import</span> WordEmbeddings, FlairEmbeddings, DocumentRNNEmbeddings
<span style="color:#f92672">from</span> flair.models <span style="color:#f92672">import</span> TextClassifier
<span style="color:#f92672">from</span> flair.trainers <span style="color:#f92672">import</span> ModelTrainer

<span style="color:#75715e"># 2. create the label dictionary</span>
label_dict <span style="color:#f92672">=</span> corpus<span style="color:#f92672">.</span>make_label_dictionary()

<span style="color:#75715e"># 3. make a list of word embeddings</span>
word_embeddings <span style="color:#f92672">=</span> [
    FlairEmbeddings(<span style="color:#e6db74">&#39;ja-forward&#39;</span>),
    FlairEmbeddings(<span style="color:#e6db74">&#39;ja-backward&#39;</span>),
]<span style="color:#75715e"># 4. initialize document embedding by passing list of word embeddings</span>
<span style="color:#75715e"># Can choose between many RNN types (GRU by default, to change use rnn_type parameter)</span>
document_embeddings: DocumentRNNEmbeddings <span style="color:#f92672">=</span> DocumentRNNEmbeddings(word_embeddings,
                                                                     hidden_size<span style="color:#f92672">=</span><span style="color:#ae81ff">512</span>,
                                                                     reproject_words<span style="color:#f92672">=</span>True,
                                                                     reproject_words_dimension<span style="color:#f92672">=</span><span style="color:#ae81ff">256</span>,
                                                                     )

<span style="color:#75715e"># 5. create the text classifier</span>
classifier <span style="color:#f92672">=</span> TextClassifier(document_embeddings, label_dictionary<span style="color:#f92672">=</span>label_dict)

<span style="color:#75715e"># 6. initialize the text classifier trainer</span>
trainer <span style="color:#f92672">=</span> ModelTrainer(classifier, corpus)

<span style="color:#75715e"># 7. start the training</span>
trainer<span style="color:#f92672">.</span>train(<span style="color:#e6db74">&#39;resources/taggers/topics&#39;</span>,
              learning_rate<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>,
              mini_batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">32</span>,
              anneal_factor<span style="color:#f92672">=</span><span style="color:#ae81ff">0.5</span>,
              patience<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>,
              max_epochs<span style="color:#f92672">=</span><span style="color:#ae81ff">150</span>)
</code></pre></div></div></details>
<p>結果はこんな感じです。
まあ…こんなもん？</p>
<details><summary>予測結果</summary><div>
`タイトル スコア` で並んでいます。
0のものはラベルがXで興味のないものです。
<pre><code class="language-結果" data-lang="結果">iPadのマウスカーソルをカスタマイズする方法とそのメリット 0.7735286951065063
部屋が汚くなってしまう原因は？実は心理的な問題かもしれない 0.5715058445930481
信用できないZoomの公開ミーティングは、クリックしてはだめです！絶対に 0.6436247825622559
おしゃれなメンズにおすすめ！持ち運びやすいステンレスボトル「Hashy Bottle」 0.5991207361221313
Windows起動時に毎回エラーメッセージが表示される問題を解決するには 0.7882207632064819
キーケースならドイツ製「Wunderkey」が多機能でアウトドアにもオススメ！ 0
洗濯機に入れるだけ。天然の「ヨード」の力で3カ月防カビでき、洗濯物も除菌・消臭！ 0
用意するものは3つ、調理も簡単。1週間作り置き+使い切りレシピまとめ 0.8449271321296692
リモートワーク時のSlack活用のコツは？ Slack Japan佐々木代表に聞く実践術 0.8076369762420654
【本日のセール情報】Amazonタイムセールで、1,000円台の多機能なスマートウォッチや2,000円台のモバイルバッテリーになる折
りたたみデスクライトがお買い得に 0.6543766856193542
がむしゃらな努力より効率を考える。現役東大生の「ひとりでしない」独学法 0
出張や気楽な小旅行にピッタリの合体型バッグ【今日のライフハックツール】 0.8223538398742676
いろいろなイラストやレイアウトが選べて、英字も可能。ペタペタ押したくなるネームスタンプ 0.8168759942054749
この新型コロナウイルス禍はすぐには終わらない。現実を受け入れて生きるしかない 0
運動不足解消！オススメの自宅フィットネス動画・ゲーム・アプリ 0.834682047367096
リモートワークで気づいた「パソコンだけがWi-Fi遅い」問題。その理由と対策は？ 0.7229756712913513
テレワークおすすめグッズ！ノートPCと周辺機器を一緒に持ち運べる「beblau」を使ってみた 0
簡単おいしいアンチョビバターはどんな料理にも使える 0.671667754650116
【読者限定で10%オフに】物が動いたら警告音＆スマホにお知らせ。トラッキングもできて盗難や忘れ物を防ぐ「tracMo Leaf」 0
家族と一緒に働くってどんな感じ？その課題は？｜みんなのリモートワーク 0.8411679267883301
</code></pre></div></details>
<h2 id="api化">API化</h2>
<p><a href="https://palletsprojects.com/p/flask/">Flask</a> を使ってAPI化します。
APIの解説は他の記事にお任せします。</p>
<p>モデルを読み込み、興味のあるものの中で最も尤度の高いものをレスポンスとして返します。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-server.py" data-lang="server.py"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_score</span>(text):
    <span style="color:#75715e"># create example sentence</span>
    sentence <span style="color:#f92672">=</span> Sentence(text, use_tokenizer<span style="color:#f92672">=</span>japanese_tokenizer)
    <span style="color:#75715e"># predict class and print</span>
    classifier<span style="color:#f92672">.</span>predict(sentence)

    label_dict <span style="color:#f92672">=</span> sentence<span style="color:#f92672">.</span>to_dict()[<span style="color:#e6db74">&#34;labels&#34;</span>][<span style="color:#ae81ff">0</span>]
    
    <span style="color:#66d9ef">return</span> label_dict[<span style="color:#e6db74">&#34;confidence&#34;</span>] <span style="color:#66d9ef">if</span> label_dict[<span style="color:#e6db74">&#34;value&#34;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__label__O&#34;</span> <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">0</span>


<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_feed</span>():
    RSS_URL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://www.lifehacker.jp/feed/index.xml&#34;</span>
    feed <span style="color:#f92672">=</span> feedparser<span style="color:#f92672">.</span>parse(RSS_URL)

    before_score <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    response_message <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
    <span style="color:#66d9ef">for</span> entry <span style="color:#f92672">in</span> feed<span style="color:#f92672">.</span>entries:
        score <span style="color:#f92672">=</span> get_score(entry<span style="color:#f92672">.</span>title)
        <span style="color:#66d9ef">if</span> score <span style="color:#f92672">&gt;</span> before_score :
            before_score <span style="color:#f92672">=</span> score
            response_message <span style="color:#f92672">=</span> entry<span style="color:#f92672">.</span>title
    <span style="color:#66d9ef">return</span> response_message
</code></pre></div><h2 id="成果物">成果物</h2>
<p><a href="https://github.com/ochiba0227/feed_flask">https://github.com/ochiba0227/feed_flask</a></p>
<h1 id="声での読み上げ">声での読み上げ</h1>
<h2 id="seikasay">Seikasay</h2>
<p>読み上げを実施するにあたり、<a href="https://hgotoh.jp/wiki/doku.php/documents/voiceroid/seikacenter/seikacenter-003">Seikasay</a>を利用させていただきました。
環境構築方法などは、公式ページを参照ください。</p>
<h2 id="記事タイトルの読み上げ">記事タイトルの読み上げ</h2>
<p>30分に一度、上記で作成したAPIにリクエストを投げて、記事を取得します。
コードはこんな感じで&hellip;必要であればforeverなどを利用してデーモン化してください。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-client.py" data-lang="client.py"><span style="color:#75715e"># coding utf-8</span>
<span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> subprocess
<span style="color:#f92672">import</span> schedule
<span style="color:#f92672">import</span> time

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">job</span>():
    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;http://127.0.0.1:5000&#34;</span>)
    cmd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;seikasay -cid 2000 -t &#34;{}&#34;&#39;</span><span style="color:#f92672">.</span>format(response<span style="color:#f92672">.</span>json()[<span style="color:#e6db74">&#34;args&#34;</span>][<span style="color:#e6db74">&#34;message&#34;</span>] )
    returncode <span style="color:#f92672">=</span> subprocess<span style="color:#f92672">.</span>run(cmd,shell<span style="color:#f92672">=</span>True)

<span style="color:#66d9ef">if</span> __name__<span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    schedule<span style="color:#f92672">.</span>every(<span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>minutes<span style="color:#f92672">.</span>do(job)
    <span style="color:#66d9ef">while</span> True:
        schedule<span style="color:#f92672">.</span>run_pending()
        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
</code></pre></div><h1 id="感想">感想</h1>
<p>想像以上に簡単に構築することができました。
ライブラリやAPIを提供していただけているのは本当にありがたいです。
また、学習を<a href="https://colab.research.google.com/notebooks/intro.ipynb?hl=ja">Google Colab</a>でGPUで高速に実行できたお陰だと思います。本当に太っ腹。
が、公式に書いてある通りにやっても動かないことがあるのが&hellip;英語が読めていないだけかもですが（ <code>__label__</code> 無くても動きそうだし。fasttext向けのフォーマットだから今回の読み込み方だったらいらなかったのかな）。</p>
<p>今後は、Techcrunch以外も学習データに入れて、広範囲に興味のある記事を抽出できるようにしていきたいです。</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
