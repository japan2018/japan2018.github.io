<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>The result of making and sharing an Italian honeymoon map album in Python | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>The result of making and sharing an Italian honeymoon map album in Python</h1>
<p>
  <small class="text-secondary">
  
  
  Mar 5, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/openstreetmap"> OpenStreetMap</a></code></small>


<small><code><a href="https://memotut.com/tags/visualization"> visualization</a></code></small>


<small><code><a href="https://memotut.com/tags/jupyter"> Jupyter</a></code></small>


<small><code><a href="https://memotut.com/tags/folium"> folium</a></code></small>

</p>
<pre><code>I went on a honeymoon to Italy a while ago. I took about 1,000 photos when I noticed it on a tour of Milan, Venice, Florence, Pisa, Rome and Pompeii in one week.
</code></pre>
<p>There was some free time, so I took a walk around 10,000 steps every day, so I wanted to make a record with the route included, so I made a map album&hellip;!</p>
<h1 id="visualization">Visualization</h1>
<p>The whole picture looks something like this. I use the map of OpenStreetMap.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/55208/d64f7203-34fa-5b34-3ef2-642dafb63fd2.png" alt=""></p>
<p>From here, if you zoom in on Venice, for example, you can see the walking route like this. I use different colors depending on the date, and since I stayed in Venice for one night, there is a two-color route.
And the marker is the point where the photo was taken, and when clicked, the photo pops up.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/55208/3b6719ff-9da5-809f-728d-fd6058c8a92c.png" alt=""></p>
<p>This is the original photo. Since I took it during the gondola tour, the marker is also on the waterway.
I was looking forward to the fact that Venice is a holy land for &ldquo;ARIA&rdquo;, but it was a water city far more fantastic than I expected. I will do my best to recommend it.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/55208/53bb94cc-2606-40e0-2f36-7230ff159ecd.jpeg" alt=""></p>
<p>This is the Plaza de Espa√±a, which is the sacred place of the timeless masterpiece &ldquo;Roman Holiday&rdquo;. I watched it on an airplane to go (Oh!</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/55208/66a64a0e-1f71-3aee-7546-fdbda633011c.png" alt=""></p>
<p>This is a cat watching over Pompeii, which has been destroyed by an eruption. Cats appear here and there. It was a cat. Nice to meet you</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/55208/4614764c-8adc-527b-d070-2a63cc0e293a.png" alt=""></p>
<p>#Reaction</p>
<p>I shared it with my family and friends, but I was very happy because I was able to share my memories while showing photos while following the journey. I went through this stall street, had a quick dinner at this shop, and ran on this road just before the meeting time.
However, since I shared the HTML file that exported the JupyterLab notebook as it was, the engineers started reading the Python code, and there was a difficulty that I could not hear this story easily w</p>
<h1 id="procedure">Procedure</h1>
<p>I wrote about 50 lines of Python code on JupyterLab and performed the following processing.
I&rsquo;ve started using Folium for work, but it&rsquo;s very easy.</p>
<ul>
<li>Read the image file with Pillow.</li>
<li>Extract the latitude/longitude information from the image Exif.</li>
<li>Extract and apply the rotation/reversal information from the image Exif.</li>
<li>Draw a route by feeding the Folium column of latitude and longitude.</li>
<li>Folium feeds latitude/longitude and Base64 encoded image and hits a marker.</li>
<li>Output HTML with JupterLab.</li>
</ul>
<p>I can pass the image tag to the Folium marker, but it seems that I can not refer to the local file, so I am using the rough technique of encoding to Base64.
Thanks to that, it is easy to share because it can output a single independent HTML file, but it is about 100 MB HTML file because it is about 1000 images although it is reduced&hellip; &hellip;W</p>
<p>#Code</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> base64
<span style="color:#f92672">import</span> folium
<span style="color:#f92672">import</span> glob
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">from</span> io <span style="color:#f92672">import</span> BytesIO
<span style="color:#f92672">from</span> matplotlib <span style="color:#f92672">import</span> pyplot <span style="color:#66d9ef">as</span> plt
<span style="color:#f92672">from</span> PIL <span style="color:#f92672">import</span> ExifTags, Image, ImageOps
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">to_deg</span>(v, ref, pos):
    d <span style="color:#f92672">=</span> float(v[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">/</span> float(v[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">1</span>])
    m <span style="color:#f92672">=</span> float(v[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">/</span> float(v[<span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">1</span>])
    s <span style="color:#f92672">=</span> float(v[<span style="color:#ae81ff">2</span>][<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">/</span> float(v[<span style="color:#ae81ff">2</span>][<span style="color:#ae81ff">1</span>])
    <span style="color:#66d9ef">return</span> (d <span style="color:#f92672">+</span> (m <span style="color:#f92672">/</span> <span style="color:#ae81ff">60.0</span>) <span style="color:#f92672">+</span> (s <span style="color:#f92672">/</span> <span style="color:#ae81ff">3600.0</span>)) <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">if</span> ref <span style="color:#f92672">==</span> pos <span style="color:#66d9ef">else</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">to_trans_methods <span style="color:#f92672">=</span> {
    <span style="color:#ae81ff">1</span>: [],
    <span style="color:#ae81ff">2</span>: [Image<span style="color:#f92672">.</span>FLIP_LEFT_RIGHT],
    <span style="color:#ae81ff">3</span>: [Image<span style="color:#f92672">.</span>ROTATE_180],
    <span style="color:#ae81ff">4</span>: [Image<span style="color:#f92672">.</span>FLIP_TOP_BOTTOM],
    <span style="color:#ae81ff">5</span>: [Image<span style="color:#f92672">.</span>FLIP_LEFT_RIGHT, Image<span style="color:#f92672">.</span>ROTATE_90],
    <span style="color:#ae81ff">6</span>: [Image<span style="color:#f92672">.</span>ROTATE_270],
    <span style="color:#ae81ff">7</span>: [Image<span style="color:#f92672">.</span>FLIP_LEFT_RIGHT, Image<span style="color:#f92672">.</span>ROTATE_270],
    <span style="color:#ae81ff">8</span>: [Image<span style="color:#f92672">.</span>ROTATE_90]
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">files <span style="color:#f92672">=</span> glob<span style="color:#f92672">.</span>glob(<span style="color:#e6db74">&#39;/path/to/*.jpg&#39;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">rows <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> files:
    <span style="color:#66d9ef">with</span> Image<span style="color:#f92672">.</span>open(file) <span style="color:#66d9ef">as</span> im:
        exif <span style="color:#f92672">=</span> {ExifTags<span style="color:#f92672">.</span>TAGS[k]: v <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> im<span style="color:#f92672">.</span>getexif()<span style="color:#f92672">.</span>items() <span style="color:#66d9ef">if</span> k <span style="color:#f92672">in</span> ExifTags<span style="color:#f92672">.</span>TAGS}
        <span style="color:#66d9ef">if</span><span style="color:#e6db74">&#39;GPSInfo&#39;</span> <span style="color:#f92672">in</span> exif:
            gps <span style="color:#f92672">=</span> {ExifTags<span style="color:#f92672">.</span>GPSTAGS[k]: v <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> exif[<span style="color:#e6db74">&#39;GPSInfo&#39;</span>]<span style="color:#f92672">.</span>items() <span style="color:#66d9ef">if</span> k <span style="color:#f92672">in</span> ExifTags<span style="color:#f92672">.</span>GPSTAGS}
            lat <span style="color:#f92672">=</span> to_deg(gps[<span style="color:#e6db74">&#39;GPSLatitude&#39;</span>], gps[<span style="color:#e6db74">&#39;GPSLatitudeRef&#39;</span>],<span style="color:#e6db74">&#39;N&#39;</span>)
            lon <span style="color:#f92672">=</span> to_deg(gps[<span style="color:#e6db74">&#39;GPSLongitude&#39;</span>], gps[<span style="color:#e6db74">&#39;GPSLongitudeRef&#39;</span>],<span style="color:#e6db74">&#39;E&#39;</span>)
            im<span style="color:#f92672">.</span>thumbnail((<span style="color:#ae81ff">192</span>, <span style="color:#ae81ff">192</span>))
            <span style="color:#66d9ef">for</span> method <span style="color:#f92672">in</span> to_trans_methods[exif<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;Orientation&#39;</span>, <span style="color:#ae81ff">1</span>)]:
                im <span style="color:#f92672">=</span> im<span style="color:#f92672">.</span>transpose(method)
            buf <span style="color:#f92672">=</span> BytesIO()
            im<span style="color:#f92672">.</span>save(buf, format<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;png&#34;</span>)
            rows<span style="color:#f92672">.</span>append([lat, lon, exif[<span style="color:#e6db74">&#39;DateTimeOriginal&#39;</span>], base64<span style="color:#f92672">.</span>b64encode(buf<span style="color:#f92672">.</span>getvalue())<span style="color:#f92672">.</span>decode()])

df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(rows, columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;lat&#39;</span>,<span style="color:#e6db74">&#39;lon&#39;</span>,<span style="color:#e6db74">&#39;dt&#39;</span>,<span style="color:#e6db74">&#39;base64&#39;</span>])
df[<span style="color:#e6db74">&#39;dt&#39;</span>] <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>to_datetime(df[<span style="color:#e6db74">&#39;dt&#39;</span>], format<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;%Y:%m:</span><span style="color:#e6db74">%d</span><span style="color:#e6db74"> %H:%M:%S&#39;</span>)
df <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>sort_values(<span style="color:#e6db74">&#39;dt&#39;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fmap <span style="color:#f92672">=</span> folium<span style="color:#f92672">.</span>Map(location<span style="color:#f92672">=</span>[df[<span style="color:#e6db74">&#39;lat&#39;</span>]<span style="color:#f92672">.</span>mean(), df[<span style="color:#e6db74">&#39;lon&#39;</span>]<span style="color:#f92672">.</span>mean()], zoom_start<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>)
hsv<span style="color:#f92672">=</span>[plt<span style="color:#f92672">.</span>get_cmap(<span style="color:#e6db74">&#39;hsv&#39;</span>, <span style="color:#ae81ff">12</span>)(i) <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">12</span>)]
fmap<span style="color:#f92672">.</span>add_child(folium<span style="color:#f92672">.</span>ColorLine(zip(df[<span style="color:#e6db74">&#39;lat&#39;</span>], df[<span style="color:#e6db74">&#39;lon&#39;</span>]), colors<span style="color:#f92672">=</span>df[<span style="color:#e6db74">&#39;dt&#39;</span>]<span style="color:#f92672">.</span>dt<span style="color:#f92672">.</span>day, colormap<span style="color:#f92672">=</span>hsv, weight<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>))
<span style="color:#66d9ef">for</span> _, row <span style="color:#f92672">in</span> df<span style="color:#f92672">.</span>iterrows():
    fmap<span style="color:#f92672">.</span>add_child(folium<span style="color:#f92672">.</span>Marker([row[<span style="color:#e6db74">&#39;lat&#39;</span>], row[<span style="color:#e6db74">&#39;lon&#39;</span>]], popup<span style="color:#f92672">=</span>f<span style="color:#e6db74">&#39;&lt;img src=&#34;data:image/png;base64,{row[&#34;base64&#34;]}&#34; &gt;&#39;</span>))
fmap
</code></pre></div><h1 id="execution-environment">Execution environment</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ python --version
Python 3.7.4

$ pip list | grep -e folium -e jupyter -e matplotlib -e pandas -e Pillow
folium 0.10.1
jupyter-client 5.3.3
jupyter-core 4.5.0
jupyterlab 1.1.4
jupyterlab-server 1.0.6
matplotlib 3.1.2
pandas 1.0.1
Pillow 7.0.0
</code></pre></div><h1 id="reference-link">Reference link</h1>
<p><a href="https://news.mynavi.jp/article/zeropython-42/">Let&rsquo;s find out the shooting location from GPS information embedded in the photo with Python | Mynavi News</a>
<a href="https://qiita.com/Klein/items/a04cf1a6c94d6f03846e">Process in PIL considering EXIF Orientation tag | Qiita</a>
<a href="https://github.com/python-visualization/folium/issues/604">View image on popup | python-visualization/folium</a></p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
