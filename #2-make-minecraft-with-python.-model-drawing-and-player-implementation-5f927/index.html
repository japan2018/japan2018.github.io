<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[#2] Make Minecraft with Python. -Model drawing and player implementation- | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[#2] Make Minecraft with Python. -Model drawing and player implementation-</h1>
<p>
  <small class="text-secondary">
  
  
  Jan 24, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/minecraft"> minecraft</a></code></small>


<small><code><a href="https://memotut.com/tags/game-production"> game production</a></code></small>


<small><code><a href="https://memotut.com/tags/pyglet"> pyglet</a></code></small>


<small><code><a href="https://memotut.com/tags/panda3d"> Panda3D</a></code></small>

</p>
<pre><code>&lt;font color=&quot;grey&quot;&gt;Part of pictures, articles, images on this page are copyrighted by Mojang AB.&lt;/font&gt;
</code></pre>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/4c03684c-1ee7-4b2f-01b7-92836d12a930.png" alt="minecraft.png"></p>
<p>#Overview
This project reproduces the world-famous sandbox game &ldquo;Minecraft&rdquo; in the programming language &ldquo;Python&rdquo;.</p>
<p>** Previous article: <a href="https://qiita.com/kkent030315/items/fd9ff0c943b65761b074">[[1] Making Minecraft with Python.-Survey and design-]</a>**</p>
<p>** Next article: [<a href="https://qiita.com/kkent030315/items/3ea7d7c59f6fdcc43ce4">[3] Making Minecraft with Python. ~Improvement of player&rsquo;s movement (concept of inertia) and collision detection ~)</a> **</p>
<p>#Introduction
Thank you very much for your patience.
It&rsquo;s the second bullet!</p>
<p>#What to do this time</p>
<ul>
<li>Selection of game engine</li>
<li>Trial run</li>
<li>Model drawing</li>
<li>Player implementation</li>
</ul>
<h2 id="game-engine-selection">Game engine selection</h2>
<p>Since it is impossible to make a 3D game engine from scratch, I searched for a 3D game engine (library) that also supports Python.</p>
<p>Among them, we have selected one that is relatively easy to use and is likely to produce beautiful drawings.</p>
<p>##Panda3D Engine
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/0a83205b-c043-e9c8-17ad-8ba14bf60ac0.png" alt="509ed0ebac43da9c5fa01735640f7ef6.png"></p>
<p><a href="https://www.panda3d.org/">&ldquo;Panda3D&rdquo;</a> is a 3D game engine.
The platforms are Python and C++.</p>
<h3 id="i-tried-using-panda3d">I tried using Panda3D</h3>
<p>I will actually move it.</p>
<p>▼ Install</p>
<pre><code>pip install --pre --extra-index-url https://archive.panda3d.org/ panda3d
</code></pre><p>▼ Source code</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:main.py" data-lang="python:main.py"><span style="color:#f92672">from</span> Renderer <span style="color:#f92672">import</span> engine

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
    _render <span style="color:#f92672">=</span> engine<span style="color:#f92672">.</span>Renderer()
    _render<span style="color:#f92672">.</span>run()

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    main()
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:engine.py" data-lang="python:engine.py"><span style="color:#f92672">from</span> direct.showbase.ShowBase <span style="color:#f92672">import</span> ShowBase
<span style="color:#f92672">from</span> direct.gui.OnscreenText <span style="color:#f92672">import</span> OnscreenText
<span style="color:#f92672">from</span> panda3d.core <span style="color:#f92672">import</span> TextNode
<span style="color:#f92672">from</span> pandac.PandaModules <span style="color:#f92672">import</span> WindowProperties

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Renderer</span>(ShowBase):

    <span style="color:#66d9ef">def</span> __init__(self):
        ShowBase<span style="color:#f92672">.</span>__init__(self)

        props <span style="color:#f92672">=</span> WindowProperties()
        props<span style="color:#f92672">.</span>setTitle(<span style="color:#e6db74">&#39;PyCraft&#39;</span>)
        props<span style="color:#f92672">.</span>setSize(<span style="color:#ae81ff">1280</span>, <span style="color:#ae81ff">720</span>)
        self<span style="color:#f92672">.</span>win<span style="color:#f92672">.</span>requestProperties(props)

        OnscreenText(text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PyCraft ScreenText&#34;</span>,
                     parent<span style="color:#f92672">=</span>None, align<span style="color:#f92672">=</span>TextNode<span style="color:#f92672">.</span>ARight,
                     fg<span style="color:#f92672">=</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>), pos<span style="color:#f92672">=</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">0.1</span>), scale<span style="color:#f92672">=.</span><span style="color:#ae81ff">08</span>,
                     shadow<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>))
</code></pre></div><p>It was drawn like this.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/699aa163-dd54-42a7-a3b8-729fbd297583.png" alt="image.png"></p>
<h4 id="load-the-model">Load the model</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:engine.py" data-lang="python:engine.py"><span style="color:#f92672">from</span> direct.showbase.ShowBase <span style="color:#f92672">import</span> ShowBase
<span style="color:#f92672">from</span> direct.gui.OnscreenText <span style="color:#f92672">import</span> OnscreenText
<span style="color:#f92672">from</span> panda3d.core <span style="color:#f92672">import</span> TextNode
<span style="color:#f92672">from</span> pandac.PandaModules <span style="color:#f92672">import</span> WindowProperties
<span style="color:#f92672">from</span> direct.showbase.Loader <span style="color:#f92672">import</span> Loader

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Renderer</span>(ShowBase):

    <span style="color:#66d9ef">def</span> __init__(self):
        ShowBase<span style="color:#f92672">.</span>__init__(self)

        props <span style="color:#f92672">=</span> WindowProperties()
        props<span style="color:#f92672">.</span>setTitle(<span style="color:#e6db74">&#39;PyCraft&#39;</span>)
        props<span style="color:#f92672">.</span>setSize(<span style="color:#ae81ff">1280</span>, <span style="color:#ae81ff">720</span>)
        self<span style="color:#f92672">.</span>win<span style="color:#f92672">.</span>requestProperties(props)

        OnscreenText(text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PyCraft ScreenText&#34;</span>,
                     parent<span style="color:#f92672">=</span>None, align<span style="color:#f92672">=</span>TextNode<span style="color:#f92672">.</span>ARight,
                     fg<span style="color:#f92672">=</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>), pos<span style="color:#f92672">=</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">0.1</span>), scale<span style="color:#f92672">=.</span><span style="color:#ae81ff">08</span>,
                     shadow<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.5</span>))

        self<span style="color:#f92672">.</span>scene <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>loader<span style="color:#f92672">.</span>loadModel(<span style="color:#e6db74">&#34;models/environment&#34;</span>)
        self<span style="color:#f92672">.</span>scene<span style="color:#f92672">.</span>reparentTo(self<span style="color:#f92672">.</span>render)
        self<span style="color:#f92672">.</span>scene<span style="color:#f92672">.</span>setScale(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
        self<span style="color:#f92672">.</span>scene<span style="color:#f92672">.</span>setPos(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>)

        self<span style="color:#f92672">.</span>cube <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>loader<span style="color:#f92672">.</span>loadModel(<span style="color:#e6db74">&#34;models/misc/rgbCube&#34;</span>)
        self<span style="color:#f92672">.</span>cube<span style="color:#f92672">.</span>reparentTo(self<span style="color:#f92672">.</span>render)
        self<span style="color:#f92672">.</span>cube<span style="color:#f92672">.</span>setScale(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>)
        self<span style="color:#f92672">.</span>cube<span style="color:#f92672">.</span>setPos(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">0</span>)
</code></pre></div><p>It turned out to be something like this.
It seems that you can operate it with a mouse.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/25a79eab-241e-d26b-3954-a9544ce99e38.png" alt="image.png">
The cube looks like this.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/419f8fc8-13f4-42aa-2766-29bec4b0a1e8.png" alt="image.png"></p>
<hr>
<h4 id="try-3d-drawing">Try 3D drawing</h4>
<blockquote>
<p>Reference: <a href="http://blog.livedoor.jp/gaziya/archives/55245611.html">gif for 6 seconds @panda3D</a></p>
</blockquote>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/921780aa-aa6a-d853-9032-c254553146ab.gif" alt="0ku48-wnqiw.gif"></p>
<p>▼ Source code
Since it will be long, only the core part will be described.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:engine.py" data-lang="python:engine.py">        self<span style="color:#f92672">.</span>world <span style="color:#f92672">=</span> BulletWorld()
        self<span style="color:#f92672">.</span>world<span style="color:#f92672">.</span>setGravity(Vec3(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">9.81</span>))
        self<span style="color:#f92672">.</span>worldPath <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>render<span style="color:#f92672">.</span>attachNewNode(<span style="color:#e6db74">&#34;&#34;</span>)

        debugNode <span style="color:#f92672">=</span> BulletDebugNode()
        nodePath <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>worldPath<span style="color:#f92672">.</span>attachNewNode(debugNode)
        nodePath<span style="color:#f92672">.</span>show()
        self<span style="color:#f92672">.</span>world<span style="color:#f92672">.</span>setDebugNode(debugNode)

        bodyGround <span style="color:#f92672">=</span> BulletRigidBodyNode()
        bodyGround<span style="color:#f92672">.</span>addShape(BulletBoxShape((<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">0.001</span>)))
        nodePath <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>worldPath<span style="color:#f92672">.</span>attachNewNode(bodyGround)
        nodePath<span style="color:#f92672">.</span>setPos(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>)
        nodePath<span style="color:#f92672">.</span>setHpr(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">0</span>)
        self<span style="color:#f92672">.</span>world<span style="color:#f92672">.</span>attachRigidBody(bodyGround)

        self<span style="color:#f92672">.</span>boxes <span style="color:#f92672">=</span> []
        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">30</span>):
            bodyBox <span style="color:#f92672">=</span> BulletRigidBodyNode()
            bodyBox<span style="color:#f92672">.</span>setMass(<span style="color:#ae81ff">1.0</span>)
            bodyBox<span style="color:#f92672">.</span>addShape(BulletBoxShape((<span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.5</span>, <span style="color:#ae81ff">0.5</span>)))
            nodePath <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>worldPath<span style="color:#f92672">.</span>attachNewNode(bodyBox)
            nodePath<span style="color:#f92672">.</span>setPos(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> i <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>)
            self<span style="color:#f92672">.</span>boxes<span style="color:#f92672">.</span>append(nodePath)
            self<span style="color:#f92672">.</span>world<span style="color:#f92672">.</span>attachRigidBody(bodyBox)
</code></pre></div><p>##Ogre3D
<a href="https://www.ogre3d.org/">&ldquo;Ogre3D&rdquo;</a> is one of the game engines that utilize hardware acceleration.
It seems to be compatible with Python and .NET as well as C++.
Realizing a 3D game on .NET is quite difficult, so I want to use Ogre.NET to realize &ldquo;I reproduced Minecraft in C#!&rdquo;.</p>
<p>Take a look at <a href="https://www.ogre3d.org/showcase">Showcase</a>.</p>
<p>This is a <a href="https://store.steampowered.com/app/408410/XMorph_Defense/?l=japanese">[X-Morph: Defense]</a> game.Of course, the Ogre engine is used. Great graphics.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/ce45bfb7-377d-1279-6ab1-b2fa9a43681a.png" alt="image.png"></p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/04fbc79f-cf9d-da97-8724-f028d4b62229.png" alt="image.png"></p>
<p>#Results of various thoughts
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/02127d3c-68c1-2fd0-dbc6-b5e6bb2610aa.png" alt="image.png"></p>
<p>In addition to game engines other than the above, we decided to use <a href="http://pyglet.org/">[Pyglet]</a>, which seems to be the most informative, considering that it is cross-platform.
It is also perfect that it does not depend on other libraries and that it supports multiple displays and multiple monitors.</p>
<p>I tried using #Pyglet
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/8af2f573-504a-cf01-355b-a0f46fc58448.png" alt="pyxpyg.png"></p>
<p>Now let&rsquo;s actually use Pyglet to do a simple drawing.</p>
<p>##Environment
▼ Install</p>
<pre><code>pip install pyglet
</code></pre><p>▼ Installation (for PyCharm)
<code>Menu bar</code>▶<code>File</code>▶<code>Settings</code>
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/3664e877-79ad-8532-e5b0-088dbfb0ad2f.png" alt="pygletins.png"></p>
<h2 id="try-to-move">Try to move</h2>
<p>▼Sample code</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:main.py" data-lang="python:main.py"><span style="color:#75715e"># Import module</span>
<span style="color:#f92672">from</span> pyglet.gl <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>

<span style="color:#75715e">#Window to display</span>
<span style="color:#75715e">#width is the width and height is the height.</span>
<span style="color:#75715e">#caption is the window title, resizable is resizing or not.</span>
pyglet<span style="color:#f92672">.</span>window<span style="color:#f92672">.</span>Window(width<span style="color:#f92672">=</span><span style="color:#ae81ff">700</span>, height<span style="color:#f92672">=</span><span style="color:#ae81ff">400</span>, caption<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Hello Pyglet!&#39;</span>, resizable<span style="color:#f92672">=</span>True)
pyglet<span style="color:#f92672">.</span>app<span style="color:#f92672">.</span>run()
</code></pre></div><p>It is OK if it is displayed like this.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/87b7694d-eed3-2747-4945-f8b2df2c64bd.png" alt="image.png"></p>
<h2 id="try-drawing-a-line">Try drawing a line</h2>
<p>OpenGL is used in Pyglet.</p>
<p>▼Sample code</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:main.py" data-lang="python:main.py"><span style="color:#75715e"># Import module</span>
<span style="color:#f92672">from</span> pyglet.gl <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>

<span style="color:#75715e">#window</span>
window <span style="color:#f92672">=</span> pyglet<span style="color:#f92672">.</span>window<span style="color:#f92672">.</span>Window(width<span style="color:#f92672">=</span><span style="color:#ae81ff">700</span>, height<span style="color:#f92672">=</span><span style="color:#ae81ff">400</span>, caption<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Hello Pyglet!&#39;</span>, resizable<span style="color:#f92672">=</span>True)

<span style="color:#75715e">#Window drawing event</span>
<span style="color:#a6e22e">@window.event</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_draw</span>():
    <span style="color:#75715e"># Clear the drawing</span>
    window<span style="color:#f92672">.</span>clear()
    glBegin(GL_LINES) <span style="color:#75715e"># start drawing lines</span>
    glColor3f(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>) <span style="color:#75715e"># R,G,B ÷ 255</span>
    From glVertex2f(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>) <span style="color:#75715e"># x, y(0, 0)</span>
    up to glVertex2f(<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">100</span>) <span style="color:#75715e"># x, y(100, 100)</span>
    glEnd() <span style="color:#75715e"># finish drawing the line</span>

pyglet<span style="color:#f92672">.</span>app<span style="color:#f92672">.</span>run()
</code></pre></div><p>When executed, the line will be drawn like this.
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/4a50f8f1-8db1-8d25-5ee2-f1287716a714.png" alt="image.png"></p>
<h3 id="explanation">Explanation</h3>
<p>In the above source code, the drawing event function of <code>window</code> is defined, and a line is drawn using OpenGL.
OpenGL seems to recognize the lower left corner of the screen as the zero coordinate.</p>
<p>**1. Declare the start of line drawing with <code>glBegin(GL_LINES)</code> **</p>
<p>**2. Declare a color with <code>glColor3f(1, 0, 0)</code> **
The colors here are RGB (Red, Green, Blue).
Each is usually 0 to 255, but since it is declared with <code>Float</code> here as it is <code>3f</code>, pass the number divided by <code>255.f</code> as an argument.
<code>3f</code> means to pass <code>3</code> numbers in <code>f</code>loat.</p>
<p>**2. Declare the start point of the line with <code>glVertex2f(x, y)</code> **
Pass the coordinates of the starting point of the line.
<code>2f</code> means to pass the coordinates of the <code>2</code> dimension with <code>f</code>loat.</p>
<p>**3. Declare the end point of the line with <code>glVertex2f(x, y)</code> **
Pass the coordinates of the end point of the line.
You can pass a value larger than the window size here, but it will not be drawn off screen.</p>
<p>**4. Declare the end of line drawing with <code>glEnd()</code> **</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/8b96ca5f-2b0b-a486-d170-c03971278424.png" alt="pygletdem2.png"></p>
<p>Try drawing a #Minecraft block model
Finally the main subject.</p>
<h2 id="preface">Preface</h2>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/5b0d3d73-35aa-0181-7ead-380b278a5ae8.png" alt="image.png">
To realize the project, trying to implement everything at once from the beginning is a <strong>big mistake</strong>.</p>
<p>Suppose you want to implement <code>feature A</code>, <code>feature B</code> and <code>feature C</code>.
When these are implemented all at once and a bug or defect occurs, it is difficult to identify which function (which part) is causing the bug or defect, or it takes longer than usual to discover the cause. I will do it.</p>
<p>The correct procedure is
Implementation of <code>Function A</code> ▶ ** Operation check ** ▶ Implementation of <code>Function B</code> ▶ ** Operation check ** ▶ Implementation of <code>Function C</code>
is.</p>
<p>In the unlikely event that a problem occurs after implementation of <code>Function C</code>, there is a problem between <code>Function B</code> and <code>Function C</code>.
Can be thought of. More efficient.
*Excluding defects due to compatibility of each function</p>
<p>At first, let&rsquo;s check the operation by implementing with the minimum configuration.
The introduction is long.</p>
<h2 id="prepare-texture">Prepare texture</h2>
<p>For the time being, we will use it as a trial, so we prepared this texture that is familiar to Minecraft.
▼ texture
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/1f56e71b-6960-c100-801b-7b6f43bc6950.png" alt="missing16.png"></p>
<p>##Implementation
Let&rsquo;s actually draw using the prepared texture!
The source code is long, so I posted it on Gist.</p>
<p>▼ Source code
<strong>Gist: <a href="https://gist.github.com/kkent030315/e18d011cae47f51cb002c267d3446205">main.py</a></strong></p>
<p>When executed, it will be drawn as follows.
<font color="grey"> *Normal condition. </font></p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/3efd2eba-b6f8-cb29-3df7-32053eba914c.png" alt="9a6730ede366fb49dbcb1cdd1a2c17c2.png"></p>
<p>For the time being, I was able to draw it, although there was only one surface.</p>
<h3 id="explanation-1">Explanation</h3>
<p>I will explain while extracting parts.
####world class
Define what is called a <code>Batch</code> that holds the <code>Vertex</code> to draw.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">self<span style="color:#f92672">.</span>batch <span style="color:#f92672">=</span> pyglet<span style="color:#f92672">.</span>graphics<span style="color:#f92672">.</span>Batch()
</code></pre></div><p>Then, define the three-dimensional coordinates that are important.
If it is set to <code>0</code> here, because it is drawn outside the screen and cannot be confirmed ** in consideration of the location of the initial camera, it is defined slightly deviated.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Define 3D world coordinates</span>
x <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>
y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
z <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>
</code></pre></div><p>Functions are provided for loading textures.
Use the <code>pyglet</code> native loader.
Specify the image patch for <code>path</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Function to load texture</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load_texture</span>(self, path):
    texture <span style="color:#f92672">=</span> pyglet<span style="color:#f92672">.</span>image<span style="color:#f92672">.</span>load(path)<span style="color:#f92672">.</span>get_texture() <span style="color:#75715e">#use pyglet texture loader</span>
    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST)
    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST)
    <span style="color:#66d9ef">return</span> pyglet<span style="color:#f92672">.</span>graphics<span style="color:#f92672">.</span>TextureGroup(texture)
</code></pre></div><h4 id="window-class">Window class</h4>
<p>Next is the window class.
This class inherits from the <code>pyglet.window.Window</code> class.</p>
<blockquote>
<p><a href="https://blog.codecamp.jp/python-class-2">What is &ldquo;inheritance&rdquo;? </a></p>
</blockquote>
<p>The initialization function initializes the <a href="https://qiita.com/msk02/items/60ea1bd5824fca134323">Instance</a> of the <code>World</code> class defined earlier.</p>
<p><code>super</code> is similar to Java.</p>
<blockquote>
<p><a href="https://www.lifewithpython.com/2014/01/python-super-function.html">&ldquo;What is super?&quot;</a></p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> __init__(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
    super()<span style="color:#f92672">.</span>__init__(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs)
    <span style="color:#75715e">#World class initialization</span>
    self<span style="color:#f92672">.</span>world <span style="color:#f92672">=</span> World()
</code></pre></div><p>Then, define the function that does the essential drawing.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">on_draw</span>(self):
    <span style="color:#75715e"># Clear screen</span>
    self<span style="color:#f92672">.</span>clear()
    <span style="color:#75715e">#World is 3D, so set to 3D drawing mode</span>
    self<span style="color:#f92672">.</span>render_mode_3d()<span style="color:#75715e"># Draw the world</span>
    self<span style="color:#f92672">.</span>world<span style="color:#f92672">.</span>draw()
</code></pre></div><p>Here is the <code>render_mode_3d()</code> function,
It is necessary to set the matrix mode when performing 3D drawing and 2D drawing.
There are **<code>Projection conversion mode(**)</code> and <strong><code>Field of view conversion mode(Model view)</code></strong>, and the default is the field of view conversion mode.
These matrix modes will be explained later.</p>
<p><font color="grey"> Note: Use <code>glLoadIdentity()</code> to erase (initialize) the cumulative mode conversion process. </font></p>
<hr>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">render_mode_3d</span>(self):
    self<span style="color:#f92672">.</span>render_mode_projection()
    <span style="color:#75715e">#Set field of view</span>
    gluPerspective(<span style="color:#ae81ff">70</span>, self<span style="color:#f92672">.</span>width <span style="color:#f92672">/</span> self<span style="color:#f92672">.</span>height, <span style="color:#ae81ff">0.05</span>, <span style="color:#ae81ff">1000</span>)
    self<span style="color:#f92672">.</span>render_mode_modelview()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">render_mode_2d</span>(self):
    self<span style="color:#f92672">.</span>render_mode_projection()
    <span style="color:#75715e">#Drawing area 0 to window_width, 0 to window_height</span>
    gluOrtho2D(<span style="color:#ae81ff">0</span>, self<span style="color:#f92672">.</span>width, <span style="color:#ae81ff">0</span>, self<span style="color:#f92672">.</span>height)
    self<span style="color:#f92672">.</span>render_mode_modelview()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">render_mode_projection</span>(self):
    glMatrixMode(GL_PROJECTION)<span style="color:#75715e"># Projection conversion mode</span>
    glLoadIdentity()<span style="color:#75715e"># clear cumulative conversion process</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">render_mode_modelview</span>(self):
    glMatrixMode(GL_MODELVIEW)<span style="color:#75715e">#Modeling conversion mode (view conversion)</span>
    glLoadIdentity()<span style="color:#75715e"># clear cumulative conversion process</span>
</code></pre></div><p><code>gluOrtho2D</code> performs projection transformation, which is parallel projection in 2D.
<code>gluOrtho2D(left, right, top, bottom)</code></p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/04c57830-6615-c1b2-a624-6d03d598113a.png" alt="gl2d.png"></p>
<p>Then, in <code>gluPerspective()</code>, set the field of view.
<code>gluPerspective(fovY, aspect, zNear, zFar)</code>
The Y-axis viewing angle, aspect (horizontal viewing angle), Z shortest distance, and Z longest distance.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/3c342a7e-8edc-7950-bac1-e6c4b80bde8c.png" alt="glsiya.png"></p>
<p>Also, <code>zNear</code> and <code>zFar</code> do not change the appearance on the screen.
This can be thought of as the same thing as if you were 1 meter closer to the screen or 1 meter closer to the screen.</p>
<p>###Extra edition
If you are not interested, you can skip this page because it will be a specialized content.</p>
<h4 id="matrix-mode">Matrix mode</h4>
<p>In matrix mode, there are <strong><code>visual field conversion (GL_PROJECTION)</code></strong> and <strong><code>modeling conversion (GL_MODELVIEW)</code></strong>.
<font color="grey"> *To be precise, there is also <code>GL_TEXTURE</code>, but this source does not handle it, so skip it. </font></p>
<p>Also, 3D ▶ 2D conversion is called <code>geometry conversion</code>.
ʻAffine conversion` for conversion when scaling/moving
I call it.</p>
<p>It&rsquo;s going to be super long &amp; I think some of them are interested, so I will throw it in an external article.
sorry.</p>
<blockquote>
<p><a href="https://qiita.com/koshian2/items/c133e2e10c261b8646bf">&ldquo;Affine transformation to fully understand&rdquo;</a></p>
</blockquote>
<p>I couldn&rsquo;t find a Japanese article that explains geometry transformation in detail.</p>
<h2 id="player-implementation">Player implementation</h2>
<p>I would like to draw all the blocks, but it is inconvenient to move the viewpoint as it is, so for the time being, I will implement the only viewpoint movement player.
I also used <a href="https://github.com/swistakm/pyimgui">[PyImGui]</a> to display debug information.</p>
<p>▼ Source code
<strong>Gist: <a href="https://gist.github.com/kkent030315/2f19c8e9ed1b4e07b4f54b1657ecd6bf">main.py</a></strong></p>
<p>▼ Such a feeling
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/e55ebe77-4de9-0400-7478-77c2a3c1ee46.gif" alt="ddiol-p2pjh.gif"></p>
<h2 id="lets-draw-the-entire-block">Let&rsquo;s draw the entire block</h2>
<p>Now that you can freely move the viewpoint and coordinates, let&rsquo;s draw the entire block.
The source code is as follows.
I&rsquo;m sorry if I&rsquo;m in the wrong direction. ~~ I&rsquo;m afraid, so I apologize in advance. ~~</p>
<p>▼ Source code
<strong>Gist: <a href="https://gist.github.com/kkent030315/a413484da860fc90e4920d3dcb43bcaf">main.py</a></strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#I am sorry if I make a mistake in the direction</span>
<span style="color:#75715e"># Front</span>
self<span style="color:#f92672">.</span>batch<span style="color:#f92672">.</span>add(<span style="color:#ae81ff">4</span>, GL_QUADS, self<span style="color:#f92672">.</span>loaded_texture, (<span style="color:#e6db74">&#39;v3f&#39;</span>, (x, y, z, x, y, z<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, x, y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, z<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, x, y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, z,)), texture_coordinates)
<span style="color:#75715e">#Backward</span>
self<span style="color:#f92672">.</span>batch<span style="color:#f92672">.</span>add(<span style="color:#ae81ff">4</span>, GL_QUADS, self<span style="color:#f92672">.</span>loaded_texture, (<span style="color:#e6db74">&#39;v3f&#39;</span>, (x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y, z<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y, z, x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, z, x<span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, z<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,)), texture_coordinates)
<span style="color:#75715e">#Bottom</span>
self<span style="color:#f92672">.</span>batch<span style="color:#f92672">.</span>add(<span style="color:#ae81ff">4</span>, GL_QUADS, self<span style="color:#f92672">.</span>loaded_texture, (<span style="color:#e6db74">&#39;v3f&#39;</span>, (x, y, z, x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y, z, x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y, z<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, x, y, z<span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>,)), texture_coordinates)
<span style="color:#75715e">#Top</span>
self<span style="color:#f92672">.</span>batch<span style="color:#f92672">.</span>add(<span style="color:#ae81ff">4</span>, GL_QUADS, self<span style="color:#f92672">.</span>loaded_texture, (<span style="color:#e6db74">&#39;v3f&#39;</span>, (x, y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, z<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, z<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, z, x, y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, z,)), texture_coordinates)
<span style="color:#75715e">#Right side</span>
self<span style="color:#f92672">.</span>batch<span style="color:#f92672">.</span>add(<span style="color:#ae81ff">4</span>, GL_QUADS, self<span style="color:#f92672">.</span>loaded_texture, (<span style="color:#e6db74">&#39;v3f&#39;</span>, (x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y, z, x, y, z, x, y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, z, x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, z,)), texture_coordinates)
<span style="color:#75715e">#left</span>
self<span style="color:#f92672">.</span>batch<span style="color:#f92672">.</span>add(<span style="color:#ae81ff">4</span>, GL_QUADS, self<span style="color:#f92672">.</span>loaded_texture, (<span style="color:#e6db74">&#39;v3f&#39;</span>, (x, y, z<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y, z<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, z<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, x, y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, z<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>,)), texture_coordinates)
</code></pre></div><p>▼It became like this
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/8ef79f54-b2ac-43ef-9381-f6fb6fad40d1.gif" alt="9cu9p-1169w.gif">
Now, as you can see from the video, there are some abnormalities in the drawing.
This is because the <em>extra part</em> such as the part that is not normally visible (rear surface) is drawn.
To prevent this, set <code>glEnable(GL_DEPTH_TEST)</code>.
This is a convenient thing that selects/eliminates the drawing of the surface that you do not want on the OpenGL side.</p>
<p>▼ After setting, it was drawn beautifully!
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/535270/b8cb465a-93f8-1451-6a15-9972ce8a8876.gif" alt="sq6py-82p4x.gif"></p>
<p>#Finally
This time, we selected the game engine, modeled it, and implemented the player.
Next time, I would like to build a world and implement hit detection.</p>
<p>Thank you for visiting this page until the end.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
