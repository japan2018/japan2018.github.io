<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Python] Use AWS interpreter with Pycharm | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] Use AWS interpreter with Pycharm</h1>
<p>
  <small class="text-secondary">
  
  
  May 4, 2017
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/pycharm">Pycharm</a></code></small>

</p>
<pre><code>## things to do
</code></pre>
<p>Develop with local pycharm using AWS instance interpreter!</p>
<h2 id="background">background</h2>
<p>When it is extremely difficult to install a specific module, it is very easy to use the already installed AWS AMI or docker container.
However, I want to do coding with an IDE such as pycharm, so it is a little difficult to enter the server and develop with vim. ..
With pycharm, I logged in to the server with remote, I found a function that can be coded using the interpreter of that server, so I tried it and made a note.
*Note that this can only be done with the professional version.</p>
<h2 id="environment">Environment</h2>
<ul>
<li>Mac Book Pro OSX El Capitan (ver10.11.3)</li>
<li>Pycharm Professional</li>
<li>AWS EC2 instance</li>
</ul>
<h2 id="method">Method</h2>
<h3 id="1-press-add-remote-in-pycharms-interpreter-settings">1 Press Add Remote in pycharm&rsquo;s interpreter settings.</h3>
<p>Click Pycharm Preferences → Project: hoge → Project Interpreter to display the following screen. If you click the gear on the upper right,
<img src="https://qiita-image-store.s3.amazonaws.com/0/40159/ca0145f6-819c-e9ec-ab32-e51e121c35f6.png" alt="Screenshot 2017-05-04 16.22.06.png">
The following window will appear. Press &ldquo;Add Remote&rdquo;.
<img width="127" alt=" screenshot 2017-05-04 16.37.16.png" src="https://qiita-image-store.s3.amazonaws.com/0/40159/cb8e1587-f2f2-4949-786d-8378d034ad68.png"></p>
<h3 id="2-ssh-settings">2 SSH settings</h3>
<p>When you press Add Remote, the interpreter&rsquo;s Configure appears. Press SSH Credentials and the following setting screen appears.
<img src="https://qiita-image-store.s3.amazonaws.com/0/40159/a8ac2d8f-eb0e-d36e-f2c5-2f146854dc82.png" alt="Screenshot 2017-05-04 16.22.29.png"></p>
<p>Here, specify the following respectively.</p>
<ul>
<li>Specify public IP such as Host:54.xx.xx.xx</li>
<li>port: specify port number for ssh connection</li>
<li>Specify ssh connection user such as user name:ec2-user</li>
<li>Specify the connection method of Auth type:password or pem</li>
<li>password: Specify the password or the destination to save the pem file</li>
<li>Python interpreter path: Specify the interpreter path.
*Basically /usr/bin/pythoin is fine, but if you don&rsquo;t understand it, check the path of the python you normally use with &ldquo;which python&rdquo; and set it.</li>
</ul>
<p>This is OK.
Sometimes, depending on the AMI, the working environment is built as a root user instead of a general user such as ec2-user, so at this time, I will mess with sshd_config and the public key.</p>
<pre><code>#sshd_config fix
vi /etc/ssh/sshd_config
# PermitRootLogin forced-commands-only below.
PermitRootLogin without-password

#Copy public key
mv /root/.ssh/authorized_keys /root/.ssh/authorized_keys_bak
cp -f /home/ec2-user/.ssh/authorized_keys /root/.ssh/authorized_keys
service sshd reload
</code></pre><p>I&rsquo;ve written this far, but I realized that this feature is quite annoying. ..
First, it cannot be executed unless the local path exists on the remote side.
Perhaps it is correct to use this function as if it were written locally and transferred to the remote.
Next, there are modules that cannot be imported for some reason.
I&rsquo;m using caffe, but import caffe says that&rsquo;s not the case.
I don&rsquo;t have pycaffe under anaconda, so I might have to move it under anaconda.</p>
<p>Hmmm, can you use it to make a source in a local IDE that doesn&rsquo;t show import errors and raise it? ? Wonder. ..
It&rsquo;s pretty sad that I can&rsquo;t debug it. .. ..
I will investigate the above problem if there is extra capacity.</p>
<h2 id="addition">Addition</h2>
<p>I added this because I noticed the correspondence between local and remote paths and the auto upload function.</p>
<h3 id="how-to-associate-local-and-remote">How to associate local and remote</h3>
<p>1 Click &ldquo;Edit Configuration..&rdquo; from &ldquo;RUN&rdquo; in the tab above.
2 Click the right side of Path Mapping.
3 Set local path and Remote path.
that&rsquo;s all.</p>
<h3 id="auto-upload-method">Auto upload method</h3>
<p>Even if you associate it, the work is only local, so you have to upload the source changed locally to AWS.
How to automatically upload the source modified with local pycharm to AWS.
1 In Preferences-&gt;Deployment, press the + button.
2 Select SFTP and specify the global IP Root path=&rdquo;/&rdquo; keypair. You can leave the Browse files on server as is.
3 In Preferences-&gt;Deployment-&gt;Options, change Upload changed files automatically&hellip; to Always and specify Override default permissions on files: to any permission.
that&rsquo;s all.</p>
<p>You can now code locally in pycharm and have it immediately reflected on AWS for development.
You can also debug. Great.</p>
<h3 id="when-using-cuda">When using cuda</h3>
<p>There may be an error because the path to the cuda lib system is missing.
In that case, in Run Configurations, set the following in the Environment Variable.</p>
<pre><code>LD_LIBRARY_PATH /usr/local/cuda/lib64:$LD_LIBRARY_PATH
</code></pre><h3 id="when-using-the-remote-interpreter-an-error-occurs-with--cannot-connect-to-x-server-in-debugging">When using the remote interpreter, an error occurs with &ldquo;: cannot connect to X server&rdquo; in debugging.</h3>
<p>I do not know exactly, but it seems that an error will occur if Xcode cannot be used on the server.
Therefore, work is required to complement with local Xcode.</p>
<ol>
<li>From the local, connect as follows.</li>
</ol>
<pre><code>ssh -Y username@ipaddress
</code></pre><p>Check the DISPLAY contents with the following command in the connection of 2.1.</p>
<pre><code>echo $DISPLAY
&gt;localhost:10.0
</code></pre><ol start="3">
<li>Set the contents of 2 to Environment Variable of pycharm.</li>
</ol>
<pre><code>DISPLAY localhost:10.0
</code></pre><p>Debugging with pycharm with 4.1 connection still connected.
OK.</p>
<h3 id="if-you-want-to-check-the-tensorboard-on-the-cloud-such-as-aws-but-the-port-is-not-open">If you want to check the tensorboard on the cloud such as AWS, but the port is not open</h3>
<p>If you connect from the local with the following, specify the used port 9999 on the server and connect to the local browser with localhost:8888, the access will be port forwarded to 9999 and it can be displayed. ..</p>
<pre><code>ssh -L 8888:localhost:9999 user@pablic_ip
</code></pre>
    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
