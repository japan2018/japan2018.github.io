<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Aiming to acquire AWS certification, give it to engineers who are not good at English! Take a screenshot of the English site, extract the text data from the image file, and then try translating it ~ Difference between AWS and Google Cloud API ~ | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Aiming to acquire AWS certification, give it to engineers who are not good at English! Take a screenshot of the English site, extract the text data from the image file, and then try translating it ~ Difference between AWS and Google Cloud API ~</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 6, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/rekognition"> ReKognition</a></code></small>


<small><code><a href="https://memotut.com/tags/gcp"> gcp</a></code></small>


<small><code><a href="https://memotut.com/tags/visionapi"> VisionAPI</a></code></small>


<small><code><a href="https://memotut.com/tags/aws-certification-exam"> AWS certification exam</a></code></small>

</p>
<pre><code>#Background
</code></pre>
<h3 id="how-are-aws-certified-measures-taken">How are AWS certified measures taken?</h3>
<p>AWS Certified Cloud Practitioner and Solution Architect – Associates have a copy of the test book and a practice test, making it an easy environment for studying the test. However, after the developer-associate, there are few Japanese language study books, so if you want to do a mock exam, <a href="https://www.udemy.com/">Udemy</a>and<a href="https://Youwillhavetorelyonwww.whizlabs.com/">Whizlabs</a>.However,mostofthepracticetestsonthesesitesareinEnglish.(AsofDecember03,2019,thereisoneJapanesemockexaminUdemy)</p>
<h3 id="difference-between-udemy-and-whizlabs">Difference between Udemy and Whizlabs</h3>
<p>I thought it would be better to do a lot of mock exams, so I tried English mock exams at Udemy and Whizlabs. My English is pretty bad, so if you can&rsquo;t read English, copy the question sentence and then <a href="https://translate.google.co.jp/?hl=ja#view=home&amp;op=translate&amp;sl=en&amp;tl=ja">Google Translate</a></p>
<p>Udemy managed to use Google Translate, but Whizlabs can no longer copy question and answer options. It is the same as the site that turns off the common right-click. So I&rsquo;ve tried a Chrome extension that works around right-click and copy protection, but it just doesn&rsquo;t work. So I contacted Whizlabs support and they said there were no plans to make it copyable: sob:</p>
<h3 id="amazon-rekognitionhttpsawsamazoncomjprekognition"><a href="https://aws.amazon.com/jp/rekognition/">Amazon Rekognition</a></h3>
<p>I&rsquo;m in trouble. View the HTML source, copy the question from there and Google translate it! I also thought about :muscle:, but since there are quite a lot of problems and it was quite difficult to copy together with options, I thought that it is possible to take a screenshot image of the problem statement and extract the text from the image file It was</p>
<p>I knew that AWS could use Amazon Rekognition** to extract text from image files, so I decided to try Rekognition.</p>
<h1 id="advance-preparation">Advance preparation</h1>
<p>I can&rsquo;t start without a shot of the problem English, so I take a screenshot of 15 Free Test questions at <a href="https://www.whizlabs.com/aws-developer-associate/">https://www.whizlabs.com/aws-developer-associate/</a>. I made the image on the browser as large as possible and made it as large as possible.</p>
<p>*Supplement: As I learned later, when selecting an answer, it seems that the characters for that option cannot be extracted in many cases. When you take a screenshot, please leave it unanswered. *</p>
<p>The environment uses MacOS. If you take a screenshot, the file name will be in Japanese, so convert the file name. I wanted to use en-q000.png, so I converted the file name with the following code.</p>
<p>Execution example</p>
<pre><code>python filename_change.py /Users/hogehoge/screenshot/test
</code></pre><details><summary>filename_change.py (collapsed)</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> glob

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>(dir):
    <span style="color:#75715e"># Take the directory where the image is located as an argument. No trailing slash required</span>
    pathpattern <span style="color:#f92672">=</span> dir <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/*&#34;</span>
    <span style="color:#75715e">#Assuming file time stamps are lined up from issue 1</span>
    files<span style="color:#f92672">=</span> sorted( glob<span style="color:#f92672">.</span>glob(pathpattern) ,key<span style="color:#f92672">=</span>os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>getmtime )<span style="color:#f92672">.</span>
    cnt<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
    <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> files:
       newfilename <span style="color:#f92672">=</span> dir<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;/en-q&#34;</span><span style="color:#f92672">+</span>str(cnt)<span style="color:#f92672">.</span>zfill(<span style="color:#ae81ff">3</span>)<span style="color:#f92672">+</span><span style="color:#e6db74">&#34;.png&#34;</span>
       os<span style="color:#f92672">.</span>rename(file,newfilename)
       <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;File name changed from {0} to {1}&#34;</span><span style="color:#f92672">.</span>format(file,newfilename))
       cnt<span style="color:#f92672">+=</span><span style="color:#ae81ff">1</span>

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;__main__&#39;</span>:
    main(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>])
</code></pre></div></div></details>
<p>With this, 15 files with image file names from en-q001.png to en-q015.png have been created. Upload this image file to S3.
After uploading it looks like this.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% aws s3 ls s3://mybucket/sample/
2019-12-03 17:43:39 <span style="color:#ae81ff">0</span>
2019-12-03 17:43:52 <span style="color:#ae81ff">132268</span> en-q001.png
2019-12-03 17:43:52 <span style="color:#ae81ff">135713</span> en-q002.png
2019-12-03 17:43:52 <span style="color:#ae81ff">130853</span> en-q003.png
2019-12-03 17:43:52 <span style="color:#ae81ff">112020</span> en-q004.png
2019-12-03 17:43:52 <span style="color:#ae81ff">125841</span> en-q005.png
<span style="color:#f92672">(</span>Omitted below<span style="color:#f92672">)</span>
</code></pre></div><h1 id="character-recognition-using-amazon-rekognition">Character recognition using Amazon Rekognition</h1>
<p><a href="https://docs.aws.amazon.com/ja_jp/rekognition/latest/dg/text-detecting-text-procedure.html">Sample code</a> was posted here, so it was very easy to use. .. Just upload the image to S3 and process the response. With the AWS CLI, you can get the result only with the following. I thought that it would be better to connect the text that Type is LINE from here, so I tried coding with Python boto3.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">
aws rekognition detect-text <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>- -image <span style="color:#e6db74">&#34;S3Object={Bucket=yourbucket,Name=shot.png}&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>- -output json
</code></pre></div><p>The actual code says to get the object name on S3 → Rekognition API → concatenate the resulting string → output to a file.</p>
<p>Execution example</p>
<pre><code>python aws_gettext_fromimage.py yourbucketname sample ./test-1205
</code></pre><details><summary>aws_gettext_fromimage.py (collapsed)</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> boto3
<span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> os

rekognition_client <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;rekognition&#39;</span>)
s3_client <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;s3&#39;</span>)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">detext_text</span>(bucketname, object):
    response<span style="color:#f92672">=</span>rekognition_client<span style="color:#f92672">.</span>detect_text(Image<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;S3Object&#39;</span>:{<span style="color:#e6db74">&#39;Bucket&#39;</span>:bucketname,<span style="color:#e6db74">&#39;Name&#39;</span>:object}})
    jsonDetextText<span style="color:#f92672">=</span>response[<span style="color:#e6db74">&#39;TextDetections&#39;</span>]
    sentence<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>
    <span style="color:#66d9ef">for</span> jsondata <span style="color:#f92672">in</span> jsonDetextText:
        <span style="color:#66d9ef">if</span> jsondata[<span style="color:#e6db74">&#39;Type&#39;</span>] <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;LINE&#39;</span>:
            sentence <span style="color:#f92672">=</span> sentence <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">+</span> jsondata[<span style="color:#e6db74">&#39;DetectedText&#39;</span>] <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>
    <span style="color:#66d9ef">return</span> (sentence)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>(bucketname, prefix, outputdir):
    Get list of objects <span style="color:#f92672">in</span> <span style="color:#75715e">#s3</span>
    response<span style="color:#f92672">=</span>s3_client<span style="color:#f92672">.</span>list_objects(
        Bucket<span style="color:#f92672">=</span>bucketname,
        Prefix<span style="color:#f92672">=</span>prefix
    )
    <span style="color:#66d9ef">if</span><span style="color:#e6db74">&#39;Contents&#39;</span> <span style="color:#f92672">in</span> response:
        keys <span style="color:#f92672">=</span> [content[<span style="color:#e6db74">&#39;Key&#39;</span>] <span style="color:#66d9ef">for</span> content <span style="color:#f92672">in</span> response[<span style="color:#e6db74">&#39;Contents&#39;</span>]]
    <span style="color:#66d9ef">else</span>:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Cannot get S3 object name&#34;</span>)
        <span style="color:#66d9ef">return</span> (<span style="color:#e6db74">&#34;NG&#34;</span>)

    <span style="color:#75715e"># Deleted because prefix is first in list</span>
    keys<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>)
    <span style="color:#75715e"># Create a directory</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(outputdir):
        os<span style="color:#f92672">.</span>makedirs(outputdir)

    <span style="color:#66d9ef">for</span> key <span style="color:#f92672">in</span> keys:
        <span style="color:#75715e"># Get only the object name and make the extension .txt</span>
        outputfilename <span style="color:#f92672">=</span> outputdir <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/&#34;</span> <span style="color:#f92672">+</span> (key<span style="color:#f92672">.</span>rsplit(<span style="color:#e6db74">&#34;/&#34;</span>,<span style="color:#ae81ff">1</span>)[<span style="color:#ae81ff">1</span>][:<span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>]) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.txt&#34;</span>
        <span style="color:#75715e"># Output to file</span>
        <span style="color:#66d9ef">with</span> open(outputfilename,<span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> f:
            f<span style="color:#f92672">.</span>write( detext_text(bucketname, key))

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;__main__&#39;</span>:
    Get bucket name, prefix, <span style="color:#f92672">and</span> output destination directory name <span style="color:#f92672">from</span> <span style="color:#75715e"># argument</span>
    bucketname <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>]
    prefix <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">2</span>]
    outputdir <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">3</span>]

    main(bucketname, prefix, outputdir)
</code></pre></div></div></details>
<p>This will generate 15 text files in the destination directory. However, I could not recognize the following.</p>
<ul>
<li>I can&rsquo;t read the answer options at all</li>
<li>Often the end of the sentence is not read</li>
<li>The same line in the question sentence is recognized as a different line
<ul>
<li>For example, recognize <code>You're a developer for a company</code> as <code>You're for (new line) a developer a company</code>.</li>
</ul>
</li>
</ul>
<p>I thought that the first two couldn&rsquo;t be helped, but the third is difficult to correct. The line breaks can be solved by concatenating them, but the position of the word will change.</p>
<p>I was wondering what to do, but I thought that if there was a service on AWS, it might be on Google Cloud, and when I looked it up, there was one! <strong>Cloud Vision API</strong>.</p>
<p>#Surprised by the result of Cloud Vision API of #Google Cloud! ! !
When I checked it, I could use it with Cloud Vison+Storage just like Rekognition+S3 of AWS, so I modified the source code a little.</p>
<pre><code class="language-pythonfrom" data-lang="pythonfrom">from google.cloud import storage
import sys
import os

vision_client = vision.ImageAnnotatorClient()
storage_client = storage.Client()

def detext_text(bucketname,object):
    uri = 'gs://'+bucketname+'/'+object
    response = vision_client.annotate_image({
        'image': {'source':{'image_uri': uri}},
        'features': [{'type':vision.enums.Feature.Type.TEXT_DETECTION}]
    })
    return ( response.text_annotations[0].description )

def main(bucketname, prefix, outputdir):

    storage_client = storage.Client()
    blobs = storage_client.list_blobs(
        bucketname,
        prefix=prefix
    )
    if not os.path.exists(outputdir):
        os.makedirs(outputdir)

    for blob in blobs:
        objectname = blob.name
        if objectname.endswith(&quot;/&quot;):
            continue
        # オブジェクト名だけを取得して拡張子を.txtに変換する
        outputfilename = outputdir + &quot;/&quot; + (objectname.rsplit(&quot;/&quot;,1)[1][:-4]) + &quot;.txt&quot;
        with open(outputfilename,'w') as f:
            f.write( detext_text(bucketname, blob.name) )

if __name__ == '__main__':
    
    bucketname = sys.argv[1]
    prefix = sys.argv[2]
    outputdir = sys.argv[3]

    main(bucketname, prefix, outputdir)
</code></pre><p>AWSのSDKと比較すると、APIをコールした後のレスポンスの取り扱いがちょっと異なる印象がありましたが、サンプルなどを参考にして動作させることができました:raised_hands:
実行方法は、上の<code>aws_gettext_fromimage.py</code>と同じです。</p>
<p><strong>結果のテキストファイルを見て、びっくりです!!</strong> :scream_cat:</p>
<p>Rekognitionの時とは異なり、**解答の選択肢は読み取れているし、一部の単語が改行されてしまっていることもありません。**一部の解答の選択肢の(A./B./C.) が欠落していたり <em>(選択肢のA.B.C.が欠落する時は、解答が2行になっている時が多かったです）</em> 、<code>B. Security</code>が<code>B.（改行）Security</code>となっているだけです。</p>
<p><strong>AWSとGoogle Cloudでこんなに差が出るものなのかと。おそらく、画像によって向き不向きがあるんだろうとは思います</strong>が、今回はそこまで検証している時間がないため、Cloud Vision APIで生成したテキストファイルを採用しました！</p>
<p>ここで、問題文は、画像ファイルで見たまま、改行されてしまっていますので、今回はVSCodeの置換（正規表現）で改行をスペースに変換しました。</p>
<h1 id="google-cloudのcloud-translationを使って翻訳">Google CloudのCloud Translationを使って翻訳</h1>
<p>テキストデータ化できているので、Google翻訳にコピペすればいいのだが、せっかくなので、翻訳ができるCloud Translationを使ってみることにした。</p>
<h2 id="google-cloudのclient-library">Google CloudのClient Library</h2>
<p>参考にしたドキュメントは、以下の２つです。必要なライブラリーは<code>pip</code>を使ってインストールします。</p>
<ul>
<li><a href="https://cloud.google.com/translate/docs/translating-text-v3?hl=ja#translate_translate_text_beta-python">テキストの翻訳（v3beta1）</a></li>
<li><a href="https://googleapis.dev/python/translation/latest/gapic/v3beta1/api.html">Client for Cloud Translation API</a></li>
</ul>
<p>ここで困ったことが。。。AWSと違って、検索しても情報量が少ない。Pythonの<code>type()</code>で型を調べながらというように、かなり思考錯誤しました。まあ、今回が、初めてGoogle Cloudのライブラリを使ったため、慣れていないことが原因だと思います。</p>
<p>ドキュメントとソースコードのパラメータの渡し方が異なりますが、まだベータ版のため、変わっているところだと思います。</p>
<h3 id="実行方法">実行方法</h3>
<p>英文のテキストデータファイルが格納されているディレクトリを引数にして実行してください。</p>
<pre><code>python translate.py ./work
</code></pre><ul>
<li>translate.py（<strong>プロジェクトIDは書き換えてから実行してください</strong>）</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> google.cloud <span style="color:#f92672">import</span> translate_v3beta1 <span style="color:#66d9ef">as</span> translate
<span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> glob
<span style="color:#f92672">import</span> os

translate_client <span style="color:#f92672">=</span> translate<span style="color:#f92672">.</span>TranslationServiceClient()

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">translate_txt</span>(text):
    project_id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Your Project ID&#39;</span>
    location <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;global&#39;</span>
    src_lang <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;en&#39;</span>
    dst_lang <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ja&#39;</span>

    parent <span style="color:#f92672">=</span> translate_client<span style="color:#f92672">.</span>location_path(project_id,location)
    response <span style="color:#f92672">=</span> translate_client<span style="color:#f92672">.</span>translate_text(
                    text, 
                    dst_lang,
                    parent,
                    mime_type<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;text/plain&#39;</span>,
                    source_language_code<span style="color:#f92672">=</span>src_lang,
                    model<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;projects/{}/locations/global/models/general/nmt&#34;</span><span style="color:#f92672">.</span>format(project_id)
                )
    translated_text<span style="color:#f92672">=</span>[]
    <span style="color:#66d9ef">for</span> translation <span style="color:#f92672">in</span> response<span style="color:#f92672">.</span>translations:
        translated_text<span style="color:#f92672">.</span>append(translation<span style="color:#f92672">.</span>translated_text)

    <span style="color:#66d9ef">return</span>( translated_text )

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">orgtext_fromfile</span>(filename):
    f <span style="color:#f92672">=</span> open( filename )
    orgtext <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>read()
    f<span style="color:#f92672">.</span>close()

    <span style="color:#66d9ef">return</span>(orgtext)

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>(orgdatadir):
    files<span style="color:#f92672">=</span> sorted(glob<span style="color:#f92672">.</span>glob(<span style="color:#e6db74">&#34;{}/*.txt&#34;</span><span style="color:#f92672">.</span>format(orgdatadir)), key<span style="color:#f92672">=</span>os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>getmtime)

    <span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> files:
        orgdata <span style="color:#f92672">=</span> []
        orgtext <span style="color:#f92672">=</span> orgtext_fromfile(file)
        orgdata<span style="color:#f92672">.</span>append(orgtext)

        <span style="color:#66d9ef">with</span> open(file, <span style="color:#e6db74">&#39;a&#39;</span>) <span style="color:#66d9ef">as</span> f:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;-------&#34;</span>,file<span style="color:#f92672">=</span>f)
            <span style="color:#66d9ef">for</span> outtext <span style="color:#f92672">in</span> translate_txt(orgdata):
                <span style="color:#66d9ef">print</span>(outtext, file<span style="color:#f92672">=</span>f)

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    orgdatadir <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>]
    main(orgdatadir)

</code></pre></div><p>このように実行すると、英文テキストに翻訳結果を追加書き込みします。15問なら一気に処理しても、すぐに終わります。また翻訳結果も問題ないですね。</p>
<p>これで、翻訳された問題・解答の選択肢を見ながら、Whizlabsの解答を選択していくことができました〜！</p>
<h1 id="whizlabs以外でもcloud-vision-apiを試してみた">Whizlabs以外でもCloud Vision APIを試してみた</h1>
<h2 id="youtube-その１">Youtube その１</h2>
<p>Yourubeの再生を停止させて、テキスト部分をスクリーンショット撮って、Vision APIで抽出してみました。テストしてみた動画はこれです。</p>
<p><a href="https://youtu.be/8j_hxBw5B4E?t=10">https://youtu.be/8j_hxBw5B4E?t=10</a></p>
<p>結果は、正解でした！</p>
<h2 id="youtube-その2">Youtube その2</h2>
<p>今度は背景が白ではない動画からスクリーンショットを撮って試してみました。</p>
<p><a href="https://youtu.be/kg_63wV7bL8?t=68">https://youtu.be/kg_63wV7bL8?t=68</a></p>
<p>結果は、タイトル枠の線をIとして認識しまっただけで、他はすべて読み取れてました。
すばらしい:raised_hands:</p>
<h1 id="かかる料金">かかる料金</h1>
<p>さあ、実際にかかる料金はいくらなのでしょうか？</p>
<h2 id="cloud-vision-apiの料金表httpscloudgooglecomvisionpricinghlja"><a href="https://cloud.google.com/vision/pricing?hl=ja">Cloud Vision APIの料金表</a></h2>
<ul>
<li>最初の1000ユニットは無料とある。1001回以上は$1.50</li>
<li>今回は1000ユニットもコールしないので、無料と判断した</li>
</ul>
<h2 id="cloud-translationの料金表httpscloudgooglecomtranslatepricinghlja"><a href="https://cloud.google.com/translate/pricing?hl=ja">Cloud Translationの料金表</a></h2>
<ul>
<li>100万文字ので$20
<ul>
<li>100万文字に満たない場合は、以下ように課金されるようです</li>
</ul>
</li>
</ul>
<blockquote>
<p>料金は「比例」計算で課金されます。料金は実際にサービスに送信された文字数に応じて請求されます。たとえば、1 か月以内に 75,000 文字を処理するように送信した場合、$1.50 が請求されます。</p>
</blockquote>
<p>さすがに、100万文字にはならないだろうと思うますので、ほとんど課金されないかなと思います。</p>
<h1 id="まとめ">まとめ</h1>
<p>作業の手順をまとめます。</p>
<ol>
<li>英文のスクリーンショットを撮る</li>
<li>スクリーンショットのファイル名は作業しやすいように変更する</li>
<li>Google Cloud Storageに画像ファイルをアップロードする4. Extract text data from image file using Cloud Vision API</li>
<li>If you need to modify the text data, modify it</li>
<li>Translate using Google Cloud Translation. If you open the text file in 5., you may use Google Translate here.</li>
</ol>
<p>With all this work, you can easily translate Whizlabs problem sentences. **In addition to Whizlabs, you can translate English on Youtube. **</p>
<h2 id="automation-of-work">Automation of work</h2>
<p>1 to 6 above. Since the work procedure of is troublesome, I thought that if I uploaded the image to Storage, I could do the translation using Cloud Functions. But after all, I didn&rsquo;t play around with Google Cloud so much, so I couldn&rsquo;t consider it. I&rsquo;m sure you can do it!</p>
<h2 id="aws-and-google-cloud">AWS and Google Cloud</h2>
<p>Until now, AWS was the only choice for me, but this time I got better results with Google Cloud. There are other Azures as well. I thought that I had to broaden my horizons so that I could select services according to the case: bow_tone1:</p>
<h2 id="about-environment">About environment</h2>
<p>This article uses the following environment.</p>
<ul>
<li>Python 3.7.2</li>
<li>boto3 1.9.172</li>
<li>botocore 1.12.221</li>
<li>google-api-core 1.14.3</li>
<li>google-cloud-core 1.0.3</li>
<li>google-cloud-storage 1.23.0</li>
<li>google-cloud-vision 0.40.0</li>
<li>google-cloud-translate 2.0.0</li>
</ul>
<h2 id="notice">Notice</h2>
<ul>
<li>In many cases, the source code does not include error handling. If you use it, please consider that.</li>
<li>This time, I omitted the settings for calling AWS CLI, SDK/Google Cloud API. If you search for it, it will appear, so please refer to that.</li>
<li>After I finished writing this article, I noticed that there was an easier way to translate to Google because it was limited to Whizlabs. But don&rsquo;t write it here. :skull_crossbones:</li>
</ul>
<p>**This concludes, but please don&rsquo;t make any comments about studying English in the first place ** :sunglasses:</p>
<hr>
<p>:fork_and_knife: <a href="https://qiita.com/advent-calendar/2019/fork">FORK Advent Calendar 2019</a>
:point_left: Day 6 <a href="https://qiita.com/kinoleaf/items/df93150874bf0a6c9b9d">Convert HEIC to JPEG with ImageMagick</a> @kinoleaf Thank you very much!
:point_right: Day 8 Thank you @AsaToBan.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
