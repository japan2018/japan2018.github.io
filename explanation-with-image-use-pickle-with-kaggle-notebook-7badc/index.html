<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Explanation with image] Use pickle with Kaggle NoteBook | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Explanation with image] Use pickle with Kaggle NoteBook</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 9, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/machine-learning"> Machine Learning</a></code></small>


<small><code><a href="https://memotut.com/tags/machinelearning"> MachineLearning</a></code></small>


<small><code><a href="https://memotut.com/tags/docker"> Docker</a></code></small>


<small><code><a href="https://memotut.com/tags/kaggle"> Kaggle</a></code></small>

</p>
<pre><code># things to do
</code></pre>
<ol>
<li>Pickle data set of csv file</li>
<li>Load the pickle file into another notebook</li>
</ol>
<p>What is # pickle?
A python object that saves binary data
<a href="https://docs.python.org/ja/3/library/pickle.html">https://docs.python.org/ja/3/library/pickle.html</a></p>
<h1 id="what-are-you-happy-about">What are you happy about?</h1>
<p>Read quickly
It&rsquo;s binary data, so parsing is fast.
You can also use learned models as pickles</p>
<p>This verification article is wonderful
<a href="https://blog.amedama.jp/entry/2018/07/11/081050">Python: I checked the persistence format of pandas</a></p>
<h1 id="try-with-titanic-data">Try with Titanic data</h1>
<p>Let&rsquo;s make train.csv pickle
This is the only code</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-.py" data-lang=".py"><span style="color:#75715e"># pickle is a standard library, so no need to install</span>
<span style="color:#f92672">import</span> pickle

<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd


train <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;../input/titanic/train.csv&#39;</span>)

<span style="color:#75715e"># specify&#39;wb&#39; (write binary)</span>
<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;train.pickle&#39;</span>,<span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> f:
    pickle<span style="color:#f92672">.</span>dump(train, f)
</code></pre></div><p>Save as # Dataset</p>
<p>First commit
![Screenshot 2019-12-09 3.16.06.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/23d3225e-caab-2f64-782d-(97258bb35f54.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/23d3225e-caab-2f64-782d-(97258bb35f54.png)</a></p>
<p>If you see a green complete in the upper left, click Open Version
![Screenshot 2019-12-09 3.17.42.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/d3183699-c1bc-cb24-11b8-(b37e393b0cdb.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/d3183699-c1bc-cb24-11b8-(b37e393b0cdb.png)</a></p>
<p>Scroll down to the Output column
![Screenshot 2019-12-09 3.18.37.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/f04941f1-2568-01e8-f4d2-(d0c25460bc68.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/f04941f1-2568-01e8-f4d2-(d0c25460bc68.png)</a></p>
<p>If you can confirm <code>train.pickle</code> New Dataset
![Screenshot 2019-12-09 3.19.07.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/d9c16ad4-fb2d-f905-3550-(ce687a8ae252.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/d9c16ad4-fb2d-f905-3550-(ce687a8ae252.png)</a></p>
<p>Enter your favorite Dataset title and create
![Screenshot 2019-12-09 3.20.36.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/1f80b151-7c2b-94d2-e166-(c90a45f56d35.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/1f80b151-7c2b-94d2-e166-(c90a45f56d35.png)</a></p>
<p>Dataset completed
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/b9f8be23-37ad-cab4-044e-58e954ae4f4b.png" alt="Screenshot 2019-12-09 3.21.08.png"></p>
<h1 id="bring-to-another-notebook">Bring to another notebook</h1>
<p>Create a new notebook + Add Data
![Screenshot 2019-12-09 3.44.17.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/6adf6f8a-b740-6477-04cb-(08a21c768c45.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/6adf6f8a-b740-6477-04cb-(08a21c768c45.png)</a></p>
<p>Filter by Your Datasets
![Screenshot 2019-12-09 3.44.44.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/02971f62-f45c-4c90-9d36-(172abff33fde.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/02971f62-f45c-4c90-9d36-(172abff33fde.png)</a></p>
<p>Add the one you just made
![Screenshot 2019-12-09 3.45.11.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/e8f90adf-075a-f324-f04c-(26d04e099c8c.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/e8f90adf-075a-f324-f04c-(26d04e099c8c.png)</a></p>
<p>Win if displayed here
![Screenshot 2019-12-09 3.46.31.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/07d980cb-6273-afa4-8d11-(b39df9f6070f.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/287998/07d980cb-6273-afa4-8d11-(b39df9f6070f.png)</a></p>
<h1 id="lets-load">Let&rsquo;s load</h1>
<p>This is the only code</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-.py" data-lang=".py"><span style="color:#75715e"># Specify&#39;rb&#39; (read binary)</span>
<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;../input/titanicdatasetpickles/train.pickle&#39;</span>,<span style="color:#e6db74">&#39;rb&#39;</span>) <span style="color:#66d9ef">as</span> f:
    train <span style="color:#f92672">=</span> pickle<span style="color:#f92672">.</span>load(f)
</code></pre></div><p>It is loaded as a DataFrame properly</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-.py" data-lang=".py">train<span style="color:#f92672">.</span>shape

<span style="color:#75715e"># (891, 12)</span>
</code></pre></div><br>
Please note that the directory name may be different from the one displayed on the right side of the screen.
`https://www.kaggle.com/anata-no-namae/data-set-no-namae` <- This notation becomes the directory name
If you check with the `ls` command, you can see that the directory name is `-` none
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-.py" data-lang=".py"><span style="color:#960050;background-color:#1e0010">!</span>ls <span style="color:#f92672">../</span>input

<span style="color:#75715e"># titanicdatasetpickles</span>
</code></pre></div><h1 id="may-be-filed">May be filed</h1>
<p>Let&rsquo;s use dump processing again</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dump_pickles.py" data-lang="dump_pickles.py">
<span style="color:#f92672">import</span> pickle

<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd


<span style="color:#75715e"># Switch path between Kaggle and another environment</span>
<span style="color:#66d9ef">if</span><span style="color:#e6db74">&#39;/kaggle/working&#39;</span> <span style="color:#f92672">in</span> _dh:
    input_path <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;../input&#39;</span>
<span style="color:#66d9ef">else</span>:
    input_path <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;./input&#39;</span>

<span style="color:#75715e"># Rewrite only here for each competition</span>
data_sets <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;train&#39;</span>: f<span style="color:#e6db74">&#39;{input_path}/titanic/train.csv&#39;</span>,
    <span style="color:#e6db74">&#39;test&#39;</span>: f<span style="color:#e6db74">&#39;{input_path}/titanic/test.csv&#39;</span>,
    <span style="color:#e6db74">&#39;gender_submission&#39;</span>: f<span style="color:#e6db74">&#39;{input_path}/titanic/gender_submission.csv&#39;</span>
}

<span style="color:#66d9ef">for</span> name, path <span style="color:#f92672">in</span> data_sets<span style="color:#f92672">.</span>items():
    df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(path)
    <span style="color:#66d9ef">with</span> open(f<span style="color:#e6db74">&#39;{name}.pickle&#39;</span>,<span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> f:
        pickle<span style="color:#f92672">.</span>dump(df, f)
</code></pre></div><h1 id="pandas-can-do-the-same">pandas can do the same</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-.py" data-lang=".py"><span style="color:#75715e"># this is</span>
<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;./train.pickle&#39;</span>,<span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> f:
    pickle<span style="color:#f92672">.</span>dump(train, f)

<span style="color:#75715e"># like this</span>
train<span style="color:#f92672">.</span>to_pickle(<span style="color:#e6db74">&#39;./train.pickle&#39;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-.py" data-lang=".py"><span style="color:#75715e"># this is</span>
<span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;../input/titanicdatasetpickles/train.pickle&#39;</span>,<span style="color:#e6db74">&#39;rb&#39;</span>) <span style="color:#66d9ef">as</span> f:
    df_ss <span style="color:#f92672">=</span> pickle<span style="color:#f92672">.</span>load(f)

<span style="color:#75715e"># like this</span>
train <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_pickle(<span style="color:#e6db74">&#39;../input/titanicdatasetpickles/train.pickle&#39;</span>)
</code></pre></div><h1 id="sometimes-i-get-this-error">Sometimes I get this error</h1>
<p><code>ModuleNotFoundError: No module named'pandas.core.internals.managers';'pandas.core.internals' is not a package</code></p>
<p>It seems that there is a problem with the version of pandas</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pip install -U pandas
</code></pre></div><p>Solved by
*Note that Kaggle&rsquo;s official docker image (kaggle/python) generated an error with pandas==0.23.4 (as of December 9, 2019)</p>
<p>This article saved me
<a href="https://estuarine.jp/2017/07/pickle_pandas_error/">Inconsistency between pickle and pandas</a></p>
<h1 id="end">End</h1>
<p>Thank you for reading to the end</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
