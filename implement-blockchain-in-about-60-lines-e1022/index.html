<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Implement blockchain in about 60 lines | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Implement blockchain in about 60 lines</h1>
<p>
  <small class="text-secondary">
  
  
  Jan 14, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/blockchain"> blockchain</a></code></small>


<small><code><a href="https://memotut.com/tags/udemy"> udemy</a></code></small>

</p>
<pre><code>#Introduction
</code></pre>
<p>In the course of <a href="https://www.udemy.com/course/python-blockchain/">Udemy</a>, I roughly understood the contents of the blockchain, so I implemented it. I implement it by myself based on the contents of the course.
Mr. Jun Sakai, an active engineer of Silicon Valley, teaches in this course, and by taking the course, you will be able to create the following programs without looking at them. This post also implements wallet and proof_of_work that are not implemented, so if you are interested, please take this course. I also recommend Jun Sakai&rsquo;s Python basic course.</p>
<ul>
<li>I made it again because I made some mistakes.</li>
</ul>
<p>#Blockchain elements
The elements in each block are as follows.</p>
<ul>
<li>Block
-previous_hash: hash value of the previous block
-nonce: Value found by mining
-transaction: Transaction processed in the block
-timestamp: time when the block was created</li>
</ul>
<img width="443" alt="Blockchain.PNG" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/315055/eae70259-deac-00c6-3830-944c51ffb459.png">
<p>All blocks on the chain are linked with previous_hash, so if you want to tamper with a block in the middle of the chain, you must recalculate all hash values after that, which will prevent tampering.</p>
<h1 id="behavior-until-block-is-added-to-chain">Behavior until block is added to chain</h1>
<p>The operation until a new block is added to the chain is as follows.</p>
<ol>
<li>Create a transaction based on sender, recipient, and amount</li>
<li>Temporarily register (pool) the created transaction</li>
<li>Mining pooled transactions (finding nonce value)</li>
<li>Create a block based on the hash value, nonce, transaction, and timestamp of the previous block</li>
<li>Add the created block to the chain</li>
</ol>
<h1 id="actually-make">Actually make</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Python" data-lang="Python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BlockChain</span>(object):

    <span style="color:#75715e"># Create the first block</span>
    <span style="color:#66d9ef">def</span> __init__(self):
        self<span style="color:#f92672">.</span>chain <span style="color:#f92672">=</span> []
        self<span style="color:#f92672">.</span>transaction_pool <span style="color:#f92672">=</span> []
        self<span style="color:#f92672">.</span>create_block(previous_hash<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Initialize&#39;</span>)

    <span style="color:#75715e">#Return hash value</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hash</span>(self, block):
        json_block <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>dumps(block)
        <span style="color:#66d9ef">return</span> hashlib<span style="color:#f92672">.</span>sha256(json_block<span style="color:#f92672">.</span>encode())<span style="color:#f92672">.</span>hexdigest()
    
    <span style="color:#75715e"># Create a block based on the received value</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_block</span>(self, previous_hash<span style="color:#f92672">=</span>None, nonce<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, transaction<span style="color:#f92672">=</span>None, timestamp<span style="color:#f92672">=</span>time<span style="color:#f92672">.</span>time()):
        block <span style="color:#f92672">=</span> {
            <span style="color:#e6db74">&#39;previous_hash&#39;</span>: previous_hash,
            <span style="color:#e6db74">&#39;nonce&#39;</span>: nonce,
            <span style="color:#e6db74">&#39;transaction&#39;</span>: transaction,
            <span style="color:#e6db74">&#39;timestamp&#39;</span>: timestamp
          }
        self<span style="color:#f92672">.</span>add_block_to_chain(block)
    
    <span style="color:#75715e"># Add blocks to the chain</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_block_to_chain</span>(self, block):
        self<span style="color:#f92672">.</span>chain<span style="color:#f92672">.</span>append(block)

    <span style="color:#75715e">#Find the nonce value</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">mining</span>(self):
        previous_hash <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>hash(self<span style="color:#f92672">.</span>chain[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>])
        nonce <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
        transaction <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>transaction_pool
        self<span style="color:#f92672">.</span>transaction_pool <span style="color:#f92672">=</span> []
        timestamp <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>time()
        self<span style="color:#f92672">.</span>create_block(previous_hash, nonce, transaction, timestamp)

    <span style="color:#75715e"># Pool transactions</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add_transaction</span>(self, sender_name, reciever_name, value):
        transaction <span style="color:#f92672">=</span> {
            <span style="color:#e6db74">&#39;Sender_name&#39;</span>: sender_name,
            <span style="color:#e6db74">&#39;Reciever_name&#39;</span>: reciever_name,
            <span style="color:#e6db74">&#39;Value&#39;</span>: value
        }
        self<span style="color:#f92672">.</span>transaction_pool<span style="color:#f92672">.</span>append(transaction)

    <span style="color:#75715e"># Output the chain in a format that is easy to see</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">print_chain</span>(self):
        <span style="color:#66d9ef">for</span> chain_index, block <span style="color:#f92672">in</span> enumerate(self<span style="color:#f92672">.</span>chain):
            <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#39;{&#34;=&#34;*40}Block {chain_index:3}&#39;</span>)
            <span style="color:#66d9ef">if</span> block[<span style="color:#e6db74">&#39;transaction&#39;</span>] <span style="color:#f92672">is</span> None:
                <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Initialize&#39;</span>)
                <span style="color:#66d9ef">continue</span>
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">for</span> key, value <span style="color:#f92672">in</span> block<span style="color:#f92672">.</span>items():
                    <span style="color:#66d9ef">if</span> key <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;transaction&#39;</span>:
                        <span style="color:#66d9ef">for</span> transaction <span style="color:#f92672">in</span> value:
                            <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#39;{&#34;transaction&#34;:15}:&#39;</span>)
                            <span style="color:#66d9ef">for</span> kk, vv <span style="color:#f92672">in</span> transaction<span style="color:#f92672">.</span>items():
                                <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\t</span><span style="color:#e6db74">{kk:15}:{vv}&#39;</span>)
                    <span style="color:#66d9ef">else</span>:
                        <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#39;{key:15}:{value}&#39;</span>)


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;__main__&#39;</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;=&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">30</span> <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;Start&#39;</span> <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;=&#39;</span><span style="color:#f92672">*</span><span style="color:#ae81ff">30</span>)
    <span style="color:#75715e"># Create BlockChain instance</span>
    blockchain <span style="color:#f92672">=</span> BlockChain()
    <span style="color:#75715e"># Register a transaction</span>
    blockchain<span style="color:#f92672">.</span>add_transaction(sender_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Alice&#39;</span>, reciever_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Bob&#39;</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>)
    <span style="color:#75715e"># Register a transaction</span>
    blockchain<span style="color:#f92672">.</span>add_transaction(sender_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Alice&#39;</span>, reciever_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Chris&#39;</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
    <span style="color:#75715e"># Do mining (find nonces)</span>
    blockchain<span style="color:#f92672">.</span>mining()
    <span style="color:#75715e"># Add transaction</span>
    blockchain<span style="color:#f92672">.</span>add_transaction(sender_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Bob&#39;</span>, reciever_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Dave&#39;</span>, value<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>)
    <span style="color:#75715e"># Do mining (find nonces)</span>
    blockchain<span style="color:#f92672">.</span>mining()
    <span style="color:#75715e"># Show the created blockchain</span>
    blockchain<span style="color:#f92672">.</span>print_chain()
</code></pre></div><h1 id="execution-result">Execution result</h1>
<pre><code>========================================Block 0
Initialize
========================================Block 1
previous_hash :54c72dc7390c09a6d2c00037c381057a7bd069e8d9c427585ce31bed16dfd0d8
nonce :0
transaction:
        Sender_name :Alice
        Reciever_name :Bob
        Value :100
transaction:
        Sender_name :Alice
        Reciever_name :Chris
        Value :1
timestamp :1578989130.9111161
========================================Block 2
previous_hash :d4bb210d2e3ad304db53756e87a7513b2fca8672c6e757bef6db3fff8ff26bb1
nonce :0
transaction:
        Sender_name :Bob
        Reciever_name :Dave
        Value :100
timestamp :1578989132.9128711
</code></pre><h1 id="finally">Finally</h1>
<p>Blockchain hasn&rsquo;t heard much name since it became popular a while ago, but its use cases are still increasing, such as Sony&rsquo;s use for copyright management and Microsoft&rsquo;s use for personal ID, so study it. I think there is a loss.
In the future, we plan to implement something linked with Flask.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
