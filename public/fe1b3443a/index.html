<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Python] Should I fix that copy and paste? | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] Should I fix that copy and paste?</h1>
<p>
  <small class="text-secondary">
  
  
  Jul 29, 2014
  </small>
  

<small><code><a href="https://memotut.com/tags/java">Java</a></code></small>


<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/javascript">JavaScript</a></code></small>


<small><code><a href="https://memotut.com/tags/jenkins">Jenkins</a></code></small>

</p>
<pre><code>It's true that copy clones of source code are more reliable than code clones, but in many cases the existence of code clones often hurts us at the last minute.
</code></pre>
<p>After the person in charge escaped, corrected the source code until late at night, and released it, in fact, I was told that &ldquo;I&rsquo;m making it with copy and paste, so please test all the other places again&rdquo; and start over Is very, very sad.</p>
<p>It&rsquo;s a humiliation to make almost the same source code and make subtle changes like a mistake search.</p>
<p>In the last minute, in order to avoid such a punishment game, the frequency of copy and paste should be constantly monitored, and if it is abnormal, it should be corrected immediately.</p>
<p>This section describes the tools to detect copy and paste.</p>
<h1 id="pmd-cpd">PMD-CPD</h1>
<p>PMD is a tool implemented in Java that detects potential problems in Java source code.
<a href="http://pmd.sourceforge.net/snapshot/">http://pmd.sourceforge.net/snapshot/</a></p>
<p>There is a CPD command that detects duplicate code as part of this feature and can detect duplicates in the following programming languages:
・Java
・JSP
・C++
・Ruby
・Fortran
・PHP
・C#
・PLSQL
・Ecmascript</p>
<h2 id="installation-method">Installation method</h2>
<p>Download one of the files below, unzip it, and unzip it to any folder.
<a href="http://sourceforge.net/projects/pmd/files/pmd/">http://sourceforge.net/projects/pmd/files/pmd/</a></p>
<h2 id="execution-example">Execution example</h2>
<h3 id="example-of-execution-on-windows">Example of execution on Windows</h3>
<pre><code>cpd --minimum-tokens 50 --language ecmascript --format text --encoding utf8 --files C:\tool\clonedigger\test\ &gt;result.txt
</code></pre><h3 id="example-of-execution-on-linux">Example of execution on Linux</h3>
<pre><code>bin/run.sh cpd --minimum-tokens 35 --format xml --language ruby --files /var/lib/redmine/app/ &gt;result.xml
</code></pre><h2 id="parameter">Parameter</h2>
<p>Parameters are shared between windows and linux.</p>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">&ndash;minimum-tokens</td>
<td align="left">Specify the number of tokens to detect duplicates.</td>
</tr>
<tr>
<td align="left">&ndash;format</td>
<td align="left">text,xml,csv can be selected. If you output it in xml, you can use it in jenkins.</td>
</tr>
<tr>
<td align="left">&ndash;language</td>
<td align="left">Specifies the programming language type.</td>
</tr>
<tr>
<td align="left">&ndash;files</td>
<td align="left">Specify the source code directory to be checked. This will be detected recursively.</td>
</tr>
<tr>
<td align="left">&ndash;encoding</td>
<td align="left">Specifies the source code encoding to be inspected</td>
</tr>
</tbody>
</table>
<p>##GUI
You can also work with GUI by executing bin/cpdgui.bat.
<img src="https://qiita-image-store.s3.amazonaws.com/0/47856/3d202fc4-eefc-3685-0eae-76c832273881.png" alt="clone.png"></p>
<p>#Clonedigger
Clonedigger is a copy and paste detection tool implemented in Python and Java.
<a href="http://clonedigger.sourceforge.net/">http://clonedigger.sourceforge.net/</a></p>
<p>The programming languages that can be detected are:</p>
<p>・Python
・Java
・Lua
・Javascript</p>
<p>There are some tips for detecting programming languages other than python.</p>
<h2 id="installation-method-1">Installation method</h2>
<pre><code>easy_install clonedigger
</code></pre><h2 id="execution-example-1">Execution example</h2>
<h3 id="python-detection-example">Python detection example</h3>
<p>__ When a file is specified __</p>
<pre><code>clonedigger -l python -o ./test.html C:\tool\clonedigger\test\test_utf8.py
</code></pre><p>__ When a folder is specified __</p>
<pre><code>clonedigger -l python -o ./test.html C:\tool\clonedigger\test\test_utf8.py
</code></pre><p>If you specify a folder, subfolders are also detected.
Create the following HTML in the file specified by -o.</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/47856/9471933c-f8d9-7377-2b73-460ca6a8d4cf.png" alt="clone.png"></p>
<p>If you use the &ndash;cpd-output option as follows, the output will be in XML format. This output format is the same as PMD/CPD.</p>
<pre><code>clonedigger -l python --cpd-output -o test.xml C:\tool\clonedigger\test\python\
</code></pre><h3 id="java-detection-example">Java detection example</h3>
<p>When detecting source code other than Python, it will not work if java_antlr does not exist in the current directory.
The following operations are required for Windows and Python2.7.</p>
<pre><code>cd C:\Python27\Lib\site-packages\clonedigger-1.1.0-py2.7.egg\clonedigger
clonedigger -l java --cpd-output -o test.xml C:\tool\clonedigger\test\test.java
</code></pre><h3 id="javascript-detection-example">JavaScript detection example</h3>
<p>When detecting JavaScript, it will not work if js_antlr does not exist in the current directory.
The following operations are required for Windows and Python2.7.</p>
<pre><code>cd C:\Python27\Lib\site-packages\clonedigger-1.1.0-py2.7.egg\clonedigger
clonedigger -l js --cpd-output -o test.xml C:\tool\clonedigger\test\test.js
</code></pre><p>JavaScript that runs on the browser also works with the following loose implementations.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">  <span style="color:#75715e">// extra last comma
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">questions</span> <span style="color:#f92672">=</span> [
    {<span style="color:#a6e22e">message</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;Oh ah&#34;</span>, <span style="color:#a6e22e">category</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">Category</span>.<span style="color:#a6e22e">emotionalExhaustion</span>},
  ];
</code></pre></div><p>However, in clonedigger, if there is such an illegal description, analysis will be interrupted and an error will occur. At this time, the following error message is displayed, so it will be a hint for correction.</p>
<pre><code>line 14:2 rule arrayItem failed predicate: {input.LA(1) == COMMA }?
</code></pre><p>#AIST CCFinderX
You can download AIST CCFinderX from the page below, which you mentioned in the comments.
<a href="http://www.ccfinder.net/ccfinderxos-j.html">http://www.ccfinder.net/ccfinderxos-j.html</a></p>
<p>It requires 32-bit Java and Python 2.6 (no up or down) to work.
If you download the Windows binary, it will not work unless you run it on 32bit, so gemx.bat needs to be modified as follows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-gemx.bat" data-lang="gemx.bat"><span style="color:#66d9ef">set</span> PATH=C:\Windows\SysWOW64;C:\TracLight\python;C:\TracLight\python\python\Scripts\;%~dp0\scripts
<span style="color:#66d9ef">set</span> CCFINDERX_PYTHON_INTERPRETER_PATH=C:\TracLight\python\python.exe
</code></pre></div><p>The following image is an example of the screen detected by gemx.bat.
<img src="https://qiita-image-store.s3.amazonaws.com/0/47856/cbd0b1bc-0543-09b5-d0a9-e2e449e33391.png" alt="Untitled.png"></p>
<p>In addition, scatter charts can be displayed. These GUIs can be attractive.</p>
<p>If you run it from the command line:</p>
<pre><code>ccfx p java -d c:\dev\java\
</code></pre><p>The a.ccfxd output at this time is a binary file that can be opened with GemX. You can convert to text format with the following command.</p>
<pre><code>&gt;ccfx p a.ccfxd &gt;test.txt
</code></pre><h2 id="support-for-visual-basic">Support for Visual Basic</h2>
<p>As a tool of this kind, Visual Basic is supported rarely.
It seems that you are also analyzing code made with VB6 and VBA. However, the cls file is not recognized, so modify ccfx_prep_scripts.ini as follows.</p>
<pre><code>visualbasic=.vb;.bas;.frm;.cls
</code></pre><h2 id="other">Other</h2>
<ul>
<li>Processing for a source that handles multibyte may fail.
・As far as I&rsquo;ve checked, the link with Jenkins seems not easy.</li>
<li>The update history page is dead linked, so it seems that it is no longer maintained.
Since the source code is available, you will need to fix it yourself if necessary.</li>
</ul>
<p>Monitoring by #Jenkins
You can monitor the transition of code clones by using Jenkins&rsquo;s Violations plugin.
<a href="https://wiki.jenkins-ci.org/display/JENKINS/Violations">https://wiki.jenkins-ci.org/display/JENKINS/Violations</a></p>
<ol>
<li>
<p>Generate XML on the workspace in Jenkins script.</p>
</li>
<li>
<p>Specify XML of 1. in cpd of ReportViolations in the post-build process of project settings.
<img src="https://qiita-image-store.s3.amazonaws.com/0/47856/221dfe69-e158-d9cd-96e2-6268ee6feee5.png" alt="clone.png"></p>
</li>
<li>
<p>The following report is created by executing each build.
<img src="https://qiita-image-store.s3.amazonaws.com/0/47856/6b96a200-44c0-4447-0ac1-327e0aa87645.png" alt="clone.png"></p>
</li>
</ol>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
