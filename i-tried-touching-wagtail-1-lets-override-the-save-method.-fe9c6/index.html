<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>I tried touching Wagtail (1), let&#39;s override the save method. | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>I tried touching Wagtail (1), let&rsquo;s override the save method.</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 23, 2019
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/django">Django</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/wagtail">Wagtail</a></code></small>

</p>
<pre><code>#### INTRODUCTION
</code></pre>
<p>Hello</p>
<p>I was developing using Wagtail a while ago. Wagtail&rsquo;s Japanese literature is not very large, so reading English literature is required.</p>
<p>As an engineer, the ability to read English literature is very important,
<strong>I wish there were references written in Japanese</strong>
I think many people should think that. <del>I think</del></p>
<p>So I&rsquo;ll write the code using Wagtail and output it.
This is the first of them.</p>
<hr>
<h4 id="about-wagtail">About Wagtail</h4>
<p>I think some people might think of Wagtail in the first place.</p>
<p>Wagtail is a <a href="https://www.asobou.co.jp/blog/web/about-cms">CMS</a><a href="https://wa3.i-3-i.info">OSS</a>developedbasedonDjango./word15874.html).WordPressrunsonPHP,whileWagtailrunsonPython.Asyoucanseefromthe<a href="http://docs.wagtail.io/en/v2.7/releases/">ReleaseNotes</a>, development is quite active.</p>
<p>By the way, Wagtail is a word that corresponds to Sekirei in Japanese. The Wagtail logo is also made with the motif of Sekirei.</p>
<hr>
<h4 id="lets-prepare-the-environment">Let&rsquo;s prepare the environment</h4>
<p>Let&rsquo;s touch it immediately.
I&rsquo;m on mac. Regarding the environment construction, I referred to the following site.</p>
<p>reference:
<a href="https://qiita.com/j54854/items/96396f24fe8ce9b60d05">Recommendation for Wagtail (1) A story that selected and selected Wagtail after comparing and examining CMS based on Django</a>
<a href="https://qiita.com/yinawekuky/items/52343fa12850f84ee79e">Create a simple blog system with wagtail ~Learn Wagtail ①</a></p>
<hr>
<h4 id="lets-write-the-body">Let&rsquo;s write the body</h4>
<p>Access the CMS from localhost and click the &ldquo;Page Button&rdquo;. Next, click &ldquo;ADD CHILD PAGE&rdquo; at the top of the screen. You can edit your blog here.</p>
<p>If you have not edited any code, you can only enter the title. Set up so that you can write the text referring to the reference website below.</p>
<p>Reference: <a href="https://tech.shiroshika.com/wagtail-homepage-plugin/">Customize Wagtail Page</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:home/models.py" data-lang="python:home/models.py">
  <span style="color:#ae81ff">1</span> <span style="color:#f92672">from</span> django.db <span style="color:#f92672">import</span> models
  <span style="color:#ae81ff">2</span>
  <span style="color:#ae81ff">3</span> <span style="color:#f92672">from</span> wagtail.core.models <span style="color:#f92672">import</span> Page
  <span style="color:#ae81ff">4</span> <span style="color:#f92672">from</span> wagtail.core.fields <span style="color:#f92672">import</span> RichTextField
  <span style="color:#ae81ff">5</span> <span style="color:#f92672">from</span> wagtail.admin.edit_handlers <span style="color:#f92672">import</span> FieldPanel
  <span style="color:#ae81ff">6</span>
  <span style="color:#ae81ff">7</span>
  <span style="color:#ae81ff">8</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HomePage</span>(Page):
  <span style="color:#ae81ff">9</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74"> 10 Page model
</span><span style="color:#e6db74"> 11 &#34;&#34;&#34;</span>
 <span style="color:#ae81ff">12</span> body <span style="color:#f92672">=</span> RichTextField(blank<span style="color:#f92672">=</span>True)
 <span style="color:#ae81ff">13</span> content_panels <span style="color:#f92672">=</span> Page<span style="color:#f92672">.</span>content_panels <span style="color:#f92672">+</span> [FieldPanel(<span style="color:#e6db74">&#34;body&#34;</span>, classname<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;full&#34;</span>),]

</code></pre></div><p>Let&rsquo;s look at the code. For the code of this model, <a href="https://github.com/wagtail/wagtail/blob/c72a4e09413bc6fc3a9cac8ed173378aa8652925/wagtail/core/models.py#L231">Page</a>modelis<a href="https://blog.codecamp.jp/python-class-2">inherited</a>TheHomePagemodeliswritten.Addedthebodyas<a href="https://github.com/wagtail/wagtail/blob/c72a4e09413bc6fc3a9cac8ed173378aa8652925/wagtail/core/fields.py#L9">RichTextField</a>,thatis,thebodymodel.Don&rsquo;tforgettoadd<a href="https://github.com/wagtail/wagtail/blob/c72a4e09413bc6fc3a9cac8ed173378aa8652925/wagtail/admin/edit_handlers.py#L420">FieldPanel</a>. ~~ There are people who forgot here ~~</p>
<p>Let&rsquo;s migrate as well.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">
python manage.py makemigrations
python manage.py migrate
</code></pre></div><p>I think the display screen looks something like this.
↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓
<img width="713" alt="Screenshots 2019-12-23 15.24.51.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/517540/fb465b6f-ea65-ba25-4b1d-7f1dd2f7e8e4.png"></p>
<hr>
<h4 id="lets-write-the-title-and-operation-when-saving-the-text">Let&rsquo;s write the title and operation when saving the text</h4>
<p>Once you&rsquo;ve filled in the title and body, you can save the content by clicking the tabs at the bottom of the screen. In that case, try to validate the title and body. This time I will limit the number of characters.
<strong>Save the title and body for testing</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:home/models.py" data-lang="python:home/models.py">  <span style="color:#ae81ff">1</span> <span style="color:#f92672">from</span> django.db <span style="color:#f92672">import</span> models
  <span style="color:#ae81ff">2</span>
  <span style="color:#ae81ff">3</span> <span style="color:#f92672">from</span> wagtail.core.models <span style="color:#f92672">import</span> Page
  <span style="color:#ae81ff">4</span> <span style="color:#f92672">from</span> wagtail.core.fields <span style="color:#f92672">import</span> RichTextField
  <span style="color:#ae81ff">5</span> <span style="color:#f92672">from</span> wagtail.admin.edit_handlers <span style="color:#f92672">import</span> FieldPanel
  <span style="color:#ae81ff">6</span>
  <span style="color:#ae81ff">7</span>
  <span style="color:#ae81ff">8</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HomePage</span>(Page):
  <span style="color:#ae81ff">9</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74"> 10 Page model
</span><span style="color:#e6db74"> 11 &#34;&#34;&#34;</span>
 <span style="color:#ae81ff">12</span> body <span style="color:#f92672">=</span> RichTextField(blank<span style="color:#f92672">=</span>True)
 <span style="color:#ae81ff">13</span> content_panels <span style="color:#f92672">=</span> Page<span style="color:#f92672">.</span>content_panels <span style="color:#f92672">+</span> [FieldPanel(<span style="color:#e6db74">&#34;body&#34;</span>, classname<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;fu ll&#34;</span>),]
 <span style="color:#ae81ff">14</span> 
 <span style="color:#ae81ff">15</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">save</span>(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
 <span style="color:#ae81ff">16</span> <span style="color:#e6db74">&#34;&#34;&#34;save function&#34;&#34;&#34;</span>
 <span style="color:#ae81ff">17</span> <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Entered save function&#34;</span>)
 <span style="color:#ae81ff">18</span> breakpoint()
</code></pre></div><p>Overrides <a href="https://qiita.com/sakamossan/items/44f54d287d13334e6406">save method</a>of<a href="https://docs.djangoproject.com/ja/3.0/">django</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">breakpoint()
</code></pre></div><p>This is a function that calls the debugger <a href="https://qiita.com/nakkun/items/62cc704af729893783f1">PDB</a> that can be used in Python. Let&rsquo;s run it immediately.</p>
<ol>
<li>Start the local server</li>
<li>Place breakpoint() anywhere</li>
<li>Save the edited file</li>
<li>Execute arbitrary command
Now the following log is output.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Entered save <span style="color:#66d9ef">function</span>
- -Return--
&gt; /Users/Username/mysite/home/models.py<span style="color:#f92672">(</span>18<span style="color:#f92672">)</span>save<span style="color:#f92672">()</span>-&gt;None
- &gt; breakpoint<span style="color:#f92672">()</span>
<span style="color:#f92672">(</span>Pdb<span style="color:#f92672">)</span> HomePage
&lt;class<span style="color:#e6db74">&#39;home.models.HomePage&#39;</span>&gt;
<span style="color:#f92672">(</span>Pdb<span style="color:#f92672">)</span> HomePage.objects
&lt;django.db.models.manager.BasePageManagerFromPageQuerySet object at 0x10ebee410&gt;
<span style="color:#f92672">(</span>Pdb<span style="color:#f92672">)</span> HomePage.objects.all<span style="color:#f92672">()</span>
&lt;PageQuerySet <span style="color:#f92672">[</span>&lt;HomePage: Home&gt;, &lt;HomePage: title&gt;<span style="color:#f92672">]</span>&gt;
<span style="color:#f92672">(</span>Pdb<span style="color:#f92672">)</span> instance <span style="color:#f92672">=</span> HomePage.objects.all<span style="color:#f92672">()</span>
<span style="color:#f92672">(</span>Pdb<span style="color:#f92672">)</span> instance
&lt;PageQuerySet <span style="color:#f92672">[</span>&lt;HomePage: Home&gt;, &lt;HomePage: title&gt;<span style="color:#f92672">]</span>&gt;
<span style="color:#f92672">(</span>Pdb<span style="color:#f92672">)</span> instance<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>
&lt;HomePage: title&gt;
<span style="color:#f92672">(</span>Pdb<span style="color:#f92672">)</span> instance<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>.title
<span style="color:#e6db74">&#39;title&#39;</span>
<span style="color:#f92672">(</span>Pdb<span style="color:#f92672">)</span> len<span style="color:#f92672">(</span>instance<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>.title<span style="color:#f92672">)</span>
Five

</code></pre></div><p>If you use <a href="https://note.nkmk.me/python-str-len/">len function</a>, you can know the length of the string.</p>
<p>When developing with Django or Wagtail, I start the debugger like this and check the contents of the object. After that, if you write a conditional expression, you can validate the number of characters in the title.</p>
<p>According to this site &ldquo;<a href="https://www.sakurasaku-labo.jp/blogs/tittle-word-count">What is the effective number of title characters in Google SEO</a>&rdquo;, up to 32 title characters can be used. Sounds right. This time I want to process it so that it does not exceed 33 characters.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:home/models.py" data-lang="python:home/models.py"> <span style="color:#ae81ff">16</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">save</span>(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
 <span style="color:#ae81ff">17</span> <span style="color:#e6db74">&#34;&#34;&#34;save function&#34;&#34;&#34;</span>
 <span style="color:#ae81ff">18</span> <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Entered save function&#34;</span>)
 <span style="color:#ae81ff">19</span> breakpoint()
 <span style="color:#ae81ff">20</span> instance <span style="color:#f92672">=</span> HomePage<span style="color:#f92672">.</span>objects<span style="color:#f92672">.</span>all() <span style="color:#75715e"># forget to erase</span>
 <span style="color:#ae81ff">21</span> titleCharCount <span style="color:#f92672">=</span> len(self<span style="color:#f92672">.</span>title)
 <span style="color:#ae81ff">22</span> <span style="color:#66d9ef">if</span> ((titleCharCount <span style="color:#f92672">&lt;</span><span style="color:#ae81ff">0</span>) <span style="color:#f92672">|</span> (titleCharCount<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">32</span>)):
 <span style="color:#ae81ff">23</span> <span style="color:#75715e">#Not validated</span>
 <span style="color:#ae81ff">24</span> <span style="color:#66d9ef">return</span>
 <span style="color:#ae81ff">25</span> <span style="color:#66d9ef">else</span>:
 <span style="color:#ae81ff">26</span> <span style="color:#75715e">#Validation passed</span>
 <span style="color:#ae81ff">27</span> <span style="color:#66d9ef">return</span> super(HomePage, self)<span style="color:#f92672">.</span>save()

</code></pre></div><p>On line 24 the object is not saved. It is saved at line 27. Let&rsquo;s check using a debugger. If you write a similar process, the text will be validated.</p>
<hr>
<h4 id="at-the-end">at the end</h4>
<p>The error message displayed at the top of the screen when the object cannot be saved is not implemented.
Next time I&rsquo;ll write the output of it.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
