<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Technology to hack MTG | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Technology to hack MTG</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 15, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/mtg">Mtg</a></code></small>

</p>
<pre><code>Hello everyone. I am [@denzowill](https://twitter.com/denzowill) who is a database engineer at LAPRAS.
</code></pre>
<p>Suddenly, what do you plan to occupy the most amount of time on your adult schedule?</p>
<p>That&rsquo;s right. It&rsquo;s &ldquo;MTG&rdquo;.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44722/959beca1-2e50-4210-9376-bb13f3fcb71c.png" alt="image.png"></p>
<p>Many MTGs are included in the schedule of working people. While working at LAPRAS, I also sometimes have lunch MTG and overtime MTG after work hours.</p>
<p>When it comes to performance tuning, it is routine to start with the biggest bottleneck. Therefore, hacking MTG, which occupies most of the schedule, is effective in improving work efficiency.</p>
<p>I&rsquo;m an engineer, so if I hack, I would rather deal with using the system rather than using the theory. Therefore, this time we will look at the technology for hacking MTG.</p>
<h3 id="mtg-definition">MTG definition</h3>
<p>First, check the definition of the MTG that is the target of the hack. The target MTG this time is</p>
<ul>
<li>Rally</li>
<li>Meeting</li>
<li>Debriefing session</li>
</ul>
<p>It&rsquo;s not <a href="https://mtg-jp.com/">Magic: The Gathering</a>. So, if you would like to know the efficiency of meeting, I will inform you that no useful information is written after this.</p>
<h3 id="api-related-to-mtg">API related to MTG</h3>
<p>MTG has a long history and various data are available. The services of major offices that can be used have various characteristics, so we will introduce each of them.</p>
<h3 id="magic-the-gathering-apiapimagicthegatheringio">Magic: The Gathering API(<code>api.magicthegathering.io</code>)</h3>
<p>API that can get information such as MTG card and format is provided. It is also introduced in some articles on Qiita.</p>
<ul>
<li><a href="https://docs.magicthegathering.io/">Magic: The Gathering API and Developer SDKs</a></li>
</ul>
<p>This provides a REST API of the form <code>https://api.magicthegathering.io/&lt;version&gt;/&lt;resource&gt;</code> and also provides SDKs for various major languages.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44722/acc09f05-5997-400f-7d72-a31e1a70ed5f.png" alt="Select Range_183.png"></p>
<p>By the way, although it is out of the documentation, if you go directly to <a href="https://github.com/MagicTheGathering">GitHub</a>, SDKs such as <code>Elixir</code> and <code>Rust</code> are also provided.</p>
<p>By the way, this kind of SDK is often just a wrapper around the API, but this one has a <code>QueryBuilder</code> and it can be used stylishly. For example, the following will find a card that contains the card name <code>Oko</code> in Japanese notation and the card type <code>Plainswalker</code>.</p>
<pre><code class="language-python:sample" data-lang="python:sample">cards = Card.where(name='Oko').where(language='japanese').where(types='Planeswalker').all()
for card in cards:
    original_name = card.name
    japanese_name = [f for f in card.foreign_names if f['language'] =='Japanese'][0]['name']
    print(f'English: {original_name}, Japanese: {japanese_name}')
</code></pre><pre><code class="language-:" data-lang=":">English: Oko, Thief of Crowns, Japanese: Crown Thief, Oko
English: Oko, the Trickster, Japanese: Trickster, Oko
</code></pre><p>The rate limit of this API is 5000 requests/hour, and there seems to be no way to increase it in particular, so use it quietly. Also, the performance of the search system is quite poor. You probably have a straightforward RDBMS in the backend that doesn&rsquo;t use a full-text search engine. Even the sample code above takes about 5 seconds.</p>
<p>Please note that this API is not officially provided by Wizards of the Coast. It seems to be an API managed by volunteers.</p>
<h3 id="mtgjson">MTGJSON</h3>
<p><a href="https://mtgjson.com">Mtgjson</a> is used as the data of the above API.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/44722/9ce8e152-3035-b830-930a-7f8d022c8a72.png" alt="Select Range_184.png"></p>
<p>mtgjson is a project to maintain and provide all the cards etc. existing in MTG as a format that can be handled by volunteers. These data can be downloaded by anyone as a JSON, SQL file, or sqlite database file.</p>
<p><a href="https://mtgjson.com/downloads/all-files/">https://mtgjson.com/downloads/all-files/</a></p>
<p>You can use these to provide your own MTG related services like the previous API. On the contrary, if you want to create your own card information service, it is easier to directly use this database instead of using the above API.</p>
<p>In addition, mtgjson also has a GitHub repository.</p>
<p><a href="https://github.com/mtgjson/mtgjson">https://github.com/mtgjson/mtgjson</a></p>
<p>It provides the code to build the data provided by mtgjson. So you can get similar data by running this repository locally. Where is the original data? I thought and looked, but it seems that it is acquired from <a href="https://scryfall.com/">https://scryfall.com/</a>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:mtgjson4/provider/scryfall.py" data-lang="python:mtgjson4/provider/scryfall.py">SCRYFALL_API_SETS: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.scryfall.com/sets/&#34;</span>
SCRYFALL_API_CARD: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.scryfall.com/cards/&#34;</span>
SCRYFALL_API_CATALOG: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.scryfall.com/catalog/{0}-types&#34;</span>
SCRYFALL_VARIATIONS: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.scryfall.com/cards/search?q=is%3Avariation</span><span style="color:#e6db74">%20s</span><span style="color:#e6db74">et%3A{0}&amp;unique=prints&#34;</span>
SCRYFALL_SET_SIZE: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.scryfall.com/cards/search?order=set&amp;q=set:{0}</span><span style="color:#e6db74">%20i</span><span style="color:#e6db74">s:booster</span><span style="color:#e6db74">%20u</span><span style="color:#e6db74">nique:prints&#34;</span>
SCRYFALL_API_SEARCH: str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://api.scryfall.com/cards/search?q=(o:deck</span><span style="color:#e6db74">%20o</span><span style="color:#e6db74">:any</span><span style="color:#e6db74">%20o</span><span style="color:#e6db74">:number</span><span style="color:#e6db74">%20o</span><span style="color:#e6db74">:cards</span><span style="color:#e6db74">%20o</span><span style="color:#e6db74">:named)&#34;</span>
</code></pre></div><h3 id="scryfall">scryfall</h3>
<p>The REST API is also provided at <a href="https://scryfall.com/,">https://scryfall.com/,</a> which provides MTG card search.</p>
<p><a href="https://scryfall.com/docs/api">https://scryfall.com/docs/api</a></p>
<p>Similar to <code>api.magicthegathering.io</code>, card search is also provided, and it runs faster than <code>api.magicthegathering.io</code>. Unfortunately there is no officially provided SDK, but it&rsquo;s a REST API so making a wrapped SDK shouldn&rsquo;t be too difficult.</p>
<p>Rate Limit is not written with a clear value, but it is about 10 requests/second, so it is a bit more severe than <code>api.magicthegathering.io</code>, but this is the API specification. Looks good.</p>
<h3 id="summary">Summary</h3>
<p>After all, in terms of what to use, it will be as follows.</p>
<ul>
<li>Anyway, I want an SDK
<ul>
<li><code>api.magicthegathering.io</code></li>
</ul>
</li>
<li>I want a high-performance search API
<ul>
<li>scryfall</li>
</ul>
</li>
<li>I want each database
<ul>
<li>mtgjson</li>
</ul>
</li>
</ul>
<p>It seems better to use scryfall if you don&rsquo;t have a database on your own, or mtgjson if you want to create something with a database. I hope that engineers who like MTG will find it useful as a source of data when doing something interesting.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
