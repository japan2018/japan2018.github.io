<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>I tried a customer cluster analysis using purchasing data | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>I tried a customer cluster analysis using purchasing data</h1>
<p>
  <small class="text-secondary">
  
  
  Jan 9, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/machine-learning"> machine learning</a></code></small>


<small><code><a href="https://memotut.com/tags/cluster-analysis"> cluster analysis</a></code></small>

</p>
<pre><code># Overview
</code></pre>
<p>We performed a customer cluster analysis based on the purchase data. After performing cluster analysis, we visualized the characteristics of each segment.</p>
<p>#Introduction
When performing machine learning, data analysis is necessary in many situations. How do you see the data you have and how do you process it?
I would like to increase the number of such drawers, but the current situation is that there are not many data analysis teaching materials using Python. (I&rsquo;m tired of talking about irises and Titanic&hellip;)
So I thought, &ldquo;Even if it&rsquo;s not Pthon, if I buy the teaching materials that can learn the method of data analysis and reproduce it in Python, I can increase the number of drawers.&rdquo;
The book I got this time is as follows.</p>
<h4 id="r-business-statistics-analysis-visitechhttpswwwamazoncojpre38393e382b8e3838de382b9e7b5b1e8a888e58886e69e90-e38393e382b8e38386e382af-e8b18ae6bea4-e6a084e6b2bbdp4798149500refsr_1_1adgrpid50883860102gclidcjwkcaiamnbwbrboeiwaqcwwpa7bggxfqkqfqrqeqwqbqeqwqbqeqwqbqeqw338575431599hvdevchvlocphy1009433hvnetwghvpos1t2hvqmtehvrand7508171191131142832hvtargidaud-7593774718933akwd-411533392957hydadcr13897_10891658jp8e38e38e88ee382b9e7b5b1e8a888e58886e69e90qid1578535237sr8-1"><a href="https://www.amazon.co.jp/R%E3%83%93%E3%82%B8%E3%83%8D%E3%82%B9%E7%B5%B1%E8%A8%88%E5%88%86%E6%9E%90-%E3%83%93%E3%82%B8%E3%83%86%E3%82%AF-%E8%B1%8A%E6%BE%A4-%E6%A0%84%E6%B2%BB/dp/4798149500/ref=sr_1_1?adgrpid=50883860102&amp;gclid=CjwKCAiAmNbwBRBOEiwAqcwwpa7BggXFQKQFQRQEQWQBQEQWQBQEQWQBQEQW=338575431599&amp;hvdev=c&amp;hvlocphy=1009433&amp;hvnetw=g&amp;hvpos=1t2&amp;hvqmt=e&amp;hvrand=7508171191131142832&amp;hvtargid=aud-759377471893%3Akwd-411533392957&amp;hydadcr=13897_10891658&amp;jp%8e3%8e3%8e8%8e%E3%82%B9%E7%B5%B1%E8%A8%88%E5%88%86%E6%9E%90&amp;qid=1578535237&amp;sr=8-1">**R Business Statistics Analysis [Visitech]**</a></h4>
<blockquote>
<p>[Purpose of this document]
This book uses R from a large amount of data accumulated in the field of business
A business statistical analysis method that seeks a Big X that is directly linked to its own sales
This is a collection of books. Easy to understand with a combination of general and actual analysis methods
I am explaining.</p>
</blockquote>
<h1 id="usage-data">Usage data</h1>
<p>I have used the above book files.</p>
<p>・Purchase history information [buying.csv]</p>
<p>#Actual code</p>
<h3 id="1-load-the-data">1. Load the data</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Import library</span>
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">import</span> seaborn <span style="color:#f92672">as</span> sns
<span style="color:#f92672">import</span> japanize_matplotlib
<span style="color:#f92672">%</span>matplotlib inline
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Read/display file</span>
buying <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;buying.csv&#34;</span>,encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;cp932&#39;</span>)
buying<span style="color:#f92672">.</span>head()
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/0ef202dc-2d8b-e68e-118b-650cead5f885.jpeg" alt="Data1.jpg"></p>
<h3 id="2-cross-tabulation">2. Cross tabulation</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Create cross-selling data by cross tabulation</span>
buying_mat <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>crosstab(buying[<span style="color:#e6db74">&#39;id&#39;</span>], buying[<span style="color:#e6db74">&#39;category&#39;</span>])
buying_mat<span style="color:#f92672">.</span>head()
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/c2b44e68-f813-85d1-6ec6-693b62f0f4b8.jpeg" alt="Data2.jpg"></p>
<h3 id="3-hierarchical-cluster-analysis-after-making-dummy-variables">3. Hierarchical cluster analysis after making dummy variables</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Convert joint sales data to dummy variables</span>
<span style="color:#75715e"># Set to &#34;1&#34; if you have purchased more than once, otherwise set to &#34;0&#34;</span>
buying_mat1 <span style="color:#f92672">=</span> buying_mat<span style="color:#f92672">.</span>copy()
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(buying_mat1)):
    <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(len(buying_mat1<span style="color:#f92672">.</span>columns)):
        <span style="color:#66d9ef">if</span> buying_mat1<span style="color:#f92672">.</span>iloc[i, j] <span style="color:#f92672">&gt;</span><span style="color:#ae81ff">1</span>:
            buying_mat1<span style="color:#f92672">.</span>iloc[i, j] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>

buying_mat1<span style="color:#f92672">.</span>head()
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/71980632-97f9-0600-56af-c871617b6b1a.jpeg" alt="Data3.jpg"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Import Library for Cluster Analysis</span>
<span style="color:#f92672">from</span> scipy.cluster.hierarchy <span style="color:#f92672">import</span> dendrogram, linkage
<span style="color:#f92672">from</span> scipy.cluster.hierarchy <span style="color:#f92672">import</span> linkage, dendrogram, fcluster
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Implementation of hierarchical clustering</span>
<span style="color:#75715e"># Ward method x Euclidean distance</span>
linkage_result <span style="color:#f92672">=</span> linkage(buying_mat1, method<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ward&#39;</span>, metric<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;euclidean&#39;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Decide the threshold for clustering</span>
threshold <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.7</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>max(linkage_result[:, <span style="color:#ae81ff">2</span>])
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Hierarchical clustering visualization</span>
plt<span style="color:#f92672">.</span>figure(num<span style="color:#f92672">=</span>None, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">9</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">200</span>, facecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;w&#39;</span>, edgecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;k&#39;</span>)
dendrogram(linkage_result, labels<span style="color:#f92672">=</span>buying_mat1<span style="color:#f92672">.</span>index, color_threshold<span style="color:#f92672">=</span>threshold)
plt<span style="color:#f92672">.</span>axhline(<span style="color:#ae81ff">7</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;r&#39;</span>)
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/d3199853-aa16-52f4-88eb-bdcb4bdc6833.png" alt="graph1.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Get clustering result value</span>
clustered <span style="color:#f92672">=</span> fcluster(linkage_result, threshold, criterion<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;distance&#39;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Check clustering result</span>
<span style="color:#66d9ef">print</span>(clustered)
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/9ae22510-854f-d215-2415-63a10f0132b3.jpeg" alt="Data4.jpg"></p>
<h3 id="4-hierarchical-cluster-analysis-without-dummy-variables">4. Hierarchical cluster analysis without dummy variables</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Implementation of hierarchical clustering</span>
<span style="color:#75715e"># Ward method x Euclidean distance</span>
linkage_result2 <span style="color:#f92672">=</span> linkage(buying_mat, method<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;ward&#39;</span>, metric<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;euclidean&#39;</span>)
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Decide the threshold for clustering</span>
threshold2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.7</span> <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>max(linkage_result2[:, <span style="color:#ae81ff">2</span>])
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Hierarchical clustering visualization</span>
plt<span style="color:#f92672">.</span>figure(num<span style="color:#f92672">=</span>None, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">9</span>), dpi<span style="color:#f92672">=</span><span style="color:#ae81ff">200</span>, facecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;w&#39;</span>, edgecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;k&#39;</span>)
dendrogram(linkage_result2, labels<span style="color:#f92672">=</span>buying_mat<span style="color:#f92672">.</span>index, color_threshold<span style="color:#f92672">=</span>threshold2)
plt<span style="color:#f92672">.</span>axhline(<span style="color:#ae81ff">23</span>, linestyle<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;--&#39;</span>, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;r&#39;</span>)
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/ac5dbe5b-6f3a-3297-c08e-bb32e5c70d0d.png" alt="graph2.png"></p>
<h3 id="5-combine-the-results-of-hierarchical-cluster-analysis-with-the-original-data">5. Combine the results of hierarchical cluster analysis with the original data</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Convert the result of hierarchical cluster analysis to DataFrame</span>
_class <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;class&#39;</span>:clustered}, index <span style="color:#f92672">=</span> buying_mat1<span style="color:#f92672">.</span>index)
_class<span style="color:#f92672">.</span>head()
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/b9b7ab40-3a51-6862-4085-4ee7438a3817.jpeg" alt="Data5.jpg"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Combine original data and analysis results</span>
buying_mat2 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([buying_mat1, _class] ,axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
buying_mat2<span style="color:#f92672">.</span>head()
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/eca033ec-9dec-0c90-a102-8e3151aa0342.jpeg" alt="Data6.jpg"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Check the number of customers in each segment</span>
buying_mat2<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;class&#39;</span>)<span style="color:#f92672">.</span>size()
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/6a4ef1d4-9528-4620-e5cc-f912c4f2a686.jpeg" alt="Data7.jpg"></p>
<h3 id="6-grasping-the-characteristics-of-joint-sales-trends-in-each-segment">6. Grasping the characteristics of joint sales trends in each segment</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Calculate the average value of all product categories by segment</span>
cluster_stats <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>round(buying_mat2<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;class&#39;</span>, as_index<span style="color:#f92672">=</span>False)<span style="color:#f92672">.</span>mean() ,<span style="color:#ae81ff">2</span>)
cluster_stats<span style="color:#f92672">.</span>head()
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/ee2711e2-79ad-f4bd-a972-29ccc8eadbe8.jpeg" alt="Data8.jpg"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Convert to portrait data format for graph drawing</span>
mat_melt <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>melt(cluster_stats, id_vars<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;class&#39;</span>, var_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Category&#39;</span>, value_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Rate&#39;</span>)
mat_melt<span style="color:#f92672">.</span>head()
<span style="color:#e6db74">``</span><span style="color:#960050;background-color:#1e0010">`!</span>[Data9<span style="color:#f92672">.</span>jpg](https:<span style="color:#f92672">//</span>qiita<span style="color:#f92672">-</span>image<span style="color:#f92672">-</span>store<span style="color:#f92672">.</span>s3<span style="color:#f92672">.</span>ap<span style="color:#f92672">-</span>northeast<span style="color:#f92672">-</span><span style="color:#ae81ff">1.</span>amazonaws<span style="color:#f92672">.</span>com<span style="color:#f92672">/</span><span style="color:#ae81ff">0</span><span style="color:#f92672">/</span><span style="color:#ae81ff">555643</span><span style="color:#f92672">/</span><span style="color:#ae81ff">39927</span>ea2<span style="color:#f92672">-</span><span style="color:#ae81ff">6</span>ad5<span style="color:#f92672">-</span><span style="color:#ae81ff">0167</span><span style="color:#f92672">-</span><span style="color:#ae81ff">9</span>f9e<span style="color:#f92672">-</span><span style="color:#ae81ff">36921</span>c46b36e<span style="color:#f92672">.</span>jpeg)

<span style="color:#e6db74">``</span><span style="color:#960050;background-color:#1e0010">`</span>python
<span style="color:#75715e"># セグメントの特徴をグラフにする</span>
fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize <span style="color:#f92672">=</span>(<span style="color:#ae81ff">20</span>,<span style="color:#ae81ff">8</span>))
ax1 <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">1</span>)
sns<span style="color:#f92672">.</span>barplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Category&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Rate&#39;</span>, data<span style="color:#f92672">=</span>mat_melt[mat_melt[<span style="color:#e6db74">&#39;class&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>], ax<span style="color:#f92672">=</span>ax1)
plt<span style="color:#f92672">.</span>xticks(rotation<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
plt<span style="color:#f92672">.</span>ylim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)

ax2 <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">2</span>)
sns<span style="color:#f92672">.</span>barplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Category&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Rate&#39;</span>, data<span style="color:#f92672">=</span>mat_melt[mat_melt[<span style="color:#e6db74">&#39;class&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>], ax<span style="color:#f92672">=</span>ax2)
plt<span style="color:#f92672">.</span>xticks(rotation<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
plt<span style="color:#f92672">.</span>ylim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)

ax3 <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">3</span>)
sns<span style="color:#f92672">.</span>barplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Category&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Rate&#39;</span>, data<span style="color:#f92672">=</span>mat_melt[mat_melt[<span style="color:#e6db74">&#39;class&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span>], ax<span style="color:#f92672">=</span>ax3)
plt<span style="color:#f92672">.</span>xticks(rotation<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
plt<span style="color:#f92672">.</span>ylim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)

ax4 <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">4</span>)
sns<span style="color:#f92672">.</span>barplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Category&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Rate&#39;</span>, data<span style="color:#f92672">=</span>mat_melt[mat_melt[<span style="color:#e6db74">&#39;class&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">4</span>], ax<span style="color:#f92672">=</span>ax4)
plt<span style="color:#f92672">.</span>xticks(rotation<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
plt<span style="color:#f92672">.</span>ylim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)           
    
ax5 <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">5</span>)
sns<span style="color:#f92672">.</span>barplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Category&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Rate&#39;</span>, data<span style="color:#f92672">=</span>mat_melt[mat_melt[<span style="color:#e6db74">&#39;class&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">5</span>], ax<span style="color:#f92672">=</span>ax5)
plt<span style="color:#f92672">.</span>xticks(rotation<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/844507ed-53c7-73b6-eafe-2eb112e8ec0a.png" alt="graph4.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># セグメントの特徴をグラフにする(for文でグラフ描画)</span>
groups <span style="color:#f92672">=</span> mat_melt<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;class&#39;</span>)
fig <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>figure(figsize <span style="color:#f92672">=</span>(<span style="color:#ae81ff">20</span>,<span style="color:#ae81ff">8</span>))

<span style="color:#66d9ef">for</span> name, group <span style="color:#f92672">in</span> groups:
    _ax <span style="color:#f92672">=</span> fig<span style="color:#f92672">.</span>add_subplot(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>, int(name))
    sns<span style="color:#f92672">.</span>barplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Category&#39;</span>, y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Rate&#39;</span>, data<span style="color:#f92672">=</span>group , ax<span style="color:#f92672">=</span>_ax)
    plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Class&#39;</span> <span style="color:#f92672">+</span> str(name))
    plt<span style="color:#f92672">.</span>xticks(rotation<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
    plt<span style="color:#f92672">.</span>ylim(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>)
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/555643/844507ed-53c7-73b6-eafe-2eb112e8ec0a.png" alt="graph4.png"></p>
<p>各セグメントの特徴から購入層を推定してみる。
・Class1
・雑貨の購入率が高い
⇒雑貨好きの層？
・Class2
・男性物を除いた項目の購入率がまんべんなく高い
⇒子供のいる家庭・女性客？
・Class3
・ベビー用品、マタニティ、男性物と購入率が高い
⇒子供のいる家庭・男性客？
・Class4
・女性物の購入率が高い
⇒女性客？
・Class5
・女性物の購入率が高い、ただしClass4とは購買傾向が異なる
⇒女性客(Class4とは購買傾向が異なる)？</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
