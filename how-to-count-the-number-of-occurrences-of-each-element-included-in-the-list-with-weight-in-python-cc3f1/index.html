<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>How to count the number of occurrences of each element included in the list with weight in Python | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>How to count the number of occurrences of each element included in the list with weight in Python</h1>
<p>
  <small class="text-secondary">
  
  
  Jan 17, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/numpy">numpy</a></code></small>


<small><code><a href="https://memotut.com/tags/pandas">pandas</a></code></small>

</p>
<pre><code># Thing you want to do
</code></pre>
<p>Given the following two lists, we want to count the number of occurrences of each element included in <code>a</code> by weighting it with the value of <code>b</code>.
Python is 3.7.5.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">a <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#e6db74">&#34;B&#34;</span>, <span style="color:#e6db74">&#34;C&#34;</span>, <span style="color:#e6db74">&#34;A&#34;</span>]
b <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span> ,<span style="color:#ae81ff">1</span> ,<span style="color:#ae81ff">2</span> ,<span style="color:#ae81ff">2</span>]

c <span style="color:#f92672">=</span> hoge(a, b)
<span style="color:#66d9ef">print</span>(c)
</code></pre></div><pre><code class="language-python:" data-lang="python:">{&quot;A&quot;: 3, &quot;B&quot;: 1, &quot;C&quot;: 2} # I want this output

# key and value can be different
# ([&quot;A&quot;, &quot;B&quot;, &quot;C&quot;], [3, 1, 2])
</code></pre><p>*Addition: <a href="https://qiita.com/minetta30/items/cc3f1b3836ceca4e3971#comment-165b055404c4c2d02c48">Comment</a> introduced a simple implementation for the above issue.</p>
<h1 id="specific-example-of-what-you-want-to-do">Specific example of what you want to do</h1>
<p>Suppose you want to count the number of books that have ever been sold at a bookstore for each book. <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>
However, I have only <strong>multiple table data that has already been aggregated for each month</strong>.
For simplicity, let&rsquo;s imagine the following two csv files.</p>
<p>■ 2020_01.csv</p>
<table>
<thead>
<tr>
<th align="center">Book name</th>
<th align="center">Volume sold</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Book_A</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">Book_B</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">Book_C</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">■ 2020_02.csv</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="center">Book name</th>
<th align="center">Volume sold</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Book_A</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">Book_C</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">Book_D</td>
<td align="center">3</td>
</tr>
</tbody>
</table>
<p>Combining these two pieces of data becomes a counting problem with &ldquo;elements&rdquo; and &ldquo;weights&rdquo; as described in &ldquo;What you want to do&rdquo;.</p>
<h1 id="method">Method</h1>
<p>It was made by the following three methods.
I would be happy if you could tell me which method is better or another method <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup>.</p>
<ol>
<li>Join all the tables, create a <code>label</code> that uniquely corresponds to the name of the book, and count with weight with <code>numpy.bincount</code>.</li>
<li>Create a <code>collections.Counter</code> object for each table and add the <code>Counter</code> objects for all the tables.</li>
<li>Use the for statement to add an element to the dictionary and update the value.
3&rsquo;. Use <code>reduce</code> instead of for statement.</li>
</ol>
<ul>
<li>Addition
<a href="https://qiita.com/minetta30/items/cc3f1b3836ceca4e3971#comment-c06191265a976e267421">Comment</a> I added 3 which I was told.</li>
</ul>
<h2 id="1-using-numpybincount">1. Using numpy.bincount</h2>
<p>By using <code>numpy</code>'s <code>bincount</code> function, you can count while weighting the input.
Reference: <a href="http://koshian2.hatenablog.jp/entry/2018/04/02/153120">Meaning of weight of numpy.bincount</a></p>
<p>However, each element entered in <code>np.bincount</code>** must be a non-negative integer**.</p>
<blockquote>
<p>numpy.bincount(x, weights=None, minlength=0)
Count number of occurrences of each value in <strong>array of non-negative ints</strong>.</p>
</blockquote>
<blockquote>
<p>x: array_like, 1 dimension, nonnegative ints</p>
</blockquote>
<ul>
<li>&mdash; Input array.
weights: array_like, optional</li>
<li>&mdash; Weights, array of the same shape as x.
minlength: int, optional</li>
<li>&mdash; A minimum number of bins for the output array.</li>
<li>&mdash; New in version 1.6.0.</li>
</ul>
<p>Therefore, to use <code>np.bincount</code>, prepare a <code>label</code> that uniquely corresponds to the book name.
I used <code>sklearn</code>'s <code>LabelEncoder</code> to create the <code>label</code>.</p>
<h3 id="code">code</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> LabelEncoder

<span style="color:#75715e"># Data preparation</span>
df_01 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame([[<span style="color:#e6db74">&#34;Book_A&#34;</span>, <span style="color:#ae81ff">1</span>],
                      [<span style="color:#e6db74">&#34;Book_B&#34;</span>, <span style="color:#ae81ff">2</span>],
                      [<span style="color:#e6db74">&#34;Book_C&#34;</span>, <span style="color:#ae81ff">3</span>]],
                     columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;Name&#34;</span>, <span style="color:#e6db74">&#34;Count&#34;</span>])
df_02 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame([[<span style="color:#e6db74">&#34;Book_A&#34;</span>, <span style="color:#ae81ff">2</span>],
                      [<span style="color:#e6db74">&#34;Book_C&#34;</span>, <span style="color:#ae81ff">1</span>],
                      [<span style="color:#e6db74">&#34;Book_D&#34;</span>, <span style="color:#ae81ff">3</span>]],
                     columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;Name&#34;</span>, <span style="color:#e6db74">&#34;Count&#34;</span>])

<span style="color:#75715e"># Join tables</span>
df_all <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([df_01, df_02])
<span style="color:#75715e"># The contents are like this.</span>
<span style="color:#75715e"># | | Name | Count |</span>
<span style="color:#75715e"># |--:|:--|--:|</span>
<span style="color:#75715e"># | 0 | Book_A | 1 |</span>
<span style="color:#75715e"># | 1 | Book_B | 2 |</span>
<span style="color:#75715e"># | 2 | Book_C | 3 |</span>
<span style="color:#75715e"># | 0 | Book_A | 2 |</span>
<span style="color:#75715e"># | 1 | Book_C | 1 |</span>
<span style="color:#75715e"># | 2 | Book_D | 3 |</span>

<span style="color:#75715e"># Label Encoding (LabelEncoder)</span>
<span style="color:#f92672">from</span> sklearn.preprocessing <span style="color:#f92672">import</span> LabelEncoder
le <span style="color:#f92672">=</span> LabelEncoder()
encoded <span style="color:#f92672">=</span> le<span style="color:#f92672">.</span>fit_transform(df_all[<span style="color:#e6db74">&#39;Name&#39;</span>]<span style="color:#f92672">.</span>values)

<span style="color:#75715e"># Label column is newly added</span>
df_all[<span style="color:#e6db74">&#34;Label&#34;</span>] <span style="color:#f92672">=</span> encoded

Weighted count <span style="color:#66d9ef">with</span> <span style="color:#75715e">#np.bincount</span>
In addition to the <span style="color:#75715e"># Label column, enter the Count column as the weight. Since the result has a decimal point, it is converted to int.</span>
count_result <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>bincount(df_all[<span style="color:#e6db74">&#34;Label&#34;</span>], weights<span style="color:#f92672">=</span>df_all[<span style="color:#e6db74">&#34;Count&#34;</span>])<span style="color:#f92672">.</span>astype(int)
Get Name corresponding to <span style="color:#75715e"># result</span>
name_result <span style="color:#f92672">=</span> le<span style="color:#f92672">.</span>inverse_transform(range(len(result)))

<span style="color:#75715e"># Finally create the dictionary you want</span>
result <span style="color:#f92672">=</span> dict(zip(name_result, count_result))
<span style="color:#66d9ef">print</span>(result)
</code></pre></div><pre><code class="language-python:" data-lang="python:">{'Book_A': 3,'Book_B': 2,'Book_C': 4,'Book_D': 3}
</code></pre><h3 id="supplement">Supplement</h3>
<p>You can also create a <code>label</code> using <code>np.unique</code>.
By setting the argument <code>return_inverse</code> of <code>np.unique</code> to True, you can get the same result as <code>fit_transform</code> of <code>LabelEncoder</code>.
In addition, the corresponding Name (<code>name_result</code> above) can also be obtained collectively.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">Label encoding using <span style="color:#75715e">#np.unique</span>
name_result, encoded <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>unique(df_all[<span style="color:#e6db74">&#34;Name&#34;</span>], return_inverse<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">print</span>(encoded)
<span style="color:#66d9ef">print</span>(name_result)
</code></pre></div><pre><code class="language-python:" data-lang="python:">[0 1 2 0 2 3]
['Book_A''Book_B''Book_C''Book_D']
</code></pre><p>Weighted counting is possible by turning the for statement without using <code>np.bincount</code> <sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># Create a zero-padded array with the same length as the dictionary you want</span>
unique_length <span style="color:#f92672">=</span> len(name_result)
count_result <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>zeros(unique_length, dtype<span style="color:#f92672">=</span>int)

<span style="color:#75715e"># Extract only the rows where encoded matches i in the table and calculate the sum of Count values.</span>
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(unique_length):
    count_result[i] <span style="color:#f92672">=</span> df_all<span style="color:#f92672">.</span>iloc[encoded<span style="color:#f92672">==</span>i][<span style="color:#e6db74">&#34;Count&#34;</span>]<span style="color:#f92672">.</span>sum()<span style="color:#f92672">.</span>astype(int)

result <span style="color:#f92672">=</span> dict(zip(name_result, count_result))
<span style="color:#66d9ef">print</span>(result)
</code></pre></div><pre><code class="language-python:" data-lang="python:">{'Book_A': 3,'Book_B': 2,'Book_C': 4,'Book_D': 3}
</code></pre><h2 id="2-using-collectionscounter">2. Using collections.Counter</h2>
<h3 id="collectionscounter-overview">collections.Counter overview</h3>
<p>The <code>Counter</code> module of the standard module <code>collections</code> is often introduced to do <strong>weightless</strong> counting.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> Counter

a <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#e6db74">&#34;B&#34;</span>, <span style="color:#e6db74">&#34;C&#34;</span>, <span style="color:#e6db74">&#34;A&#34;</span>]

Give a list to <span style="color:#75715e">#Counter for unweighted counting</span>
counter <span style="color:#f92672">=</span> Counter(a)
<span style="color:#66d9ef">print</span>(counter)

Access to <span style="color:#75715e"># element is the same as dictionary</span>
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;A:&#34;</span>, counter[<span style="color:#e6db74">&#34;A&#34;</span>])
</code></pre></div><pre><code class="language-python:" data-lang="python:">Counter({'A': 2,'B': 1,'C': 1})
A: 2
</code></pre><p>Also, if it has already been aggregated like this time, you can create an object by storing it in a dictionary once and then passing it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">counter <span style="color:#f92672">=</span> Counter(dict([[<span style="color:#e6db74">&#34;Book_A&#34;</span>, <span style="color:#ae81ff">1</span>],
                        [<span style="color:#e6db74">&#34;Book_B&#34;</span>, <span style="color:#ae81ff">2</span>],
                        [<span style="color:#e6db74">&#34;Book_C&#34;</span>, <span style="color:#ae81ff">3</span>]])))
<span style="color:#66d9ef">print</span>(counter)
</code></pre></div><pre><code class="language-python:" data-lang="python:">Counter({'Book_A': 1,'Book_B': 2,'Book_C': 3})
</code></pre><h3 id="calculation-using-counter">Calculation using Counter</h3>
<p>By the way, this <code>Counter</code> object can be calculated.
Reference: <a href="https://www.headboost.jp/python-counter/#24_Counter">Various methods to check the number of occurrences of elements with Python Counter</a></p>
<p>The purpose of this time seems to be achieved by the operation of the sum.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> Counter

a <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#e6db74">&#34;B&#34;</span>, <span style="color:#e6db74">&#34;C&#34;</span>, <span style="color:#e6db74">&#34;A&#34;</span>]
b <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;C&#34;</span>, <span style="color:#e6db74">&#34;D&#34;</span>]

counter_a <span style="color:#f92672">=</span> Counter(a)
counter_b <span style="color:#f92672">=</span> Counter(b)

<span style="color:#75715e"># sum can be added</span>
counter_ab <span style="color:#f92672">=</span> sum([counter_a, counter_b], Counter())
<span style="color:#66d9ef">print</span>(counter_ab)
</code></pre></div><pre><code class="language-python:" data-lang="python:">Counter({'A': 2,'C': 2,'B': 1,'D': 1})
```### code
```python
from collections import Counter

# Data preparation
df_01 = pd.DataFrame([[&quot;Book_A&quot;, 1],
                      [&quot;Book_B&quot;, 2],
                      [&quot;Book_C&quot;, 3]],
                     columns=[&quot;Name&quot;, &quot;Count&quot;])
df_02 = pd.DataFrame([[&quot;Book_A&quot;, 2],
                      [&quot;Book_C&quot;, 1],
                      [&quot;Book_D&quot;, 3]],
                     columns=[&quot;Name&quot;, &quot;Count&quot;])

Creating a # Counter
counter_01 = Counter(dict(df_01[[&quot;Name&quot;, &quot;Count&quot;]].values))
counter_02 = Counter(dict(df_02[[&quot;Name&quot;, &quot;Count&quot;]].values))

#Calculate sum
# *Supplement: An initial value can be set in the second argument of sum.
# This time, an empty Counter is set as the initial value. The default is 0 (int).
result = sum([counter_01, counter_02], Counter())
print(result)
</code></pre><pre><code class="language-python:" data-lang="python:">Counter({'Book_C': 4,'Book_A': 3,'Book_D': 3,'Book_B': 2})
</code></pre><p>~~ Apparently, the numbers are sorted in descending order of count. ~~
*Additional note: In some cases, it was not sorted. Since it was a dictionary, the order did not matter.</p>
<h2 id="3-add-the-element-to-the-dictionary-and-update-the-value-with-the-for-statement">3. Add the element to the dictionary and update the value with the for statement</h2>
<h3 id="adding-elements-to-the-dictionary-and-updating-values">Adding elements to the dictionary and updating values</h3>
<p>If you give multiple <code>value</code> to the same <code>key</code> in the dictionary, it will be overwritten with the last given <code>value</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>( {<span style="color:#e6db74">&#34;A&#34;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;B&#34;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;C&#34;</span>: <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;A&#34;</span>:<span style="color:#ae81ff">10</span>})
</code></pre></div><pre><code class="language-python:" data-lang="python:">{'A': 10,'B': 2,'C': 3}
</code></pre><p>If you use this, you can update the count value of a certain <code>key</code> by acquiring <strong>the value</strong> of an existing dictionary and adding the <strong>added value</strong> to the end.
To add an element to the end of an existing dictionary, add **(2 stars) in front of the variable and expand the dictionary.
Reference: <a href="https://qiita.com/supersaiakujin/items/faee48d35f8d80daa1ac">[Python] function argument *(star) and **(double star)</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#Existing dictionary</span>
d <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;A&#34;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;B&#34;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;C&#34;</span>: <span style="color:#ae81ff">3</span>}

element to add <span style="color:#75715e">#value to</span>
k <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;A&#34;</span>
v <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
<span style="color:#75715e"># Update</span>
Equivalent to d <span style="color:#f92672">=</span> {<span style="color:#f92672">**</span>d, k: d[k]<span style="color:#f92672">+</span>v} <span style="color:#75715e"># {&#34;A&#34;: 1, &#34;B&#34;: 2, &#34;C&#34;: 3, &#34;A&#34;: 1+10}</span>

<span style="color:#66d9ef">print</span>(d)
</code></pre></div><pre><code class="language-python:" data-lang="python:">{'A': 11,'B': 2,'C': 3}
</code></pre><p>However, if you specify a <code>key</code> that does not exist in the dictionary, an error will occur, so you cannot add a new <code>key</code> as it is.
Then, use the function <code>get()</code> of the dictionary object. You can use <code>get()</code> to set the value to return by default if <code>key</code> does not exist in the dictionary.
Reference: <a href="https://note.nkmk.me/python-dict-get/">Get value from key with Python dictionary get method (OK even if there is no existing key)</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">d <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;A&#34;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;B&#34;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;C&#34;</span>: <span style="color:#ae81ff">3</span>}

<span style="color:#75715e"># Specify an existing key</span>
<span style="color:#66d9ef">print</span>(d<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;A&#34;</span>, <span style="color:#e6db74">&#34;NO KEY&#34;</span>))
<span style="color:#75715e"># Specify a key that does not exist</span>
<span style="color:#66d9ef">print</span>(d<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;D&#34;</span>, <span style="color:#e6db74">&#34;NO KEY&#34;</span>))
</code></pre></div><pre><code class="language-python:" data-lang="python:">1
NO KEY
</code></pre><p>With this, you can set the default value to <code>0</code> and add and update the same.
Using the above contents, the code to perform weighted count by adding/updating values to the empty dictionary is as follows.</p>
<h3 id="code-1">code</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">from</span> itertools <span style="color:#f92672">import</span> chain

<span style="color:#75715e"># Data preparation</span>
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">from</span> itertools <span style="color:#f92672">import</span> chain
<span style="color:#f92672">from</span> functools <span style="color:#f92672">import</span> reduce

<span style="color:#75715e"># Data preparation</span>
df_01 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame([[<span style="color:#e6db74">&#34;Book_A&#34;</span>, <span style="color:#ae81ff">1</span>],
                      [<span style="color:#e6db74">&#34;Book_B&#34;</span>, <span style="color:#ae81ff">2</span>],
                      [<span style="color:#e6db74">&#34;Book_C&#34;</span>, <span style="color:#ae81ff">3</span>]],
                     columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;Name&#34;</span>, <span style="color:#e6db74">&#34;Count&#34;</span>])
df_02 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame([[<span style="color:#e6db74">&#34;Book_A&#34;</span>, <span style="color:#ae81ff">2</span>],
                      [<span style="color:#e6db74">&#34;Book_C&#34;</span>, <span style="color:#ae81ff">1</span>],
                      [<span style="color:#e6db74">&#34;Book_D&#34;</span>, <span style="color:#ae81ff">3</span>]],
                     columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;Name&#34;</span>, <span style="color:#e6db74">&#34;Count&#34;</span>])
<span style="color:#75715e"># Convert data frame to dictionary</span>
data1 <span style="color:#f92672">=</span> dict(df_01[[<span style="color:#e6db74">&#34;Name&#34;</span>, <span style="color:#e6db74">&#34;Count&#34;</span>]]<span style="color:#f92672">.</span>values)
data2 <span style="color:#f92672">=</span> dict(df_02[[<span style="color:#e6db74">&#34;Name&#34;</span>, <span style="color:#e6db74">&#34;Count&#34;</span>]]<span style="color:#f92672">.</span>values)

<span style="color:#75715e">#Function definition</span>
chain_items <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> data: chain<span style="color:#f92672">.</span>from_iterable( d<span style="color:#f92672">.</span>items() <span style="color:#66d9ef">for</span> d <span style="color:#f92672">in</span> data) <span style="color:#75715e"># function that joins multiple dictionaries and returns &#34;key and value pair&#34;</span>
add_elem <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> acc, e :{ <span style="color:#f92672">**</span>acc, e[<span style="color:#ae81ff">0</span>]: acc<span style="color:#f92672">.</span>get(e[<span style="color:#ae81ff">0</span>], <span style="color:#ae81ff">0</span>) <span style="color:#f92672">+</span> e[<span style="color:#ae81ff">1</span>]} <span style="color:#75715e"># Function to add elements to the dictionary and update values</span>

A function that accepts multiple dictionaries where <span style="color:#75715e"># key is an element and value is a weight and merges</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">merge_count</span>(<span style="color:#f92672">*</span>data):
    result <span style="color:#f92672">=</span> {}
    <span style="color:#66d9ef">for</span> e <span style="color:#f92672">in</span> chain_items(data):
        result <span style="color:#f92672">=</span> add_elem(result, e)
    <span style="color:#66d9ef">return</span> result

<span style="color:#66d9ef">print</span>( merge_count(data1, data2))
</code></pre></div><pre><code class="language-python:" data-lang="python:">{'A': 3,'B': 2,'C': 4,'D': 3}
</code></pre><h3 id="3use-reduce-instead-of-for-statement">3&rsquo;use <code>reduce</code> instead of for statement</h3>
<p>If you use <code>reduce</code>, you can iterate without writing a for statement.
<code>reduce</code> takes the following arguments.</p>
<ul>
<li>First argument: function. However, take the calculation result up to the previous time and the current value as the argument.</li>
<li>Second argument: loopable object (list, generator, etc.)</li>
<li>Third argument (optional): Initial value. Default is 0</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> functools <span style="color:#f92672">import</span> reduce

func <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> ans, x: ans <span style="color:#f92672">*</span> x
a <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>]
start <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>

<span style="color:#66d9ef">print</span>(reduce(func, a, start))
</code></pre></div><pre><code class="language-python:" data-lang="python:">240 # 10*1 = 10
     # -&gt; 10*2 = 20
     # -&gt; 20*3 = 60
     # -&gt; 60*4 = 240
</code></pre><p>Reproducing the above <code>merge_count</code> using <code>reduce</code> is as follows.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> functools <span style="color:#f92672">import</span> reduce

merge_count <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> <span style="color:#f92672">*</span>data :reduce( add_elem, chain_items(data), {}) <span style="color:#75715e"># equivalent to merge_count above</span>
<span style="color:#66d9ef">print</span>( merge_count(data1, data2))
</code></pre></div><pre><code class="language-python:" data-lang="python:">{'A': 3,'B': 2,'C': 4,'D': 3}
</code></pre><p>Regarding <code>reduce</code>, the following sites were very helpful.
Reference: <a href="https://postd.cc/an-introduction-to-functional-programming/">Introduction to Functional Programming</a></p>
<ul>
<li>Method 3 was explained in <a href="https://qiita.com/minetta30/items/cc3f1b3836ceca4e3971#comment-c06191265a976e267421">Comments</a>.</li>
</ul>
<h1 id="referenced-page">Referenced page</h1>
<p><a href="http://koshian2.hatenablog.jp/entry/2018/04/02/153120">Meaning of numpy.bincount weight</a>
[Category variable encoding]
(<a href="https://qiita.com/ground0state/items/f516b97c7a8641e474c4">https://qiita.com/ground0state/items/f516b97c7a8641e474c4</a>)</p>
<p>[[Python] Counting list elements, using collections.Counter]
(<a href="https://qiita.com/ellio08/items/259388b511e24625c0d7">https://qiita.com/ellio08/items/259388b511e24625c0d7</a>)
[Various methods to check the number of occurrences of elements with Python Counter]
(<a href="https://www.headboost.jp/python-counter/">https://www.headboost.jp/python-counter/</a>)</p>
<p>[[Python] *(star) and **(double star) of function argument]
(<a href="https://qiita.com/supersaiakujin/items/faee48d35f8d80daa1ac">https://qiita.com/supersaiakujin/items/faee48d35f8d80daa1ac</a>)
[Introduction to Functional Programming]
(<a href="https://postd.cc/an-introduction-to-functional-programming/">https://postd.cc/an-introduction-to-functional-programming/</a>)</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>I gave a specific example to make it easy to convey, but actually I used it to aggregate the morphological analysis results of multiple documents. <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>Execution speed, memory efficiency&hellip; <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>With my own knowledge, I couldn&rsquo;t think of anything other than writing a for statement (except for the list comprehension). <a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
