<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Article to see when the code of the Python script of Blender does not work in 2.80 | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Article to see when the code of the Python script of Blender does not work in 2.80</h1>
<p>
  <small class="text-secondary">
  
  
  Nov 1, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/blender">Blender</a></code></small>

</p>
<pre><code>Oh Python! Guys, are you modeling well today?
</code></pre>
<p>I tried to run Blender with a Python script and was suffering from a mysterious error. As a result of struggling hard, I found that the cause was ** API specification change **. It can be considered that most of the code currently published on the net (for 2.77 or earlier) does not work just by copying and copying.</p>
<p>↑ So, regarding the code that is currently released, if you do this here, it will work even with 2.80! I will publish a modified version. After arranging the code before and after the change, I will explain in the form that it has been changed like this by referring to the relevant reference where the change has occurred. The key change points are roughly the same for any code, so it&rsquo;s likely that they&rsquo;ll be helpful to anyone who&rsquo;s been hit by an error in some other code.</p>
<p>The people who wrote the code are not bad at all, but there is no choice because the specifications have changed. The evolution of Blender isn&rsquo;t bad either. If no one is bad and people are suffering&hellip; the sin, I&rsquo;ll carry it on my back.</p>
<p>#First example</p>
<p><a href="https://blog.engineer.adways.net/entry/advent_calendar_2017/04">Easy 3DCG with Blender x Python! </a></p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288125/a91f5448-82b3-4e5c-09a7-f337a1083759.png" alt="image.png"></p>
<p>A script that creates a mesh like the one above.</p>
<h2 id="code">code</h2>
<p>original</p>
<pre><code class="language-python:2.79" data-lang="python:2.79">
import bpy
import math

#reset objects
bpy.ops.object.select_all(action='SELECT')
bpy.ops.object.delete(True)

#world
bpy.context.scene.world.horizon_color=(0.0,0.0,0.0)

#plane_add
for i in range(0,100):
    bpy.ops.mesh.primitive_plane_add(radius = (i*1.1/100),location=(0,0,0),rotation=(math.pi*1/2,math.pi*i*8.2/360,math .pi*i*10/360))

for item in bpy.context.scene.objects:
    if item.type =='MESH':
        bpy.context.scene.objects.active = bpy.data.objects[item.name]
        bpy.ops.object.modifier_add(type='WIREFRAME')
        bpy.context.object.modifiers['Wireframe'].thickness = 0.0025
        bpy.context.object.modifiers['Wireframe'].use_boundary = True

#lamp add
bpy.ops.object.lamp_add(type='HEMI',location=(0.0,0.0,2.0))

#camera add
bpy.ops.object.camera_add(location=(5.0,0.0,0.0))
bpy.data.objects['Camera'].rotation_euler = (math.pi*1/2, 0, math.pi*1/2)

#render
bpy.context.scene.render.resolution_x = 1000
bpy.context.scene.render.resolution_y = 1000
bpy.context.scene.render.resolution_percentage = 100
bpy.context.scene.camera = bpy.context.object
bpy.context.scene.render.image_settings.file_format ='PNG'
bpy.data.scenes[&quot;Scene&quot;].render.filepath = &quot;tmp/plane.png&quot;
bpy.ops.render.render(write_still=True)
</code></pre><p>After change</p>
<pre><code class="language-python:2.80" data-lang="python:2.80">import bpy
import math

#reset objects
bpy.ops.object.select_all(action='SELECT')
bpy.ops.object.delete(True)

#plane_add
for i in range(0,100):
    bpy.ops.mesh.primitive_plane_add(size = (i*1.1/100),location=(0,0,0),rotation=(math.pi*1/2,math.pi*i*8.2/360,math .pi*i*10/360))

for item in bpy.context.scene.objects:
    if item.type =='MESH':
        bpy.context.view_layer.objects.active = bpy.data.objects[item.name]
        bpy.ops.object.modifier_add(type='WIREFRAME')
        bpy.context.object.modifiers['Wireframe'].thickness = 0.0025
        bpy.context.object.modifiers['Wireframe'].use_boundary = True

#lamp add
bpy.ops.object.light_add(location=(0.0,0.0,2.0))

#camera add
bpy.ops.object.camera_add(location=(5.0,0.0,0.0))
bpy.data.objects['Camera'].rotation_euler = (math.pi*1/2, 0, math.pi*1/2)

#render
bpy.context.scene.render.resolution_x = 1000
bpy.context.scene.render.resolution_y = 1000
bpy.context.scene.render.resolution_percentage = 100
bpy.context.scene.camera = bpy.context.object
bpy.context.scene.render.image_settings.file_format ='PNG'
bpy.data.scenes[&quot;Scene&quot;].render.filepath = &quot;tmp/plane.png&quot;
bpy.ops.render.render(write_still=True)
</code></pre><p>##changes</p>
<pre><code class="language-Python:2.79" data-lang="Python:2.79">    bpy.ops.mesh.primitive_plane_add(radius = (i*1.1/100),location=(0,0,0),rotation=(math.pi*1/2,math.pi*i*8.2/360,math .pi*i*10/360))
</code></pre><pre><code class="language-Python:2.80" data-lang="Python:2.80">    bpy.ops.mesh.primitive_plane_add(size = (i*1.1/100),location=(0,0,0),rotation=(math.pi*1/2,math.pi*i*8.2/360,math .pi*i*10/360))
</code></pre><p>Added plane primitives. <code>radius</code> indicating scale is changed to <code>size</code>.</p>
<p>Applicable reference: <a href="https://docs.blender.org/api/current/bpy.ops.mesh.html?highlight=primitive%20plane#bpy.ops.mesh.primitive_plane_add">https://docs.blender.org/api/current/bpy.ops.mesh.html?highlight=primitive%20plane#bpy.ops.mesh.primitive_plane_add</a></p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288125/8f3926f4-c645-2926-6b8a-1a0035d9caa8.png" alt="image.png"></p>
<pre><code class="language-Python:2.79" data-lang="Python:2.79">        bpy.context.scene.objects.active = bpy.data.objects[item.name]
</code></pre><pre><code class="language-Python:2.80" data-lang="Python:2.80">        bpy.context.view_layer.objects.active = bpy.data.objects[item.name]
</code></pre><p>Select active object. In the original, the part that was <code>bpy.context.scene~</code> must be changed to <code>bpy.context.view_layer~</code>. Since the API of <code>scene</code> remains, I don&rsquo;t really know how to use it properly, but here is the reference <a href="https://docs.blender.org/api/current/bpy.types.Scene.html">here</a> is the only way to study.</p>
<pre><code class="language-Python:2.79" data-lang="Python:2.79">bpy.ops.object.lamp_add(type='HEMI',location=(0.0,0.0,2.0))
</code></pre><pre><code class="language-Python:2.80" data-lang="Python:2.80">bpy.ops.object.light_add(location=(0.0,0.0,2.0))
</code></pre><p>Addition of lamp. Renamed <code>lamp</code> to <code>light</code>. Also, the <code>HEMI</code> (hemisphere) type light disappears.</p>
<p><a href="https://docs.blender.org/api/current/bpy.ops.object.html?highlight=light%20add#bpy.ops.object.light_add">https://docs.blender.org/api/current/bpy.ops.object.html?highlight=light%20add#bpy.ops.object.light_add</a></p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288125/103b0879-ee6e-d7d6-ee9b-9777e433281b.png" alt="image.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#75715e">#world</span>
bpy<span style="color:#f92672">.</span>context<span style="color:#f92672">.</span>scene<span style="color:#f92672">.</span>world<span style="color:#f92672">.</span>horizon_color<span style="color:#f92672">=</span>(<span style="color:#ae81ff">0.0</span>,<span style="color:#ae81ff">0.0</span>,<span style="color:#ae81ff">0.0</span>)
</code></pre></div><p>No alternative API was found for this. In the GUI</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288125/5b62c70d-d8e4-a820-0e29-ab2795e014c2.png" alt="image.png">You can change it by operating here. There is an API called <code>bpy.context.scene.world.color</code> for the time being, but it does not change even if this is specified. This is beyond reach. If you want to implement again, please change manually. Excuse me…….</p>
<p>#Second example</p>
<p><a href="https://qiita.com/muripo_life/items/42d7f49aa99077f52cb0">Introduction to blender python script_01</a></p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288125/5258f840-8257-ccad-f0b3-568aca267eba.png" alt="image.png"></p>
<p>A script to generate the above mesh without using primitives.</p>
<p>##Source code</p>
<p>original</p>
<pre><code class="language-python:2.79" data-lang="python:2.79">import bpy

#Remove default Cube
def delete_all():
    for item in bpy.context.scene.objects:
        bpy.context.scene.objects.unlink(item)

    for item in bpy.data.objects:
        bpy.data.objects.remove(item)

    for item in bpy.data.meshes:
        bpy.data.meshes.remove(item)

    for item in bpy.data.materials:
        bpy.data.materials.remove(item)

delete_all()

#Define vertex coordinates
coords=[
    (-1.0, -1.0, -1.0),
    (1.0, -1.0, -1.0),
    (1.0, 1.0, -1.0),
    (-1.0, 1.0, -1.0),
    (0.0, 0.0, 1.0)
]

#Define a face using this subscript
# Each face is defined by a sequence of 4 integers
# Triangular face must have the same first and fourth vertices
faces=[
    (2,1,0,3),
    (0,1,4,0),
    (1,2,4,1),
    (2,3,4,2),
    (3,0,4,3)
]

#Create new mesh
me = bpy.data.meshes.new(&quot;PyramidMesh&quot;)
#Create object with mesh
ob = bpy.data.objects.new(&quot;Pyramid&quot;, me)
# Place object at 3D cursor position
ob.location = bpy.context.scene.cursor_location
# Link object to scene
bpy.context.scene.objects.link(ob)
# Fill the vertices, edges and faces of the mesh
me.from_pydata(coords,[],faces)
# Update the mesh with new data
me.update(calc_edges=True)
</code></pre><p>After change</p>
<pre><code class="language-python:2.80" data-lang="python:2.80">import bpy

#Remove default Cube
def delete_all():
    for item in bpy.context.scene.objects:
        bpy.context.scene.collection.objects.unlink(item)

    for item in bpy.data.objects:
        bpy.data.objects.remove(item)

    for item in bpy.data.meshes:
        bpy.data.meshes.remove(item)

    for item in bpy.data.materials:
        bpy.data.materials.remove(item)

delete_all()

#Define vertex coordinates
coords=[
    (-1.0, -1.0, -1.0),
    (1.0, -1.0, -1.0),
    (1.0, 1.0, -1.0),
    (-1.0, 1.0, -1.0),
    (0.0, 0.0, 1.0)
]

#Define a face using this subscript
# Each face is defined by a sequence of 4 integers
# Triangular face must have the same first and fourth vertices
faces=[
    (2,1,0,3),
    (0,1,4,0),
    (1,2,4,1),
    (2,3,4,2),
    (3,0,4,3)
]

#Create new mesh
me = bpy.data.meshes.new(&quot;PyramidMesh&quot;)
#Create object with mesh
ob = bpy.data.objects.new(&quot;Pyramid&quot;, me)
# Place object at 3D cursor position
ob.location = bpy.context.scene.cursor.location
# Link object to scene
bpy.context.scene.collection.objects.link(ob)
# Fill the vertices, edges and faces of the mesh
me.from_pydata(coords,[],faces)
# Update the mesh with new data
me.update(calc_edges=True)
</code></pre><p>##changes</p>
<pre><code class="language-python:2.79" data-lang="python:2.79">        bpy.context.scene.objects.unlink(item)
</code></pre><pre><code class="language-python:2.80" data-lang="python:2.80">        bpy.context.scene.collection.objects.unlink(item)
</code></pre><p>It is a command about objects in the current scene, but since a layer called <code>collection</code> has been added under <code>scene</code>, it is necessary to reflect that. There is also <code>objects</code> directly under <code>scene</code>, and if that is the case, an error will occur when you <code>link</code> or <code>unlink</code> an object. Many people may have been cried by the error <code>AttributeError:'bpy_prop_collection' object has no attribute'link'</code>.</p>
<pre><code class="language-python:2.79" data-lang="python:2.79">ob.location = bpy.context.scene.cursor_location
</code></pre><pre><code class="language-python:2.80" data-lang="python:2.80">ob.location = bpy.context.scene.cursor.location
</code></pre><p>Specify the cursor position. In 2.79 and below, there was an API called <code>curosr_location</code>, but in 2.80 it seems that there is a hierarchical structure where there is <code>location</code> under <code>cursor</code>.</p>
<p>Applicable reference: <a href="https://docs.blender.org/api/current/bpy.types.View3DCursor.html">https://docs.blender.org/api/current/bpy.types.View3DCursor.html</a></p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288125/59b3ef43-ed7c-d24e-437c-d7e8403a9fb1.png" alt="image.png"></p>
<pre><code class="language-python:2.79" data-lang="python:2.79">bpy.context.scene.objects.link(ob)
</code></pre><pre><code class="language-python:2.80" data-lang="python:2.80">bpy.context.scene.collection.objects.link(ob)
</code></pre><p>Same as the previous story of <code>collection</code>.</p>
<p>#Tips for finding usable APIs</p>
<p>In this way, since there are too many changes and little information is needed, it is necessary to search for an API that can be used by yourself. At such times,</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/288125/40a10cfe-763d-3adf-b084-52df598578d3.png" alt="Image.png"></p>
<p>If you press <code>Ctrl</code>+<code>Space</code> on the Python console of Blender, a list of possible commands will appear (it may be narrowed down accordingly if you enter halfway) It may be useful ..</p>
<p>Then, everyone has a good Blender 2.80 life.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
