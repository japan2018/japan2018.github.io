<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>How to save scraped table in csv with python | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>How to save scraped table in csv with python</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 23, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/html"> HTML</a></code></small>


<small><code><a href="https://memotut.com/tags/scraping"> scraping</a></code></small>


<small><code><a href="https://memotut.com/tags/csv"> CSV</a></code></small>

</p>
<pre><code># About this article
</code></pre>
<p>I needed to scrape a table on a web page in my research, so I will introduce the python program used at that time. By the way, I had zero scraping history, so I made it while checking various things, but there was hardly anything explaining how to convert the table on the web page to HTML and then convert the HTML table part to csv. So I wrote this article.</p>
<p>#Introduction
For notes on scraping, please see the URL below.
<a href="https://qiita.com/Azunyan1111/items/b161b998790b1db2ff7a">https://qiita.com/Azunyan1111/items/b161b998790b1db2ff7a</a></p>
<p>#Scraping with Python
The whole program can be found on <a href="https://github.com/tsuno0829/scraping_table/blob/master/scraping_table.ipynb">here</a>.</p>
<h2 id="import">import</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> csv
<span style="color:#f92672">import</span> urllib
<span style="color:#f92672">from</span> bs4 <span style="color:#f92672">import</span> BeautifulSoup
</code></pre></div><p>Description of imported library
・Csv is a standard Python library used this time for writing CSV files.
・Urllib is used to access and acquire data (HTML) on the web
・BeautifulSoup is used to extract targeted data from HTML</p>
<h2 id="get-html">Get HTML</h2>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/196744/7f1d0dd3-30e6-d934-adac-85834cf47715.png" alt="image.png"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://en.wikipedia.org/wiki/List_of_cities_in_Japan&#34;</span>
html <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>urlopen(url)
soup <span style="color:#f92672">=</span> BeautifulSoup(html,<span style="color:#e6db74">&#39;html.parser&#39;</span>)
<span style="color:#75715e"># Get all table (table tag) parts from HTML</span>
table <span style="color:#f92672">=</span> soup<span style="color:#f92672">.</span>find_all(<span style="color:#e6db74">&#34;table&#34;</span>)
</code></pre></div><p>This time, I will scrape the wikipedia table that summarizes Japanese cities.</p>
<p>Urllib.request.urlopen of the program gets the HTML of the specified url. After that, it is formatted by using Beautiful Soup so that it can be handled easily, and further, all the parts with tables (parts surrounded by table tags) are retrieved from soup.find_all(&ldquo;table&rdquo;) from HTML, and then preparation is complete.</p>
<h2 id="find-the-name-of-the-table-tag-you-want-to-get">Find the name of the TABLE tag you want to get</h2>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/196744/fe86eb57-2195-89e9-7c81-4c2878e55ef3.png" alt="image.png"></p>
<p>If you are using chrome browser, you can enter developer tools (black screen in screenshot) by pressing F12 (command+option+I on mac). After that, you can see the HTML source code from Elements, and search the table tag you want to scrape in it. This time, I want to get the table selected in blue. Actually, this can be obtained simply by selecting the className &ldquo;wikitable&rdquo; from all table tags.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">for</span> tab <span style="color:#f92672">in</span> table:
    table_className <span style="color:#f92672">=</span> tab<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;class&#34;</span>)
    <span style="color:#66d9ef">print</span>(table_className)
    <span style="color:#66d9ef">if</span> table_className[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;wikitable&#34;</span>:
        <span style="color:#66d9ef">break</span>

Output result when there <span style="color:#f92672">is</span> no <span style="color:#75715e">#break statement</span>
<span style="color:#75715e"># [&#39;vertical-navbox&#39;,&#39;nowraplinks&#39;,&#39;hlist&#39;]</span>
<span style="color:#75715e"># [&#39;wikitable&#39;] &lt;- Use break statement here to exit</span>
<span style="color:#75715e"># [&#39;wikitable&#39;,&#39;sortable&#39;]</span>
<span style="color:#75715e"># [&#39;wikitable&#39;,&#39;sortable&#39;]</span>
<span style="color:#75715e"># [&#39;wikitable&#39;]</span>
<span style="color:#75715e"># [&#39;nowraplinks&#39;,&#39;mw-collapsible&#39;,&#39;autocollapse&#39;,&#39;navbox-inner&#39;]</span>
</code></pre></div><p>・Table_className[0] is set because wikitable is at the beginning of className.
・In addition, in this case, there are other tables with the same name as the wikitable on HTML, but the table I want this time is always the first wikitable, so immediately after passing the if statement, the break statement is immediately issued. I&rsquo;m using it to put a process out of the loop.</p>
<h2 id="if-you-can-retrieve-the-target-table-save-it-by-converting-it-to-csv">If you can retrieve the target table, save it by converting it to CSV</h2>
<p>Finally, add the CSV save function to the above program.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">for</span> tab <span style="color:#f92672">in</span> table:
    table_className <span style="color:#f92672">=</span> tab<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;class&#34;</span>)
    <span style="color:#66d9ef">if</span> table_className[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;wikitable&#34;</span>:
        <span style="color:#75715e"># CSV save part</span>
        <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;test.csv&#34;</span>, <span style="color:#e6db74">&#34;w&#34;</span>, encoding<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf-8&#39;</span>) <span style="color:#66d9ef">as</span> file:
            writer <span style="color:#f92672">=</span> csv<span style="color:#f92672">.</span>writer(file)
            rows <span style="color:#f92672">=</span> tab<span style="color:#f92672">.</span>find_all(<span style="color:#e6db74">&#34;tr&#34;</span>)
            <span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> rows:
                csvRow <span style="color:#f92672">=</span> []
                <span style="color:#66d9ef">for</span> cell <span style="color:#f92672">in</span> row<span style="color:#f92672">.</span>findAll([<span style="color:#e6db74">&#39;td&#39;</span>,<span style="color:#e6db74">&#39;th&#39;</span>]):
                    csvRow<span style="color:#f92672">.</span>append(cell<span style="color:#f92672">.</span>get_text())
                writer<span style="color:#f92672">.</span>writerow(csvRow)
        <span style="color:#66d9ef">break</span>
</code></pre></div><p>The CSV save function is to extract the table tag in the row direction (&ldquo;tr&rdquo;), extract it in the column direction (&ldquo;td&rdquo;, &ldquo;th&rdquo;), append it to the list format, and save it in CSV (table If you can extract even the tags, I think you can use this with copy and paste.)</p>
<h2 id="display-the-csv-using-pandas-for-confirmation">Display the CSV using pandas for confirmation</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;test.csv&#34;</span>)
</code></pre></div><p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/196744/49b8ffdd-cd00-1581-1336-6bfca1fd0d45.png" alt="image.png"></p>
<p>Safely, what I saved in csv could be displayed by pandas!</p>
<p>#Summary
It depends on the site you want to scrape, but I think you can get the table in CSV with this procedure! Thank you for visiting so far!</p>
<h1 id="references">References</h1>
<p><a href="https://qiita.com/Azunyan1111/items/b161b998790b1db2ff7a">https://qiita.com/Azunyan1111/items/b161b998790b1db2ff7a</a></p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
