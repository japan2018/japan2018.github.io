<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>Tips to conveniently use models utils.Choices | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Tips to conveniently use models utils.Choices</h1>
<p>
  <small class="text-secondary">
  
  
  Feb 3, 2020
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/django">Django</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/django-rest-framework">django-rest-framework</a></code></small>

</p>
<pre><code># model_utils.Choices
</code></pre>
<p>Django, DRF users Are you using <code>model_utils.Choices</code>?
We use it conveniently, but basically we often use it for status management.</p>
<p>Is it like this?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">News</span>(models<span style="color:#f92672">.</span>Model):
    STATUS <span style="color:#f92672">=</span> Choices(
        (<span style="color:#e6db74">&#39;DRAFT&#39;</span>,<span style="color:#e6db74">&#39;draft&#39;</span>),
        (<span style="color:#e6db74">&#39;CHECK&#39;</span>,<span style="color:#e6db74">&#39;waiting for review&#39;</span>),
        (<span style="color:#e6db74">&#39;PUBLISHED&#39;</span>,<span style="color:#e6db74">&#39;Public&#39;</span>),
    )

    status <span style="color:#f92672">=</span> StatusField(
        choices_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;STATUS&#39;</span>,
        help_text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Status&#34;</span>,
        default<span style="color:#f92672">=</span>STATUS<span style="color:#f92672">.</span>DRAFT,
    )

    title <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(
        max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span>,
        null<span style="color:#f92672">=</span>False,
        blank<span style="color:#f92672">=</span>False,
        default<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>,
        help_text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;News title&#34;</span>
    )

    body <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>TextField(
        null<span style="color:#f92672">=</span>False,
        blank<span style="color:#f92672">=</span>False,
        default<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>,
        help_text<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;News Details&#34;</span>
    )
</code></pre></div><h2 id="what-is-the-explanation-value-of-choice-used-for">What is the explanation (VALUE) of Choice used for?</h2>
<p>KEY and its description can be defined in Choice (KEY is stored in DB), but I&rsquo;m not sure how useful this description is. Comments are good, right? I feel like that. Moreover, if this Choice field is output as it is with the Serializer, only the KEY is output, so there is no further use for the explanation (VALUE).</p>
<h2 id="usage-of-value">Usage of VALUE</h2>
<p>For example, if you explain in the example of â†‘, I think that there is a management screen to manage news, and there are things you want to display the status in the list or search by status. On that screen, you want to use <code>draft</code> or <code>publishing</code> instead of <code>DRAFT</code> or <code>PUBLISHED</code>.</p>
<p>At that time, it seems silly to implement each programmer to return KEY and VALUE in output serialization of Choice, so we have created and operated such an extension.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyChoiceField</span>(serializers<span style="color:#f92672">.</span>ChoiceField):
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">to_representation</span>(self, obj):
        choice <span style="color:#f92672">=</span> getattr(self,<span style="color:#e6db74">&#39;_choices&#39;</span>)
        key <span style="color:#f92672">=</span> str(obj)
        <span style="color:#66d9ef">if</span> key <span style="color:#f92672">in</span> choice:
            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;key&#39;</span>: key,<span style="color:#e6db74">&#39;val&#39;</span>: choice[key]}
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;key&#39;</span>: key,<span style="color:#e6db74">&#39;val&#39;</span>:<span style="color:#e6db74">&#39;&#39;</span>}


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyModelSerializer</span>(serializers<span style="color:#f92672">.</span>ModelSerializer):
    <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    Rewrite fields that are automatically expanded in the serializer
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    serializer_choice_field <span style="color:#f92672">=</span> MyChoiceField
</code></pre></div><p>Each serializer inherits MyModelSerializer.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NewsSerializer</span>(MyModelSerializer):
    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Meta</span>:
        model <span style="color:#f92672">=</span> News
        fields <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;__all__&#34;</span>
</code></pre></div><p>Now <code>status</code> will output the key and value.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
