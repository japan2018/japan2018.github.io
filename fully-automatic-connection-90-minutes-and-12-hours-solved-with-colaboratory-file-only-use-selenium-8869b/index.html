<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Fully automatic connection] 90 minutes and 12 hours solved with Colaboratory file only [Use Selenium] | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Fully automatic connection] 90 minutes and 12 hours solved with Colaboratory file only [Use Selenium]</h1>
<p>
  <small class="text-secondary">
  
  
  Nov 18, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/selenium"> Selenium</a></code></small>


<small><code><a href="https://memotut.com/tags/scraping"> scraping</a></code></small>


<small><code><a href="https://memotut.com/tags/machine-learning"> machine learning</a></code></small>


<small><code><a href="https://memotut.com/tags/googlecolaboratory"> GoogleColaboratory</a></code></small>

</p>
<pre><code>Are you using Google Colaboratory? It's the best, isn't it?
</code></pre>
<p>Google Colaboratory is a Jupyter notebook environment that runs on a browser. Moreover, GPU and TPU machines can be used free of charge. That&rsquo;s the best.</p>
<p>However, there were two rules about usage time (described later), and it was also a addictive point to crawl Colaboratory users.</p>
<p><strong>&ldquo;When I wake up in the morning, the connection will be cut&hellip;&quot;</strong></p>
<p>** &ldquo;It was reset (forced connection lost) after 12 hours, so I have to restart it.&rdquo; **</p>
<p>** &ldquo;I wonder if I keep running the script locally to avoid the 90-minute problem.&quot;**</p>
<p>I wonder if there was a lot of this kind of misery in everyone.</p>
<p>Many Colaboratory users share their solutions to these problems.</p>
<p><a href="https://qiita.com/Ningensei848/items/a7daa6ee4ef692a3d65e#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE">Summary of articles by pioneers</a></p>
<p>Like the pioneers, I also contribute.</p>
<ol>
<li>After 12 hours, you have to manually read the data and execute the file.</li>
<li>90 minutes I have to always run a script on my PC to avoid the problem</li>
</ol>
<p>In this article, the above problems are solved as follows by using Selenium in Colaboratory.</p>
<ol>
<li>
<p>Automatically save/read data and execute files
-You can run programs that take more than 12 hours without worrying about the 12-hour reset problem that was inevitable until now</p>
</li>
<li>
<p>The executable file itself accesses its page regularly
-90 minute session never expires
-Eliminates the need to always run scripts on your local PC</p>
</li>
</ol>
<h2 id="overview">Overview</h2>
<ul>
<li>90 minutes problem avoidance with Colaboratory file alone</li>
<li>By using Selenium in Colaboratory, by setting fileA → fileB → fileA, 12 hours problem is automatically avoided</li>
<li><a href="https://qiita.com/Ningensei848/items/a7daa6ee4ef692a3d65e#%E7%8F">Authentication</a>toopenanotherColaboratoryfilewithSeleniuminColaboratorybyusingtheUserProfilecreatedinChrome.%BE%E5%9C%A8%E3%83%96%E3%83%81%E5%BD%93%E3%81%9F%E3%81%A3%E3%81%A6%E3%81%84(%E3%82%8B%E5%A3%81)avoid(Japaneseisbad&hellip;)</li>
</ul>
<h2 id="menu">menu</h2>
<p>The article has become quite long, so please skip it as appropriate.
<a href="https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#%E3%82%84%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%93%E3%81%A8">What we are doing</a>・<a href="https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#%E6%A4%9C%E8%A8%BC%E7%B5%90%E6%9E%9C">Verificationresult</a>[Operationcheckvideo](<a href="https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8(%AA%8D%E5%8B%95%E7%94%BB)">https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8(%AA%8D%E5%8B%95%E7%94%BB)</a> may be easier to grasp the image.</p>
<ol>
<li><a href="https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#%E3%82%84%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%93%E3%81%A8">What we are doing</a></li>
<li><a href="https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#%E4%BD%BF%E7%94%A8%E7%92%B0%E5%A2%83">Environment</a></li>
<li>[12 hours &amp; 90 minutes rule](<a href="https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#12%E6%99%82%E9%96%9390%E5%88%86%E3%83%AB%25(E3%83%BC%E3%83%AB)">https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#12%E6%99%82%E9%96%9390%E5%88%86%E3%83%AB%(E3%83%BC%E3%83%AB)</a></li>
<li><a href="https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#%E6%BA%96%E5%82%99">Preparation</a></li>
<li><a href="https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#%E5%AE%9F%E8%A3%85">Implementation</a></li>
<li><a href="https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#%E6%A4%9C%E8%A8%BC%E7%B5%90%E6%9E%9C">Verification result</a></li>
<li>[Operation check video](<a href="https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D%E5%8B(%95%E7%94%BB)">https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#%E5%8B%95%E4%BD%9C%E7%A2%BA%E8%AA%8D%E5%8B(%95%E7%94%BB)</a></li>
<li>[Source code summary](<a href="https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83(%BC%E3%83%89%E3%81%BE%E3%81%A8%E3%82%81)">https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83(%BC%E3%83%89%E3%81%BE%E3%81%A8%E3%82%81)</a></li>
<li><a href="https://qiita.com/shoyaokayama/items/8869b7dda6deff017046#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB">Conclusion</a></li>
</ol>
<h2 id="what-you-are-doing">What you are doing</h2>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/234523/2a8c1a9c-87d2-42c8-f749-06b4c50d2a70.jpeg" alt="colaboratory_selenium.jpg"></p>
<ol>
<li>Start the instance (with GPU) and execute FileA.</li>
<li>Measure the instance startup time and use Selenium to start another instance (without GPU: None) and execute FileB at the timing when 11 hours have passed.</li>
<li>After 12 hours, FileA instance is terminated.</li>
<li>After the instance of FileA ends, execute <code>1.</code> above using Selenium in FileB.</li>
</ol>
<p>Then, in order to avoid session disconnection for both File A and B, the following processing is performed using Selenium.</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/234523/e9f11945-422c-b5db-353b-40999a980885.jpeg" alt="selen_90.jpg"></p>
<h2 id="usage-environment">usage environment</h2>
<h5 id="google-colaboratory">Google Colaboratory</h5>
<ul>
<li>Ubuntu18.04</li>
</ul>
<h5 id="ubuntu-environment-to-create-user-profiles-used-by-selenium">Ubuntu environment (to create User Profiles used by Selenium)</h5>
<ul>
<li>Ubuntu18.04 (building an Ubuntu environment that allows GUI operation with Docker for Mac. See the article below)</li>
</ul>
<p><a href="https://qiita.com/ryoya-s/items/ee1daf9cab18c100c990">Create a Linux (Ubuntu) container that can be operated by GUI by introducing Docker</a></p>
<h2 id="12-hours--90-minutes-rule">12 hours &amp; 90 minutes rule</h2>
<p>As mentioned above, Google Colaboratory has rules regarding usage time.</p>
<blockquote>
<p>12 hours &amp; 90 minutes rule
In Google Colaboratory, if the following conditions are met, all instance states will be reset even if there are running programs.</p>
</blockquote>
<blockquote>
<p>[12 hour rule] 12 hours have passed since the new instance was started
[90 minute rule] 90 minutes have passed since the notebook session expired
◆ [Google Colaboratory&rsquo;s 90-minute session expiration countermeasure [automatic connection]](<a href="https://qiita.com/enmaru/items/2770df602dd7778d4ce6#12%E6%99%82%E9%96%9390%E5%88%86%25(E3%83%AB%E3%83%BC%E3%83%AB)">https://qiita.com/enmaru/items/2770df602dd7778d4ce6#12%E6%99%82%E9%96%9390%E5%88%86%(E3%83%AB%E3%83%BC%E3%83%AB)</a></p>
</blockquote>
<p>In this article, we will show you how to solve the 12 hour rule and 90 minute rule within Colaboratory.</p>
<blockquote>
<p>Also, it seems difficult to run Selenium on Google Coloaboratory (← WebDriver startup seems difficult). If it is possible, launch selenum with Google Coloaboratory_fileA to launch Google Coloaboratory_fileB, and then launch selenum with Google Coloaboratory_fileB to launch Google Coloaboratory_fileC (&hellip;endless repeat) after 12 hours. I was writing but orz
◆ <a href="https://qiita.com/Fortinbras/items/4cfa9269af2ab8d1d4d5">Think about how to regularly run Google Colaboratory</a></p>
</blockquote>
<p>The above article is for reference when I regularly run Colaboratory. This time, we will realize the above-mentioned Unko program.</p>
<h2 id="preparation">Preparation</h2>
<ol>
<li>Create User Profile</li>
<li>Create private repository &amp; get access token on Github</li>
<li>Create and execute Colaboratory file</li>
</ol>
<p>The description will be given in the above order. When actually trying, 1 and 2 can be reversed.</p>
<h3 id="create-user-profile">Create User Profile</h3>
<p>To use Selenium to automatically execute Google Colaboratory files, you need to log in to Google. However, <a href="https://qiita.com/Ningensei848/items/a7daa6ee4ef692a3d65e#%E7%8F%BE%E5%9C%A8%E3%83%96%E3%83%81%E5%BD%93%E3%81%9F%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E5%A3%81">this article</a> As you can see, reCAPTCHA string is a Colaboratory file. It seems tough to break through in the cell inside.</p>
<p>As a solution, I decided to use <strong>User Profile</strong> saved for each user in Chrome. Bookmarks, cookies (id, password), etc. are saved in the User Profile. I thought that if I could load it when Selenium was executed in Colaboratory, I would not need to be authenticated.#### What is User Profile</p>
<p>User Profile is a file group that summarizes account information associated with each user who uses Chrome. Bookmarks, cookies (id, password), etc. are saved inside.</p>
<p>Once you log in to Google or Colaboratory, the data will be saved in it. Therefore, you need to log in manually once, but you can avoid any authentication process by loading it in Selenium.</p>
<h4 id="create-user-profile-1">Create User Profile</h4>
<p>This time, the machine running on Google Colaboratory is Ubuntu 18.04 (November 11, 2019), so it is certain to use the User Profile that stores the data logged in to Google or Colaboratory in the <strong>same environment</strong>.</p>
<p>At first, I was trying to load the Mac User Profile into Selenium in Colaboratory, but I was prompted to authenticate again.</p>
<p>After that, I built an Ubuntu environment that allows GUI operation with Docker for Mac, opened Chrome there, and logged in to Google and Colaboratory. And I succeeded by using the created User Profile in Colaboratory.</p>
<p><a href="https://qiita.com/ryoya-s/items/ee1daf9cab18c100c990">Create a Linux (Ubuntu) container that can be operated by GUI by introducing Docker</a></p>
<h4 id="user-profile-confirmation-method">User Profile Confirmation Method</h4>
<p>There are several ways to get a User Profile. I created a new one with the second method.</p>
<ol>
<li>How to check on Chrome</li>
</ol>
<blockquote>
<p>(1) Start Chrome, enter chrome://version in the address bar, and press the Enter key.</p>
</blockquote>
<blockquote>
<p>(2) Profile path shows the profile directory path of the user currently using.
<a href="https://laboradian.com/chrome-multi-profiles/#1_Chrome">◆About Chrome User Profile</a></p>
</blockquote>
<ol start="2">
<li>How to make new with Selenium</li>
</ol>
<p>By executing the following code, User Profile will be created in the current directory. So just manually log in to Google or Colaboratory!</p>
<p>I wonder if the program is closed, and User Profile is complete. Next, let&rsquo;s load this User Profile into Colaboratory using GitHub&rsquo;s private repository.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#f92672">import</span> os
<span style="color:#f92672">from</span> selenium <span style="color:#f92672">import</span> webdriver
<span style="color:#f92672">from</span> selenium.webdriver.chrome.options <span style="color:#f92672">import</span> Options
<span style="color:#f92672">import</span> chromedriver_binary

userdata_dir <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;UserData&#39;</span> <span style="color:#75715e"># When creating a User Profile directly under the current directory</span>
os<span style="color:#f92672">.</span>makedirs(userdata_dir, exist_ok<span style="color:#f92672">=</span>True)

options <span style="color:#f92672">=</span> webdriver<span style="color:#f92672">.</span>ChromeOptions()
<span style="color:#75715e"># Path setting of User Profile</span>
options<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#39;--user-data-dir=&#39;</span> <span style="color:#f92672">+</span> userdata_dir)

driver <span style="color:#f92672">=</span> webdriver<span style="color:#f92672">.</span>Chrome(options<span style="color:#f92672">=</span>options)
<span style="color:#66d9ef">try</span>:
    driver<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;https://google.com&#34;</span>)
<span style="color:#66d9ef">except</span>:
    driver<span style="color:#f92672">.</span>quit()
<span style="color:#66d9ef">finally</span>:
    driver<span style="color:#f92672">.</span>quit()
</code></pre></div><h4 id="important-point">important point</h4>
<p>I&rsquo;m still trying to figure out what went wrong with my Mac User Profile&hellip;
Is it an OS issue or a chrome driver issue? I would be happy if you could tell me more.</p>
<h3 id="create-a-private-repository-on-github--get-access-token">Create a private repository on Github &amp; get access token</h3>
<p>Since the User Profile is a <strong>lump of personal information</strong>, it is your responsibility to read it in Colaboratory. I chose GitHub because it was difficult to certify the following, <a href="https://qiita.com/wagase/items/4ed3e9998848cfa733be">Unlimited use of private repositories on GitHub</a>.</p>
<img width="601" alt="Screenshots 2019-11-10 17.27.17.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/234523/f47227a7-b836-9263-901d-2b8ba08291fe.png">
<h4 id="important-point-1">important point</h4>
<ul>
<li>Create a private repository and push your User Profile to it.</li>
<li>Be sure to use this as an opportunity for two-step verification.</li>
</ul>
<h4 id="access-token-acquisition-method">Access token acquisition method</h4>
<p>How to create a private repository is omitted. Refer to the following article for how to get the access token.</p>
<p><a href="https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line">Create personal access token for command line</a></p>
<p>The following command is used to clone a private repository with 2-step verification.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
<span style="color:#e6db74">&#34;git clone https://{access token}:x-oauth-basic@github.com/{user name}/{repository name}.git&#34;</span>
</code></pre></div><p>Now you&rsquo;re ready to load your User Profile into Colaboratory!</p>
<p>Thank you so much for reading so long.
It&rsquo;s hard to write, isn&rsquo;t it?</p>
<h2 id="implementation">Implementation</h2>
<p>Then, finally we are going to implement it! ! !</p>
<p>For the setup to use Selenium in Colaboratory, refer to the following article.</p>
<p><a href="https://qiita.com/Ningensei848/items/a7daa6ee4ef692a3d65e">Poem on Selenium on Colaboratory and time limit avoidance method</a></p>
<h3 id="colaboratory-file-creation">Colaboratory file creation</h3>
<p>The files created in this article are as follows.</p>
<ul>
<li>colab_selen.ipynb(FileA)</li>
<li>return_selen.ipynb(FileB)</li>
</ul>
<h4 id="gitpython">gitPython</h4>
<p>I also referred to the following article for the implementation of gitPython.</p>
<p><a href="https://qiita.com/Ningensei848/items/a7daa6ee4ef692a3d65e">Poem on Selenium on Colaboratory and time limit avoidance method</a>
<a href="https://gitpython.readthedocs.io/en/stable/">GitPython docs</a></p>
<p>I actually implemented clone using gitPython as follows.</p>
<pre><code class="language-python:" data-lang="python:">
%cd /content
repository_path = &quot;{repository name}&quot;
# Directory existence confirmation
if not os.path.isdir(repository_path):
    git.Git().clone(&quot;https://{access token}:x-oauth-basic@github.com/{username}/&quot; + repository_path + &quot;.git&quot;)
else:
  pass

# Move to cloned directory
%cd my-selenium-profile
</code></pre><p>It looks like this until push.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SeleniumColaboratory</span>():
    <span style="color:#66d9ef">def</span> __init__(self, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2&#34;</span>):
        
        <span style="color:#75715e"># Set current directory to path</span>
        self<span style="color:#f92672">.</span>path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>getcwd()
        self<span style="color:#f92672">.</span>store_path <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>path <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/elapsed_time.txt&#34;</span>

        <span style="color:#e6db74">&#34;~~~~~~~~~~~~~~~~~~~~~~~~ omitted ~~~~~~~~~~~~~~~~~~~~~~~~ &#34;</span>

        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">git_push</span>(self):
            <span style="color:#66d9ef">try</span>:
                repo <span style="color:#f92672">=</span> git<span style="color:#f92672">.</span>Repo<span style="color:#f92672">.</span>init()
                repo<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>add(self<span style="color:#f92672">.</span>store_path)
                repo<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>commit(<span style="color:#e6db74">&#34;add elapsed_time.txt&#34;</span>)
                origin <span style="color:#f92672">=</span> repo<span style="color:#f92672">.</span>remote(name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;origin&#34;</span>)
                origin<span style="color:#f92672">.</span>push()
                <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Success&#34;</span>
            
            <span style="color:#66d9ef">except</span>:
                <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Error&#34;</span>
        <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>(self):
            <span style="color:#75715e"># Push to GitHub</span>
            result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>git_push(<span style="color:#e6db74">&#34;learning data or intermediate products&#34;</span>)

</code></pre></div><h4 id="selenium-related">Selenium related</h4>
<p>In order to make Selenium read <code>UserData_Ubuntu</code> in the directory cloned from GitHub, do the following process.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># User Plofile path</span>
userdata_dir <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;UserData_Ubuntu&#34;</span>
options <span style="color:#f92672">=</span> webdriver<span style="color:#f92672">.</span>ChromeOptions()
<span style="color:#75715e"># Read User Plofile</span>
options<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;--user-data-dir=&#34;</span> <span style="color:#f92672">+</span> userdata_dir)
</code></pre></div><p>The whole Selenium setup process looks like this.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SeleniumColaboratory</span>():
    <span style="color:#66d9ef">def</span> __init__(self, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2&#34;</span>):
        <span style="color:#75715e"># Set current directory to path</span>
        self<span style="color:#f92672">.</span>path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>getcwd()
        self<span style="color:#f92672">.</span>store_path <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>path <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/elapsed_time.txt&#34;</span>
        <span style="color:#75715e"># User Plofile path</span>
        userdata_dir <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;UserData_Ubuntu&#34;</span>
        options <span style="color:#f92672">=</span> webdriver<span style="color:#f92672">.</span>ChromeOptions()
        <span style="color:#75715e"># Read User Plofileoptions.add_argument(&#34;--user-data-dir=&#34; + userdata_dir)</span>
        options<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;--headless&#34;</span>)
        options<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;--no-sandbox&#34;</span>)
        options<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;--disable-dev-shm-usage&#34;</span>)
        <span style="color:#75715e"># open it, go to a website, and get results</span>
        self<span style="color:#f92672">.</span>driver <span style="color:#f92672">=</span> webdriver<span style="color:#f92672">.</span>Chrome(<span style="color:#e6db74">&#34;chromedriver&#34;</span>,options<span style="color:#f92672">=</span>options)
</code></pre></div><p>To access other Colabratory files</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">access_another_colabo</span>(self, path):

        <span style="color:#75715e">#Open a new tab and update</span>
        self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>execute_script(<span style="color:#e6db74">&#34;window.open()&#34;</span>) <span style="color:#75715e">#make new tab</span>
        self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>switch_to<span style="color:#f92672">.</span>window(self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>window_handles[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#75715e">#switch new tab</span>
        self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>get(path)
        <span style="color:#75715e">#Wait until all page elements are loaded</span>
        WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">60</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>presence_of_all_elements_located)

        <span style="color:#75715e">#Check if the specified URL can be accessed (Check if the authentication page is skipped)</span>
        cur_url <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>current_url
        <span style="color:#66d9ef">print</span>(cur_url)
        
        self<span style="color:#f92672">.</span>click_change_runtime()
        
        <span style="color:#75715e"># Execute all cells</span>
        self<span style="color:#f92672">.</span>click_runall()

    
</code></pre></div><p>It is implemented in.
The following summary code in the code below prevents the session from being cut off by accessing your own file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">auto_access</span>(self, path):
        <span style="color:#66d9ef">try</span>:
            <span style="color:#75715e">#Open a new tab and update</span>
            self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>execute_script(<span style="color:#e6db74">&#34;window.open()&#34;</span>) <span style="color:#75715e">#make new tab</span>
            self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>switch_to<span style="color:#f92672">.</span>window(self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>window_handles[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#75715e">#switch new tab</span>
            self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>get(path)
            <span style="color:#75715e">#Wait until all page elements are loaded</span>
            WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">60</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>presence_of_all_elements_located)
            <span style="color:#75715e">#Check if the specified URL can be accessed (Check if the authentication page is skipped)</span>
            cur_url <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>current_url
            <span style="color:#66d9ef">print</span>(cur_url)
            self<span style="color:#f92672">.</span>click_change_runtime()
            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">30</span>)

        <span style="color:#66d9ef">except</span> urllib3<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>NewConnectionError <span style="color:#66d9ef">as</span> e:
            <span style="color:#66d9ef">print</span>(str(e))
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;********Portal New connection timed out***********&#34;</span>)
            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">30</span>)

        <span style="color:#66d9ef">except</span> urllib3<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>MaxRetryError <span style="color:#66d9ef">as</span> e:
            <span style="color:#66d9ef">print</span>(str(e))
            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">30</span>)
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;*********Portal Max tries exceeded************&#34;</span>)
</code></pre></div><p>It is implemented in.</p>
<p>In addition to opening other Colaboratory files, you also need to run the files. The execution order is as follows.</p>
<ol>
<li>Make runtime changes</li>
<li>Execute all cells</li>
</ol>
<p>So you have to click on the element that pulls the red line below.</p>
<img width="549" alt="Screenshots 2019-11-14 0.40.16.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/234523/5934b546-cb6a-d31e-9406-55650b241ae6.png">
<p>To click &ldquo;Run All Cells&rdquo;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">click_runall</span>(self):
        <span style="color:#75715e"># Runtime click</span>
        select_dropdown <span style="color:#f92672">=</span> WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">20</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>element_to_be_clickable((By<span style="color:#f92672">.</span>ID,<span style="color:#e6db74">&#34;runtime-menu-button&#34;</span>)))
        select_dropdown<span style="color:#f92672">.</span>click()
        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
        <span style="color:#75715e"># Click the execute all cells button</span>
        select_dropdown <span style="color:#f92672">=</span> WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">20</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>element_to_be_clickable((By<span style="color:#f92672">.</span>ID,<span style="color:#e6db74">&#34;:1s&#34;</span>)))
        select_dropdown<span style="color:#f92672">.</span>click()
</code></pre></div><p>It is implemented in.
In order to set the runtime change, set the instance type once and set it in Selenium. In the following summary code</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_mode</span>(self, mode):

        <span style="color:#66d9ef">if</span> mode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;None&#34;</span>:
            self<span style="color:#f92672">.</span>mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1&#34;</span>
        <span style="color:#66d9ef">elif</span> mode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;GPU&#34;</span>:
            self<span style="color:#f92672">.</span>mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2&#34;</span>
        <span style="color:#66d9ef">elif</span> mode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;TPU&#34;</span>:
            self<span style="color:#f92672">.</span>mode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;3&#34;</span>
        <span style="color:#66d9ef">else</span>:
            self<span style="color:#f92672">.</span>mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1&#34;</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">click_change_runtime</span>(self):
        <span style="color:#75715e"># Runtime click</span>
        select_dropdown <span style="color:#f92672">=</span> WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">20</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>element_to_be_clickable((By<span style="color:#f92672">.</span>ID,<span style="color:#e6db74">&#34;runtime-menu-button&#34;</span>)))
        select_dropdown<span style="color:#f92672">.</span>click()
        <span style="color:#75715e"># Runtime type change click</span>
        select_dropdown <span style="color:#f92672">=</span> WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">20</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>element_to_be_clickable((By<span style="color:#f92672">.</span>ID,<span style="color:#e6db74">&#34;:23&#34;</span>)))
        select_dropdown<span style="color:#f92672">.</span>click()
        <span style="color:#75715e"># Drop down click</span>
        select_dropdown <span style="color:#f92672">=</span> WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">20</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>element_to_be_clickable((By<span style="color:#f92672">.</span>ID,<span style="color:#e6db74">&#34;input-4&#34;</span>)))
        select_dropdown<span style="color:#f92672">.</span>click()
        
        <span style="color:#75715e"># I sometimes click without waiting</span>
        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)

        <span style="color:#75715e">#XPATH I want to avoid</span>
        <span style="color:#75715e"># Runtime selection</span>
        select_dropdown <span style="color:#f92672">=</span> WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">20</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>element_to_be_clickable((By<span style="color:#f92672">.</span>XPATH,<span style="color:#e6db74">&#34;//*[@id=&#39;accelerator&#39;]/paper-item[&#34;</span> <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>mode <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;]&#34;</span>))) )
        select_dropdown<span style="color:#f92672">.</span>click()

        <span style="color:#75715e"># Save button click</span>
        select_dropdown <span style="color:#f92672">=</span> WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">20</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>element_to_be_clickable((By<span style="color:#f92672">.</span>ID,<span style="color:#e6db74">&#34;ok&#34;</span>)))
        select_dropdown<span style="color:#f92672">.</span>click()
</code></pre></div><p>It is implemented in.</p>
<p>Summary code is folded ↓ ↓ ↓</p>
<h4 id="detailssummarysummary-codesummarydiv"><details><summary>Summary code</summary><div></h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> os

<span style="color:#75715e"># set options to be headless, ..</span>
<span style="color:#f92672">from</span> selenium <span style="color:#f92672">import</span> webdriver
<span style="color:#f92672">from</span> selenium.webdriver.common.by <span style="color:#f92672">import</span> By
<span style="color:#f92672">from</span> selenium.webdriver.support.ui <span style="color:#f92672">import</span> WebDriverWait
<span style="color:#f92672">from</span> selenium.webdriver.support <span style="color:#f92672">import</span> expected_conditions <span style="color:#66d9ef">as</span> EC


<span style="color:#f92672">import</span> subprocess <span style="color:#f92672">as</span> sp
<span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta, timezone
<span style="color:#f92672">import</span> urllib3
<span style="color:#f92672">import</span> time

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SeleniumColaboratory</span>():
    <span style="color:#66d9ef">def</span> __init__(self, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;2&#34;</span>):
        userdata_dir <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;UserData_Ubuntu&#34;</span>
        <span style="color:#75715e"># Set current directory to path</span>
        self<span style="color:#f92672">.</span>path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>getcwd()
        self<span style="color:#f92672">.</span>store_path <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>path <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/elapsed_time.txt&#34;</span>

        options <span style="color:#f92672">=</span> webdriver<span style="color:#f92672">.</span>ChromeOptions()
        options<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;--user-data-dir=&#34;</span> <span style="color:#f92672">+</span> userdata_dir)
        options<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;--headless&#34;</span>)
        options<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;--no-sandbox&#34;</span>)
        options<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;--disable-dev-shm-usage&#34;</span>)<span style="color:#75715e"># open it, go to a website, and get results</span>
        self<span style="color:#f92672">.</span>driver <span style="color:#f92672">=</span> webdriver<span style="color:#f92672">.</span>Chrome(<span style="color:#e6db74">&#34;chromedriver&#34;</span>,options<span style="color:#f92672">=</span>options)

        <span style="color:#75715e"># FIleB path</span>
        self<span style="color:#f92672">.</span>access_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://colab.research.google.com/drive/1s3LeBakro8zDX_FGAZfhmgnNZktjwJtD&#34;</span>
        <span style="color:#75715e"># FilleA path for auto-access</span>
        self<span style="color:#f92672">.</span>access_path_2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://colab.research.google.com/drive/1wT6ZpKLNr24R5qEfH-0jotifhBVrfA9S&#34;</span>

        self<span style="color:#f92672">.</span>mode <span style="color:#f92672">=</span> str(mode)

        jtime <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>get_japan_time()
        initial_text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;------------------ &#34;</span> <span style="color:#f92672">+</span> jtime<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#34;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span>) <span style="color:#f92672">+</span>  <span style="color:#e6db74">&#34; ------------------</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
        self<span style="color:#f92672">.</span>append_time_file(initial_text)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">click_runall</span>(self):

        select_dropdown <span style="color:#f92672">=</span> WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">20</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>element_to_be_clickable((By<span style="color:#f92672">.</span>ID,<span style="color:#e6db74">&#34;runtime-menu-button&#34;</span>)))
        select_dropdown<span style="color:#f92672">.</span>click()
        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
        select_dropdown <span style="color:#f92672">=</span> WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">20</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>element_to_be_clickable((By<span style="color:#f92672">.</span>ID,<span style="color:#e6db74">&#34;:1s&#34;</span>)))
        select_dropdown<span style="color:#f92672">.</span>click()
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">click_change_runtime</span>(self):
        <span style="color:#75715e"># ランタイムクリック</span>
        select_dropdown <span style="color:#f92672">=</span> WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">20</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>element_to_be_clickable((By<span style="color:#f92672">.</span>ID,<span style="color:#e6db74">&#34;runtime-menu-button&#34;</span>)))
        select_dropdown<span style="color:#f92672">.</span>click()
        <span style="color:#75715e"># ランタイムのタイプ変更クリック</span>
        select_dropdown <span style="color:#f92672">=</span> WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">20</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>element_to_be_clickable((By<span style="color:#f92672">.</span>ID,<span style="color:#e6db74">&#34;:23&#34;</span>)))
        select_dropdown<span style="color:#f92672">.</span>click()
        <span style="color:#75715e"># ドロップダウンクリック</span>
        select_dropdown <span style="color:#f92672">=</span> WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">20</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>element_to_be_clickable((By<span style="color:#f92672">.</span>ID,<span style="color:#e6db74">&#34;input-4&#34;</span>)))
        select_dropdown<span style="color:#f92672">.</span>click()
        
        <span style="color:#75715e"># 待たずにクリックしてしまうことがあるので</span>
        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)

        <span style="color:#75715e"># XPATH避けたい</span>
        <span style="color:#75715e"># ランタイム選択</span>
        select_dropdown <span style="color:#f92672">=</span> WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">20</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>element_to_be_clickable((By<span style="color:#f92672">.</span>XPATH,<span style="color:#e6db74">&#34;//*[@id=&#39;accelerator&#39;]/paper-item[&#34;</span> <span style="color:#f92672">+</span> self<span style="color:#f92672">.</span>mode <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;]&#34;</span>)))
        select_dropdown<span style="color:#f92672">.</span>click()

        <span style="color:#75715e"># 保存ボタンクリック</span>
        select_dropdown <span style="color:#f92672">=</span> WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">20</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>element_to_be_clickable((By<span style="color:#f92672">.</span>ID,<span style="color:#e6db74">&#34;ok&#34;</span>)))
        select_dropdown<span style="color:#f92672">.</span>click()
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">check_time</span>(self):
        <span style="color:#75715e"># インスタンスを起動してからの時間を返す</span>
        res <span style="color:#f92672">=</span> sp<span style="color:#f92672">.</span>Popen([<span style="color:#e6db74">&#34;cat&#34;</span>, <span style="color:#e6db74">&#34;/proc/uptime&#34;</span>], stdout<span style="color:#f92672">=</span>sp<span style="color:#f92672">.</span>PIPE)
        <span style="color:#75715e"># 単位はHour</span>
        use_time <span style="color:#f92672">=</span> float(sp<span style="color:#f92672">.</span>check_output([<span style="color:#e6db74">&#34;awk&#34;</span>, <span style="color:#e6db74">&#34;{print $1 /60 /60 }&#34;</span>], stdin<span style="color:#f92672">=</span>res<span style="color:#f92672">.</span>stdout)<span style="color:#f92672">.</span>decode()<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>))
        <span style="color:#66d9ef">return</span> use_time

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">append_time_file</span>(self, txt):

        <span style="color:#66d9ef">with</span> open(self<span style="color:#f92672">.</span>store_path, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;a&#39;</span>) <span style="color:#66d9ef">as</span> f:
            f<span style="color:#f92672">.</span>write(txt)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">access_another_colabo</span>(self, path):

        <span style="color:#75715e">#新規タブを開いて更新処理</span>
        self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>execute_script(<span style="color:#e6db74">&#34;window.open()&#34;</span>) <span style="color:#75715e">#make new tab</span>
        self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>switch_to<span style="color:#f92672">.</span>window(self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>window_handles[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#75715e">#switch new tab</span>
        self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>get(path)
        <span style="color:#75715e"># ページの要素が全て読み込まれるまで待機</span>
        WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">60</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>presence_of_all_elements_located)

        <span style="color:#75715e"># 指定のURLにアクセスできているか確認(認証ページに飛ばされていないか確認)</span>
        cur_url <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>current_url
        <span style="color:#66d9ef">print</span>(cur_url)
        
        self<span style="color:#f92672">.</span>click_change_runtime()
        
        <span style="color:#75715e"># 全てのセルを実行する</span>
        self<span style="color:#f92672">.</span>click_runall()

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">auto_access</span>(self, path):
        <span style="color:#66d9ef">try</span>:
            <span style="color:#75715e">#新規タブを開いて更新処理</span>
            self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>execute_script(<span style="color:#e6db74">&#34;window.open()&#34;</span>) <span style="color:#75715e">#make new tab</span>
            self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>switch_to<span style="color:#f92672">.</span>window(self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>window_handles[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]) <span style="color:#75715e">#switch new tab</span>
            self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>get(path)
            <span style="color:#75715e"># ページの要素が全て読み込まれるまで待機</span>
            WebDriverWait(self<span style="color:#f92672">.</span>driver, <span style="color:#ae81ff">60</span>)<span style="color:#f92672">.</span>until(EC<span style="color:#f92672">.</span>presence_of_all_elements_located)
            <span style="color:#75715e"># 指定のURLにアクセスできているか確認(認証ページに飛ばされていないか確認)</span>
            cur_url <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>driver<span style="color:#f92672">.</span>current_url
            <span style="color:#66d9ef">print</span>(cur_url)
            self<span style="color:#f92672">.</span>click_change_runtime()
            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">30</span>)

        <span style="color:#66d9ef">except</span> urllib3<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>NewConnectionError <span style="color:#66d9ef">as</span> e:
            <span style="color:#66d9ef">print</span>(str(e))
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;********Portal New connection timed out***********&#34;</span>)
            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">30</span>)

        <span style="color:#66d9ef">except</span> urllib3<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>MaxRetryError <span style="color:#66d9ef">as</span> e:
            <span style="color:#66d9ef">print</span>(str(e))
            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">30</span>)
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;*********Portal Max tries exceeded************&#34;</span>)
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">set_mode</span>(self, mode):

        <span style="color:#66d9ef">if</span> mode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;None&#34;</span>:
            self<span style="color:#f92672">.</span>mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1&#34;</span>
        <span style="color:#66d9ef">elif</span> mode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;GPU&#34;</span>:
            self<span style="color:#f92672">.</span>mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2&#34;</span>
        <span style="color:#66d9ef">elif</span> mode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;TPU&#34;</span>:
            self<span style="color:#f92672">.</span>mode <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;3&#34;</span>
        <span style="color:#66d9ef">else</span>:
            self<span style="color:#f92672">.</span>mode <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1&#34;</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">git_push</span>(self):
        <span style="color:#66d9ef">try</span>:
            repo <span style="color:#f92672">=</span> git<span style="color:#f92672">.</span>Repo<span style="color:#f92672">.</span>init()
            repo<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>add(self<span style="color:#f92672">.</span>store_path)
            repo<span style="color:#f92672">.</span>index<span style="color:#f92672">.</span>commit(<span style="color:#e6db74">&#34;add elapsed_time.txt&#34;</span>)
            origin <span style="color:#f92672">=</span> repo<span style="color:#f92672">.</span>remote(name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;origin&#34;</span>)
            origin<span style="color:#f92672">.</span>push()
            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Success&#34;</span>
            
        <span style="color:#66d9ef">except</span>:
            <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Error&#34;</span>
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_japan_time</span>(self):
        
        <span style="color:#75715e"># タイムゾーンの生成</span>
        JST <span style="color:#f92672">=</span> timezone(timedelta(hours<span style="color:#f92672">=+</span><span style="color:#ae81ff">9</span>), <span style="color:#e6db74">&#39;JST&#39;</span>)

        <span style="color:#75715e"># GOOD, タイムゾーンを指定している．早い</span>
        <span style="color:#66d9ef">return</span> datetime<span style="color:#f92672">.</span>now(JST)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>(self):

        <span style="color:#66d9ef">while</span> True:
            elapsed_time <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>check_time()
            <span style="color:#66d9ef">print</span>(elapsed_time)
            jtime <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>get_japan_time()
            append_text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;File A : &#34;</span> <span style="color:#f92672">+</span> str(elapsed_time) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; Hour (&#34;</span> <span style="color:#f92672">+</span>str(jtime<span style="color:#f92672">.</span>strftime(<span style="color:#e6db74">&#34;%H:%M:%S&#34;</span>)) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>
            self<span style="color:#f92672">.</span>append_time_file(append_text)
            <span style="color:#75715e"># 11時間越えたら</span>
            <span style="color:#66d9ef">if</span> elapsed_time <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">11</span>:<span style="color:#75715e"># Push to GitHub</span>
                result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>git_push()
                self<span style="color:#f92672">.</span>set_mode(<span style="color:#e6db74">&#34;None&#34;</span>)
                <span style="color:#75715e"># Open Colaboratory File B</span>
                self<span style="color:#f92672">.</span>access_another_colabo(self<span style="color:#f92672">.</span>access_path)
                
                self<span style="color:#f92672">.</span>set_mode(<span style="color:#e6db74">&#34;GPU&#34;</span>)
                self<span style="color:#f92672">.</span>auto_access(self<span style="color:#f92672">.</span>access_path_2)
                <span style="color:#66d9ef">break</span>

            <span style="color:#66d9ef">else</span>:
                self<span style="color:#f92672">.</span>set_mode(<span style="color:#e6db74">&#34;GPU&#34;</span>)
                self<span style="color:#f92672">.</span>auto_access(self<span style="color:#f92672">.</span>access_path_2)
                <span style="color:#75715e"># Check every 60 minutes</span>
                time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">3600</span>)
                

        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Done.&#34;</span>)

    
</code></pre></div></div></details>
<h4 id="selenium-note">Selenium Note</h4>
<ul>
<li>The shortcut key didn&rsquo;t work</li>
</ul>
<h2 id="inspection-result">inspection result</h2>
<p>The following processing was performed and it was verified that the 90-minute-12-hour problem solution in this article was useful.</p>
<h3 id="filea-processing">FileA processing</h3>
<ol>
<li>Every hour, write to <code>elapsed_time.txt</code> in the following format (1st line is the first time only)</li>
<li>Access FileA every hour using Selenium</li>
<li>Execute FileB from FileA using Selenium when the instance startup time exceeds 11 hours</li>
<li>At the same timing, push <code>elapsed_time.txt</code> to GitHub.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text:elapsed_time.txt" data-lang="text:elapsed_time.txt">1 ------------------ {Japan date and time} ------------------
2 {File name}:{Instance startup time}({Japan time})
</code></pre></div><h3 id="fileb-processing">FileB processing</h3>
<ol>
<li>Perform the same process as above <code>1.</code></li>
<li>Access FileB every 0.5 hours using Selenium</li>
<li>Execute FileA from FileB using Selenium when the instance startup time exceeds 1.5 hours</li>
<li>At the same timing, push <code>elapsed_time.txt</code> to GitHub.</li>
<li>Repeat <code>2.</code> above until the instance ends</li>
</ol>
<h3 id="12-hour-problem">12 hour problem</h3>
<p>I started from FileB, but if you check the <code>elapsed_time.txt</code> pushed on GitHub, you can see that it rotates twice without problems.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text:elapsed_time.txt" data-lang="text:elapsed_time.txt">- ----------------- 2019-11-15 ------------------
File B: 0.148172 Hour (11:02:53)
File B: 0.659194 Hour (11:33:32)
File B: 1.16914 Hour (12:04:08)
File B: 1.67921 Hour (12:34:45)
- ----------------- 2019-11-15 ------------------
File A: 0.371208 Hour (12:35:44)
File A: 1.38115 Hour (13:36:19)
File A: 2.39099 Hour (14:36:55)
File A: 3.40073 Hour (15:37:30)
File A: 4.41073 Hour (16:38:06)
File A: 5.42056 Hour (17:38:41)
File A: 6.43057 Hour (18:39:17)
File A: 7.4407 Hour (19:39:54)
File A: 8.45084 Hour (20:40:30)
File A: 9.46208 Hour (21:41:11)
File A: 10.4723 Hour (22:41:48)
File A: 11.4827 Hour (23:42:25)
- ----------------- 2019-11-15 ------------------
File B: 0.070075 Hour (23:43:33)
File B: 0.579919 Hour (00:14:09)
File B: 1.09002 Hour (00:44:45)
File B: 1.59973 Hour (01:15:20)
- ----------------- 2019-11-16 ------------------
File A: 0.0631278 Hour (01:16:18)
File A: 1.07302 Hour (02:16:53)
File A: 2.08286 Hour (03:17:29)
File A: 3.09267 Hour (04:18:04)
File A: 4.10244 Hour (05:18:39)
File A: 5.11231 Hour (06:19:15)
File A: 6.1223 Hour (07:19:51)
File A: 7.13236 Hour (08:20:27)
File A: 8.14249 Hour (09:21:04)
File A: 9.15265 Hour (10:21:40)
File A: 10.163 Hour (11:22:17)
File A: 11.1734 Hour (12:22:55)
</code></pre></div><h3 id="90-minute-problem">90-minute problem</h3>
<p>You can confirm that processing is continuing without the session being cut off.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text:elapsed_time.txt" data-lang="text:elapsed_time.txt">- ----------------- 2019-11-14 ------------------
File A: 0.0933806 Hour (21:44:54)
File A: 1.10327 Hour (22:45:30)
File A: 2.11307 Hour (23:46:05)
File A :3.12278 Hour (00:46:40)
File A: 4.13269 Hour (01:47:16)
File A: 5.14361 Hour (02:47:55)
File A: 6.15773 Hour (03:48:46)
File A: 7.16782 Hour (04:49:22)
File A: 8.17792 Hour (05:49:58)
File A: 9.18807 Hour (06:50:35)
File A: 10.1983 Hour (07:51:12)
File A: 11.2088 Hour (08:51:50)
</code></pre></div><h2 id="operation-check-video">Operation check video</h2>
<p>The session executed in the browser of the local PC has been reset because it has already passed 12 hours, but since the file is newly executed in the browser opened with Selenium in Colaboratory, it is executed in the other session. You can see that</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/234523/99123af1-c946-032a-483a-80613317b64f.gif" alt="output.gif"></p>
<h2 id="source-code-summary">Source code summary</h2>
<ul>
<li>
<p>colab_selen.ipynb(FileA)
<a href="https://colab.research.google.com/drive/1wT6ZpKLNr24R5qEfH-0jotifhBVrfA9S">https://colab.research.google.com/drive/1wT6ZpKLNr24R5qEfH-0jotifhBVrfA9S</a></p>
</li>
<li>
<p>return_selen.ipynb(FileB)
<a href="https://colab.research.google.com/drive/1s3LeBakro8zDX_FGAZfhmgnNZktjwJtD">https://colab.research.google.com/drive/1s3LeBakro8zDX_FGAZfhmgnNZktjwJtD</a></p>
</li>
</ul>
<h2 id="in-conclusion">in conclusion</h2>
<p>By using Selenium, we were able to show how to avoid the 90-minute-12-hour problem only with the Colaboratory file. Therefore, even if you perform processing that exceeds 12 hours (eg learning of Deep Learning model), it can be automatically performed!</p>
<p>Although I leave the source code comments as much as possible, I think there is a lack of explanation.</p>
<p>I wanted to write more carefully, but I&rsquo;m spending too much time writing this article, so I&rsquo;ll go back before the professor gets angry! See you soon!</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://qiita.com/ryoya-s/items/ee1daf9cab18c100c990">Install Docker to create a Linux (Ubuntu) container that can be operated by GUI</a></li>
<li><a href="https://qiita.com/mattsu6/items/5511c5631e7a54550f7f">Python3 datetime becomes faster just by specifying the time zone</a></li>
<li><a href="https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line">Create personal access token for command line</a>
<a href="https://nade-nadegata.hatenablog.jp/entry/2018/09/13/001637">Open link in separate tab with selenium</a></li>
</ul>
<h5 id="pioneers-of-selenium-on-colaboratory">Pioneers of Selenium on Colaboratory</h5>
<ul>
<li><a href="%5Bhttps://qiita.com/FrozenVoice/items/5348a74feeb5e8b8b8ad">I tried to use Selenium on Colaboratory (and it was bad)-Qiita</a></li>
<li><a href="">Preparing Selenium execution environment in Google Colaboratory (failure)-Qiita</a></li>
<li><a href="https://qiita.com/ftoyoda/items/fe3e2fe9e962e01ac421">Selenium can be used in Colaboratory: Easy scraping of javascript generated pages-Qiita</a></li>
<li><a href="https://stackoverflow.com/questions/53532060/webdriverexception-message-service-content-chromedriver-unexpectedly-exited">python-WebDriverException: Message: Service/content/chromedriver unexpectedly exited. Status code was: -6 with ChromeDriver Google Colab and Selenium-Stack Overflow</a></li>
</ul>
<h5 id="articles-that-will-be-useful-for-regular-colaboratory-executions-google-colaboratorys-90-minute-session-cutout-measure-automatic-connection-qiitahttpsqiitacomenmaruitems2770df602dd7778d4ce6">Articles that will be useful for regular Colaboratory executions-<a href="https://qiita.com/enmaru/items/2770df602dd7778d4ce6">Google Colaboratory&rsquo;s 90-minute session cutout measure [automatic connection]-Qiita</a></h5>
<ul>
<li><a href="https://qiita.com/Gimina_Graph/items/4bdf3e3c3658eeb0eba8">I want to avoid the 90-minute rule of Google Colaboratory. -Qiita</a></li>
<li><a href="https://qiita.com/Fortinbras/items/4cfa9269af2ab8d1d4d5">Think about how to regularly run Google Colaboratory-Qiita</a></li>
<li><a href="https://qiita.com/iZuno-K/items/453cbc023a477359f272">Development of infrastructure for machine learning in Google Colaboratory-Qiita</a></li>
<li><a href="https://qiita.com/Ningensei848/items/a7daa6ee4ef692a3d65e">Poem about Selenium on Colaboratory and time limit avoidance method</a></li>
</ul>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
