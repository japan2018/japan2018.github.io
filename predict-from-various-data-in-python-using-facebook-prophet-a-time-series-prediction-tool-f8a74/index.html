<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://japan2018.github.io/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://japan2018.github.io/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://japan2018.github.io/favicon-16x16.png">

  
  <link rel="manifest" href="https://japan2018.github.io/site.webmanifest">

  
  <link rel="mask-icon" href="https://japan2018.github.io/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://japan2018.github.io/css/bootstrap.min.css" />

  
  <title>Predict from various data in Python using Facebook Prophet, a time series prediction tool | Some Title</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Predict from various data in Python using Facebook Prophet, a time series prediction tool</h1>
<p>
  <small class="text-secondary">
  
  
  Mar 8, 2020
  </small>
  

<small><code><a href="https://japan2018.github.io/tags/python">Python</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/facebook"> Facebook</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/programming"> programming</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/data-analysis"> data analysis</a></code></small>


<small><code><a href="https://japan2018.github.io/tags/ai"> AI</a></code></small>

</p>
<pre><code>&gt;This article is [Greg Rafferty](https://towardsdatascience.com/@raffg?source=post_page-----29810eb57e66----------------------)Translatedfrom&quot;[ForecastinginPythonwithFacebookProphet](https://towardsdatascience.com/forecasting-in-python-with-facebook-prophet-29810eb57e66)&quot; published in November 2019 by Mr. ..
</code></pre>
<p>This article is published with the permission of the original author.</p>
<p>I&rsquo;m Greg Rafferty, a data scientist in the Bay Area. You can also check the code used in this project from my <a href="https://github.com/raffg/prophet_forecasting">github</a>.</p>
<p>In this article, I&rsquo;ll show you how to use the Facebook Prophet prediction library to make a variety of predictions, and some advanced techniques to use your expertise to handle trend inconsistencies. There are many Prophet tutorials out there on the web, but none of them have too much detail on how to tune a Prophet model or integrate the analyst&rsquo;s knowledge to properly navigate data to the model. not. I&rsquo;ll cover both in this article.</p>
<hr>
<p><img src="https://miro.medium.com/max/1992/1*Ojg2gNI8FSEVyaP4w7oKgw.jpeg" alt="">
<a href="https://www.instagram.com/p/BaKEnIPFUq-/">https://www.instagram.com/p/BaKEnIPFUq-/</a></p>
<p>In a previous article on Forecasting with Tableau (<a href="https://towardsdatascience.com/forecasting-with-python-and-tableau-dd37a218a1e5),">https://towardsdatascience.com/forecasting-with-python-and-tableau-dd37a218a1e5),</a> we used a modified ARIMA algorithm to help passengers on commercial flights in the United States. Predicted number. ARIMA&rsquo;s approach works well for predicting constant data and short time frames, but there are cases where ARIMA cannot handle it, and Facebook engineers have developed tools to use in such cases. Prophet has its back end built on STAN, a probabilistic coding language. This allows Prophet to have many of the benefits that Bayes statistics bring, such as seasonality, expertise inclusion, and confidence intervals that add data-driven estimates of risk.</p>
<p>Here, we&rsquo;ll take a look at three data sources to illustrate the use of Prophet and its benefits. If you really want to try it out, install Prophet first. <a href="https://facebook.github.io/prophet/docs/installation.html#python">Facebook documentation</a>hasabriefexplanation.Allthecodeneededtobuildthemodelusedtowritethisarticlecanbefoundinthis<a href="https://github.com/raffg/prophet_forecasting/blob/master/prophet.ipynb">notebook</a> I will.</p>
<hr>
<p>#Air passenger</p>
<p>Let&rsquo;s start with the simple one first. We will use the same airline passenger data that we used in <a href="https://towardsdatascience.com/forecasting-with-python-and-tableau-dd37a218a1e5">previous article</a>. Prophet requires time series data with two or more columns, ds which is a timestamp and y which is a value. After loading the data, format it like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">passengers <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;data/AirPassengers.csv&#39;</span>)df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame()
df[<span style="color:#e6db74">&#39;ds&#39;</span>] <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>to_datetime(passengers[<span style="color:#e6db74">&#39;Month&#39;</span>])
df[<span style="color:#e6db74">&#39;y&#39;</span>] <span style="color:#f92672">=</span> passengers[<span style="color:#e6db74">&#39;#Passengers&#39;</span>]
</code></pre></div><p>With just a few lines, Prophet can make predictive models as sophisticated as the ARIMA model I built earlier. Here I call Prophet and make a 6-year forecast (frequency monthly, duration 12 months x 6 years):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">prophet <span style="color:#f92672">=</span> Prophet()
prophet<span style="color:#f92672">.</span>fit(df)
future <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">6</span>, freq<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;M&#39;</span>)
forecast <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>predict(future)
fig <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>plot(forecast)
a <span style="color:#f92672">=</span> add_changepoints_to_plot(fig<span style="color:#f92672">.</span>gca(), prophet, forecast)
</code></pre></div><p><img src="https://miro.medium.com/max/1424/1*zPdY-d5i_G3xAZ-6hM2bAw.png" alt="">
U.S. commercial airline passenger numbers (per 1000)</p>
<p>Prophet encloses the original data in black dots and displays the predictive model in blue. The light blue region is the confidence interval. A red line is also added using the add_changepoints_to_plot function. The vertical red dashed line shows where Prophet identified changes in the trend, and the red curve shows the trend with all seasonality removed. We will continue to use this plot format in this article.</p>
<p>Now for the simple case, let&rsquo;s look at a bit more complex data.</p>
<hr>
<h1 id="divvy-bike-share">Divvy Bike Share</h1>
<p><a href="https://www.divvybikes.com/">Divvy</a>isabicyclesharingserviceinChicago.IhavepreviouslyworkedonaprojectthatanalyzedDivvydataandassociateditwithweatherinformationgatheredfrom<a href="https://www.wunderground.com/">WeatherUnderground</a>. I knew this data showed strong seasonality, so I thought it would be a great example to demonstrate Prophet&rsquo;s capabilities and chose it.</p>
<p>Divvy data is divided by ride. To format the data for Prophet, first aggregate to a daily level and then a mode in the &ldquo;events&rdquo; column for each day (for example, weather conditions: &ldquo;unclear&rdquo; &ldquo;rain or snow&rdquo; &ldquo;sunny&rdquo; &quot; Create a column consisting of cloudiness, storm, unknown, etc., number of uses (rides), and average temperature.</p>
<p>Once the data is formatted, let&rsquo;s look at the daily usage:</p>
<p><img src="https://miro.medium.com/max/1420/1*ovvlflewhMW0UJA1GMkXew.png" alt=""></p>
<p>From here, you can see that the data has a distinct seasonality and that the trend is increasing over time. We will use this dataset to demonstrate how to add external regressors, in this case weather and temperature. Let&rsquo;s look at the temperature:</p>
<p><img src="https://miro.medium.com/max/1390/1*bB2oEvvuXzdqFKXZf1s95A.png" alt=""></p>
<p>It looks very similar to the previous graph, but without an increasing trend. This analogy makes sense, because on sunny and warm days more cyclists ride and both plots move up and down in tandem.</p>
<p>When you add another external explanatory variable to create a forecast, the external variable you add requires data for the forecast period. For this reason, I keep my Divvy data short for a year so that I can forecast that year with weather information. You&rsquo;ll also see that we&rsquo;re also adding US default holidays to Prophet.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">prophet <span style="color:#f92672">=</span> Prophet()
prophet<span style="color:#f92672">.</span>add_country_holidays(country_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;US&#39;</span>)
prophet<span style="color:#f92672">.</span>fit(df[d[<span style="color:#e6db74">&#39;date&#39;</span>] <span style="color:#f92672">&lt;</span>pd<span style="color:#f92672">.</span>to_datetime(<span style="color:#e6db74">&#39;2017-01-01&#39;</span>)])
future <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">365</span>, freq<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;d&#39;</span>)
forecast <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>predict(future)
fig <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>plot(forecast)
a <span style="color:#f92672">=</span> add_changepoints_to_plot(fig<span style="color:#f92672">.</span>gca(), prophet, forecast)
plt<span style="color:#f92672">.</span>show()
fig2 <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>plot_components(forecast)
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p>The code block above creates the trend plot described in the Air Passenger section.</p>
<p><img src="https://miro.medium.com/max/1424/1*mfaeVj5vJYQsV34dJmpWGA.png" alt="">
Divvy trend plot</p>
<p>And below is the component plot:</p>
<p><img src="https://miro.medium.com/max/1276/1*lCUGoLhuF9aafnUylTUavg.png" alt="">
Divvy component plot</p>
<p>The component plot consists of three sections: trends, holidays and seasonality. The sum of these three components actually makes up the entire model. Trends are represented by data minus all other components. The holiday plot shows the effect of all the holidays in the model. The holidays implemented in Prophet can be thought of as an unnatural event in which the trend deviates from the baseline, but returns after the event ends. External explanatory variables (discussed in more detail below) are similar to holidays in that they can cause the trend to deviate from the baseline, but the trend remains unchanged after the event. In this case, all holidays led to a reduction in passenger numbers, which also makes sense given that many of our users are commuters. Looking at the weekly seasonality component, you can see that the number of users remains fairly constant throughout the week, but falls sharply on weekends. This is further evidence to support the speculation that most passengers are commuters. Last but not least, the yearly seasonal variation graph is quite rippling. These plots are made with a Fourier transform, essentially a stacked sine wave. Obviously the default values in this case are too flexible. To smooth the curve, we&rsquo;ll now create a Prophet model to turn off the seasonality of the year and add external variables to accommodate it, but with less freedom. The model also adds these weather variables.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">prophet <span style="color:#f92672">=</span> Prophet(growth<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;linear&#39;</span>,
                  yearly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
                  weekly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>,
                  daily_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,holidays<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>,
                  seasonality_mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;multiplicative&#39;</span>,
                  seasonality_prior_scale<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>,
                  holidays_prior_scale<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>,
                  changepoint_prior_scale<span style="color:#f92672">=.</span><span style="color:#ae81ff">05</span>,
                  mcmc_samples<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
                 )<span style="color:#f92672">.</span>add_seasonality(name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;yearly&#39;</span>,
                                    period<span style="color:#f92672">=</span><span style="color:#ae81ff">365.25</span>,
                                    fourier_order<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>,
                                    prior_scale<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>,
                                    mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;additive&#39;</span>)prophet<span style="color:#f92672">.</span>add_country_holidays(country_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;US&#39;</span>)
prophet<span style="color:#f92672">.</span>add_regressor(<span style="color:#e6db74">&#39;temp&#39;</span>)
prophet<span style="color:#f92672">.</span>add_regressor(<span style="color:#e6db74">&#39;cloudy&#39;</span>)
prophet<span style="color:#f92672">.</span>add_regressor(<span style="color:#e6db74">&#39;not clear&#39;</span>)
prophet<span style="color:#f92672">.</span>add_regressor(<span style="color:#e6db74">&#39;rain or snow&#39;</span>)
prophet<span style="color:#f92672">.</span>fit(df[df[<span style="color:#e6db74">&#39;ds&#39;</span>] <span style="color:#f92672">&lt;</span> pd<span style="color:#f92672">.</span>to_datetime(<span style="color:#e6db74">&#39;2017&#39;</span>)])
future <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">365</span>, freq<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;D&#39;</span>)
future[<span style="color:#e6db74">&#39;temp&#39;</span>] <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#39;temp&#39;</span>]
future[<span style="color:#e6db74">&#39;cloudy&#39;</span>] <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#39;cloudy&#39;</span>]
future[<span style="color:#e6db74">&#39;not clear&#39;</span>] <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#39;not clear&#39;</span>]
future[<span style="color:#e6db74">&#39;rain or snow&#39;</span>] <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#39;rain or snow&#39;</span>]
forecast <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>predict(future)
fig <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>plot(forecast)
a <span style="color:#f92672">=</span> add_changepoints_to_plot(fig<span style="color:#f92672">.</span>gca(), prophet, forecast)
plt<span style="color:#f92672">.</span>show()
fig2 <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>plot_components(forecast)
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p>トレンドプロットはほとんど同じだったため、コンポーネントプロットのみお見せします:</p>
<p><img src="https://miro.medium.com/max/1276/1*ApBAn7A7v92KfvlXrD8FRQ.png" alt="">
カーブを滑らかにし、年間の季節性と天候の外部変数を追加したDivvyコンポーネントプロット</p>
<p>このプロットでは、トレンドの最後の年は上向きになっており、最初のプロットのように下向きになっていません！これは昨年のデータの平均気温が低く、利用者数が予想以上に減少したためと説明できます。また、年次のカーブが平滑化され、extra_regressors_multiplicativeプロットが追加されています。これは天候の影響を示しています。利用者数の増減も想定通りの結果になっています。夏には利用者数が増加し、冬には減少と、その変動の多くは天候によって説明できます。実演のためにもう一つ確認したいことがあります。上記のモデルを、今度は雨や雪の外部変数のみを追加してもう一度実行します。コンポーネントプロットは次のとおりになりました。</p>
<p><img src="https://miro.medium.com/max/1274/1*PXfXYus_XTYfjJVhSoTtBg.png" alt="">
雨や雪の影響のみを示したDivvyコンポーネントプロット</p>
<p>これは、雨や雪が降っている日は、そうでない日に比べて、一日の利用回数が約1400回も少なくなることを示しています。なかなか面白いでしょう？</p>
<p>最後に、このデータセットを時間単位で集約し、もう1つのコンポーネントプロットである日次の季節性を作成します。そのプロットは次のようになります:</p>
<p><img src="https://miro.medium.com/max/1274/1*0bYvcUaBn4I3jXql8DEveQ.png" alt="">
日次の季節性を示したDivvyコンポーネントプロット</p>
<p><a href="https://www.ted.com/talks/rives_the_4_a_m_mystery">Rives氏が言うとおり、午前4時は朝起きる時間としては最悪</a>なのでしょう。明らかにシカゴの自転車利用者たちも同意見のようです。午前8時を過ぎると朝の通勤者によるピークを迎えます。そして午後6時頃には夕方の帰宅者による全体のピークが訪れます。真夜中過ぎに小さなピークがあるのもわかります。バーから家に帰る人たちによるものだと思われます。以上がDivvyのデータです！次はInstagramに移りましょう。</p>
<h1 id="instagram">Instagram</h1>
<p>Prophetは本来Facebookが自社のデータを分析するためにされたものです。ならばこのデータセットはProphetを使ってみるには最適でしょう。私はInstagramでいくつかの興味深いトレンドを持つアカウントを探し、次の3つのアカウントを見つけました: <a href="https://www.instagram.com/natgeo/">@natgeo</a>、<a href="https://www.instagram.com/kosh_dp/">@kosh_dp</a>、<a href="https://www.instagram.com/jamesrodriguez10/">@jamesrodriguez10</a></p>
<h2 id="national-geographic">National Geographic</h2>
<p><img src="https://miro.medium.com/max/2160/1*kqEtEU9XmM73oyQqWqWUXQ.jpeg" alt="">
<a href="https://www.instagram.com/p/B5G_U_IgVKv/">https://www.instagram.com/p/B5G_U_IgVKv/</a></p>
<p>2017年、私はある<a href="https://public.tableau.com/profile/greg4084#!/vizhome/NationalGeographiconInstagram/Storyboard">プロジェクト</a>に取り組んでいる時、NationalGeographicの<a href="https://www.instagram.com/natgeo/">Instagramアカウント</a>に<a href="https://github.com/raffg/natgeo_instagram_anomaly">ある異常</a>があることに気付きました。2016年の8月、写真あたりのいいね数が不可解にも突然、劇的に増加し8月が終わるとすぐにベースラインに戻るという出来事がありました。私はこの急上昇がいいね数を増やすための1ヶ月を通したマーケティングキャンペーンによるものとしてモデル化し、将来のマーケティングキャンペーンの効果を予測できるかどうか試してみようと思いました。</p>
<p>National Geographicののいいね数は以下のとおりです。トレンドは明らかに増加しており、時間の経過とともにばらつきも増えています。いいね数が劇的に多い例外はたくさんありますが、2016年8月のスパイクでは、その月に投稿されたすべての写真が、その前後の月に投稿されたものよりも圧倒的に多いいいね数を獲得しています。</p>
<p><img src="https://miro.medium.com/max/1454/1*JytuTCr6bqlN2ycJ3zU3Qw.png" alt=""></p>
<p>これがなぜなのか推測したくはありませんが、せっかく作ったこのモデルのために、例えばNational Geographicのマーケティング部門が、特にいいね数を増やすことを目的とした1カ月間のキャンペーンを行ったと仮定してみましょう。まず、この事実を無視したモデルを構築し、比較するためのベースラインを作成します。</p>
<p><img src="https://miro.medium.com/max/1424/1*NDZwKWnClYTfjitUkzzoEQ.png" alt="">
National Geographicの写真1枚あたりのいいね数</p>
<p>Prophetはこのスパイクのために混乱してしまっているようです。毎年8月の急上昇が青線で示されているように、毎年の季節性コンポーネントにこのスパイクを追加しようとしているのがわかります。Prophetはこれを繰り返しのイベントであるとということにしたいようです。Prophetに、他の年では繰り返されていない特別なことが2016年には起こったということを伝えるために、この月に休日を作ることにしましょう:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">promo <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;holiday&#39;</span>: <span style="color:#e6db74">&#34;Promo event&#34;</span>,
                      <span style="color:#e6db74">&#39;ds&#39;</span> : pd<span style="color:#f92672">.</span>to_datetime([<span style="color:#e6db74">&#39;2016-08-01&#39;</span>]),
                      <span style="color:#e6db74">&#39;lower_window&#39;</span>: <span style="color:#ae81ff">0</span>,
                      <span style="color:#e6db74">&#39;upper_window&#39;</span>: <span style="color:#ae81ff">31</span>})
future_promo <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;holiday&#39;</span>: <span style="color:#e6db74">&#34;Promo event&#34;</span>,
                      <span style="color:#e6db74">&#39;ds&#39;</span> : pd<span style="color:#f92672">.</span>to_datetime([<span style="color:#e6db74">&#39;2020-08-01&#39;</span>]),
                      <span style="color:#e6db74">&#39;lower_window&#39;</span>: <span style="color:#ae81ff">0</span>,
                      <span style="color:#e6db74">&#39;upper_window&#39;</span>: <span style="color:#ae81ff">31</span>})promos_hypothetical <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([promo, future_promo])
</code></pre></div><p>promoデータフレームには2016年8月のイベントのみが含まれ、promos_hypotheticalデータフレームには、National Geographicが2020年8月に実施を検討していると仮定した追加のプロモーションが含まれています。休日を追加する場合、Prophetでは、ブラックフライデーを感謝祭に含めるか、クリスマスイブをクリスマスに含めるかなど、基本的な休日イベントに含める日数を多めに設定することもできますし、少なめに設定することもできます。今回、私は”holiday”の後に31日を追加し、月全体をイベントに含めました。以下がそのコードと新しいトレンドプロットになります。Prophetオブジェクトを呼び出すときに、holidays=promoを指定していることに注意してください。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">prophet <span style="color:#f92672">=</span> Prophet(holidays<span style="color:#f92672">=</span>promo)
prophet<span style="color:#f92672">.</span>add_country_holidays(country_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;US&#39;</span>)
prophet<span style="color:#f92672">.</span>fit(df)
future <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">365</span>, freq<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;D&#39;</span>)
forecast <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>predict(future)
fig <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>plot(forecast)
a <span style="color:#f92672">=</span> add_changepoints_to_plot(fig<span style="color:#f92672">.</span>gca(), prophet, forecast)
plt<span style="color:#f92672">.</span>show()
fig2 <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>plot_components(forecast)
plt<span style="color:#f92672">.</span>show()
<span style="color:#960050;background-color:#1e0010">```!</span>[](https:<span style="color:#f92672">//</span>miro<span style="color:#f92672">.</span>medium<span style="color:#f92672">.</span>com<span style="color:#f92672">/</span>max<span style="color:#f92672">/</span><span style="color:#ae81ff">1424</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>J_hBatKMhiuXRq5xlntbSw<span style="color:#f92672">.</span>png)
Likes per National Geographic photo, including August <span style="color:#ae81ff">2016</span> marketing campaign

It <span style="color:#f92672">is</span> wonderful<span style="color:#960050;background-color:#1e0010">!</span> Here, Prophet shows that this ridiculous spike <span style="color:#f92672">in</span> spikes really did only <span style="color:#f92672">in</span> <span style="color:#ae81ff">2016</span>, <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> August each year<span style="color:#f92672">.</span> So next time, let<span style="color:#e6db74">&#39;s use this model again to predict what would happen if National Geographic launched the same campaign in 2020, using the promos_hypothetical data frame.</span>

<span style="color:#960050;background-color:#1e0010">!</span>[](https:<span style="color:#f92672">//</span>miro<span style="color:#f92672">.</span>medium<span style="color:#f92672">.</span>com<span style="color:#f92672">/</span>max<span style="color:#f92672">/</span><span style="color:#ae81ff">1424</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>WgwLko2ylkI6k46dQ9z1WQ<span style="color:#f92672">.</span>png)
Liked per National Geographic photo assuming a marketing campaign <span style="color:#f92672">in</span> <span style="color:#ae81ff">2020</span>

You can use this method to predict what happens when you add an unnatural event<span style="color:#f92672">.</span> For example, this year<span style="color:#e6db74">&#39;s product sales plan might be a model. Let&#39;</span>s move on to the next account<span style="color:#f92672">.</span>

<span style="color:#75715e">## Anastasia Kosh</span>

<span style="color:#960050;background-color:#1e0010">!</span>[](https:<span style="color:#f92672">//</span>miro<span style="color:#f92672">.</span>medium<span style="color:#f92672">.</span>com<span style="color:#f92672">/</span>max<span style="color:#f92672">/</span><span style="color:#ae81ff">2160</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>C4KYfORbwFkzLRlIT5jyhw<span style="color:#f92672">.</span>jpeg)
https:<span style="color:#f92672">//</span>www<span style="color:#f92672">.</span>instagram<span style="color:#f92672">.</span>com<span style="color:#f92672">/</span>p<span style="color:#f92672">/</span>BfZG2QCgL37<span style="color:#f92672">/</span>

[Anastasia Kosh](https:<span style="color:#f92672">//</span>www<span style="color:#f92672">.</span>instagram<span style="color:#f92672">.</span>com<span style="color:#f92672">/</span>kosh_dp<span style="color:#f92672">/</span>) <span style="color:#f92672">is</span> a Russian photographer who posts quirky self<span style="color:#f92672">-</span>portraits on his Instagram <span style="color:#f92672">and</span> posts music videos on YouTube<span style="color:#f92672">.</span> When I lived <span style="color:#f92672">in</span> Moscow a few years ago, we lived on the same street <span style="color:#f92672">and</span> were neighbors<span style="color:#f92672">.</span> At that time, her Instagram had about <span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">000</span> followers, but <span style="color:#f92672">in</span> <span style="color:#ae81ff">2017</span> her YouTube account spread rapidly <span style="color:#f92672">in</span> Russia, becoming a little celebrity, especially <span style="color:#f92672">in</span> her teens <span style="color:#f92672">in</span> Moscow<span style="color:#f92672">.</span> With her Instagram account growing exponentially <span style="color:#f92672">and</span> her followers rapidly approaching <span style="color:#ae81ff">1</span> million, I thought this exponential growth would be a good challenge <span style="color:#66d9ef">for</span> Prophet<span style="color:#f92672">.</span>

The data to model <span style="color:#f92672">is</span>:

<span style="color:#960050;background-color:#1e0010">!</span>[](https:<span style="color:#f92672">//</span>miro<span style="color:#f92672">.</span>medium<span style="color:#f92672">.</span>com<span style="color:#f92672">/</span>max<span style="color:#f92672">/</span><span style="color:#ae81ff">1438</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>mF<span style="color:#f92672">-</span>lEcggwSBD1QFVb7OKWQ<span style="color:#f92672">.</span>png)

This shows typical hockey sticks <span style="color:#f92672">and</span> optimistic growth, but only <span style="color:#f92672">in</span> this case would it really be<span style="color:#960050;background-color:#1e0010">!</span> As <span style="color:#66d9ef">with</span> the other data we have seen, modeling <span style="color:#66d9ef">with</span> linear growth <span style="color:#f92672">is</span> an unrealistic forecast<span style="color:#f92672">.</span>

<span style="color:#960050;background-color:#1e0010">!</span>[](https:<span style="color:#f92672">//</span>miro<span style="color:#f92672">.</span>medium<span style="color:#f92672">.</span>com<span style="color:#f92672">/</span>max<span style="color:#f92672">/</span><span style="color:#ae81ff">1424</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>ftbQpnhSGgtJqotT4Alp5g<span style="color:#f92672">.</span>png)
Photos of Anastasia Kosh growing linearly Likes per photo

This curve continues indefinitely<span style="color:#f92672">.</span> But of course, there <span style="color:#f92672">is</span> an upper limit on the number of Instagram likes<span style="color:#f92672">.</span> Theoretically, this limit <span style="color:#f92672">is</span> equal to the total number of registered accounts on the service<span style="color:#f92672">.</span> However, the reality <span style="color:#f92672">is</span> that <span style="color:#f92672">not</span> all accounts will see your photos, nor will they like them<span style="color:#f92672">.</span> Here, a little expertise <span style="color:#66d9ef">as</span> an analyst can help<span style="color:#f92672">.</span> This time, I decided to model this <span style="color:#66d9ef">with</span> logistic growth<span style="color:#f92672">.</span> To do this, you must tell the Prophet the ceiling ceiling (Prophet calls it cap) <span style="color:#f92672">and</span> the floor floor<span style="color:#f92672">.</span>

<span style="color:#960050;background-color:#1e0010">```</span>python3
cap <span style="color:#f92672">=</span> <span style="color:#ae81ff">200000</span>
floor <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
df[<span style="color:#e6db74">&#39;cap&#39;</span>] <span style="color:#f92672">=</span> cap
df[<span style="color:#e6db74">&#39;floor&#39;</span>] <span style="color:#f92672">=</span> floor
</code></pre></div><p>As a result of my knowledge of Instagram and a little trial and error, I decided that the maximum number of likes is 200,000 and the minimum limit is 0. In Prophet, these values do not have to be constant, as they can be defined as a function of time. In this case, this is exactly the case when you need a constant value:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">prophet <span style="color:#f92672">=</span> Prophet(growth<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;logistic&#39;</span>,
                  changepoint_range<span style="color:#f92672">=</span><span style="color:#ae81ff">0.95</span>,
                  yearly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
                  weekly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
                  daily_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
                  seasonality_prior_scale<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>,
                  changepoint_prior_scale<span style="color:#f92672">=.</span><span style="color:#ae81ff">01</span>)
prophet<span style="color:#f92672">.</span>add_country_holidays(country_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;RU&#39;</span>)
prophet<span style="color:#f92672">.</span>fit(df)
future <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">1460</span>, freq<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;D&#39;</span>)
future[<span style="color:#e6db74">&#39;cap&#39;</span>] <span style="color:#f92672">=</span> cap
future[<span style="color:#e6db74">&#39;floor&#39;</span>] <span style="color:#f92672">=</span> floor
forecast <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>predict(future)
fig <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>plot(forecast)
a <span style="color:#f92672">=</span> add_changepoints_to_plot(fig<span style="color:#f92672">.</span>gca(), prophet, forecast)
plt<span style="color:#f92672">.</span>show()
fig2 <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>plot_components(forecast)
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p>I&rsquo;ve defined this growth as logistic growth, turned off all seasonality (it didn&rsquo;t seem that much on this plot), and adjusted a few more parameters. I have also added a default holiday in Russia as most of Anastasia&rsquo;s followers are in Russia. When you call the .fit method with df, Prophet looks at the df&rsquo;s cap and floor columns and knows to include them in the model. At this time, be sure to add these columns to the data frame when creating the prediction data frame (future data frame in the code block above). This will be revisited in the next section. But for now, the trend plot is much more realistic!</p>
<p><img src="https://miro.medium.com/max/1424/1*5nGOfwXPI735WO0PWbRdaQ.png" alt="">
Logistics Growing Anastasia Kosh Likes per photo</p>
<p>Let&rsquo;s look at the last example.</p>
<h2 id="james-rodríguez">James Rodríguez</h2>
<p><img src="https://miro.medium.com/max/2160/1*dRUZaChxRUXyW5lSm9Q7Uw.jpeg" alt="">
<a href="https://www.instagram.com/p/BySl8I7HOWa/">https://www.instagram.com/p/BySl8I7HOWa/</a></p>
<p><a href="https://www.instagram.com/jamesrodriguez10/">James Rodríguez</a>isaColombianfootballerwhoplayedagreatroleinboththe2014and2018WorldCups.HisInstagramaccounthasgrownsteadilysinceitopened.However,whileworkingon<a href="https://towardsdatascience.com/the-top-50-most-followed-instagrammers-visualized-134ca4788938">previousanalysis</a>, during his last two World Cups, I&rsquo;ve noticed a sharp and sustained increase in followers in my account. In contrast to the National Geographic account surge that can be modeled as a holiday season, Rodríguez&rsquo;s growth is not returning to the baseline after two tournaments, but is redefining a new baseline. This is a fundamentally different movement, and capturing this movement requires a different modeling approach.</p>
<p>Below are the likes per photo since opening the James Rodríguez account:</p>
<p><img src="https://miro.medium.com/max/1454/1*EsWsQzJdPt_wrnioIaI40Q.png" alt=""></p>
<p>It&rsquo;s difficult to model this cleanly with the techniques you&rsquo;ve been using so far in this tutorial. It is possible that the trend baseline increased in the 2014 Summer 1st World Cup, the spike occurred in the 2018 Summer 2nd World Cup, and the baseline also changed. Attempting to model this behavior with the default model does not work.</p>
<p><img src="https://miro.medium.com/max/1424/1*XqcEgdDWpTZ66XCq_LqUaA.png" alt="">
Photos of James Rodríguez likes per photo</p>
<p>However, this is not a terrible model. The behavior in these two World Cups is simply not well modeled. Modeling these tournaments as holidays, like the data from Anastasia Kosh above, shows an improvement in the model.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">wc_2014 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;holiday&#39;</span>: <span style="color:#e6db74">&#34;World Cup 2014&#34;</span>,
                      <span style="color:#e6db74">&#39;ds&#39;</span>: pd<span style="color:#f92672">.</span>to_datetime([<span style="color:#e6db74">&#39;2014-06-12&#39;</span>]),
                      <span style="color:#e6db74">&#39;lower_window&#39;</span>: <span style="color:#ae81ff">0</span>,
                      <span style="color:#e6db74">&#39;upper_window&#39;</span>: <span style="color:#ae81ff">40</span>})
wc_2018 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame({<span style="color:#e6db74">&#39;holiday&#39;</span>: <span style="color:#e6db74">&#34;World Cup 2018&#34;</span>,
                      <span style="color:#e6db74">&#39;ds&#39;</span>: pd<span style="color:#f92672">.</span>to_datetime([<span style="color:#e6db74">&#39;2018-06-14&#39;</span>]),
                      <span style="color:#e6db74">&#39;lower_window&#39;</span>: <span style="color:#ae81ff">0</span>,
                      <span style="color:#e6db74">&#39;upper_window&#39;</span>: <span style="color:#ae81ff">40</span>})world_cup <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([wc_2014, wc_2018])prophet <span style="color:#f92672">=</span> Prophet(yearly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
                  weekly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
                  daily_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
                  holidays<span style="color:#f92672">=</span>world_cup,
                  changepoint_prior_scale<span style="color:#f92672">=.</span><span style="color:#ae81ff">1</span>)
prophet<span style="color:#f92672">.</span>fit(df)
future <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">365</span>, freq<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;D&#39;</span>)
forecast <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>predict(future)
fig <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>plot(forecast)
a <span style="color:#f92672">=</span> add_changepoints_to_plot(fig<span style="color:#f92672">.</span>gca(), prophet, forecast)
plt<span style="color:#f92672">.</span>show()
fig2 <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>plot_components(forecast)
plt<span style="color:#f92672">.</span>show()
<span style="color:#960050;background-color:#1e0010">```!</span>[](https:<span style="color:#f92672">//</span>miro<span style="color:#f92672">.</span>medium<span style="color:#f92672">.</span>com<span style="color:#f92672">/</span>max<span style="color:#f92672">/</span><span style="color:#ae81ff">1424</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1</span><span style="color:#f92672">*</span>QIrOGNtBsINwUhSHUMb<span style="color:#f92672">-</span>cQ<span style="color:#f92672">.</span>png)
Liked photos of James Rodríguez when adding holidays during the World Cup

It<span style="color:#e6db74">&#39;s too late for the model to respond to the changing trend lines around the 2014 World Cup, and I personally don&#39;</span>t like it yet<span style="color:#f92672">.</span> The transition of the trend line <span style="color:#f92672">is</span> too smooth<span style="color:#f92672">.</span> In such cases, adding an external explanatory variable allows Prophet to take into account sudden changes<span style="color:#f92672">.</span>

In this example, we define two periods <span style="color:#66d9ef">for</span> each event, one before <span style="color:#f92672">and</span> one after<span style="color:#f92672">.</span> Modeling <span style="color:#f92672">in</span> this way assumes that there <span style="color:#f92672">is</span> a particular trendline before the tournament, that trendline undergoes a linear change during the tournament, <span style="color:#f92672">and</span> the tournament <span style="color:#f92672">is</span> followed by a different trendline<span style="color:#f92672">.</span> <span style="color:#f92672">..</span> I define these periods <span style="color:#66d9ef">as</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">or</span> <span style="color:#ae81ff">1</span>, on <span style="color:#f92672">or</span> off, <span style="color:#f92672">and</span> let Prophet train the data to learn its magnitude<span style="color:#f92672">.</span>

<span style="color:#960050;background-color:#1e0010">```</span>python3
df[<span style="color:#e6db74">&#39;during_world_cup_2014&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
df<span style="color:#f92672">.</span>loc[(df[<span style="color:#e6db74">&#39;ds&#39;</span>] <span style="color:#f92672">&gt;=</span> pd<span style="color:#f92672">.</span>to_datetime(<span style="color:#e6db74">&#39;2014-05-02&#39;</span>)) <span style="color:#f92672">&amp;</span> (df[<span style="color:#e6db74">&#39;ds&#39;</span>] <span style="color:#f92672">&lt;=</span> pd<span style="color:#f92672">.</span>to_datetime(<span style="color:#e6db74">&#39;2014-08-25&#39;</span>)), <span style="color:#e6db74">&#39;during_world_cup_2014&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
df[<span style="color:#e6db74">&#39;after_world_cup_2014&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
df<span style="color:#f92672">.</span>loc[(df[<span style="color:#e6db74">&#39;ds&#39;</span>] <span style="color:#f92672">&gt;=</span> pd<span style="color:#f92672">.</span>to_datetime(<span style="color:#e6db74">&#39;2014-08-25&#39;</span>)),<span style="color:#e6db74">&#39;after_world_cup_2014&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> df[<span style="color:#e6db74">&#39;during_world_cup_2018&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
df<span style="color:#f92672">.</span>loc[(df[<span style="color:#e6db74">&#39;ds&#39;</span>] <span style="color:#f92672">&gt;=</span> pd<span style="color:#f92672">.</span>to_datetime(<span style="color:#e6db74">&#39;2018-06-04&#39;</span>)) <span style="color:#f92672">&amp;</span> (df[<span style="color:#e6db74">&#39;ds&#39;</span>] <span style="color:#f92672">&lt;=</span> pd<span style="color:#f92672">.</span>to_datetime(<span style="color:#e6db74">&#39;2018-07-03&#39;</span>)), <span style="color:#e6db74">&#39;during_world_cup_2018&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
df[<span style="color:#e6db74">&#39;after_world_cup_2018&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
df<span style="color:#f92672">.</span>loc[(df[<span style="color:#e6db74">&#39;ds&#39;</span>] <span style="color:#f92672">&gt;=</span> pd<span style="color:#f92672">.</span>to_datetime(<span style="color:#e6db74">&#39;2018-07-03&#39;</span>)),<span style="color:#e6db74">&#39;after_world_cup_2018&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</code></pre></div><p>Update the future data frame to include the &ldquo;holiday&rdquo; event as follows:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">prophet <span style="color:#f92672">=</span> Prophet(yearly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
                  weekly_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
                  daily_seasonality<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>,
                  holidays<span style="color:#f92672">=</span>world_cup,
                  changepoint_prior_scale<span style="color:#f92672">=.</span><span style="color:#ae81ff">1</span>)prophet<span style="color:#f92672">.</span>add_regressor(<span style="color:#e6db74">&#39;during_world_cup_2014&#39;</span>, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;additive&#39;</span>)
prophet<span style="color:#f92672">.</span>add_regressor(<span style="color:#e6db74">&#39;after_world_cup_2014&#39;</span>, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;additive&#39;</span>)
prophet<span style="color:#f92672">.</span>add_regressor(<span style="color:#e6db74">&#39;during_world_cup_2018&#39;</span>, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;additive&#39;</span>)
prophet<span style="color:#f92672">.</span>add_regressor(<span style="color:#e6db74">&#39;after_world_cup_2018&#39;</span>, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;additive&#39;</span>) prophet<span style="color:#f92672">.</span>fit(df)
future <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>make_future_dataframe(periods<span style="color:#f92672">=</span><span style="color:#ae81ff">365</span>)future[<span style="color:#e6db74">&#39;during_world_cup_2014&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
future<span style="color:#f92672">.</span>loc[(future[<span style="color:#e6db74">&#39;ds&#39;</span>] <span style="color:#f92672">&gt;=</span> pd<span style="color:#f92672">.</span>to_datetime(<span style="color:#e6db74">&#39;2014-05-02&#39;</span>)) <span style="color:#f92672">&amp;</span> (future[<span style="color:#e6db74">&#39;ds&#39;</span>] <span style="color:#f92672">&lt;=</span> pd<span style="color:#f92672">.</span>to_datetime(<span style="color:#e6db74">&#39;2014-08-25&#39;</span>)), <span style="color:#e6db74">&#39;during_world_cup_2014&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
future[<span style="color:#e6db74">&#39;after_world_cup_2014&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
future<span style="color:#f92672">.</span>loc[(future[<span style="color:#e6db74">&#39;ds&#39;</span>] <span style="color:#f92672">&gt;=</span> pd<span style="color:#f92672">.</span>to_datetime(<span style="color:#e6db74">&#39;2014-08-25&#39;</span>)),<span style="color:#e6db74">&#39;after_world_cup_2014&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> future[<span style="color:#e6db74">&#39;during_world_cup_2018&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
future<span style="color:#f92672">.</span>loc[(future[<span style="color:#e6db74">&#39;ds&#39;</span>] <span style="color:#f92672">&gt;=</span> pd<span style="color:#f92672">.</span>to_datetime(<span style="color:#e6db74">&#39;2018-06-04&#39;</span>)) <span style="color:#f92672">&amp;</span> (future[<span style="color:#e6db74">&#39;ds&#39;</span>] <span style="color:#f92672">&lt;=</span> pd<span style="color:#f92672">.</span>to_datetime(<span style="color:#e6db74">&#39;2018-07-03&#39;</span>)), <span style="color:#e6db74">&#39;during_world_cup_2018&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
future[<span style="color:#e6db74">&#39;after_world_cup_2018&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
future<span style="color:#f92672">.</span>loc[(future[<span style="color:#e6db74">&#39;ds&#39;</span>] <span style="color:#f92672">&gt;=</span> pd<span style="color:#f92672">.</span>to_datetime(<span style="color:#e6db74">&#39;2018-07-03&#39;</span>)),<span style="color:#e6db74">&#39;after_world_cup_2018&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>forecast <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>predict(future)
fig <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>plot(forecast)
a <span style="color:#f92672">=</span> add_changepoints_to_plot(fig<span style="color:#f92672">.</span>gca(), prophet, forecast)
plt<span style="color:#f92672">.</span>show()
fig2 <span style="color:#f92672">=</span> prophet<span style="color:#f92672">.</span>plot_components(forecast)
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="https://miro.medium.com/max/1424/1*hd9iY1OipkeNbuy5HNlZ6g.png" alt="">
Likes per photo of James Rodríguez with external explanatory variables added</p>
<p>Look at this blue line. The red line shows trends only and is excluded from the effects of additional external variables and holidays. See how the blue trendline soars during the World Cup. This is exactly what our expertise teaches! When Rodríguez scored his first goal in the World Cup, he suddenly got thousands of followers on his account. You can see the specific effects of these external explanatory variables in the component plot.</p>
<p><img src="https://miro.medium.com/max/1278/1*DQKXAjKsP9peJjtTkOYv_w.png" alt="">
James Rodríguez&rsquo;s World Cup external explanatory variable component plot</p>
<p>This shows that the World Cup had no effect on the number of likes in Rodríguez&rsquo;s photos from 2013 to early 2014. During the 2014 World Cup, his average showed a dramatic rise like the image, which continued after the tournament ended, which gave him so many active followers during the event. I can explain from that.) There was a similar increase at the 2018 World Cup, but less dramatic. It can be inferred that this is probably because there weren&rsquo;t many football fans who didn&rsquo;t know him at the time.</p>
<hr>
<p>Thank you for coming to the end of this article! Now that you know how to use holidays in Prophet, linear and logistic growth, and how you can use external regressors to significantly improve Prophet&rsquo;s forecasts. Facebook created an incredibly useful tool called Prophet that turned the once-difficult task of stochastic prediction into a simple set of parameters that could be tuned extensively. Hope your predictions are great!</p>
<p>#Translation cooperation
Original Author: <strong><a href="https://towardsdatascience.com/@raffg?source=post_page-----29810eb57e66----------------------">Greg Rafferty</a></strong>
Thank you for letting us share your knowledge!</p>
<p>This article has been published by the cooperation of the following people.
Thank you again.
Selected by: yumika tomita
Translated by: siho1
Auditor: takujio
Published by: siho1</p>
<p>#Why not make an article with us?
We have translated high-quality overseas articles into Japanese with the cooperation of several excellent engineers, and published the articles.
Please feel free to contact us if you would like to share our activities with us, or if you are interested in disseminating a good article to many people.
In <a href="mailto:main@babydegu.com">Mail</a>,pleasegiveamessagewiththetitle&quot;hopetoparticipate&rdquo;,orsendamessageon<a href="https://twitter.com/BabyDegu?lang=ja">Twitter</a> If so, it is possible to introduce you to the part that can assist you after selection.
*We will always reply to your message.</p>
<h1 id="we-are-looking-forward-to-your-feedback">We are looking forward to your feedback</h1>
<p>How was this article?
・It was better if I could do this, I want you to do this more, I think this is better
・This kind of place was good
We are looking for frank opinions such as.
Your comments will help us improve the quality of future articles, so feel free to post them in the comments. We also welcome your comments on <a href="https://twitter.com/BabyDegu?lang=ja">Twitter</a>.
We look forward to your message.</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-123456789-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
