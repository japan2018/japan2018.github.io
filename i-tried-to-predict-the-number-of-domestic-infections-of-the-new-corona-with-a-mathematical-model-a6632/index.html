<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>I tried to predict the number of domestic infections of the new corona with a mathematical model | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>I tried to predict the number of domestic infections of the new corona with a mathematical model</h1>
<p>
  <small class="text-secondary">
  
  
  Mar 9, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/scipy">scipy</a></code></small>


<small><code><a href="https://memotut.com/tags/python3">Python3</a></code></small>

</p>
<pre><code>## Overview
</code></pre>
<p>Since I found The Lancet&rsquo;s paper <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> that predicts the number of infected people with a mathematical model, I implemented a mathematical model to predict the number of infected people in Japan and compared it with other infectious diseases.</p>
<h3 id="summary">Summary</h3>
<ul>
<li>The number of infected people was predicted by the SEIR model.</li>
<li>The basic reproduction number of the new Corona is about 2.9, which is slightly higher than that of influenza.</li>
<li>If infection control is not effective, the peak number of domestic infections is around GW.</li>
<li>The number of domestic deaths over the next year will be over 10,000 (when the fatality rate is 0.01%).</li>
<li>Foreign immigration restrictions are meaningless.</li>
</ul>
<h3 id="table-of-contents">table of contents</h3>
<ol>
<li><a href="#1-Thispurpose">This purpose</a></li>
<li><a href="#2-Mathematicalmodelforinfectiousdiseases">Mathematical model for infectious diseases</a></li>
<li><a href="#3-Parameterestimation">Parameter estimation</a></li>
<li><a href="#4-Implementedandillustratedinpython">Implemented and illustrated in python</a></li>
<li><a href="#5-Supplement">Supplement</a></li>
</ol>
<h2 id="1-purpose-of-this-time">1. Purpose of this time</h2>
<ol>
<li>
<p>Predict the future number of domestic infections of the new coronavirus (COVID-19, new corona) with a mathematical model.</p>
</li>
<li>
<p>Compare the basic reproduction numbers of the new corona with other infectious diseases.</p>
</li>
<li>
<p>Implementation of scientific calculation using Scipy.</p>
</li>
</ol>
<h2 id="2-infectious-disease-mathematical-model">2. Infectious disease mathematical model</h2>
<blockquote>
<p>&ldquo;A mathematical expression describes the process of how an infectious disease spreads, how long an infected person develops, and how severe it becomes.&quot;<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup></p>
</blockquote>
<p>In the infectious disease mathematical model, the population is divided according to the stage of infection, etc., and the increase/decrease of each population is expressed by a differential equation.
I will explain the simple SEIR model and the extended version used this time.</p>
<h3 id="21-seir-model">2.1. SEIR model</h3>
<ul>
<li>$S$: Number of people without immunity (Susceptible)</li>
<li>$E$: Number of people after exposure (Exposed)</li>
<li>$I$: Number of infectious period (Infectious)</li>
<li>$R$: Number of people who recovered from infection and acquired immunity (Recovered)</li>
<li>$\beta$: infection rate, $\gamma$: recovery (quarantine) rate, $\sigma$: probability of acquiring infectivity, $N$: total population</li>
</ul>
<p>Then, the following simultaneous differential equations are obtained.</p>
<pre><code class="language-math" data-lang="math">\begin{align}
\frac{dS(t)}{dt} &amp;= -\beta \frac{I(t)}{N}S(t) \\

\frac{dE(t)}{dt} &amp;= \beta \frac{I(t)}{N}S(t)-\sigma E(t) \\

\frac{dI(t)}{dt} &amp;= \sigma E(t)-\gamma I(t) \\

\frac{dR(t)}{dt} &amp;= \gamma I(t) \\

N &amp;= S(t) + E(t) + I(t) + R(t)
\end{align}
</code></pre><p>However, ignoring the birth rate and mortality rate, he says that he will never be infected again because he will always recover and acquire immunity after the onset.</p>
<p>If you solve it by giving an appropriate initial value, you can predict the number of future infections. (I put the figure <sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup> for reference)</p>
<img width="698" alt="SEIR_InsetChart_default.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/381868/0984b468-a418-457b-13b1-e2f80ac810ef.png">
<p>For detailed explanation and implementation, refer to the qiita article <sup id="fnref:4"><a href="#fn:4" class="footnote-ref" role="doc-noteref">4</a></sup>.</p>
<p>Here, $R_0=\beta / \gamma$ is called the basic reproduction number, and &ldquo;(
The number of secondary infections produced by one infected person (when possessed). <sup id="fnref:5"><a href="#fn:5" class="footnote-ref" role="doc-noteref">5</a></sup>
** The point is that the larger $R_0$ is, the greater the infectivity is. **</p>
<p>You can also use $R_0$ to calculate how much vaccination you can spread to prevent an epidemic.</p>
<p>In addition to SEIR, various models can be created by subdividing the entire population by residence and age, or by reflecting the characteristics of infectious diseases in differential equations. For example, there are SIR that does not consider E, SEIS that does not consider immunity, and MSEIR that considers passive immunity <sup id="fnref:6"><a href="#fn:6" class="footnote-ref" role="doc-noteref">6</a></sup>.</p>
<h2 id="22-extended-seird-model">2.2. Extended SEIRD model</h2>
<p>The above SEIR is too simple, so this time we will extend it to a model that takes into account the population inflow and outflow and mortality rate with reference to the paper <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>.</p>
<ul>
<li>$R_0$: Number of basic reproductions ($R_0=\beta / \gamma$)</li>
<li>$T_E$: Average post-exposure period (days) ($\gamma^{-1} = T_I$)</li>
<li>$T_I$: Average infectivity period (days) ($\sigma^{-1} = T_E$)</li>
<li>$N_{J,I}$: Number of travelers from Japan to overseas (people/day)</li>
<li>$N_{I,J}$: Number of travelers from overseas to Japan (person/day)</li>
<li>$f$: lethality</li>
<li>$D(t)$: Number of deaths (persons)</li>
</ul>
<p>Then, the following simultaneous differential equations can be obtained.</p>
<pre><code class="language-math" data-lang="math">\begin{align}
\frac{dS(t)}{dt} &amp;=-\frac{R_0}{D_I} \frac{I(t)}{N(t)} S(t)-N_{J,I} +
 \left(1-\frac{E(t) + I(t)}{N(t)} \right)N_{I,J} \\

\frac{dE(t)}{dt} &amp;= \frac{R_0}{D_I} \frac{I(t)}{N(t)} S(t)-\frac{E(t)}{T_E } + \frac{E(t) + I(t)}{N(t)} N_{I,J}\\

\frac{dI(t)}{dt} &amp;= \frac{E(t)}{T_E}-\frac{I(t)}{T_I}\\

\frac{dR(t)}{dt} &amp;= (1-f) \frac{I(t)}{T_I}\\

\frac{dD(t)}{dt} &amp;= f \frac{I(t)}{T_I} \\

N(t) &amp;= S(t) + E(t) + I(t) + R(t)
\end{align}
</code></pre><p>However, regarding $N_{J,I}$ and $N_{I,J}$, all the people who go to Japan from overseas belong to $S$, and the people who come to Japan from overseas belong to $S, E$. I will.</p>
<p>Like the paper <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, parameters other than $R_0$ are replaced by appropriate values. For $T_I and T_E$, we set $T_E=6.0 and T_I=2.4$ by referring to SARS corona. The price of $N_{J, I}, N_{I, J}$ is $N_{J, I}=40000, N_{I, J}=70000$ with reference to the number of travelers in February 2019.</p>
<h2 id="3-parameter-estimation">3. Parameter estimation</h2>
<p>The unknown parameter of the model is $R_0$. There are various estimation methods such as least-squares method, maximum likelihood estimation, MAP estimation, Bayes estimation <sup id="fnref:7"><a href="#fn:7" class="footnote-ref" role="doc-noteref">7</a></sup>, but this time, the likelihood is calculated as a non-stationary Poisson process <sup id="fnref:8"><a href="#fn:8" class="footnote-ref" role="doc-noteref">8</a></sup> and $R_0$ is calculated by maximum likelihood estimation. ..</p>
<h3 id="31-maximum-likelihood-estimation">3.1. Maximum likelihood estimation</h3>
<p>Maximum likelihood estimation that everyone loves. First, the probability (likelihood) of the observed data is expressed as a function of $R_0$, and $R_0$ that maximizes it is calculated. When the likelihood is calculated by modeling the number of infected people as a non-stationary Poisson process with reference to the paper <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>,</p>
<pre><code class="language-math" data-lang="math">L(R_0) = \prod_{d=D_s}^{D_e} \frac{e^{-\lambda_d}\lambda_d^{x_d}}{x_d!}
</code></pre><p>However, the number of infected people at $D_s$: first day of observation, $D_s$: last day of observation, and $x_d$: $d$,</p>
<pre><code class="language-math" data-lang="math">\lambda (t, R_0) = E(t) + I(t) \\
\lambda _d (R_0) = \int_{d-1}^{d} \lambda (u, R_0) du
</code></pre><p>will do. $\lambda$ represents the average when the number of infected people follows Poisson distribution.</p>
<p>Excluding the terms unrelated to $R_0$ from the log-likelihood, $R_0$ can be estimated by</p>
<pre><code class="language-math" data-lang="math">\newcommand{\argmin}{\mathop{\rm arg~min}\limits}

\argmin_{R_0&gt; 0}-\log L(R_0) = \argmin_{R_0&gt; 0} \sum_{d=D_s}^{D_e} (\lambda_d(R_0)-x_d \log \lambda_d(R_0))
</code></pre><h2 id="4-implemented-and-illustrated-in-python">4. Implemented and illustrated in python</h2>
<details><summary>SEIR class implementation</summary><div>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> scipy
<span style="color:#f92672">from</span> scipy.integrate <span style="color:#f92672">import</span> odeint
<span style="color:#f92672">from</span> scipy.optimize <span style="color:#f92672">import</span> minimize
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> mean_absolute_error, mean_squared_error


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SIR</span>(object):

    <span style="color:#66d9ef">def</span> __init__(self, r_0, t_i, dt, init_S, init_I, init_R):
        self<span style="color:#f92672">.</span>r_0 <span style="color:#f92672">=</span> r_0
        self<span style="color:#f92672">.</span>t_i <span style="color:#f92672">=</span> t_i
        self<span style="color:#f92672">.</span>dt <span style="color:#f92672">=</span> dt
        self<span style="color:#f92672">.</span>init_state_list <span style="color:#f92672">=</span> [init_S, init_I, init_R]

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_get_param</span>(self, params, key, default, t<span style="color:#f92672">=</span>None):
        Corresponds to <span style="color:#e6db74">&#34;&#34;&#34; parameter change over time
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> isinstance(params, dict):
            <span style="color:#66d9ef">if</span> key <span style="color:#f92672">in</span> list(params<span style="color:#f92672">.</span>keys()):
                param <span style="color:#f92672">=</span> params[key]
                <span style="color:#66d9ef">if</span> isinstance(param, list):
                    <span style="color:#66d9ef">return</span> param[np<span style="color:#f92672">.</span>clip(int(t <span style="color:#f92672">/</span> self<span style="color:#f92672">.</span>dt), <span style="color:#ae81ff">0</span>, len(param)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)]
                <span style="color:#66d9ef">elif</span> isinstance(param, np<span style="color:#f92672">.</span>ndarray):
                    <span style="color:#66d9ef">return</span> param
                <span style="color:#66d9ef">else</span>:
                    <span style="color:#66d9ef">return</span> default
            <span style="color:#66d9ef">else</span>:
                <span style="color:#66d9ef">return</span> default
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">return</span> default

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_ode</span>(self, state_list, t<span style="color:#f92672">=</span>None, params<span style="color:#f92672">=</span>None):
        <span style="color:#e6db74">&#34;&#34;&#34;Define simultaneous differential equations
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        r_0 <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_param(params,<span style="color:#e6db74">&#39;r_0&#39;</span>, self<span style="color:#f92672">.</span>r_0, t<span style="color:#f92672">=</span>t)
        t_i <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_param(params,<span style="color:#e6db74">&#39;t_i&#39;</span>, self<span style="color:#f92672">.</span>t_i, t<span style="color:#f92672">=</span>t)
        S, I, R <span style="color:#f92672">=</span> state_list
        N <span style="color:#f92672">=</span> S <span style="color:#f92672">+</span> I <span style="color:#f92672">+</span> R
        dstate_dt <span style="color:#f92672">=</span> list()
        dstate_dt[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=-</span>(r_0 <span style="color:#f92672">/</span> t_i) <span style="color:#f92672">*</span> (I <span style="color:#f92672">/</span> N) <span style="color:#f92672">*</span> S
        dstate_dt[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> (r_0 <span style="color:#f92672">/</span> t_i) <span style="color:#f92672">*</span> (I <span style="color:#f92672">/</span> N) <span style="color:#f92672">*</span> S<span style="color:#f92672">-</span>I <span style="color:#f92672">/</span> t_i
        dstate_dt[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> I <span style="color:#f92672">/</span> t_i
        <span style="color:#66d9ef">return</span> dstate_dtdef solve_ode(self, len_days<span style="color:#f92672">=</span><span style="color:#ae81ff">365</span>, params<span style="color:#f92672">=</span>None):
        <span style="color:#e6db74">&#34;&#34;&#34;微分方程式を解く
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        t <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linspace(<span style="color:#ae81ff">0</span>, len_days, int(len_days <span style="color:#f92672">/</span> self<span style="color:#f92672">.</span>dt), endpoint<span style="color:#f92672">=</span>False)
        args <span style="color:#f92672">=</span> (params,) <span style="color:#66d9ef">if</span> params <span style="color:#66d9ef">else</span> ()
        <span style="color:#66d9ef">return</span> odeint(self<span style="color:#f92672">.</span>_ode, self<span style="color:#f92672">.</span>init_state_list, t, args<span style="color:#f92672">=</span>args)


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomizedSEIRD</span>(SIR):

    <span style="color:#66d9ef">def</span> __init__(self, r_0<span style="color:#f92672">=</span>None, t_e<span style="color:#f92672">=</span><span style="color:#ae81ff">6.0</span>, t_i<span style="color:#f92672">=</span><span style="color:#ae81ff">2.4</span>, n_i_j<span style="color:#f92672">=</span><span style="color:#ae81ff">70000</span>, n_j_i<span style="color:#f92672">=</span><span style="color:#ae81ff">40000</span>, f<span style="color:#f92672">=</span><span style="color:#ae81ff">0.0001</span>, dt<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>,
            init_S<span style="color:#f92672">=</span><span style="color:#ae81ff">126800000</span>, init_E<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, init_I<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, init_R<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, init_D<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>):
        self<span style="color:#f92672">.</span>r_0 <span style="color:#f92672">=</span> r_0
        self<span style="color:#f92672">.</span>t_e <span style="color:#f92672">=</span> t_e
        self<span style="color:#f92672">.</span>t_i <span style="color:#f92672">=</span> t_i
        self<span style="color:#f92672">.</span>n_i_j <span style="color:#f92672">=</span> n_i_j
        self<span style="color:#f92672">.</span>n_j_i <span style="color:#f92672">=</span> n_j_i
        self<span style="color:#f92672">.</span>f <span style="color:#f92672">=</span> f
        self<span style="color:#f92672">.</span>dt <span style="color:#f92672">=</span> dt
        self<span style="color:#f92672">.</span>init_state_list <span style="color:#f92672">=</span> [init_S, init_E, init_I, init_R, init_D]

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_ode</span>(self, state_list, t<span style="color:#f92672">=</span>None, params<span style="color:#f92672">=</span>None):
        <span style="color:#e6db74">&#34;&#34;&#34;連立微分方程式を定義する
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        r_0 <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_param(params, <span style="color:#e6db74">&#39;r_0&#39;</span>, self<span style="color:#f92672">.</span>r_0, t<span style="color:#f92672">=</span>t)
        t_e <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_param(params, <span style="color:#e6db74">&#39;t_e&#39;</span>, self<span style="color:#f92672">.</span>t_e, t<span style="color:#f92672">=</span>t)
        t_i <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_param(params, <span style="color:#e6db74">&#39;t_i&#39;</span>, self<span style="color:#f92672">.</span>t_i, t<span style="color:#f92672">=</span>t)
        n_i_j <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_param(params, <span style="color:#e6db74">&#39;n_i_j&#39;</span>, self<span style="color:#f92672">.</span>n_i_j, t<span style="color:#f92672">=</span>t)
        n_j_i <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_param(params, <span style="color:#e6db74">&#39;n_j_i&#39;</span>, self<span style="color:#f92672">.</span>n_j_i, t<span style="color:#f92672">=</span>t)
        f <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_get_param(params, <span style="color:#e6db74">&#39;f&#39;</span>, self<span style="color:#f92672">.</span>f)
        S, E, I, R, D <span style="color:#f92672">=</span> state_list
        N <span style="color:#f92672">=</span> S <span style="color:#f92672">+</span> E <span style="color:#f92672">+</span> I <span style="color:#f92672">+</span> R
        dstate_dt <span style="color:#f92672">=</span> list()
        dstate_dt<span style="color:#f92672">.</span>append(<span style="color:#f92672">-</span> (r_0 <span style="color:#f92672">/</span> t_i) <span style="color:#f92672">*</span> (I <span style="color:#f92672">/</span> N) <span style="color:#f92672">*</span> S <span style="color:#f92672">-</span> n_j_i <span style="color:#f92672">+</span> (<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> ((E <span style="color:#f92672">+</span> I) <span style="color:#f92672">/</span> N)) <span style="color:#f92672">*</span> n_i_j)
        dstate_dt<span style="color:#f92672">.</span>append((r_0 <span style="color:#f92672">/</span> t_i) <span style="color:#f92672">*</span> (I <span style="color:#f92672">/</span> N) <span style="color:#f92672">*</span> S <span style="color:#f92672">-</span> E <span style="color:#f92672">/</span> t_e <span style="color:#f92672">+</span> ((E <span style="color:#f92672">+</span> I) <span style="color:#f92672">/</span> N) <span style="color:#f92672">*</span> n_i_j)
        dstate_dt<span style="color:#f92672">.</span>append(E <span style="color:#f92672">/</span> t_e <span style="color:#f92672">-</span> I <span style="color:#f92672">/</span> t_i)
        dstate_dt<span style="color:#f92672">.</span>append((<span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> f) <span style="color:#f92672">*</span> I <span style="color:#f92672">/</span> t_i)
        dstate_dt<span style="color:#f92672">.</span>append(f <span style="color:#f92672">*</span> I <span style="color:#f92672">/</span> t_i)
        <span style="color:#66d9ef">return</span> dstate_dt

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_calc_neg_log_likelihood_r0</span>(self, r_0, X):
        <span style="color:#e6db74">&#34;&#34;&#34;対数尤度(R_0に関係ある部分のみ)を計算する
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        solution <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>solve_ode(len_days<span style="color:#f92672">=</span>len(X), params<span style="color:#f92672">=</span>dict(r_0<span style="color:#f92672">=</span>r_0))
        lambda_arr <span style="color:#f92672">=</span> solution[int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>self<span style="color:#f92672">.</span>dt)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>::int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>self<span style="color:#f92672">.</span>dt), <span style="color:#ae81ff">2</span>] <span style="color:#75715e"># I</span>
        <span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span> np<span style="color:#f92672">.</span>sum(<span style="color:#f92672">-</span> lambda_arr <span style="color:#f92672">+</span> X <span style="color:#f92672">*</span> np<span style="color:#f92672">.</span>log(lambda_arr))
    
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_calc_error</span>(self, r_0, X, metric<span style="color:#f92672">=</span>mean_absolute_error):
        <span style="color:#e6db74">&#34;&#34;&#34;平均絶対誤差、平均二乗誤差を計算する
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        solution <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>solve_ode(len_days<span style="color:#f92672">=</span>len(X), params<span style="color:#f92672">=</span>dict(r_0<span style="color:#f92672">=</span>r_0))
        e_arr <span style="color:#f92672">=</span> solution[int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>self<span style="color:#f92672">.</span>dt)<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>::int(<span style="color:#ae81ff">1</span><span style="color:#f92672">/</span>self<span style="color:#f92672">.</span>dt), <span style="color:#ae81ff">2</span>]  <span style="color:#75715e"># I</span>
        <span style="color:#66d9ef">return</span> metric(X, e_arr)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">exec_point_estimation</span>(self, init_r_0, X, project<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mle&#39;</span>):
        <span style="color:#e6db74">&#34;&#34;&#34;パラメータを点推定する
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> project <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;mle&#39;</span>:
            result <span style="color:#f92672">=</span> minimize(self<span style="color:#f92672">.</span>_calc_neg_log_likelihood_r0, init_r_0, args<span style="color:#f92672">=</span>(X,), method<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Nelder-Mead&#39;</span>)
        <span style="color:#66d9ef">elif</span> project <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;lad&#39;</span>:
            result <span style="color:#f92672">=</span> minimize(self<span style="color:#f92672">.</span>_calc_error, init_r_0, args<span style="color:#f92672">=</span>(X, mean_absolute_error), method<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Nelder-Mead&#39;</span>)
        <span style="color:#66d9ef">elif</span> project <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;ls&#39;</span>:
            result <span style="color:#f92672">=</span> minimize(self<span style="color:#f92672">.</span>_calc_error, init_r_0, args<span style="color:#f92672">=</span>(X, mean_squared_error), method<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Nelder-Mead&#39;</span>)
        <span style="color:#66d9ef">else</span>:
            <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#39;Invalid project: {project}&#39;</span>)
            <span style="color:#66d9ef">return</span> None
        <span style="color:#66d9ef">if</span> self<span style="color:#f92672">.</span>r_0 <span style="color:#f92672">is</span> None:
            self<span style="color:#f92672">.</span>r_0 <span style="color:#f92672">=</span> result<span style="color:#f92672">.</span>x[<span style="color:#ae81ff">0</span>]
        <span style="color:#66d9ef">return</span> result

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">exec_map</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;MAP推定
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">pass</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">exec_mcmc</span>(self):
        <span style="color:#e6db74">&#34;&#34;&#34;MCMC法
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">pass</span>

</code></pre></div></div></details>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
    <span style="color:#75715e"># 1/16 から 3/8 までの感染者数</span>
    X <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array([
        <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>,  <span style="color:#75715e"># 1/25</span>
        <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">14</span>, <span style="color:#ae81ff">17</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">23</span>,  <span style="color:#75715e"># 2/4</span>
        <span style="color:#ae81ff">35</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">86</span>, <span style="color:#ae81ff">90</span>, <span style="color:#ae81ff">96</span>, <span style="color:#ae81ff">161</span>, <span style="color:#ae81ff">163</span>, <span style="color:#ae81ff">203</span>, <span style="color:#ae81ff">251</span>, <span style="color:#ae81ff">259</span>,  <span style="color:#75715e"># 2/14</span>
        <span style="color:#ae81ff">338</span>, <span style="color:#ae81ff">414</span>, <span style="color:#ae81ff">520</span>, <span style="color:#ae81ff">616</span>, <span style="color:#ae81ff">705</span>, <span style="color:#ae81ff">728</span>, <span style="color:#ae81ff">743</span>, <span style="color:#ae81ff">743</span>, <span style="color:#ae81ff">838</span>, <span style="color:#ae81ff">851</span>, <span style="color:#75715e"># 2/24</span>
        <span style="color:#ae81ff">862</span>, <span style="color:#ae81ff">891</span>, <span style="color:#ae81ff">919</span>, <span style="color:#ae81ff">938</span>, <span style="color:#ae81ff">947</span>, <span style="color:#ae81ff">961</span>, <span style="color:#ae81ff">980</span>, <span style="color:#ae81ff">999</span>, <span style="color:#ae81ff">1035</span>, <span style="color:#ae81ff">1056</span>, <span style="color:#75715e"># 3/5</span>
        <span style="color:#ae81ff">1113</span>, <span style="color:#ae81ff">1157</span>, <span style="color:#ae81ff">1190</span> <span style="color:#75715e"># 3/8</span>
    ])
    model <span style="color:#f92672">=</span> CustomizedSEIRD()
    result <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>exec_point_estimation(init_r_0<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, X<span style="color:#f92672">=</span>X, project<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mle&#39;</span>)
    <span style="color:#66d9ef">print</span>(result<span style="color:#f92672">.</span>x[<span style="color:#ae81ff">0</span>])
</code></pre></div><pre><code>2.8806152343750036
</code></pre><p>「感染者数」というのは扱いが難しくて、実際にカウントされるのは高々来院した人だけで、かつ診断基準や検査の感度特異度を考えると真の$x_d$は誰にも分かりません。ここでは、クルーズ船も含めた感染者数<sup id="fnref:9"><a href="#fn:9" class="footnote-ref" role="doc-noteref">9</a></sup>をもとに推定しました。</p>
<p>拡張SEIRモデルによる今後の国内感染者数予測(Iが感染者数)</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/381868/8caef1c0-712b-0aba-1dc4-a5ab65998623.png" alt="SEIRD2.png"></p>
<p>青線が推定した$R_0$が今後変化しない場合のグラフです。このまま行くと、丁度GWが終わった頃に感染者数がピークになります。
赤線と青線が3/9以降の$R_0$を変化させた場合のグラフです。$R_0$は「1人の感染者当たりが生産する2次感染者数」なので、感染対策や移動の制限などにより小さくなります。$R_0$を十分に小さくできれば緑線のように封じ込めることができます。</p>
<p>下図は厚生省が公表した図<sup id="fnref:9"><a href="#fn:9" class="footnote-ref" role="doc-noteref">9</a></sup>ですが、感染者数のグラフの形状がちゃんと一致してます。</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/381868/7d12198a-21a2-3147-6919-441a1bcca156.png" alt="厚生省コロナ感染者数.png"></p>
<p>また、例えば$N_{i, j}$を変化させると外国人の入国の制限によって感染者数は変化するのかどうか計算できます。同じモデルで計算すると、3/9以降を$N_{i, j}=0$にしても$R_0$が同じであれば感染者数はほぼ変わりません。つまり(このモデルが正しければ)入国制限は無意味ということになります。</p>
<p>次に、基本再生産数と致死率を他の感染症<sup id="fnref:10"><a href="#fn:10" class="footnote-ref" role="doc-noteref">10</a></sup>と比較してみます。
(新型コロナの致死率は各国の致死率からだいたい0.1%~5%とします)</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/381868/8de3a689-32f6-5f05-d45e-7f409b9c168e.png" alt="comparison.png"></p>
<p>新型コロナの基本再生産数や致死率が他の感染症より突出して高いということはないみたいです。
(感染症の危険性は、症状の軽重やワクチンの有無なども考慮する必要があり、基本再生産数や致死率が低いからといって安全という訳では無いとは思いますが、細かい話は感染症に強い人に聞いてください)</p>
<h2 id="5-補足">5. 補足</h2>
<p><a href="https://www.mhlw.go.jp/index.html">厚生労働省</a></p>
<p><a href="http://www.kansensho.or.jp/">日本感染症学会</a></p>
<p><a href="https://www.who.int/">WHO</a></p>
<p><a href="https://www.cdc.gov/">CDC</a><a href="https://gisanddata.maps.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6">Acoolsite(JohnsHopkinsCSSE)whereyoucancheckthenumberofinfectedpeople</a></p>
<p>** I am not an infectious disease specialist, a public health major or a statistician. Real-life infectious diseases are not as simple as our model, so this prediction is probably wrong.
We are not responsible for any damages caused by the contents of this article. **</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><a href="https://www.thelancet.com/journals/lancet/article/PIIS0140-6736(20)30260-9/fulltext">Nowcasting and forecasting the potential domestic and international spread of the 2019-nCoV outbreak originating in Wuhan, China: a modeling study</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p><a href="https://www.jst.go.jp/ristex/stipolicy/policy-door/article-02.html">Stop infectious diseases with mathematical model</a> <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p><a href="https://institutefordiseasemodeling.github.io/Documentation/general/model-seir.html">SEIR and SEIRS models</a> <a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:4" role="doc-endnote">
<p><a href="https://qiita.com/Student-M/items/4e3e286bf08b7320b665">Introduction to mathematical model of infectious disease: Outline of SEIR model by Python and introduction of parameter estimation</a> <a href="#fnref:4" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:5" role="doc-endnote">
<p><a href="https://www.ism.ac.jp/editsec/toukei/pdf/54-2-461.pdf">Prediction of epidemic of infectious disease: Quantitative problem in mathematical model of infectious disease</a> <a href="#fnref:5" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:6" role="doc-endnote">
<p><a href="https://en.wikipedia.org/wiki/Compartmentmental_models_in_epidemiology#The_SEIR_Model">Compartmental models in epidemiology</a> <a href="#fnref:6" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:7" role="doc-endnote">
<p><a href="https://qiita.com/jyori112/items/80b21422b15753a1c5a4">Maximum likelihood estimation, MAP estimation, Bayes estimation learned in Fujii Yodan</a> <a href="#fnref:7" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:8" role="doc-endnote">
<p><a href="http://abrahamcow.hatenablog.com/entry/2017/04/08/062220">SIR model and non-stationary Poisson process</a> <a href="#fnref:8" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:9" role="doc-endnote">
<p><a href="https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/0000164708_00001.html">About new coronavirus infectious diseases</a> <a href="#fnref:9" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:10" role="doc-endnote">
<p><a href="https://en.wikipedia.org/wiki/List_of_human_disease_case_fatality_rates">List of human disease case fatality rates</a> <a href="#fnref:10" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
