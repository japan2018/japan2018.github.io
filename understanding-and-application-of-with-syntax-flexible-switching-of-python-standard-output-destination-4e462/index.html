<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Understanding and application of with syntax] Flexible switching of Python standard output destination | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Understanding and application of with syntax] Flexible switching of Python standard output destination</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 13, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/python3">Python3</a></code></small>

</p>
<pre><code>This section describes how to use the standard output (file output, console output) of Python standard output (print or sys.stdout) by switching with the with syntax as appropriate.
</code></pre>
<h1 id="motivation">Motivation</h1>
<p>The output destination of standard output can be changed according to the process as follows,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sys
<span style="color:#75715e"># Temporarily change to file output</span>
sys<span style="color:#f92672">.</span>stdout <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;out.log&#39;</span>,<span style="color:#e6db74">&#39;a+&#39;</span>)

<span style="color:#f92672">...</span>
sys<span style="color:#f92672">.</span>stdout<span style="color:#f92672">.</span>write(<span style="color:#e6db74">&#39;fugahoge&#39;</span>)
<span style="color:#f92672">...</span>

<span style="color:#75715e">#return to console output</span>
sys<span style="color:#f92672">.</span>stdout <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>__stdout__
</code></pre></div><p>When the processing is over, I thought that there might be something because it is troublesome to undo it, and remembering that using the with syntax made close() after file open() unnecessary, this article Came to write.</p>
<h1 id="what-this-article-describes">What this article describes</h1>
<ul>
<li>How to change standard output</li>
<li>with syntax description</li>
<li>How to change the output destination of standard output with the with syntax</li>
</ul>
<h1 id="with-syntax">with syntax</h1>
<p>The with syntax is used in various situations such as the following file read/write and tensorflow gradient_tape.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;&#39;</span>,<span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
  f<span style="color:#f92672">.</span>read()
</code></pre></div><p>Reference: <a href="https://qiita.com/howmuch515/items/95efab2e61f735a150e3">with syntax (Python)</a>
What is going on with the ## with syntax
What happens when you use the with syntax is that if you specify (or create) an instance after with, the process will run as follows.</p>
<ol>
<li>The instance&rsquo;s <code>.__enter__()</code> method is called</li>
<li>Processing in with syntax</li>
<li>The instance&rsquo;s <code>.__exit__()</code> method is called</li>
</ol>
<h3 id="code-example">Code example</h3>
<p>If you execute code like the following,</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Logger</span>():
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">setIO</span>(self, <span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs):
        <span style="color:#75715e"># Generate TestIO instance</span>
        <span style="color:#66d9ef">return</span> TestIO(<span style="color:#f92672">*</span>args, <span style="color:#f92672">**</span>kwargs)

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestIO</span>():
    <span style="color:#66d9ef">def</span> __enter__(self):
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;enter&#39;</span>)

    <span style="color:#66d9ef">def</span> __exit__(self, <span style="color:#f92672">*</span>args):
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;exit&#39;</span>)

logger <span style="color:#f92672">=</span> Logger()
<span style="color:#66d9ef">with</span> logger<span style="color:#f92672">.</span>setIO():
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;---- in with syntax ----&#39;</span>)
</code></pre></div><p>The output is as follows.</p>
<pre><code class="language-:console" data-lang=":console">enter
- --- in with syntax ----
exit
</code></pre><p>With this, it can be confirmed that the <code>.__enter__()`` method -&gt; processing within the with syntax -&gt; </code>.<strong>exit</strong>()``` method is executed in that order.</p>
<p>Reference:</p>
<ul>
<li><a href="https://reiki4040.hatenablog.com/entry/20130331/1364723288">What is with syntax-Ice cream all year round</a></li>
<li><a href="https://qiita.com/tchnkmr/items/c6b6480d236a51b91c17">Implement a class that can be used with [Python] with syntax</a></li>
</ul>
<h1 id="flexible-switching-of-standard-output-destination-with-with-syntax">Flexible switching of standard output destination with with syntax</h1>
<p>Finally, I will introduce a code example of &ldquo;Flexibly switching the output destination of standard output with the with syntax&rdquo; which is the subject of this article.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sys

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SetIO</span>():
    <span style="color:#e6db74">&#34;&#34;&#34; Class for switching I/O with &#34;&#34;&#34;</span> syntax
    <span style="color:#66d9ef">def</span> __init__(self, filename: str):
        self<span style="color:#f92672">.</span>filename <span style="color:#f92672">=</span> filename

    <span style="color:#66d9ef">def</span> __enter__(self):
        sys<span style="color:#f92672">.</span>stdout <span style="color:#f92672">=</span> _STDLogger(out_file<span style="color:#f92672">=</span>self<span style="color:#f92672">.</span>filename)

    <span style="color:#66d9ef">def</span> __exit__(self, <span style="color:#f92672">*</span>args):
        sys<span style="color:#f92672">.</span>stdout <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>__stdout__

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">_STDLogger</span>():
    <span style="color:#e6db74">&#34;&#34;&#34;Custom I/O&#34;&#34;&#34;</span>
    <span style="color:#66d9ef">def</span> __init__(self, out_file<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;out.log&#39;</span>):
        self<span style="color:#f92672">.</span>log <span style="color:#f92672">=</span> open(out_file, <span style="color:#e6db74">&#34;a+&#34;</span>)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">write</span>(self, message):
        self<span style="color:#f92672">.</span>log<span style="color:#f92672">.</span>write(message)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">flush</span>(self):
        <span style="color:#75715e"># this flush method is needed for python 3 compatibility.</span>
        <span style="color:#66d9ef">pass</span>

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;before with block&#39;</span>)

<span style="color:#66d9ef">with</span> SetIO(<span style="color:#e6db74">&#39;out.log&#39;</span>):
    Switch to <span style="color:#75715e">#file output</span>
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;---- in with syntax ----&#39;</span>)

<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;after with block&#39;</span>)
</code></pre></div><p>When I run the above code,
The following is output to the console.</p>
<pre><code class="language-:console" data-lang=":console">before with block
after with block
</code></pre><p>And the following is output to the file (out.log).</p>
<pre><code class="language-:out.log" data-lang=":out.log">- --- in with syntax ----
</code></pre><p>I was able to switch the with syntax to the standard output destination by the above method.
#Summary
You can change the output destination by using the namespace of the built-in logger module, but I think it is inconvenient to change the output destination in detail. (There is a possibility that you are not familiar with logger)
Therefore, I think that there are situations where the method introduced in this article can be used.
I hope you find it helpful!</p>
<h1 id="refs">Refs</h1>
<ul>
<li><a href="https://reiki4040.hatenablog.com/entry/20130331/1364723288">What is with syntax-Ice cream all year round</a></li>
<li><a href="https://qiita.com/tchnkmr/items/c6b6480d236a51b91c17">Implement a class that can be used with [Python] with syntax</a></li>
<li><a href="https://qiita.com/howmuch515/items/95efab2e61f735a150e3">with syntax (Python)</a></li>
</ul>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
