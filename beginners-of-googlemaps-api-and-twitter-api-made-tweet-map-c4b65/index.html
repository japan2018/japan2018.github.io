<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>Beginners of GoogleMaps API and Twitter API made tweet map | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>Beginners of GoogleMaps API and Twitter API made tweet map</h1>
<p>
  <small class="text-secondary">
  
  
  Nov 22, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/javascript">JavaScript</a></code></small>


<small><code><a href="https://memotut.com/tags/twitter">Twitter</a></code></small>


<small><code><a href="https://memotut.com/tags/googlemapsapi">GoogleMapsAPI</a></code></small>


<small><code><a href="https://memotut.com/tags/twitterapi">TwitterAPI</a></code></small>

</p>
<pre><code>#Introduction
</code></pre>
<p>If I knew when and where I tweeted, I thought it would be fun to look like a life log, so I made a tweet map.</p>
<p>It is the first time to touch GoogleMaps API and TwtterAPI.
Thanks to various sites. .. .. ..</p>
<p>![Screenshot 2019-11-25 14.14.55.png](<a href="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/445408/d4ca8dcd-e24a-ca6e-b09c-(df19ed888805.png)">https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/445408/d4ca8dcd-e24a-ca6e-b09c-(df19ed888805.png)</a>
⬆️ This is when riding a bicycle on the Shimanami Kaido
(It&rsquo;s fun to know where you were and what you were doing!</p>
<p>#0. Development environment
PC: MacBook Air (Retina, 13-inch, 2018)
OS: macOS Mojave (ver 10.14.1)
Processor: 1.6 GHz Intel Core i5
Memory: 16 GB 2133 MHz LPDDR3
Editor: Visual Studio Code</p>
<p>#1. Preparation
This time, download the movement history from the location history of Google Map and use it.
Also, the content of the tweet can be obtained using the Twitter API.
Data download and registration are required respectively.</p>
<h2 id="get-location-history">Get location history</h2>
<p>For the location history acquisition method, refer to here.
<a href="https://qiita.com/maatumoDev/items/b2a97006bb382c3ed649">Download Google Map history (timeline)</a></p>
<p><a href="https://quzee.hatenablog.com/entry/2017/11/19/235725">Extract Google Maps action log</a></p>
<h2 id="how-to-register-googlemaps-api">How to register GoogleMaps API</h2>
<p>For the registration method required when using GoogleMaspAPI, refer to here.
<a href="https://qiita.com/Haruka-Ogawa/items/997401a2edcd20e61037">I tried using Google Maps API</a></p>
<h2 id="twitter-api-registration-method">Twitter API registration method</h2>
<p>Refer to here for the registration method of Twitter API.
<a href="https://qiita.com/kngsym2018/items/2524d21455aac111cdee">Summary of steps from Twitter API registration (account application method) to approval</a></p>
<p>##Tweet data preparation
Location history data is in json format, so it seems convenient to match the file format, so prepare the tweet data in json format (tweet_timeline.json) as well.</p>
<p>(This time I wanted to use a library called tweepy, so I wrote it in python.)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-get_tweet_data.py" data-lang="get_tweet_data.py"><span style="color:#f92672">import</span> tweepy
<span style="color:#f92672">import</span> json
<span style="color:#f92672">import</span> time
<span style="color:#f92672">import</span> calendar


<span style="color:#75715e"># Consumer key and access token settings for using Twitter API</span>
Consumer_key <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&lt;API key obtained by applying for Twitter API registration&gt;&#39;</span>
Consumer_secret <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&lt;Consumer_secret obtained by applying for Twitter API registration&gt;&#39;</span>
Access_token <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&lt;Access_token obtained by applying for Twitter API registration&gt;&#39;</span>
Access_secret <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&lt;Access_secret obtained by applying for Twitter API registration&gt;&#39;</span>

<span style="color:#75715e">#Certification</span>
auth <span style="color:#f92672">=</span> tweepy<span style="color:#f92672">.</span>OAuthHandler(Consumer_key, Consumer_secret)
auth<span style="color:#f92672">.</span>set_access_token(Access_token, Access_secret)

api <span style="color:#f92672">=</span> tweepy<span style="color:#f92672">.</span>API(auth, wait_on_rate_limit<span style="color:#f92672">=</span>True)


<span style="color:#75715e"># Tweet data array</span>
tweet_data <span style="color:#f92672">=</span> []

<span style="color:#75715e"># Account account name Enter the account name without @</span>
user <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;*********&#34;</span>

<span style="color:#75715e"># json data creation</span>
<span style="color:#66d9ef">for</span> tweet <span style="color:#f92672">in</span> tweepy<span style="color:#f92672">.</span>Cursor(api<span style="color:#f92672">.</span>user_timeline, screen_name<span style="color:#f92672">=</span>user, exclude_replies<span style="color:#f92672">=</span>True, include_entities<span style="color:#f92672">=</span>True)<span style="color:#f92672">.</span>items():

    <span style="color:#75715e">#Convert tweet time of twitter API to UNIX</span>
    tweet_utc_time <span style="color:#f92672">=</span> time<span style="color:#f92672">.</span>strptime(
        str(tweet<span style="color:#f92672">.</span>created_at), <span style="color:#e6db74">&#34;%Y-%m-</span><span style="color:#e6db74">%d</span><span style="color:#e6db74"> %H:%M:%S&#34;</span>)
    tweet_unix_time <span style="color:#f92672">=</span> calendar<span style="color:#f92672">.</span>timegm(tweet_utc_time)

    <span style="color:#75715e"># Add URL element of image if there is image</span>
    <span style="color:#66d9ef">if</span><span style="color:#e6db74">&#39;media&#39;</span> <span style="color:#f92672">in</span> tweet<span style="color:#f92672">.</span>entities:
        <span style="color:#66d9ef">for</span> media <span style="color:#f92672">in</span> tweet<span style="color:#f92672">.</span>entities[<span style="color:#e6db74">&#39;media&#39;</span>]:
            tweet_image_url <span style="color:#f92672">=</span> media[<span style="color:#e6db74">&#39;media_url_https&#39;</span>]

            <span style="color:#75715e"># Add image element to tweet data array</span>
            tweet_data<span style="color:#f92672">.</span>append({
                <span style="color:#e6db74">&#34;id&#34;</span>: tweet<span style="color:#f92672">.</span>id, <span style="color:#e6db74">&#34;created_at&#34;</span>: tweet_unix_time, <span style="color:#e6db74">&#34;text&#34;</span>: tweet<span style="color:#f92672">.</span>text,
                <span style="color:#e6db74">&#34;fav&#34;</span>: tweet<span style="color:#f92672">.</span>favorite_count, <span style="color:#e6db74">&#34;RT&#34;</span>: tweet<span style="color:#f92672">.</span>retweet_count, <span style="color:#e6db74">&#34;image&#34;</span>: tweet_image_url
            })

    <span style="color:#66d9ef">else</span>:
        <span style="color:#75715e"># Add elements to Tweet data array</span>
        tweet_data<span style="color:#f92672">.</span>append({
            <span style="color:#e6db74">&#34;id&#34;</span>: tweet<span style="color:#f92672">.</span>id, <span style="color:#e6db74">&#34;created_at&#34;</span>: tweet_unix_time, <span style="color:#e6db74">&#34;text&#34;</span>: tweet<span style="color:#f92672">.</span>text,
            <span style="color:#e6db74">&#34;fav&#34;</span>: tweet<span style="color:#f92672">.</span>favorite_count, <span style="color:#e6db74">&#34;RT&#34;</span>: tweet<span style="color:#f92672">.</span>retweet_count
        })

tweet_dict <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;timeline&#34;</span>: tweet_data}

<span style="color:#75715e"># json file name</span>
fw <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;tweet_timeline.json&#39;</span>,<span style="color:#e6db74">&#39;w&#39;</span>)
<span style="color:#75715e"># json file output Write to file with json.dump function</span>
json<span style="color:#f92672">.</span>dump(tweet_dict, fw, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>, ensure_ascii<span style="color:#f92672">=</span>False)

</code></pre></div><p>Since the Twitter API can take time in a special format, it is converted to Unix time so that it matches the location history, and the image data is also summarized in a json file in a format that is easy to handle.</p>
<p>#2.Map Tweet to GoogleMap
After that, using the prepared location history and Tweet data, mapping coordinates and Tweet data is completed.
Use javascript, html, and css to use GoogleMaps API.</p>
<p>This site has helped me a lot. .. .. It is almost a copy and paste level. ..
<a href="http://cly7796.net/wp/javascript/add-markers-from-json-data-with-the-google-maps-api/">Place markers from json data with Google Maps API</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sample.js" data-lang="sample.js"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">START_DAY</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;2019/4/7&#39;</span>;
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">END_DAY</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;2019/4/8&#39;</span>;
<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">POINTS</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">date</span>;
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ready</span> <span style="color:#f92672">=</span> {<span style="color:#a6e22e">api</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">ajax</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> };
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">map</span>;
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">mapData</span>;
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">mapOptions</span> <span style="color:#f92672">=</span> {
    <span style="color:#a6e22e">center</span><span style="color:#f92672">:</span> {<span style="color:#960050;background-color:#1e0010">/ latitude and longitude of map</span>
        <span style="color:#a6e22e">lat</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">35.700000</span>,
        <span style="color:#a6e22e">lng</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">139.772000</span>
    },
    <span style="color:#a6e22e">zoom</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">17</span>, <span style="color:#75715e">// map magnification
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">scrollwheel</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>, <span style="color:#75715e">// Whether to scale by wheel operation
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">mapTypeControl</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>, <span style="color:#75715e">// whether to show map switching control
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">streetViewControl</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span> <span style="color:#75715e">// Whether to show street view controls
</span><span style="color:#75715e"></span>}
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">latlngs</span> <span style="color:#f92672">=</span> [];
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">tweetdata</span>;

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">infoWindowIndex</span> <span style="color:#f92672">=</span> [];

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">startDay</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date(<span style="color:#a6e22e">START_DAY</span>);
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">unixTimestampstartDay</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">round</span>(<span style="color:#a6e22e">startDay</span>.<span style="color:#a6e22e">getTime</span>());
<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">unixTimestampstartDay</span>)

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">endDay</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date(<span style="color:#a6e22e">END_DAY</span>);
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">unixTimestampendDay</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">round</span>(<span style="color:#a6e22e">endDay</span>.<span style="color:#a6e22e">getTime</span>())
<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">unixTimestampendDay</span>)

<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">aveLat</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">aveLng</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;


<span style="color:#a6e22e">$</span>(<span style="color:#66d9ef">function</span> () {
    <span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">ajax</span>({
        <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#39;tweet_timeline.json&#39;</span>,
        <span style="color:#a6e22e">dataType</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#39;json&#39;</span>,
        <span style="color:#a6e22e">cache</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
    })
        .<span style="color:#a6e22e">then</span>(
            <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">data</span>) {
                <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Twitter timeline was successfully obtained.&#39;</span>);
                <span style="color:#a6e22e">tweetData</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>[<span style="color:#e6db74">&#34;timeline&#34;</span>];
                <span style="color:#a6e22e">ready</span>[<span style="color:#e6db74">&#39;ajax&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;

            },
            <span style="color:#66d9ef">function</span> () {
                <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Failed to get Twitter timeline.&#39;</span>);
            }
        );
});

<span style="color:#a6e22e">$</span>(<span style="color:#66d9ef">function</span> () {
    <span style="color:#a6e22e">$</span>.<span style="color:#a6e22e">ajax</span>({
        <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#39;Location history.json&#39;</span>,
        <span style="color:#a6e22e">dataType</span><span style="color:#f92672">:</span><span style="color:#e6db74">&#39;json&#39;</span>,
        <span style="color:#a6e22e">cache</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">false</span>
    })
        .<span style="color:#a6e22e">then</span>(
            <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">data</span>) {
                <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Successfully obtained location information.&#39;</span>);
                <span style="color:#a6e22e">mapData</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>[<span style="color:#e6db74">&#34;locations&#34;</span>];
                <span style="color:#a6e22e">ready</span>[<span style="color:#e6db74">&#39;ajax&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;

                <span style="color:#a6e22e">generate_map</span>();
            },
            <span style="color:#66d9ef">function</span> () {
                <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Failed to get location information.&#39;</span>);
            });
});


<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Processing after Google Maps API is ready
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">api_ready</span>() {
    <span style="color:#a6e22e">ready</span>[<span style="color:#e6db74">&#39;api&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
    <span style="color:#a6e22e">generate_map</span>();
}

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Generate map
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">generate_map</span>() {
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">ready</span>[<span style="color:#e6db74">&#39;api&#39;</span>] <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">ready</span>[<span style="color:#e6db74">&#39;ajax&#39;</span>]) {
        <span style="color:#a6e22e">map</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">maps</span>.<span style="color:#a6e22e">Map</span>(document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#39;map&#39;</span>), (
            <span style="color:#75715e">// zoom level
</span><span style="color:#75715e"></span>            <span style="color:#a6e22e">zoom</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">10</span>,
            <span style="color:#75715e">// center point latitude longitude
</span><span style="color:#75715e"></span>            <span style="color:#a6e22e">center</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">maps</span>.<span style="color:#a6e22e">LatLng</span>(<span style="color:#a6e22e">mapData</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">latitudeE7</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.0000001</span>, <span style="color:#a6e22e">mapData</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">longitudeE7</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.0000001</span>),
            <span style="color:#75715e">// display distance scale
</span><span style="color:#75715e"></span>            <span style="color:#a6e22e">scaleControl</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span>,
            <span style="color:#75715e">// map type
</span><span style="color:#75715e"></span>            <span style="color:#a6e22e">mapTypeId</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">maps</span>.<span style="color:#a6e22e">MapTypeId</span>.<span style="color:#a6e22e">ROADMAP</span>

        });
        <span style="color:#a6e22e">add_marker</span>();
        <span style="color:#a6e22e">generate_polyline</span>();
    }
}

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Add markers to the map
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">add_marker</span>() {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">markerNum</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">infoWindowNum</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">mapData</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">POINTS</span>) {
        <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">item</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mapData</span>[<span style="color:#a6e22e">i</span>];
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">startDay</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">timestampMs</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">timestampMs</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">endDay</span>) (

            <span style="color:#a6e22e">date</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date(Number(<span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">timestampMs</span>));
            <span style="color:#a6e22e">latlngs</span>.<span style="color:#a6e22e">push</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">maps</span>.<span style="color:#a6e22e">LatLng</span>(<span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">latitudeE7</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.0000001</span>, <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">longitudeE7</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.0000001</span>));

            <span style="color:#75715e">// Create a balloon
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ins</span> <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&lt;div class=&#34;map-window&#34;&gt;&#39;</span>;
            <span style="color:#a6e22e">ins</span> <span style="color:#f92672">+=</span><span style="color:#e6db74">&#39;&lt;font size=&#34;2&#34;&gt;&#39;</span>
            <span style="color:#75715e">//ins +=&#39;&lt;p class=&#34;map-window_name&#34;&gt;&#39; + date +&#39;&lt;/p&gt;&#39;;
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">flag</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">tw</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">itemNext</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mapData</span>[<span style="color:#a6e22e">i</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">POINTS</span>];

            <span style="color:#75715e">// Reflect the Tweet content in the balloon
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">j</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">tweetData</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">j</span><span style="color:#f92672">++</span>) {
                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">timestampMs</span> <span style="color:#f92672">&lt;=</span> (<span style="color:#a6e22e">tweetData</span>[<span style="color:#a6e22e">j</span>].<span style="color:#a6e22e">created_at</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>) <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">tweetData</span>[<span style="color:#a6e22e">j</span>].<span style="color:#a6e22e">created_at</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>) <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">itemNext</span>.<span style="color:#a6e22e">timestampMs</span>) {
                    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">date</span>);
                    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">tweetData</span>[<span style="color:#a6e22e">j</span>].<span style="color:#a6e22e">text</span>);
                    <span style="color:#a6e22e">ins</span> <span style="color:#f92672">+=</span><span style="color:#e6db74">&#39;&lt;p class=&#34;map-window_name&#34;&gt;&#39;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">tweetData</span>[<span style="color:#a6e22e">j</span>].<span style="color:#a6e22e">text</span> <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&lt;/p&gt;&#39;</span>;
                    <span style="color:#75715e">// If the key &#34;image&#34; exists in the associative array, add the image
</span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">tweetData</span>[<span style="color:#a6e22e">j</span>].<span style="color:#a6e22e">image</span>) {
                        <span style="color:#a6e22e">ins</span> <span style="color:#f92672">+=</span> <span style="color:#e6db74">&#34;&lt;img src=&#39;&#34;</span><span style="color:#f92672">+</span><span style="color:#a6e22e">tweetData</span>[<span style="color:#a6e22e">j</span>].<span style="color:#a6e22e">image</span><span style="color:#f92672">+</span><span style="color:#e6db74">&#34;:thumb&#39;&gt;&lt;/br &gt;&#34;</span>;
                    }
                    <span style="color:#a6e22e">tw</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
                }
            }
            <span style="color:#a6e22e">ins</span> <span style="color:#f92672">+=</span><span style="color:#e6db74">&#39;&lt;/font&gt;&#39;</span>;
            <span style="color:#a6e22e">ins</span> <span style="color:#f92672">+=</span><span style="color:#e6db74">&#39;&lt;/div&gt;&#39;</span>;

            <span style="color:#75715e">//Create balloons only for markers with Tweet
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">tw</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) {
                <span style="color:#75715e">// set marker
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">marker</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">maps</span>.<span style="color:#a6e22e">Marker</span>({
                    <span style="color:#a6e22e">position</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">latlngs</span>[<span style="color:#a6e22e">markerNum</span>],
                    <span style="color:#a6e22e">map</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">map</span>,
                    <span style="color:#a6e22e">animation</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">maps</span>.<span style="color:#a6e22e">Animation</span>.<span style="color:#a6e22e">DROP</span>,
                });

                <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">infoWindow</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">maps</span>.<span style="color:#a6e22e">InfoWindow</span>({
                    <span style="color:#a6e22e">content</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">ins</span>
                });

                <span style="color:#a6e22e">infoWindowIndex</span>[<span style="color:#a6e22e">infoWindowNum</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">i</span>;
                <span style="color:#a6e22e">infoWindowNum</span><span style="color:#f92672">++</span>;

                <span style="color:#75715e">// Marker event setting
</span><span style="color:#75715e"></span>                <span style="color:#a6e22e">add_event_to_marker</span>(<span style="color:#a6e22e">marker</span>, <span style="color:#a6e22e">infoWindow</span>, <span style="color:#a6e22e">i</span>);
            }

            <span style="color:#a6e22e">aveLat</span> <span style="color:#f92672">+=</span> (<span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">latitudeE7</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.0000001</span>);
            <span style="color:#a6e22e">aveLng</span> <span style="color:#f92672">+=</span> (<span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">longitudeE7</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.0000001</span>)
            <span style="color:#a6e22e">markerNum</span><span style="color:#f92672">++</span>;
        }

    }
    <span style="color:#75715e">// set the average of the coordinates to the center of the map
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">aveLat</span> <span style="color:#f92672">/=</span> <span style="color:#a6e22e">markerNum</span>;
    <span style="color:#a6e22e">aveLng</span> <span style="color:#f92672">/=</span> <span style="color:#a6e22e">markerNum</span>;
    <span style="color:#a6e22e">map</span>.<span style="color:#a6e22e">setCenter</span>(<span style="color:#66d9ef">new</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">maps</span>.<span style="color:#a6e22e">LatLng</span>(<span style="color:#a6e22e">aveLat</span>, <span style="color:#a6e22e">aveLng</span>));

}

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Add event to marker
</span><span style="color:#75715e"> * @param {object} marker (required) Marker information
</span><span style="color:#75715e"> * @param {object} infoWindow (required) Callout information
</span><span style="color:#75715e"> * @param {number} index (required) Index number of map information
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">add_event_to_marker</span>(<span style="color:#a6e22e">marker</span>, <span style="color:#a6e22e">infoWindow</span>, <span style="color:#a6e22e">index</span>) {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">item</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">mapData</span>[<span style="color:#a6e22e">index</span>];
    <span style="color:#a6e22e">item</span>[<span style="color:#e6db74">&#39;marker&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">marker</span>;
    <span style="color:#a6e22e">item</span>[<span style="color:#e6db74">&#39;infoWindow&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">infoWindow</span>;

    <span style="color:#a6e22e">item</span>[<span style="color:#e6db74">&#39;infoWindow&#39;</span>].<span style="color:#a6e22e">open</span>(<span style="color:#a6e22e">map</span>, <span style="color:#a6e22e">item</span>[<span style="color:#e6db74">&#39;marker&#39;</span>]);

    <span style="color:#75715e">// Show a balloon when clicking the marker
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">item</span>[<span style="color:#e6db74">&#39;marker&#39;</span>].<span style="color:#a6e22e">addListener</span>(<span style="color:#e6db74">&#39;click&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">e</span>) {
        <span style="color:#a6e22e">infoWindows_hide</span>();
        <span style="color:#a6e22e">item</span>[<span style="color:#e6db74">&#39;infoWindow&#39;</span>].<span style="color:#a6e22e">open</span>(<span style="color:#a6e22e">map</span>, <span style="color:#a6e22e">item</span>[<span style="color:#e6db74">&#39;marker&#39;</span>]);
    });
}

<span style="color:#75715e">/**
</span><span style="color:#75715e"> * Hide balloon
</span><span style="color:#75715e"> */</span>
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">infoWindows_hide</span>() {
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">infoWindowIndex</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">startDay</span> <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">mapData</span>[<span style="color:#a6e22e">infoWindowIndex</span>[<span style="color:#a6e22e">i</span>]][<span style="color:#e6db74">&#39;timestampMs&#39;</span>] <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">mapData</span>[<span style="color:#a6e22e">infoWindowIndex</span>[<span style="color:#a6e22e">i</span>]][<span style="color:#e6db74">&#39;timestampMs&#39;</span>] <span style="color:#f92672">&lt;=</span> <span style="color:#a6e22e">endDay</span>)
            <span style="color:#a6e22e">mapData</span>[<span style="color:#a6e22e">infoWindowIndex</span>[<span style="color:#a6e22e">i</span>]][<span style="color:#e6db74">&#39;infoWindow&#39;</span>].<span style="color:#a6e22e">close</span>();
    }
}

<span style="color:#75715e">/** Display balloons in order */</span>
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">infoWindows_open</span>() {
    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">j</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">mapData</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">infoWindowIndex</span>[<span style="color:#a6e22e">j</span>] <span style="color:#f92672">==</span> <span style="color:#a6e22e">i</span>) {
            <span style="color:#a6e22e">mapData</span>[<span style="color:#a6e22e">i</span>][<span style="color:#e6db74">&#39;infoWindow&#39;</span>].<span style="color:#a6e22e">open</span>(<span style="color:#a6e22e">map</span>, <span style="color:#a6e22e">mapData</span>[<span style="color:#a6e22e">i</span>][<span style="color:#e6db74">&#39;marker&#39;</span>]);
            <span style="color:#a6e22e">j</span><span style="color:#f92672">++</span>;
        }
    }
}


<span style="color:#75715e">/** Generate a polyline */</span>
<span style="color:#66d9ef">function</span> <span style="color:#a6e22e">generate_polyline</span>() {
    <span style="color:#75715e">// Draw a line
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">lines</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">google</span>.<span style="color:#a6e22e">maps</span>.<span style="color:#a6e22e">Polyline</span>({
        <span style="color:#a6e22e">path</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">latlngs</span>,
        <span style="color:#a6e22e">strokeColor</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;#8a2be2&#34;</span>,
        <span style="color:#a6e22e">strokeOpacity</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">.7</span>,
        <span style="color:#a6e22e">strokeWeight</span><span style="color:#f92672">:</span> <span style="color:#ae81ff">5</span>
    });
    <span style="color:#a6e22e">lines</span>.<span style="color:#a6e22e">setMap</span>(<span style="color:#a6e22e">map</span>);
}

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-map.html" data-lang="map.html"><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ja&#34;</span>&gt;

&lt;<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> /&gt;

    &lt;<span style="color:#f92672">title</span>&gt;Tweet map&lt;/<span style="color:#f92672">title</span>&gt;

    &lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sample.css&#34;</span> /&gt;

&lt;/<span style="color:#f92672">head</span>&gt;

&lt;<span style="color:#f92672">body</span>&gt;

    &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;map&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
    &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://code.jquery.com/jquery-3.1.1.min.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
    &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;./sample.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
    &lt;<span style="color:#f92672">script</span>
        <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://maps.googleapis.com/maps/api/js?key=&lt;prepared GCP key&gt;&amp;callback=api_ready&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;

&lt;/<span style="color:#f92672">body</span>&gt;

&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sample.css" data-lang="sample.css">#map {
    <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">1000</span><span style="color:#66d9ef">px</span>;
    <span style="color:#66d9ef">height</span>: <span style="color:#ae81ff">600</span><span style="color:#66d9ef">px</span>;
}
</code></pre></div><p>The code is fluffy, but what I&rsquo;m doing is simple and I try to display tweets that are close in time compared to the time at each point in the location history and the tweet time.To be more specific, the coordinates remained fine every 3 minutes, so the tweet tweeted within the time of the location history and the time of the next time (about 3 minutes later) is displayed.</p>
<p>In addition, the locus is also displayed using the GoogleMap method called polyline so that you can see the locus of movement.</p>
<p>#3. Notes
(1) The location information, Tweet contents, and API key information are personal information and must not be disclosed!</p>
<p>(2) When executing in a local environment, accessing a local file with Ajax in chrome causes an error. Run Chorme with sudo!
<a href="https://qiita.com/cigalecigales/items/33afaa42f91542ffa62e">[<em>Other</em>] Access local files with Ajax on Chrome</a></p>
<p>③ You can only trace back to the date when you can get location history and Tweet data! (Obvious)</p>
<p>#4. Referenced Web articles</p>
<p>It may be a reference or almost copy and paste. .. .. .. Excuse me. .. .. Thank you so much.
(I used to refer to various websites, so please tell me if you say, &ldquo;This code is the copy and paste of the one I wrote?&rdquo;.)</p>
<p>・<a href="https://www.iphone-mysterious.com/20190929124638.html">Use Google Timeline for recording travel and outings</a></p>
<p>・<a href="https://dailytextmining.hatenablog.com/entry/2018/07/03/022622">[Capture on day 10] Convert created_at of Twitter API to UNIX time and save to DATETIME</a></p>
<p>・<a href="https://qiita.com/tomozo6/items/d7fac0f942f3c4c66daf">Try playing with twitter API #3 (Get search results)</a></p>
<p>・<a href="https://www.google-mapi.com/googlemaps/polyline-display.html">Displaying polylines Google Maps API V3 How to use JavaScript</a></p>
<p>#Other
Since it is a type that I am satisfied with making, it may be that the explanation is missing, but if it is difficult to understand, please ask. .. ..</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
