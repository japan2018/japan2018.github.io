<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Python] Simple network operation by linking Cisco DNA Center and Tact Switch | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] Simple network operation by linking Cisco DNA Center and Tact Switch</h1>
<p>
  <small class="text-secondary">
  
  
  Dec 8, 2019
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/network">Network</a></code></small>


<small><code><a href="https://memotut.com/tags/api">api</a></code></small>


<small><code><a href="https://memotut.com/tags/raspberrypi">RaspberryPi</a></code></small>


<small><code><a href="https://memotut.com/tags/cisco">Cisco</a></code></small>

</p>
<pre><code>#Introduction
</code></pre>
<p>This article was posted as the eighth day of Cisco Systems Japan Advent Calendar 2019 by volunteers from Cisco.</p>
<ul>
<li>2017 version: <a href="https://qiita.com/advent-calendar/2017/cisco">https://qiita.com/advent-calendar/2017/cisco</a></li>
<li>2018 version: <a href="https://qiita.com/advent-calendar/2018/cisco">https://qiita.com/advent-calendar/2018/cisco</a></li>
<li>2019 version: <a href="https://qiita.com/advent-calendar/2019/cisco">https://qiita.com/advent-calendar/2019/cisco</a></li>
</ul>
<h1 id="what-do-you-want-to-do">What do you want to do?</h1>
<ul>
<li>Network operation that anyone can do</li>
<li>Cisco&rsquo;s best-selling controller for Cisco DNA Center <a href="https://en.wikipedia.org/wiki/%E3%82%B9%E3%83%86%E3%83%AB%E3%82%B9%E3%83%9E%E3%83%BC%E3%82%B1%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0">~~ Stema ~~</a> Tips demo</li>
<li>Balancing work and material</li>
<li>Common cool topics ~~ Policy, AI or Assurance ~ ~, but rather quiet operation that is often heard</li>
<li><a href="https://qiita.com/kikuta1978/items/12f9ef8c5f7a64652b12">Reuse of goods bought in 2017</a></li>
</ul>
<h1 id="what-is-this">What is this?</h1>
<ul>
<li>Issue a Python script that automates routine network management tasks using Tact Switch</li>
<li>The script is <a href="https://developer.html">API</a>of<a href="https://www.cisco.com/c/ja_jp/products/cloud-systems-management/dna-center/index.html">CiscoDNACenter</a>.(cisco.com/dnacenter/) and network equipment is controlled by the controller</li>
<li>Port shut/no shut, Vlan change, config backup using template function of Cisco DNA Center</li>
<li>Make your lab gorgeous by illuminating the LEDs with PoE port no shut</li>
</ul>
<h2 id="completion-drawing">Completion drawing</h2>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/157325/173fca4a-9b00-c2d6-26da-d6801654ae5c.jpeg" alt="IMG_1322.JPG"></p>
<h2 id="tact-switch-for-operation">Tact switch for operation</h2>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/157325/a8b573d3-15d7-12b5-1e39-b980c52aec9c.jpeg" alt="IMG_1323.JPG"></p>
<h2 id="logical-configuration">Logical configuration</h2>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/157325/22fc1dad-b915-0db9-bac7-da2beb136d68.png" alt="SS 2019-12-08 0.19.26.png"></p>
<p>#Demo and commentary</p>
<ol>
<li>Switch port shut/no shut (illumination off/on powered via PoE)</li>
<li>Change vlan setting of switch port (99 or 1)</li>
<li>Simultaneous backup of switch configuration to FTP server</li>
<li>(Bonus) Message notification that work is in progress</li>
</ol>
<h2 id="demo-video">Demo video</h2>
<p>*Click to open Youtube (total 4 minutes 40 seconds)
<a href="https://www.youtube.com/watch?v=BVIkaV1y46Q"><img src="http://img.youtube.com/vi/BVIkaV1y46Q/hqdefault.jpg" alt="Simple Network Operation with Cisco DNA Center and TACT switch"></a></p>
<p>0:16 Demo1: Interface Shut / No shut &hellip; LED Off/On with shut/no shut of PoE
0:51 Demo2: Vlan change &hellip;Switching between Vlan99 and Vlan1
2:00 Demo3: Configuration backup &hellip; Backup of switch configuration to FTP server
3:27 Demo4: Notification to SNS &hellip;Post work notification to WebEx Teams</p>
<h2 id="configuration-script">configuration, script</h2>
<h3 id="raspberry-pi">Raspberry Pi</h3>
<p>Seven Python scripts are prepared on Raspberry Pi. One (template_switch.py) is to accept the input of each button and execute one of the six scripts. The rest of the scripts will direct you to the Cisco DNA Center APIs, depending on your use (there is only one post directly to WebEx Teams).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
pi@raspberrypi:~/code $ uname -a
Linux raspberrypi 4.19.75-v7+ <span style="color:#75715e">#1270 SMP Tue Sep 24 18:45:11 BST 2019 armv7l GNU/Linux</span>
pi@raspberrypi:~/code $ ls -la
<span style="color:#ae81ff">36</span> in total
drwxr-xr-x <span style="color:#ae81ff">2</span> root root <span style="color:#ae81ff">4096</span> Dec <span style="color:#ae81ff">7</span> 03:11.
drwxr-xr-x <span style="color:#ae81ff">21</span> pi pi <span style="color:#ae81ff">4096</span> December <span style="color:#ae81ff">6</span> 01:29 ..
- rwxr-xr-x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">845</span> December <span style="color:#ae81ff">6</span> 01:30 teams.py
- rwxr-xr-x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1285</span> December <span style="color:#ae81ff">5</span> 23:08 templateConfigbackup.py
- rwxr-xr-x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1246</span> December <span style="color:#ae81ff">4</span> 04:42 templateNoShut.py
- rwxr-xr-x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1243</span> December <span style="color:#ae81ff">4</span> 04:41 templateShut.py
- rwxr-xr-x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1369</span> December <span style="color:#ae81ff">6</span> 00:45 templateVlan1.py
- rwxr-xr-x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1370</span> December <span style="color:#ae81ff">6</span> 00:46 templateVlan99.py
- rwxr-xr-x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1894</span> December <span style="color:#ae81ff">6</span> 06:22 template_switch.py
</code></pre></div><p>Connect the six buttons (<a href="http://akizukidenshi.com/catalog/g/gP-03647/">Tact Switch</a>)betweenthesixGPIOs(General-purposeinput/output)andGNDrespectively.AllowsthecodeintoacceptInput.Forthepinlayout,searchforitappropriatelyorfollowthemodelnumberofRaspberryPi.<a href="https://iot.keicode.com/raspberry-pi/pinout.php">Reference:RaspberryPi2/3Bpinarrangement(40pins)</a></p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/157325/89a682b5-c948-23bb-d66a-f1f9e21a09bb.jpeg" alt="IMG_1266.jpg"></p>
<p>*<a href="https://www.amazon.co.jp/dp/4062579774/">Color illustration: Learn the latest Raspberry Pi electronic work to understand how it works by making it (Bluebacks)</a>
<img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/157325/cb04e1c5-6181-bef6-4fdb-53e6c65db621.jpeg" alt="IMG_1342.jpg"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:template_switch.py" data-lang="python:template_switch.py"><span style="color:#75715e"># -*- coding: utf-8 -*-</span>

<span style="color:#f92672">import</span> RPi.GPIO <span style="color:#f92672">as</span> GPIO
<span style="color:#f92672">import</span> time
<span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> os

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    pin1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span>
    pin2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">13</span>
    pin3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>
    pin4 <span style="color:#f92672">=</span> <span style="color:#ae81ff">29</span>
    pin5 <span style="color:#f92672">=</span> <span style="color:#ae81ff">31</span>
    pin6 <span style="color:#f92672">=</span> <span style="color:#ae81ff">37</span>

    GPIO<span style="color:#f92672">.</span>setmode(GPIO<span style="color:#f92672">.</span>BOARD)
    GPIO<span style="color:#f92672">.</span>setup(pin1, GPIO<span style="color:#f92672">.</span>IN, pull_up_down <span style="color:#f92672">=</span> GPIO<span style="color:#f92672">.</span>PUD_UP)
    GPIO<span style="color:#f92672">.</span>setup(pin2, GPIO<span style="color:#f92672">.</span>IN, pull_up_down <span style="color:#f92672">=</span> GPIO<span style="color:#f92672">.</span>PUD_UP)
    GPIO<span style="color:#f92672">.</span>setup(pin3, GPIO<span style="color:#f92672">.</span>IN, pull_up_down <span style="color:#f92672">=</span> GPIO<span style="color:#f92672">.</span>PUD_UP)
    GPIO<span style="color:#f92672">.</span>setup(pin4, GPIO<span style="color:#f92672">.</span>IN, pull_up_down <span style="color:#f92672">=</span> GPIO<span style="color:#f92672">.</span>PUD_UP)
    GPIO<span style="color:#f92672">.</span>setup(pin5, GPIO<span style="color:#f92672">.</span>IN, pull_up_down <span style="color:#f92672">=</span> GPIO<span style="color:#f92672">.</span>PUD_UP)
    GPIO<span style="color:#f92672">.</span>setup(pin6, GPIO<span style="color:#f92672">.</span>IN, pull_up_down <span style="color:#f92672">=</span> GPIO<span style="color:#f92672">.</span>PUD_UP)

    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Waiting for button...&#34;</span>)
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;-- 6(noshut)-5(shut)-4(vlan1)-3(vlan99)-2(backup)-1(message) --&#34;</span>)

    <span style="color:#66d9ef">while</span> True:
        button1 <span style="color:#f92672">=</span> GPIO<span style="color:#f92672">.</span>input(pin1)
        button2 <span style="color:#f92672">=</span> GPIO<span style="color:#f92672">.</span>input(pin2)
        button3 <span style="color:#f92672">=</span> GPIO<span style="color:#f92672">.</span>input(pin3)
        button4 <span style="color:#f92672">=</span> GPIO<span style="color:#f92672">.</span>input(pin4)
        button5 <span style="color:#f92672">=</span> GPIO<span style="color:#f92672">.</span>input(pin5)
        button6 <span style="color:#f92672">=</span> GPIO<span style="color:#f92672">.</span>input(pin6)

        cmd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
        <span style="color:#66d9ef">if</span> button1 <span style="color:#f92672">==</span> False:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Bottun1-teams.py&#34;</span>)
            cmd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;python ./teams.py&#39;## I&#39;m working on it now ##&#39;&#34;</span>

        <span style="color:#66d9ef">elif</span> button2 <span style="color:#f92672">==</span> False:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Button2-templateConfigbackup.py&#34;</span>)
            cmd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;python ./templateConfigbackup.py&#34;</span>

        <span style="color:#66d9ef">elif</span> button3 <span style="color:#f92672">==</span> False:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Button3-templateVlan99.py&#34;</span>)
            cmd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;python ./templateVlan99.py&#34;</span>

        <span style="color:#66d9ef">elif</span> button4 <span style="color:#f92672">==</span> False:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Button4-templateVlan1.py&#34;</span>)
            cmd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;python ./templateVlan1.py&#34;</span>

        <span style="color:#66d9ef">elif</span> button5 <span style="color:#f92672">==</span> False:<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Button5-templateShut.py&#34;</span>)
            cmd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;python ./templateShut.py&#34;</span>

        <span style="color:#66d9ef">elif</span> button6 <span style="color:#f92672">==</span> False:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Button6-templateNoShut.py&#34;</span>)
            cmd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;python ./templateNoShut.py&#34;</span>

        <span style="color:#66d9ef">if</span> cmd <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span>:
            ret <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>popen(cmd)<span style="color:#f92672">.</span>readline()<span style="color:#f92672">.</span>strip()
            <span style="color:#66d9ef">print</span>(ret)
            time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)

        time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">0.1</span>)

    GPIO<span style="color:#f92672">.</span>cleanup()
</code></pre></div><h3 id="cisco-dna-center">Cisco DNA Center</h3>
<p>The target devices (two Catalyst 9300 in this example) must be pre-registered with Cisco DNA Center. (Procedure omitted)</p>
<h4 id="0-template-editor">0. Template Editor</h4>
<p>Register the Cisco IOS CLI using the Template Editor function from the Cisco DNA Center GUI. Variables that you want to complete dynamically are treated as variables by putting a dollar sign ($) in front of them, and you can complete them at the time of execution with a script or GUI.</p>
<h4 id="1-interface-shutno-shut">1. Interface shut/no shut</h4>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/157325/6eb3a398-0d53-fa5e-5cd6-29cbf3306465" alt="SS 2019-12-08 0.40.21.png">.png)</p>
<h4 id="2-change-vlan">2. Change Vlan</h4>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/157325/6ea09010-61fe-7db3-e34d-7b10ca53d594.png" alt="SS 2019-12-08 0.39.59.png"></p>
<h4 id="3-copy-config-to-file-server">3. Copy config to file server</h4>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/157325/3603345c-5cd8-9f27-fc11-4080e56267af.png" alt="SS 2019-12-08 0.41.07.png"></p>
<h4 id="4-archive-using-config-archive-function">4. Archive using config archive function</h4>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/157325/122ea012-51c9-5989-e69f-5fa0954d4271.png" alt="SS 2019-12-08 0.43.10.png"></p>
<h4 id="-ios-xe-settings-required-for-config-archive">* IOS-XE settings required for config archive</h4>
<pre><code class="language-cisco" data-lang="cisco">archive
 log config
  logging enable
  logging size 1000
  notify syslog contenttype plaintext
  hidekeys
 path ftp://&lt;ipaddress&gt;/ConfigBackup/Cat9300_demo1
!
ip ftp username &lt;ftpusername&gt;
ip ftp password &lt;ftppassword&gt;
</code></pre><h3 id="cisco-dna-center-apis-and-python-scripts">Cisco DNA Center APIs and Python scripts</h3>
<p>We use API of &ldquo;Deploy Template&rdquo; from various things.
In the following script sample, it is included in one for the sake of clarity such as token acquisition and path generation. (Usually, considering the efficiency and maintainability, I think that the files should be separated and imported.)</p>
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/157325/815538d5-5a65-cf5f-a42d-acc92a4a9219.png" alt="SS 2019-12-08 0.53.28.png"></p>
<h4 id="1-switch-port-shutno-shut">1. Switch port shut/no shut</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:templateNoShut.py" data-lang="python:templateNoShut.py"><span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> json

DNAC_URL <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;https://&lt;dnac_ip_address&gt;/api&#39;</span>
DNAC_USER <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&lt;username&gt;&#39;</span>
DNAC_PASSWORD <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&lt;password&gt;&#39;</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_token</span>(url, user, password):
    api_call <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/system/v1/auth/token&#39;</span>
    url <span style="color:#f92672">+=</span> api_call
    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(url<span style="color:#f92672">=</span>url, auth<span style="color:#f92672">=</span>(user, password), verify<span style="color:#f92672">=</span>False)<span style="color:#f92672">.</span>json()
    <span style="color:#66d9ef">return</span> response[<span style="color:#e6db74">&#34;Token&#34;</span>]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">deploy</span>(token):
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;X-Auth-Token&#39;</span>: token,
        <span style="color:#e6db74">&#39;content-type&#39;</span>:<span style="color:#e6db74">&#39;application/json&#39;</span>
        }
    url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://&lt;dnac_ip_address&gt;/api/v1/template-programmer/template/deploy&#34;</span>
    
    payload <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;templateId&#34;</span>: <span style="color:#e6db74">&#34;&lt;template_id&gt;&#34;</span>,
        <span style="color:#e6db74">&#34;forcePushTemplate&#34;</span>: <span style="color:#e6db74">&#34;true&#34;</span>,
        <span style="color:#e6db74">&#34;targetInfo&#34;</span>: [
            {
                <span style="color:#75715e">#LED has one port, so this script only specifies one switch</span>
                <span style="color:#e6db74">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;&lt;device_ip&gt;&#34;</span>,
                <span style="color:#75715e">#To switch between shut or no shut by specifying the parameter here</span>
                <span style="color:#e6db74">&#34;params&#34;</span>: {
                    <span style="color:#e6db74">&#34;shutnoshut&#34;</span>: <span style="color:#e6db74">&#34;no shut&#34;</span>
                },
                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;MANAGED_DEVICE_IP&#34;</span>
            }
        ],
        }

    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(url<span style="color:#f92672">=</span>url, data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(payload), headers<span style="color:#f92672">=</span>headers, verify<span style="color:#f92672">=</span>False)
    <span style="color:#66d9ef">print</span>(response)

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;__main__&#39;</span>:
    token <span style="color:#f92672">=</span> get_token(DNAC_URL, DNAC_USER, DNAC_PASSWORD)
    deploy(token)
</code></pre></div><h4 id="2-change-vlan-1">2. Change Vlan</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:templateVlan99.py" data-lang="python:templateVlan99.py"><span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> json

DNAC_URL <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;https://&lt;dnac_ip_address&gt;/api&#39;</span>
DNAC_USER <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&lt;username&gt;&#39;</span>
DNAC_PASSWORD <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&lt;password&gt;&#39;</span>
<span style="color:#75715e">#This setting is for multiple units, in this example we are executing for two units</span>
ips <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;&lt;ip_address_1&gt;&#34;</span>, <span style="color:#e6db74">&#34;&lt;ip_address_2&gt;&#34;</span>]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_token</span>(url, user, password):
    api_call <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/system/v1/auth/token&#39;</span>
    url <span style="color:#f92672">+=</span> api_call
    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(url<span style="color:#f92672">=</span>url, auth<span style="color:#f92672">=</span>(user, password), verify<span style="color:#f92672">=</span>False)<span style="color:#f92672">.</span>json()
    <span style="color:#66d9ef">return</span> response[<span style="color:#e6db74">&#34;Token&#34;</span>]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">deploy</span>(token, ipaddr):
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;X-Auth-Token&#39;</span>: token,
        <span style="color:#e6db74">&#39;content-type&#39;</span>:<span style="color:#e6db74">&#39;application/json&#39;</span>
        }
    url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://&lt;dnac_ip_address&gt;/api/v1/template-programmer/template/deploy&#34;</span>
    
    payload <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#34;templateId&#34;</span>: <span style="color:#e6db74">&#34;&lt;template_id&gt;&#34;</span>,
        <span style="color:#e6db74">&#34;forcePushTemplate&#34;</span>: <span style="color:#e6db74">&#34;true&#34;</span>,
        <span style="color:#e6db74">&#34;targetInfo&#34;</span>: [
            {
                <span style="color:#e6db74">&#34;id&#34;</span>: ipaddr,
                If there are multiple variables <span style="color:#f92672">in</span> <span style="color:#75715e">#Template, specify them here as well.</span>
                The value of <span style="color:#75715e">#Vlan and the interface name are specified.</span>
                <span style="color:#e6db74">&#34;params&#34;</span>: {
                    <span style="color:#e6db74">&#34;vlan&#34;</span>: <span style="color:#e6db74">&#34;99&#34;</span>,
                    <span style="color:#e6db74">&#34;interface&#34;</span>: <span style="color:#e6db74">&#34;range GigabitEthernet 1/0/6-10&#34;</span>
                },
                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;MANAGED_DEVICE_IP&#34;</span>
            }
        ],
        }

    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(url<span style="color:#f92672">=</span>url, data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(payload), headers<span style="color:#f92672">=</span>headers, verify<span style="color:#f92672">=</span>False)
    <span style="color:#66d9ef">print</span>(response)

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;__main__&#39;</span>:
    token <span style="color:#f92672">=</span> get_token(DNAC_URL, DNAC_USER, DNAC_PASSWORD)
    <span style="color:#66d9ef">for</span> ip <span style="color:#f92672">in</span> ips:
        deploy(token, ip)
</code></pre></div><h4 id="3-copy-ios-config-to-file-server">3. Copy IOS config to file server</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:templateConfigbackup.py" data-lang="python:templateConfigbackup.py"><span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> json

DNAC_URL <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;https://&lt;dnac_ip_address&gt;/api&#39;</span>
DNAC_USER <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&lt;username&gt;&#39;</span>
DNAC_PASSWORD <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&lt;password&gt;&#39;</span>
<span style="color:#75715e">#This setting is for multiple units, in this example we are executing for two units</span>
ips <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;&lt;ip_address_1&gt;&#34;</span>, <span style="color:#e6db74">&#34;&lt;ip_address_2&gt;&#34;</span>]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_token</span>(url, user, password):
    api_call <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;/system/v1/auth/token&#39;</span>
    url <span style="color:#f92672">+=</span> api_call
    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(url<span style="color:#f92672">=</span>url, auth<span style="color:#f92672">=</span>(user, password), verify<span style="color:#f92672">=</span>False)<span style="color:#f92672">.</span>json()<span style="color:#66d9ef">return</span> response[<span style="color:#e6db74">&#34;Token&#34;</span>]

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">deploy</span>(token, ipaddr):
    headers <span style="color:#f92672">=</span> {
        <span style="color:#e6db74">&#39;X-Auth-Token&#39;</span>: token,
        <span style="color:#e6db74">&#39;content-type&#39;</span>:<span style="color:#e6db74">&#39;application/json&#39;</span>
        }
    url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://10.71.130.53/api/v1/template-programmer/template/deploy&#34;</span>
    
    payload <span style="color:#f92672">=</span> {
        This <span style="color:#f92672">is</span> the simplest pattern <span style="color:#f92672">in</span> the <span style="color:#75715e"># template that does not handle variables.</span>
        <span style="color:#75715e"># Two types of config backup methods are available for demonstration.</span>
        <span style="color:#75715e">#&#34;templateId&#34;: &#34;&lt;template_id_1&gt;&#34;,</span>
        <span style="color:#e6db74">&#34;templateId&#34;</span>: <span style="color:#e6db74">&#34;&lt;template_id_2&gt;&#34;</span>,
        <span style="color:#e6db74">&#34;forcePushTemplate&#34;</span>: <span style="color:#e6db74">&#34;true&#34;</span>,
        <span style="color:#e6db74">&#34;targetInfo&#34;</span>: [
            {
                <span style="color:#e6db74">&#34;id&#34;</span>: ipaddr,
                <span style="color:#e6db74">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;MANAGED_DEVICE_IP&#34;</span>
            }
        ],
        }

    response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(url<span style="color:#f92672">=</span>url, data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(payload), headers<span style="color:#f92672">=</span>headers, verify<span style="color:#f92672">=</span>False)
    <span style="color:#66d9ef">print</span>(response)

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span><span style="color:#e6db74">&#39;__main__&#39;</span>:
    token <span style="color:#f92672">=</span> get_token(DNAC_URL, DNAC_USER, DNAC_PASSWORD)
    <span style="color:#66d9ef">for</span> ip <span style="color:#f92672">in</span> ips:
        deploy(token, ip)
</code></pre></div><h4 id="4-message-notification-to-webex-team">4. Message notification to WebEx Team</h4>
<p>I was exhausted, so I just posted a fixed message. With the push of a button, someone will do a lot of communication checking, document the results and post them&hellip;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:teams.py" data-lang="python:teams.py"><span style="color:#75715e"># -*- coding: utf-8 -*-</span>
<span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> sys

ACCESS_TOKEN <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;access_token&gt;&#34;</span>
ROOM_ID <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&lt;room_id&gt;&#34;</span>
YOUR_MESSAGE <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>]

<span style="color:#75715e">#Create header</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">setHeaders</span>():
    accessToken_hdr <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Bearer&#39;</span> <span style="color:#f92672">+</span> ACCESS_TOKEN
    spark_header <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;Authorization&#39;</span>: accessToken_hdr,<span style="color:#e6db74">&#39;Content-Type&#39;</span>:<span style="color:#e6db74">&#39;application/json; charset=utf-8&#39;</span>}
    <span style="color:#66d9ef">return</span> spark_header

<span style="color:#75715e">#Post a message in space</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">postMsg</span>(the_header,roomId,message):
    message <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{&#34;roomId&#34;:&#34;&#39;</span> <span style="color:#f92672">+</span> roomId <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&#34;,&#34;text&#34;:&#34;&#39;</span> <span style="color:#f92672">+</span> message <span style="color:#f92672">+</span><span style="color:#e6db74">&#39;&#34;}&#39;</span>
    uri <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;https://api.ciscospark.com/v1/messages&#39;</span>
    resp <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(uri, data<span style="color:#f92672">=</span>message, headers<span style="color:#f92672">=</span>the_header)
    <span style="color:#66d9ef">print</span> resp

header<span style="color:#f92672">=</span>setHeaders()
postMsg(header,ROOM_ID,YOUR_MESSAGE)
</code></pre></div><p>#Summary</p>
<h3 id="anyone-can-do">Anyone can do</h3>
<p>Ultimate simplicity. How about doing common tasks with the push of a button?</p>
<h3 id="suitable-for-controller-use">Suitable for controller use</h3>
<p>If you access the device directly from the tact switch, for example by linking it to Ansible or using Netconf/Restconf, you don&rsquo;t need something like Cisco DNA Center. If you have a small number of devices, or if the content of the template is extremely customized for local operations, you may not want a controller.</p>
<p>On the other hand, people who are not in charge of the network in the first place, such as having a large number of switches (hundreds), not wanting scripts to absorb differences in operation between devices, or not wanting to ensure scalability and availability with script execution servers If you want to link the network operation with the application, or in such a case, it is better to have a controller.</p>
<p>For a wide area and leveled area (entire LAN, whole DC, etc.) via the controller, for local and custom operation areas (HQ WAN connection, etc.) directly without using the controller. It is good to use them properly. This frees you from the trouble of maintaining and managing playbooks.</p>
<h3 id="simple-and-generalized-script">Simple and generalized script</h3>
<p>Did you understand that the handling of network devices is hidden through the sample script? I was able to confirm that what was said on page 15 of the slide below was realized to some extent even with the most familiar operations (shut/no shut, vlan change, etc.).</p>
<p><a href="https://www.slideshare.net/CiscoJapan/interop-tokyo-2016-lanwansdn-apicem">[Interop Tokyo 2016] Introducing SDN Controller APIC-EM for LAN/WAN</a>
*APIC-EM is included in the entire Cisco DNA Center.</p>
<p>Of course, the functionality itself has evolved to a more intent-based basis, and in terms of the Cisco DNA Center, APIs such as Assurance, SD-Access, and application policies will give you a future feeling.</p>
<h3 id="cisco-dna-center-template-editor">Cisco DNA Center Template Editor</h3>
<p>The Cisco DNA Center is a network management platform positioned as an intent-based policy controller + data platform, but it can also be used as a macro controller that circulates frequently used configurations (CLI) like the Template Editor. It seems that common tasks can be automated by linking the CLI template with the upper script or another application and hitting the API.</p>
<h3 id="software-hardware-api-network-technicians">Software, Hardware, API, Network Technicians</h3>
<p>Although it is possible to do anything with software, many network shops will love it because they can&rsquo;t escape from hardware. There must have been times when everyone was excited about wiring to a rack. On the other hand, it was also an important mission to connect the network and the upper system using the API of the completely open network infrastructure, and to connect the automation linked with another system using the API. .. Network engineers who can connect hardware to software and business applications will have a bright future.</p>
<p>So sometimes it was a good time to play around with a breadboard and jumper wires.</p>
<h3 id="application">Application</h3>
<ul>
<li>Tactile switch used for input -&gt; Toggle switch, sensor input, etc.</li>
<li>Network operation -&gt; In addition to setting changes, communication confirmation test, route switching, etc.</li>
<li>Notification -&gt; In addition to mail and SNS, notification with changed LED lighting pattern, display on mini LCD etc.</li>
<li>Others -&gt; Record and record the operator with the camera</li>
</ul>
<p>There are many possibilities!</p>
<h1 id="used">Used</h1>
<ul>
<li><a href="https://www.switch-science.com/catalog/3050/">Raspberry Pi 3B</a>,breadboard,jumperwire(male/male,male/female), tact switch</li>
<li><a href="http://www.tp-link.jp/products/details/cat-43_TL-POE10R.html">PoE Splitter (TP-Link TL-POE10R)</a></li>
<li><a href="https://www.amazon.co.jp/gp/product/B01AALVG38/">LED wire light (2.1mm jack, 12V input)</a></li>
<li><a href="https://www.cisco.com/c/ja_jp/products/collateral/switches/catalyst-9300-series-switches/datasheet-c78-738977.html">Catalyst9300 24P</a> Two</li>
<li><a href="https://www.cisco.com/c/ja_jp/products/cloud-systems-management/dna-center/index.html#~resources">Cisco DNA Center</a> 1.3.1.3</li>
</ul>
<p>#Reference URL, book</p>
<ul>
<li><a href="https://blogs.cisco.com/developer/dna-center-template-programmer-api">Cisco blog for reference regarding template function</a></li>
<li><a href="https://developer.cisco.com/learning/tracks/dnacenter-programmability/dnac-rest-apis/dnac-template-prg/step/1">Quickly Deploy Configuration Templates with Cisco DNA Center Platform and Template Programmer</a></li>
<li><a href="https://gblogs.cisco.com/jp/2018/07/intent-based-networing-and-dna-center/">Intent-based Networking and DNA Center</a></li>
<li><a href="https://www.amazon.co.jp/dp/4062579774/">Color illustration: Learn the latest Raspberry Pi electronic work to understand how it works by making it (Bluebacks)</a></li>
<li><a href="https://torisky.com/%E3%83%A9%E3%82%BA%E3%83%91%E3%82%A4%EF%BC%9A%E3%82%BF%E3%82%AF%E3%83%88%E3%82%B9%E3%82%A4%E3%83%83%E3%83%81%E3%81%A7python%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E5%8B%95%E4%BD%9C/">Raspai: Run a Python program with Tact Switch-Life is unreadable blog</a></li>
<li><a href="https://qiita.com/kikuta1978/items/12f9ef8c5f7a64652b12">Network control with Alexa &hellip; incidentally coloring Christmas</a></li>
<li><a href="https://developer.cisco.com/codeexchange/">Cisco DevNet Code Exchange</a></li>
<li><a href="https://developer.cisco.com/learning/">Cisco DevNet Learning Labs</a></li>
</ul>
<h1 id="disclaimerthe-opinions-expressed-on-this-site-and-the-corresponding-comments-are-the-personal-opinions-of-the-author-and-not-cisco-the-content-on-this-site-is-provided-for-information-purposes-only-and-is-not-intended-as-a-recommendation-or-representation-by-cisco-or-any-other-party-each-user-is-solely-responsible-for-the-content-of-all-information-posted-linked-or-otherwise-uploaded-to-this-website-by-disclaiming-cisco-from-any-and-all-liability-for-the-use-of-this-website-i-agree">DisclaimerThe opinions expressed on this site and the corresponding comments are the personal opinions of the author and not Cisco. The content on this site is provided for information purposes only and is not intended as a recommendation or representation by Cisco or any other party. Each user is solely responsible for the content of all information posted, linked or otherwise uploaded to this website by disclaiming Cisco from any and all liability for the use of this website. I agree.</h1>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
