<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <meta name="generator" content="Hugo 0.72.0" />

  
  <meta name="description" content="Some description">
  

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://memotut.com/apple-touch-icon.png">

  
  <link rel="icon" type="image/png" sizes="32x32" href="https://memotut.com/favicon-32x32.png">

  
  <link rel="icon" type="image/png" sizes="16x16" href="https://memotut.com/favicon-16x16.png">

  
  <link rel="manifest" href="https://memotut.com/site.webmanifest">

  
  <link rel="mask-icon" href="https://memotut.com/safari-pinned-tab.svg" color="#5bbad5">

  <meta name="msapplication-TileColor" content="#da532c">

  <meta name="theme-color" content="#ffffff">

  
  <link rel="stylesheet" href="https://memotut.com/css/bootstrap.min.css" />

  
  <title>[Python] First data analysis/machine learning (Kaggle) | Memo Tut</title>
  

  <style>
body {
  min-width: 300px;
}

.custom-navbar {
  margin-bottom: 1em;
  height: 60px;
}

.custom-navbar a {
  display: inline-block; 
  padding: 18px 0;
  margin-right: 1em; 
  font-weight: bold; 
}

.custom-navbar a:hover,
.custom-navbar a:focus {
  text-decoration: none; 
}

@media print {
  .custom-navbar {
    display: none;
  }
}

article {
  padding-bottom: 1em;
}

img {
  max-width: 100%;
}


body {
  background-color: #fff;
}



body {
  color: #212529;
}



a {
  color: #007bff;
}



a:hover,
a:focus {
  color: #0056b3;
}



.custom-navbar {
  background-color: #212529;
}



.custom-navbar a {
  color: rgba(255, 255, 255, 0.75);
}



.custom-navbar a:hover,
.custom-navbar a:focus {
  color: rgba(255, 255, 255, 1);
}



.container {
  max-width: 800px;
}



pre {
  display: block;
  padding: 9.5px;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}

pre code {
  padding: 0;
  font-size: inherit;
  color: inherit; 
  white-space: pre-wrap;
  background-color: transparent;
  border: none;
  border-radius: 0;
}

code {
  padding: 2px 4px;
  color: inherit; 
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: .9em;
}



blockquote,
.blockquote {
  padding: 10px 20px;
  margin: 0 0 20px;
  font-size: 1em;
  border-left: 5px solid #6c757d;
}

</style>
</head>

<body>
  <nav class="custom-navbar">
  <div class="container">
    
    <a href="/">Posts</a>
    
    <a href="/tags/">Tags</a>
    
    <a href="/about/">About</a>
    
    <a href="/index.xml">RSS</a>
    
  </div>
</nav>
  
  <div class="container">
    <article>
      <h1>[Python] First data analysis/machine learning (Kaggle)</h1>
<p>
  <small class="text-secondary">
  
  
  Mar 10, 2020
  </small>
  

<small><code><a href="https://memotut.com/tags/python">Python</a></code></small>


<small><code><a href="https://memotut.com/tags/beginner"> Beginner</a></code></small>


<small><code><a href="https://memotut.com/tags/datascience"> DataScience</a></code></small>


<small><code><a href="https://memotut.com/tags/kaggle"> Kaggle</a></code></small>


<small><code><a href="https://memotut.com/tags/titanic"> titanic</a></code></small>

</p>
<pre><code>#Introduction
</code></pre>
<p>As I was about to get a job (spring break in the fourth year of university), I suddenly wanted to become a data scientist, so I started working on Kaggle for the time being.</p>
<p>This time, I worked on a tutorial of <a href="https://www.kaggle.com/"><strong>Kaggle</strong></a>&quot;<a href="https://www.kaggle.com/c/Theproblemis%22titanic/overview"><strong>Titanic</strong></a>&rdquo;.</p>
<p>I have experience in statistical analysis in my research, but since I do not understand machine learning at all, I decided to study with reference to the code of the incredibly excellent person!</p>
<p>By the way, here is the reference
<a href="https://www.kaggle.com/arthurtok/introduction-to-ensembling-stacking-in-python">✔︎Introduction to Ensembling/Stacking in Python</a>
This code was described as &ldquo;Most voted&rdquo; in Notebook. (As of March 10, 2020)</p>
<p>I also referred to this article that referred to the above code lol
<a href="https://qiita.com/hkthirano/items/2c35a81fbc95f0e4b7c1">Ensemble (Stacking) Learning &amp; Machine Learning Tutorial in Python</a></p>
<p>#Introduction
The content of the Titanic competition that we are working on this time will be given data about passengers such as age, gender, number of people in the room, room class, life and death.</p>
<p>Based on that data,
** Data pre-processing
→ Data visualization
→ Stacking model construction
→Test data
→ Evaluation**</p>
<p>Finally, we will predict the life and death of passengers using a model constructed from test data. How well this prediction works is also a criterion for the score.</p>
<p>Since there is quite a lot of volume, in this article, I will focus on &ldquo;pre-processing&rdquo; and &ldquo;visualization of data&rdquo;**!</p>
<p>After building the model, I will post it in the next article!
Click here for sequel articles ↓ ↓ ↓
<a href="https://qiita.com/Julio_dev/items/4754a8dc545b7023e8c1">[Python] First data analysis/machine learning (Kaggle) ~Part2~</a></p>
<p>Now, let&rsquo;s start preprocessing the data! !</p>
<p>#Data preprocessing</p>
<h3 id="library-import">library import</h3>
<p>Roughly the library used this time</p>
<ul>
<li>Mathematical and statistical processing: numpy, pundas</li>
<li>Regular expression operation (searching or replacing specified words or numbers): <a href="https://www.lifewithpython.com/2014/10/re-regular-expression.html">re</a></li>
<li>I have various models~: <a href="https://techacademy.jp/magazine/17375">sklearn</a></li>
<li>Gradient boosting decision tree algorithm: <a href="http://tekenuko.hatenablog.com/entry/2016/09/22/220814">XGboost</a></li>
<li>Graphs and diagrams: matplotlib, seaborn, plotly</li>
<li>Show/Hide warnings: warnings</li>
<li>5 basic models
-<a href="https://qiita.com/mshinoda88/items/8bfe0b540b35437296bd">RandomForestClassifier</a>
-<a href="https://qiita.com/kibinag0/items/2e6740c58c1f2d2e119e">AdaBoostClassifier</a>
-<a href="https://qiita.com/temy13/items/a69a20f2c0d3cf11627c">GradientBoostingClassifier</a>
-<a href="https://future-chem.com/ames-random-forest/">ExtraTreesClassifier</a>
-<a href="http://neuro-educator.com/ml3/">SVC</a></li>
<li>It is <a href="https://qiita.com/kibinag0/items/1a29db61fcb8c527d952">Kfold</a> to apply these 5 model libraries at the same time.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:import_library.py" data-lang="python:import_library.py"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np
<span style="color:#f92672">import</span> re
<span style="color:#f92672">import</span> sklearn
<span style="color:#f92672">import</span> xgboost <span style="color:#f92672">as</span> xgb
<span style="color:#f92672">import</span> seaborn <span style="color:#f92672">as</span> sns
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">%</span>matplotlib inline

<span style="color:#f92672">import</span> plotly.offline <span style="color:#f92672">as</span> py
py<span style="color:#f92672">.</span>init_notebook_mode(connected<span style="color:#f92672">=</span>True)
<span style="color:#f92672">import</span> plotly.graph_objs <span style="color:#f92672">as</span> go
<span style="color:#f92672">import</span> plotly.tools <span style="color:#f92672">as</span> tls

<span style="color:#f92672">import</span> warnings
warnings<span style="color:#f92672">.</span>filterwarnings(<span style="color:#e6db74">&#39;ignore&#39;</span>)

<span style="color:#75715e"># 5 models</span>
<span style="color:#f92672">from</span> sklearn.ensemble <span style="color:#f92672">import</span> (RandomForestClassifier, AdaBoostClassifier,
                              (GradientBoostingClassifier, ExtraTreesClassifier)
<span style="color:#f92672">from</span> sklearn.svm <span style="color:#f92672">import</span> SVC

<span style="color:#75715e"># Adapt multiple machine learning libraries simultaneously</span>
<span style="color:#f92672">from</span> sklearn.cross_validation <span style="color:#f92672">import</span> KFold
</code></pre></div><h3 id="get-data">Get data</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:import_data.py" data-lang="python:import_data.py">train <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;../input/train.csv&#39;</span>)
test <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;../input/test.csv&#39;</span>)

<span style="color:#75715e"># Make Passenger ID hold passenger ID</span>
PassengerId <span style="color:#f92672">=</span> test[<span style="color:#e6db74">&#39;PassengerId&#39;</span>]

train<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">3</span>)
</code></pre></div><p>output
<img width="978" alt="Screenshot 2020-03-10 16.13.20.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/383306/1d3cb07c-89df-aebe-beab-0f8d9258fd22.png"></p>
<p>Data description</p>
<ul>
<li>PassengerId: Passenger ID</li>
<li>Survived: Life/Death flag (1 if surviving, 0 if dying)</li>
<li>Pclass: Ticket class</li>
<li>Name: Passenger name</li>
<li>Sex: sex</li>
<li>Age: Age</li>
<li>SibSp: brother/spouse on board</li>
<li>Parch: Parents/children on board</li>
<li>fare: Fee</li>
<li>cabin: guest room number</li>
<li>Embarked: Port on board</li>
</ul>
<h3 id="feature-engineering">Feature engineering</h3>
<p>We will process the acquired data to make it easier to analyze.
This <strong>preprocessing seems to be quite important</strong> in machine learning, so I&rsquo;ll do my best, though it&rsquo;s long! !</p>
<p>Basically, all missing values (no values) and character data are converted to numerical data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:FeatureEngineering.py" data-lang="python:FeatureEngineering.py">full_data <span style="color:#f92672">=</span> [train, test]

<span style="color:#75715e"># Passenger name length</span>
train[<span style="color:#e6db74">&#39;name_length&#39;</span>] <span style="color:#f92672">=</span> train[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#f92672">.</span>apply(len)
test[<span style="color:#e6db74">&#39;name_length&#39;</span>] <span style="color:#f92672">=</span> test[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#f92672">.</span>apply(len)

<span style="color:#75715e">#1 if there is room number data, 0 if missing value</span>
train[<span style="color:#e6db74">&#39;Has_Cabin&#39;</span>] <span style="color:#f92672">=</span> train[<span style="color:#e6db74">&#39;Cabin&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">if</span> type(x) <span style="color:#f92672">==</span> float <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">1</span>)
test[<span style="color:#e6db74">&#39;Has_Cabin&#39;</span>] <span style="color:#f92672">=</span> test[<span style="color:#e6db74">&#39;Cabin&#39;</span>]<span style="color:#f92672">.</span>apply(<span style="color:#66d9ef">lambda</span> x: <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">if</span> type(x) <span style="color:#f92672">==</span> float <span style="color:#66d9ef">else</span> <span style="color:#ae81ff">1</span>)

<span style="color:#75715e">#Define family size from &#34;Number of siblings/spouse&#34; and &#34;Number of parents/children&#34; riding in Titanic</span>
<span style="color:#66d9ef">for</span> dataset <span style="color:#f92672">in</span> full_data:
    dataset [<span style="color:#e6db74">&#39;FamilySize&#39;</span>] <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Sibsp&#39;</span>] <span style="color:#f92672">+</span> dataset[<span style="color:#e6db74">&#39;Parch&#39;</span>] <span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>

<span style="color:#75715e">#If there is no family, &#34;Is Alone&#34; is 1</span>
<span style="color:#66d9ef">for</span> dataset <span style="color:#f92672">in</span> full_data:
    dataset[<span style="color:#e6db74">&#39;IsAlone&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    dataset<span style="color:#f92672">.</span>loc[dataset[<span style="color:#e6db74">&#39;FamilySize&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#39;IsAlone&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>

<span style="color:#75715e">#Set the most missing value at the port of departure as&#39;S&#39;</span>
<span style="color:#66d9ef">for</span> dataset <span style="color:#f92672">in</span> full_data:
    dataset[<span style="color:#e6db74">&#39;Embarked&#39;</span>] <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Embarked&#39;</span>]<span style="color:#f92672">.</span>fillna(<span style="color:#e6db74">&#39;S&#39;</span>)

<span style="color:#75715e">#Set missing value of median as median</span>
<span style="color:#75715e">#Price is divided into 4 groups</span>
<span style="color:#66d9ef">for</span> dataset <span style="color:#f92672">in</span> full_data:
    dataset[<span style="color:#e6db74">&#39;Fare&#39;</span>] <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Fare&#39;</span>]<span style="color:#f92672">.</span>fillna(train[<span style="color:#e6db74">&#39;Fare&#39;</span>]<span style="color:#f92672">.</span>median())
train[<span style="color:#e6db74">&#39;CategoricalFare&#39;</span>] <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>qcut(train[<span style="color:#e6db74">&#39;Fare&#39;</span>], <span style="color:#ae81ff">4</span>)

<span style="color:#75715e"># Divide age into 5 groups</span>
<span style="color:#66d9ef">for</span> dataset <span style="color:#f92672">in</span> full_data:
    age_avg <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Age&#39;</span>]<span style="color:#f92672">.</span>mean()
    age_std <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Age&#39;</span>]<span style="color:#f92672">.</span>std()
    age_null_count <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Age&#39;</span>]<span style="color:#f92672">.</span>isnull()<span style="color:#f92672">.</span>sum()
    <span style="color:#75715e">#List of random values to put in missing values</span>
    <span style="color:#75715e">#Use a value that is larger or smaller than the average value by the deviation</span>
    age_null_random_list <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>randint(age_avg<span style="color:#f92672">-</span>age_std, age_avg <span style="color:#f92672">+</span> age_std, size <span style="color:#f92672">=</span> age_null_count)
    dataset[<span style="color:#e6db74">&#39;Age&#39;</span>][np<span style="color:#f92672">.</span>isnan(dataset[<span style="color:#e6db74">&#39;Age&#39;</span>])] <span style="color:#f92672">=</span> age_null_random_list
    <span style="color:#75715e"># Convert data to int type</span>
    dataset[<span style="color:#e6db74">&#39;Age&#39;</span>] <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Age&#39;</span>]<span style="color:#f92672">.</span>astype(int)

train[<span style="color:#e6db74">&#39;CategoricalAge&#39;</span>] <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>qcut(train[<span style="color:#e6db74">&#39;Age&#39;</span>],<span style="color:#ae81ff">5</span>)

<span style="color:#75715e">#Define the function get_title that retrieves the name</span>
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_title</span>(name):
    title_search <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#39;([A-Za-z]+)\.&#39;</span>,name)
    <span style="color:#75715e">#If there is a name, take it out and return it</span>
    <span style="color:#66d9ef">if</span> title_search:
       <span style="color:#66d9ef">return</span> title_search<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>)
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>

<span style="color:#75715e">#Use function get_title</span>
<span style="color:#66d9ef">for</span> dataset <span style="color:#f92672">in</span> ftll_data:
    dataset[<span style="color:#e6db74">&#39;Title&#39;</span>] <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Name&#39;</span>]<span style="color:#f92672">.</span>apply(get_title)

    <span style="color:#75715e">#Correct the mistake in entering the namedataset[&#39;Title&#39;] = dataset[&#39;Title&#39;].replace([&#39;Lady&#39;,&#39;Countess&#39;,&#39;Capt&#39;,&#39;Col&#39;,&#39;Don&#39;,&#39;Dr&#39;,&#39;Major&#39;,&#39;Rev&#39;, &#39; Sir&#39;,&#39;Jonkheer&#39;,&#39;Dona&#39;],&#39;Rare&#39;)</span>

    dataset[<span style="color:#e6db74">&#39;Title&#39;</span>] <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Title&#39;</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;Mlle&#39;</span>,<span style="color:#e6db74">&#39;Miss&#39;</span>)
    dataset[<span style="color:#e6db74">&#39;Title&#39;</span>] <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Title&#39;</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;Ms&#39;</span>,<span style="color:#e6db74">&#39;Miss&#39;</span>)
    dataset[<span style="color:#e6db74">&#39;Title&#39;</span>] <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Title&#39;</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;Mme&#39;</span>,<span style="color:#e6db74">&#39;Mrs&#39;</span>)

<span style="color:#66d9ef">for</span> dataset <span style="color:#f92672">in</span> full_data:
    <span style="color:#75715e"># 0 for women, 1 for men</span>
    dataset[<span style="color:#e6db74">&#39;Sex&#39;</span>] <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Sex&#39;</span>]<span style="color:#f92672">.</span>map( {<span style="color:#e6db74">&#39;female&#39;</span>: <span style="color:#ae81ff">0</span>,<span style="color:#e6db74">&#39;male&#39;</span>: <span style="color:#ae81ff">1</span>} )<span style="color:#f92672">.</span>astype(int)

    <span style="color:#75715e"># Labels for 5 types of names</span>
    title_mapping <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;Mr&#34;</span>: <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;Miss&#34;</span>: <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#34;Mrs&#34;</span>: <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;Master&#34;</span>: <span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;Rare&#34;</span>: <span style="color:#ae81ff">5</span>}
    dataset[<span style="color:#e6db74">&#39;Title&#39;</span>] <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Title&#39;</span>]<span style="color:#f92672">.</span>map(title_mapping)
    dataset[<span style="color:#e6db74">&#39;Title&#39;</span>] <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Title&#39;</span>]<span style="color:#f92672">.</span>fillna(<span style="color:#ae81ff">0</span>)

    <span style="color:#75715e"># Labels for 3 types of departure ports</span>
    dataset[<span style="color:#e6db74">&#39;Embarked&#39;</span>] <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Embarked&#39;</span>]<span style="color:#f92672">.</span>map( {<span style="color:#e6db74">&#39;S&#39;</span>: <span style="color:#ae81ff">0</span>,<span style="color:#e6db74">&#39;C&#39;</span>: <span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#39;Q&#39;</span>: <span style="color:#ae81ff">2</span>} )<span style="color:#f92672">.</span>astype(int)

    <span style="color:#75715e"># Divide charges into 4 groups</span>
    dataset<span style="color:#f92672">.</span>loc[ dataset[<span style="color:#e6db74">&#39;Fare&#39;</span>] <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">7.91</span>,<span style="color:#e6db74">&#39;Fare&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    dataset<span style="color:#f92672">.</span>loc[(dataset[<span style="color:#e6db74">&#39;Fare&#39;</span>] <span style="color:#f92672">&gt;</span><span style="color:#ae81ff">7.91</span>) <span style="color:#f92672">&amp;</span> (dataset[<span style="color:#e6db74">&#39;Fare&#39;</span>] <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">14.454</span>),<span style="color:#e6db74">&#39;Fare&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    dataset<span style="color:#f92672">.</span>loc[(dataset[<span style="color:#e6db74">&#39;Fare&#39;</span>] <span style="color:#f92672">&gt;</span><span style="color:#ae81ff">14.454</span>) <span style="color:#f92672">&amp;</span> (dataset[<span style="color:#e6db74">&#39;Fare&#39;</span>] <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">31</span>),<span style="color:#e6db74">&#39;Fare&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
    dataset<span style="color:#f92672">.</span>loc[ dataset[<span style="color:#e6db74">&#39;Fare&#39;</span>]<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">31</span>,<span style="color:#e6db74">&#39;Fare&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
    dataset[<span style="color:#e6db74">&#39;Fare&#39;</span>] <span style="color:#f92672">=</span> dataset[<span style="color:#e6db74">&#39;Fare&#39;</span>]<span style="color:#f92672">.</span>astype(int)

    <span style="color:#75715e"># Divide age into 5 groups</span>
    dataset<span style="color:#f92672">.</span>loc[ dataset[<span style="color:#e6db74">&#39;Age&#39;</span>] <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">16</span>,<span style="color:#e6db74">&#39;Age&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    dataset<span style="color:#f92672">.</span>loc[(dataset[<span style="color:#e6db74">&#39;Age&#39;</span>] <span style="color:#f92672">&gt;</span><span style="color:#ae81ff">16</span>) <span style="color:#f92672">&amp;</span> (dataset[<span style="color:#e6db74">&#39;Age&#39;</span>] <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">32</span>),<span style="color:#e6db74">&#39;Age&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    dataset<span style="color:#f92672">.</span>loc[(dataset[<span style="color:#e6db74">&#39;Age&#39;</span>] <span style="color:#f92672">&gt;</span><span style="color:#ae81ff">32</span>) <span style="color:#f92672">&amp;</span> (dataset[<span style="color:#e6db74">&#39;Age&#39;</span>] <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">48</span>),<span style="color:#e6db74">&#39;Age&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
    dataset<span style="color:#f92672">.</span>loc[(dataset[<span style="color:#e6db74">&#39;Age&#39;</span>] <span style="color:#f92672">&gt;</span><span style="color:#ae81ff">48</span>) <span style="color:#f92672">&amp;</span> (dataset[<span style="color:#e6db74">&#39;Age&#39;</span>] <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">64</span>),<span style="color:#e6db74">&#39;Age&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
    dataset<span style="color:#f92672">.</span>loc[ dataset[<span style="color:#e6db74">&#39;Age&#39;</span>]<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">64</span>,<span style="color:#e6db74">&#39;Age&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;

<span style="color:#75715e"># Remove unnecessary features</span>
drop_elements <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;PassengerId&#39;</span>,<span style="color:#e6db74">&#39;Name&#39;</span>,<span style="color:#e6db74">&#39;Ticket&#39;</span>,<span style="color:#e6db74">&#39;Cabin&#39;</span>,<span style="color:#e6db74">&#39;SibSp&#39;</span>]
train <span style="color:#f92672">=</span> train<span style="color:#f92672">.</span>drop(drop_elements, axis <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
train <span style="color:#f92672">=</span> train<span style="color:#f92672">.</span>drop([<span style="color:#e6db74">&#39;CategoricalAge&#39;</span>,<span style="color:#e6db74">&#39;CategoricalFare&#39;</span>], axis <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
test <span style="color:#f92672">=</span> test<span style="color:#f92672">.</span>drop(drop_elements, axis <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)

</code></pre></div><p>Coding learned</p>
<ul>
<li>How to use lambda function</li>
<li>fillna()</li>
<li>pandas qcut</li>
<li>map function</li>
<li>Input the value only when it is True in [] of loc[] without using if statement</li>
<li>axis = 1</li>
</ul>
<p>#Data visualization
Finally the pre-processing is over! !
Let&rsquo;s make sure that all data are numerical data!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:visualize.py" data-lang="python:visualize.py">train<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">3</span>)
</code></pre></div><img width="714" alt="Screenshots 2020-03-10 17.25.59.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/383306/addf0bed-2460-6b31-130d-d45db9c839b0.png">
<h3 id="peason-correlation-heatmap">Peason Correlation Heatmap</h3>
<p>Check the correlation between the features with the heat map.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:heatmap.py" data-lang="python:heatmap.py">colormap <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>cm<span style="color:#f92672">.</span>RdBu
plt<span style="color:#f92672">.</span>figure(figsize <span style="color:#f92672">=</span> (<span style="color:#ae81ff">14</span>,<span style="color:#ae81ff">12</span>))
plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;Peason Correlation of Features&#39;</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.05</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>)
sns<span style="color:#f92672">.</span>heatmap(train<span style="color:#f92672">.</span>astype(float)<span style="color:#f92672">.</span>corr(), linewidths<span style="color:#f92672">=</span><span style="color:#ae81ff">0.1</span>, vmax<span style="color:#f92672">=</span><span style="color:#ae81ff">1.0</span>, square <span style="color:#f92672">=</span> True, cmap<span style="color:#f92672">=</span>colormap, linecolor<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;white&#39;</span>, annot<span style="color:#f92672">=</span>True)
</code></pre></div><img width="755" alt="Screenshot 2020-03-10 17.32.26.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/383306/479dfdd1-bcf9-c76b-a075-8dc9b0043d30.png">
<p>From this plot, we can see that the features are not so strongly correlated to each other.</p>
<p>Features are independent of each other
→ No useless features
→Important for building a learning model
(Parch and FamilySize have a relatively strong correlation, but we will leave them as they are.)</p>
<h3 id="pair-plot">Pair Plot</h3>
<p>Distribution of data from one feature to another</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python:PairPlot.py" data-lang="python:PairPlot.py">g <span style="color:#f92672">=</span> sns<span style="color:#f92672">.</span>pairplot(train[[<span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Survived&#39;</span>, <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Pclass&#39;</span>, <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Sex&#39;</span>, <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Age&#39;</span>, <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Parch&#39;</span>, <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Fare&#39;</span>, <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Embarked&#39;</span>,
       <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;FamilySize&#39;</span>, <span style="color:#e6db74">u</span><span style="color:#e6db74">&#39;Title&#39;</span>]], hue<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Survived&#39;</span>, palette <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;seismic&#39;</span>,size<span style="color:#f92672">=</span><span style="color:#ae81ff">1.2</span>,diag_kind <span style="color:#f92672">=</span><span style="color:#e6db74">&#39;kde&#39;</span>,diag_kws<span style="color:#f92672">=</span>dict(shade<span style="color:#f92672">=</span>True),plot_kws<span style="color:#f92672">=</span>dict(s<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span> ))
g<span style="color:#f92672">.</span>set(xticklabels<span style="color:#f92672">=</span>[])
</code></pre></div><img width="720" alt="Screenshot 2020-03-10 17.40.00.png" src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/383306/e5a2a2be-b704-06e4-7d58-14bf79a7e777.png">
<p>#Summary
In this article, we worked on the Kaggle tutorial &ldquo;Titanic&rdquo;.
As a flow,</p>
<ol>
<li>Import the library</li>
<li>Acquisition of data</li>
<li>Data pre-processing
-Eliminate missing values (randomly insert values close to the average value, etc.)
-Data division
-Convert category data to numbers</li>
<li>Data visualization
-Pearson correlation heatmap
-Pair plot</li>
</ol>
<p>It was quite difficult even up to this point, but since it is the production of model building from here, I will continue to do my best! !</p>

    </article>
  </div>

  
  
  
  <script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-169005401-1', 'auto');
  ga('send', 'pageview');
  </script>
  <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  

  
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
window.addEventListener("load", function(){
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#216942",
      "text": "#b2d192"
    },
    "button": {
      "background": "#afed71"
    }
  }
})});
</script>

</body>

</html>
